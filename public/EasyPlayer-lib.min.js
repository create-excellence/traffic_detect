!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.videojs=t()}(this,function(){var e="7.2.4",t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t){return e(t={exports:{}},t.exports),t.exports}var r,n="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},a={},s=Object.freeze({default:a}),o=s&&a||s,u=void 0!==t?t:"undefined"!=typeof window?window:{};"undefined"!=typeof document?r=document:(r=u["__GLOBAL_DOCUMENT_CACHE@4"])||(r=u["__GLOBAL_DOCUMENT_CACHE@4"]=o);var l=r,c=void 0,d="info",h=[],f=function(e,t){var i=c.levels[d],r=new RegExp("^("+i+")$");if("log"!==e&&t.unshift(e.toUpperCase()+":"),h&&h.push([].concat(t)),t.unshift("VIDEOJS:"),n.console){var a=n.console[e];a||"debug"!==e||(a=n.console.info||n.console.log),a&&i&&r.test(e)&&a[Array.isArray(t)?"apply":"call"](n.console,t)}};(c=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];f("log",t)}).levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:d},c.level=function(e){if("string"==typeof e){if(!c.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');d=e}return d},c.history=function(){return h?[].concat(h):[]},c.history.clear=function(){h&&(h.length=0)},c.history.disable=function(){null!==h&&(h.length=0,h=null)},c.history.enable=function(){null===h&&(h=[])},c.error=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return f("error",t)},c.warn=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return f("warn",t)},c.debug=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return f("debug",t)};var p=c;var m=function(e){for(var t="",i=0;i<arguments.length;i++)t+=(r=e[i],r.replace(/\n\r?\s*/g,"")+(arguments[i+1]||""));var r;return t},g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},b=function(e,t){return e.raw=t,e},T=Object.prototype.toString,S=function(e){return w(e)?Object.keys(e):[]};function E(e,t){S(e).forEach(function(i){return t(e[i],i)})}function k(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return Object.assign?Object.assign.apply(Object,[e].concat(i)):(i.forEach(function(t){t&&E(t,function(t,i){e[i]=t})}),e)}function w(e){return!!e&&"object"===(void 0===e?"undefined":g(e))}function A(e){return w(e)&&"[object Object]"===T.call(e)&&e.constructor===Object}function L(e,t){if(!e||!t)return"";if("function"==typeof n.getComputedStyle){var i=n.getComputedStyle(e);return i?i[t]:""}return""}var C=b(["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."],["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."]);function R(e){return"string"==typeof e&&/\S/.test(e)}function O(e){if(/\s/.test(e))throw new Error("class has illegal whitespace characters")}function D(){return l===n.document}function I(e){return w(e)&&1===e.nodeType}function P(){try{return n.parent!==n.self}catch(e){return!0}}function x(e){return function(t,i){if(!R(t))return l[e](null);R(i)&&(i=l.querySelector(i));var r=I(i)?i:l;return r[e]&&r[e](t)}}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3],n=l.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){var i=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?(p.warn(m(C,e,i)),n.setAttribute(e,i)):"textContent"===e?U(n,i):n[e]=i}),Object.getOwnPropertyNames(i).forEach(function(e){n.setAttribute(e,i[e])}),r&&te(n,r),n}function U(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function N(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function B(e,t){return O(t),e.classList?e.classList.contains(t):(i=t,new RegExp("(^|\\s)"+i+"($|\\s)")).test(e.className);var i}function F(e,t){return e.classList?e.classList.add(t):B(e,t)||(e.className=(e.className+" "+t).trim()),e}function j(e,t){return e.classList?e.classList.remove(t):(O(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e}function G(e,t,i){var r=B(e,t);if("function"==typeof i&&(i=i(e,t)),"boolean"!=typeof i&&(i=!r),i!==r)return i?F(e,t):j(e,t),e}function V(e,t){Object.getOwnPropertyNames(t).forEach(function(i){var r=t[i];null===r||void 0===r||!1===r?e.removeAttribute(i):e.setAttribute(i,!0===r?"":r)})}function H(e){var t={},i=",autoplay,stretch,fluent,controls,playsinline,loop,muted,default,defaultMuted,";if(e&&e.attributes&&e.attributes.length>0)for(var r=e.attributes,n=r.length-1;n>=0;n--){var a=r[n].name,s=r[n].value;"boolean"!=typeof e[a]&&-1===i.indexOf(","+a+",")||(s=null!==s),t[a]=s}return t}function z(e,t){return e.getAttribute(t)}function W(e,t,i){e.setAttribute(t,i)}function q(e,t){e.removeAttribute(t)}function K(){l.body.focus(),l.onselectstart=function(){return!1}}function X(){l.onselectstart=function(){return!0}}function Y(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),i.height||(i.height=parseFloat(L(e,"height"))),i.width||(i.width=parseFloat(L(e,"width"))),i}}function $(e){var t=void 0;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var i=l.documentElement,r=l.body,a=i.clientLeft||r.clientLeft||0,s=n.pageXOffset||r.scrollLeft,o=t.left+s-a,u=i.clientTop||r.clientTop||0,c=n.pageYOffset||r.scrollTop,d=t.top+c-u;return{left:Math.round(o),top:Math.round(d)}}function Q(e,t){var i={},r=$(e),n=e.offsetWidth,a=e.offsetHeight,s=r.top,o=r.left,u=t.pageY,l=t.pageX;return t.changedTouches&&(l=t.changedTouches[0].pageX,u=t.changedTouches[0].pageY),i.y=Math.max(0,Math.min(1,(s-u+a)/a)),i.x=Math.max(0,Math.min(1,(l-o)/n)),i}function J(e){return w(e)&&3===e.nodeType}function Z(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function ee(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),I(e)||J(e)?e:"string"==typeof e&&/\S/.test(e)?l.createTextNode(e):void 0}).filter(function(e){return e})}function te(e,t){return ee(t).forEach(function(t){return e.appendChild(t)}),e}function ie(e,t){return te(Z(e),t)}function re(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||0===e.button&&1===e.buttons)}var ne=x("querySelector"),ae=x("querySelectorAll"),se=Object.freeze({isReal:D,isEl:I,isInFrame:P,createEl:M,textContent:U,prependTo:N,hasClass:B,addClass:F,removeClass:j,toggleClass:G,setAttributes:V,getAttributes:H,getAttribute:z,setAttribute:W,removeAttribute:q,blockTextSelection:K,unblockTextSelection:X,getBoundingClientRect:Y,findPosition:$,getPointerPosition:Q,isTextNode:J,emptyEl:Z,normalizeContent:ee,appendContent:te,insertContent:ie,isSingleLeftClick:re,$:ne,$$:ae}),oe=1;function ue(){return oe++}var le={},ce="vdata"+(new Date).getTime();function de(e){var t=e[ce];return t||(t=e[ce]=ue()),le[t]||(le[t]={}),le[t]}function he(e){var t=e[ce];return!!t&&!!Object.getOwnPropertyNames(le[t]).length}function fe(e){var t=e[ce];if(t){delete le[t];try{delete e[ce]}catch(t){e.removeAttribute?e.removeAttribute(ce):e[ce]=null}}}function pe(e,t){var i=de(e);0===i.handlers[t].length&&(delete i.handlers[t],e.removeEventListener?e.removeEventListener(t,i.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&fe(e)}function me(e,t,i,r){i.forEach(function(i){e(t,i,r)})}function ge(e){function t(){return!0}function i(){return!1}if(!e||!e.isPropagationStopped){var r=e||n.event;e={};for(var a in r)"layerX"!==a&&"layerY"!==a&&"keyLocation"!==a&&"webkitMovementX"!==a&&"webkitMovementY"!==a&&("returnValue"===a&&r.preventDefault||(e[a]=r[a]));if(e.target||(e.target=e.srcElement||l),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){r.preventDefault&&r.preventDefault(),e.returnValue=!1,r.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){r.stopPropagation&&r.stopPropagation(),e.cancelBubble=!0,r.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=i,e.stopImmediatePropagation=function(){r.stopImmediatePropagation&&r.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=i,null!==e.clientX&&void 0!==e.clientX){var s=l.documentElement,o=l.body;e.pageX=e.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=e.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e}var ye=!1;!function(){try{var e=Object.defineProperty({},"passive",{get:function(){ye=!0}});n.addEventListener("test",null,e),n.removeEventListener("test",null,e)}catch(e){}}();var ve=["touchstart","touchmove"];function _e(e,t,i){if(Array.isArray(t))return me(_e,e,t,i);var r=de(e);if(r.handlers||(r.handlers={}),r.handlers[t]||(r.handlers[t]=[]),i.guid||(i.guid=ue()),r.handlers[t].push(i),r.dispatcher||(r.disabled=!1,r.dispatcher=function(t,i){if(!r.disabled){t=ge(t);var n=r.handlers[t.type];if(n)for(var a=n.slice(0),s=0,o=a.length;s<o&&!t.isImmediatePropagationStopped();s++)try{a[s].call(e,t,i)}catch(e){p.error(e)}}}),1===r.handlers[t].length)if(e.addEventListener){var n=!1;ye&&ve.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,r.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,r.dispatcher)}function be(e,t,i){if(he(e)){var r=de(e);if(r.handlers){if(Array.isArray(t))return me(be,e,t,i);var n=function(e,t){r.handlers[t]=[],pe(e,t)};if(void 0!==t){var a=r.handlers[t];if(a)if(i){if(i.guid)for(var s=0;s<a.length;s++)a[s].guid===i.guid&&a.splice(s--,1);pe(e,t)}else n(e,t)}else for(var o in r.handlers)Object.prototype.hasOwnProperty.call(r.handlers||{},o)&&n(e,o)}}}function Te(e,t,i){var r=he(e)?de(e):{},n=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=ge(t),r.dispatcher&&r.dispatcher.call(e,t,i),n&&!t.isPropagationStopped()&&!0===t.bubbles)Te.call(null,n,t,i);else if(!n&&!t.defaultPrevented){var a=de(t.target);t.target[t.type]&&(a.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),a.disabled=!1)}return!t.defaultPrevented}function Se(e,t,i){if(Array.isArray(t))return me(Se,e,t,i);var r=function r(){be(e,t,r),i.apply(this,arguments)};r.guid=i.guid=i.guid||ue(),_e(e,t,r)}var Ee=Object.freeze({fixEvent:ge,on:_e,off:be,trigger:Te,one:Se}),ke=!1,we=void 0,Ae=function(){if(D()&&!1!==we.options.autoSetup){var e=Array.prototype.slice.call(l.getElementsByTagName("video")),t=Array.prototype.slice.call(l.getElementsByTagName("audio")),i=Array.prototype.slice.call(l.getElementsByTagName("video-js")),r=e.concat(t,i);if(r&&r.length>0)for(var n=0,a=r.length;n<a;n++){var s=r[n];if(!s||!s.getAttribute){Le(1);break}if(void 0===s.player){null!==s.getAttribute("data-setup")&&we(s)}}else ke||Le(1)}};function Le(e,t){t&&(we=t),n.setTimeout(Ae,e)}D()&&"complete"===l.readyState?ke=!0:Se(n,"load",function(){ke=!0});var Ce=function(e){var t=l.createElement("style");return t.className=e,t},Re=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t},Oe=function(e,t,i){t.guid||(t.guid=ue());var r=function(){return t.apply(e,arguments)};return r.guid=i?i+"_"+t.guid:t.guid,r},De=function(e,t){var i=Date.now();return function(){var r=Date.now();r-i>=t&&(e.apply(void 0,arguments),i=r)}},Ie=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,a=void 0,s=function(){var n=this,s=arguments,o=function(){a=null,o=null,i||e.apply(n,s)};!a&&i&&e.apply(n,s),r.clearTimeout(a),a=r.setTimeout(o,t)};return s.cancel=function(){r.clearTimeout(a),a=null},s},Pe=function(){};Pe.prototype.allowedEvents_={},Pe.prototype.on=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},_e(this,e,t),this.addEventListener=i},Pe.prototype.addEventListener=Pe.prototype.on,Pe.prototype.off=function(e,t){be(this,e,t)},Pe.prototype.removeEventListener=Pe.prototype.off,Pe.prototype.one=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},Se(this,e,t),this.addEventListener=i},Pe.prototype.trigger=function(e){var t=e.type||e;"string"==typeof e&&(e={type:t}),e=ge(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Te(this,e)},Pe.prototype.dispatchEvent=Pe.prototype.trigger;var xe=void 0;Pe.prototype.queueTrigger=function(e){var t=this;xe||(xe=new Map);var i=e.type||e,r=xe.get(this);r||(r=new Map,xe.set(this,r));var a=r.get(i);r.delete(i),n.clearTimeout(a);var s=n.setTimeout(function(){0===r.size&&(r=null,xe.delete(t)),t.trigger(e)},0);r.set(i,s)};var Me=function(e){return e instanceof Pe||!!e.eventBusEl_&&["on","one","off","trigger"].every(function(t){return"function"==typeof e[t]})},Ue=function(e){return"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length},Ne=function(e){if(!e.nodeName&&!Me(e))throw new Error("Invalid target; must be a DOM node or evented object.")},Be=function(e){if(!Ue(e))throw new Error("Invalid event type; must be a non-empty string or array.")},Fe=function(e){if("function"!=typeof e)throw new Error("Invalid listener; must be a function.")},je=function(e,t){var i=t.length<3||t[0]===e||t[0]===e.eventBusEl_,r=void 0,n=void 0,a=void 0;return i?(r=e.eventBusEl_,t.length>=3&&t.shift(),n=t[0],a=t[1]):(r=t[0],n=t[1],a=t[2]),Ne(r),Be(n),Fe(a),{isTargetingSelf:i,target:r,type:n,listener:a=Oe(e,a)}},Ge=function(e,t,i,r){Ne(e),e.nodeName?Ee[t](e,i,r):e[t](i,r)},Ve={on:function(){for(var e=this,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var n=je(this,i),a=n.isTargetingSelf,s=n.target,o=n.type,u=n.listener;if(Ge(s,"on",o,u),!a){var l=function(){return e.off(s,o,u)};l.guid=u.guid;var c=function(){return e.off("dispose",l)};c.guid=u.guid,Ge(this,"on","dispose",l),Ge(s,"on","dispose",c)}},one:function(){for(var e=this,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var n=je(this,i),a=n.isTargetingSelf,s=n.target,o=n.type,u=n.listener;if(a)Ge(s,"one",o,u);else{var l=function t(){for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];e.off(s,o,t),u.apply(null,r)};l.guid=u.guid,Ge(s,"one",o,l)}},off:function(e,t,i){if(!e||Ue(e))be(this.eventBusEl_,e,t);else{var r=e,n=t;Ne(r),Be(n),Fe(i),i=Oe(this,i),this.off("dispose",i),r.nodeName?(be(r,n,i),be(r,"dispose",i)):Me(r)&&(r.off(n,i),r.off("dispose",i))}},trigger:function(e,t){return Te(this.eventBusEl_,e,t)}};function He(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).eventBusKey;if(t){if(!e[t].nodeName)throw new Error('The eventBusKey "'+t+'" does not refer to an element.');e.eventBusEl_=e[t]}else e.eventBusEl_=M("span",{className:"vjs-event-bus"});return k(e,Ve),e.on("dispose",function(){e.off(),n.setTimeout(function(){e.eventBusEl_=null},0)}),e}var ze={state:{},setState:function(e){var t=this;"function"==typeof e&&(e=e());var i=void 0;return E(e,function(e,r){t.state[r]!==e&&((i=i||{})[r]={from:t.state[r],to:e}),t.state[r]=e}),i&&Me(this)&&this.trigger({changes:i,type:"statechanged"}),i}};function We(e,t){return k(e,ze),e.state=k({},e.state,t),"function"==typeof e.handleStateChanged&&Me(e)&&e.on("statechanged",e.handleStateChanged),e}function qe(e){return"string"!=typeof e?e:e.charAt(0).toUpperCase()+e.slice(1)}function Ke(){for(var e={},t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return i.forEach(function(t){t&&E(t,function(t,i){A(t)?(A(e[i])||(e[i]={}),e[i]=Ke(e[i],t)):e[i]=t})}),e}var Xe=function(){function e(t,i,r){if(y(this,e),!t&&this.play?this.player_=t=this:this.player_=t,this.options_=Ke({},this.options_),i=this.options_=Ke(this.options_,i),this.id_=i.id||i.el&&i.el.id,!this.id_){var n=t&&t.id&&t.id()||"no_player";this.id_=n+"_component_"+ue()}this.name_=i.name||null,i.el?this.el_=i.el:!1!==i.createEl&&(this.el_=this.createEl()),!1!==i.evented&&He(this,{eventBusKey:this.el_?"el_":null}),We(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},!1!==i.initChildren&&this.initChildren(),this.ready(r),!1!==i.reportTouchActivity&&this.enableTouchActivity()}return e.prototype.dispose=function(){if(this.trigger({type:"dispose",bubbles:!1}),this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),fe(this.el_),this.el_=null),this.player_=null},e.prototype.player=function(){return this.player_},e.prototype.options=function(e){return p.warn("this.options() has been deprecated and will be moved to the constructor in 6.0"),e?(this.options_=Ke(this.options_,e),this.options_):this.options_},e.prototype.el=function(){return this.el_},e.prototype.createEl=function(e,t,i){return M(e,t,i)},e.prototype.localize=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=this.player_.language&&this.player_.language(),n=this.player_.languages&&this.player_.languages(),a=n&&n[r],s=r&&r.split("-")[0],o=n&&n[s],u=i;return a&&a[e]?u=a[e]:o&&o[e]&&(u=o[e]),t&&(u=u.replace(/\{(\d+)\}/g,function(e,i){var r=t[i-1],n=r;return void 0===r&&(n=e),n})),u},e.prototype.contentEl=function(){return this.contentEl_||this.el_},e.prototype.id=function(){return this.id_},e.prototype.name=function(){return this.name_},e.prototype.children=function(){return this.children_},e.prototype.getChildById=function(e){return this.childIndex_[e]},e.prototype.getChild=function(e){if(e)return e=qe(e),this.childNameIndex_[e]},e.prototype.addChild=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.children_.length,n=void 0,a=void 0;if("string"==typeof t){a=qe(t);var s=i.componentClass||a;i.name=a;var o=e.getComponent(s);if(!o)throw new Error("Component "+s+" does not exist");if("function"!=typeof o)return null;n=new o(this.player_||this,i)}else n=t;if(this.children_.splice(r,0,n),"function"==typeof n.id&&(this.childIndex_[n.id()]=n),(a=a||n.name&&qe(n.name()))&&(this.childNameIndex_[a]=n),"function"==typeof n.el&&n.el()){var u=this.contentEl().children[r]||null;this.contentEl().insertBefore(n.el(),u)}return n},e.prototype.removeChild=function(e){if("string"==typeof e&&(e=this.getChild(e)),e&&this.children_){for(var t=!1,i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(t){this.childIndex_[e.id()]=null,this.childNameIndex_[e.name()]=null;var r=e.el();r&&r.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}}},e.prototype.initChildren=function(){var t=this,i=this.options_.children;if(i){var r=this.options_,n=function(e){var i=e.name,n=e.opts;if(void 0!==r[i]&&(n=r[i]),!1!==n){!0===n&&(n={}),n.playerOptions=t.options_.playerOptions;var a=t.addChild(i,n);a&&(t[i]=a)}},a=void 0,s=e.getComponent("Tech");(a=Array.isArray(i)?i:Object.keys(i)).concat(Object.keys(this.options_).filter(function(e){return!a.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(function(e){var r=void 0,n=void 0;return"string"==typeof e?n=i[r=e]||t.options_[r]||{}:(r=e.name,n=e),{name:r,opts:n}}).filter(function(t){var i=e.getComponent(t.opts.componentClass||qe(t.name));return i&&!s.isTech(i)}).forEach(n)}},e.prototype.buildCSSClass=function(){return""},e.prototype.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))},e.prototype.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},e.prototype.$=function(e,t){return ne(e,t||this.contentEl())},e.prototype.$$=function(e,t){return ae(e,t||this.contentEl())},e.prototype.hasClass=function(e){return B(this.el_,e)},e.prototype.addClass=function(e){F(this.el_,e)},e.prototype.removeClass=function(e){j(this.el_,e)},e.prototype.toggleClass=function(e,t){G(this.el_,e,t)},e.prototype.show=function(){this.removeClass("vjs-hidden")},e.prototype.hide=function(){this.addClass("vjs-hidden")},e.prototype.lockShowing=function(){this.addClass("vjs-lock-showing")},e.prototype.unlockShowing=function(){this.removeClass("vjs-lock-showing")},e.prototype.getAttribute=function(e){return z(this.el_,e)},e.prototype.setAttribute=function(e,t){W(this.el_,e,t)},e.prototype.removeAttribute=function(e){q(this.el_,e)},e.prototype.width=function(e,t){return this.dimension("width",e,t)},e.prototype.height=function(e,t){return this.dimension("height",e,t)},e.prototype.dimensions=function(e,t){this.width(e,!0),this.height(t)},e.prototype.dimension=function(e,t,i){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;var r=this.el_.style[e],n=r.indexOf("px");return-1!==n?parseInt(r.slice(0,n),10):parseInt(this.el_["offset"+qe(e)],10)},e.prototype.currentDimension=function(e){var t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if("function"==typeof n.getComputedStyle){var i=n.getComputedStyle(this.el_);t=i.getPropertyValue(e)||i[e]}if(0===(t=parseFloat(t))){var r="offset"+qe(e);t=this.el_[r]}return t},e.prototype.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},e.prototype.currentWidth=function(){return this.currentDimension("width")},e.prototype.currentHeight=function(){return this.currentDimension("height")},e.prototype.focus=function(){this.el_.focus()},e.prototype.blur=function(){this.el_.blur()},e.prototype.emitTapEvents=function(){var e=0,t=null,i=void 0;this.on("touchstart",function(r){1===r.touches.length&&(t={pageX:r.touches[0].pageX,pageY:r.touches[0].pageY},e=(new Date).getTime(),i=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)i=!1;else if(t){var r=e.touches[0].pageX-t.pageX,n=e.touches[0].pageY-t.pageY;Math.sqrt(r*r+n*n)>10&&(i=!1)}});var r=function(){i=!1};this.on("touchleave",r),this.on("touchcancel",r),this.on("touchend",function(r){if(t=null,!0===i){(new Date).getTime()-e<200&&(r.preventDefault(),this.trigger("tap"))}})},e.prototype.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e=Oe(this.player(),this.player().reportUserActivity),t=void 0;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});var i=function(i){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",i),this.on("touchcancel",i)}},e.prototype.setTimeout=function(e,t){var i,r,a=this;return e=Oe(this,e),i=n.setTimeout(function(){a.off("dispose",r),e()},t),(r=function(){return a.clearTimeout(i)}).guid="vjs-timeout-"+i,this.on("dispose",r),i},e.prototype.clearTimeout=function(e){n.clearTimeout(e);var t=function(){};return t.guid="vjs-timeout-"+e,this.off("dispose",t),e},e.prototype.setInterval=function(e,t){var i=this;e=Oe(this,e);var r=n.setInterval(e,t),a=function(){return i.clearInterval(r)};return a.guid="vjs-interval-"+r,this.on("dispose",a),r},e.prototype.clearInterval=function(e){n.clearInterval(e);var t=function(){};return t.guid="vjs-interval-"+e,this.off("dispose",t),e},e.prototype.requestAnimationFrame=function(e){var t,i,r=this;return this.supportsRaf_?(e=Oe(this,e),t=n.requestAnimationFrame(function(){r.off("dispose",i),e()}),(i=function(){return r.cancelAnimationFrame(t)}).guid="vjs-raf-"+t,this.on("dispose",i),t):this.setTimeout(e,1e3/60)},e.prototype.cancelAnimationFrame=function(e){if(this.supportsRaf_){n.cancelAnimationFrame(e);var t=function(){};return t.guid="vjs-raf-"+e,this.off("dispose",t),e}return this.clearTimeout(e)},e.registerComponent=function(t,i){if("string"!=typeof t||!t)throw new Error('Illegal component name, "'+t+'"; must be a non-empty string.');var r=e.getComponent("Tech"),n=r&&r.isTech(i),a=e===i||e.prototype.isPrototypeOf(i.prototype);if(n||!a){var s=void 0;throw s=n?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error('Illegal component, "'+t+'"; '+s+".")}t=qe(t),e.components_||(e.components_={});var o=e.getComponent("Player");if("Player"===t&&o&&o.players){var u=o.players,l=Object.keys(u);if(u&&l.length>0&&l.map(function(e){return u[e]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return e.components_[t]=i,i},e.getComponent=function(t){if(t)return t=qe(t),e.components_&&e.components_[t]?e.components_[t]:void 0},e}();Xe.prototype.supportsRaf_="function"==typeof n.requestAnimationFrame&&"function"==typeof n.cancelAnimationFrame,Xe.registerComponent("Component",Xe);var Ye=n.navigator&&n.navigator.userAgent||"",$e=/AppleWebKit\/([\d.]+)/i.exec(Ye),Qe=$e?parseFloat($e.pop()):null,Je=/iPad/i.test(Ye),Ze=/iPhone/i.test(Ye)&&!Je,et=/iPod/i.test(Ye),tt=Ze||Je||et,it=function(){var e=Ye.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),rt=/Android/i.test(Ye),nt=function(){var e=Ye.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);return t&&i?parseFloat(e[1]+"."+e[2]):t||null}(),at=rt&&nt<5&&Qe<537,st=/Firefox/i.test(Ye),ot=/Edge/i.test(Ye),ut=!ot&&(/Chrome/i.test(Ye)||/CriOS/i.test(Ye)),lt=function(){var e=Ye.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),ct=function(){var e=/MSIE\s(\d+)\.\d/.exec(Ye),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(Ye)&&/rv:11.0/.test(Ye)&&(t=11),t}(),dt=/Safari/i.test(Ye)&&!ut&&!rt&&!ot,ht=(dt||tt)&&!ut,ft=D()&&("ontouchstart"in n||n.navigator.maxTouchPoints||n.DocumentTouch&&n.document instanceof n.DocumentTouch),pt=Object.freeze({IS_IPAD:Je,IS_IPHONE:Ze,IS_IPOD:et,IS_IOS:tt,IOS_VERSION:it,IS_ANDROID:rt,ANDROID_VERSION:nt,IS_NATIVE_ANDROID:at,IS_FIREFOX:st,IS_EDGE:ot,IS_CHROME:ut,CHROME_VERSION:lt,IE_VERSION:ct,IS_SAFARI:dt,IS_ANY_SAFARI:ht,TOUCH_ENABLED:ft});function mt(e,t,i,r){return function(e,t,i){if("number"!=typeof t||t<0||t>i)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is non-numeric or out of bounds (0-"+i+").")}(e,r,i.length-1),i[r][t]}function gt(e){return void 0===e||0===e.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:mt.bind(null,"start",0,e),end:mt.bind(null,"end",1,e)}}function yt(e,t){return Array.isArray(e)?gt(e):void 0===e||void 0===t?gt():gt([[e,t]])}function vt(e,t){var i=0,r=void 0,n=void 0;if(!t)return 0;e&&e.length||(e=yt(0,0));for(var a=0;a<e.length;a++)r=e.start(a),(n=e.end(a))>t&&(n=t),i+=n-r;return i/t}for(var _t={},bt=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Tt=bt[0],St=void 0,Et=0;Et<bt.length;Et++)if(bt[Et][1]in l){St=bt[Et];break}if(St)for(var kt=0;kt<St.length;kt++)_t[Tt[kt]]=St[kt];function wt(e){if(e instanceof wt)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:w(e)&&("number"==typeof e.code&&(this.code=e.code),k(this,e)),this.message||(this.message=wt.defaultMessages[this.code]||"")}wt.prototype.code=0,wt.prototype.message="",wt.prototype.status=null,wt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],wt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var At=0;At<wt.errorTypes.length;At++)wt[wt.errorTypes[At]]=At,wt.prototype[wt.errorTypes[At]]=At;var Lt=function(e,t){var i,r=null;try{i=JSON.parse(e,t)}catch(e){r=e}return[r,i]};function Ct(e){return void 0!==e&&null!==e&&"function"==typeof e.then}function Rt(e){Ct(e)&&e.then(null,function(e){})}var Ot=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,i,r){return e[i]&&(t[i]=e[i]),t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})},Dt=function(e){var t=e.$$("track"),i=Array.prototype.map.call(t,function(e){return e.track});return Array.prototype.map.call(t,function(e){var t=Ot(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===i.indexOf(e)}).map(Ot))},It=function(e,t){return e.forEach(function(e){var i=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(function(e){return i.addCue(e)})}),t.textTracks()},Pt="vjs-modal-dialog",xt=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.opened_=n.hasBeenOpened_=n.hasBeenFilled_=!1,n.closeable(!n.options_.uncloseable),n.content(n.options_.content),n.contentEl_=M("div",{className:Pt+"-content"},{role:"document"}),n.descEl_=M("p",{className:Pt+"-description vjs-control-text",id:n.el().getAttribute("aria-describedby")}),U(n.descEl_,n.description()),n.el_.appendChild(n.descEl_),n.el_.appendChild(n.contentEl_),n}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},t.prototype.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,e.prototype.dispose.call(this)},t.prototype.buildCSSClass=function(){return Pt+" vjs-hidden "+e.prototype.buildCSSClass.call(this)},t.prototype.handleKeyPress=function(e){27===e.which&&this.closeable()&&this.close()},t.prototype.label=function(){return this.localize(this.options_.label||"Modal Window")},t.prototype.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},t.prototype.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.closeable()&&this.on(this.el_.ownerDocument,"keydown",Oe(this,this.handleKeyPress)),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},t.prototype.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},t.prototype.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.closeable()&&this.off(this.el_.ownerDocument,"keydown",Oe(this,this.handleKeyPress)),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},t.prototype.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,i=this.getChild("closeButton");if(t&&!i){var r=this.contentEl_;this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=r,this.on(i,"close",this.close)}!t&&i&&(this.off(i,"close",this.close),this.removeChild(i),i.dispose())}return this.closeable_},t.prototype.fill=function(){this.fillWith(this.content())},t.prototype.fillWith=function(e){var t=this.contentEl(),i=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),ie(t,e),this.trigger("modalfill"),r?i.insertBefore(t,r):i.appendChild(t);var n=this.getChild("closeButton");n&&i.appendChild(n.el_)},t.prototype.empty=function(){this.trigger("beforemodalempty"),Z(this.contentEl()),this.trigger("modalempty")},t.prototype.content=function(e){return void 0!==e&&(this.content_=e),this.content_},t.prototype.conditionalFocus_=function(){var e=l.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus(),this.on(l,"keydown",this.handleKeyDown))},t.prototype.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null),this.off(l,"keydown",this.handleKeyDown)},t.prototype.handleKeyDown=function(e){if(9===e.which){for(var t=this.focusableEls_(),i=this.el_.querySelector(":focus"),r=void 0,n=0;n<t.length;n++)if(i===t[n]){r=n;break}l.activeElement===this.el_&&(r=0),e.shiftKey&&0===r?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||r!==t.length-1||(t[0].focus(),e.preventDefault())}},t.prototype.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(e){return(e instanceof n.HTMLAnchorElement||e instanceof n.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof n.HTMLInputElement||e instanceof n.HTMLSelectElement||e instanceof n.HTMLTextAreaElement||e instanceof n.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof n.HTMLIFrameElement||e instanceof n.HTMLObjectElement||e instanceof n.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")})},t}(Xe);xt.prototype.options_={pauseOnOpen:!0,temporary:!0},Xe.registerComponent("ModalDialog",xt);var Mt=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y(this,t);var r=_(this,e.call(this));r.tracks_=[],Object.defineProperty(r,"length",{get:function(){return this.tracks_.length}});for(var n=0;n<i.length;n++)r.addTrack(i[n]);return r}return t.prototype.addTrack=function(e){var t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack"}))},t.prototype.removeTrack=function(e){for(var t=void 0,i=0,r=this.length;i<r;i++)if(this[i]===e){(t=this[i]).off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:"removetrack"})},t.prototype.getTrackById=function(e){for(var t=null,i=0,r=this.length;i<r;i++){var n=this[i];if(n.id===e){t=n;break}}return t},t}(Pe);Mt.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"};for(var Ut in Mt.prototype.allowedEvents_)Mt.prototype["on"+Ut]=null;var Nt=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].enabled=!1)},Bt=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y(this,t);for(var r=i.length-1;r>=0;r--)if(i[r].enabled){Nt(i,i[r]);break}var n=_(this,e.call(this,i));return n.changing_=!1,n}return t.prototype.addTrack=function(t){var i=this;t.enabled&&Nt(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&t.addEventListener("enabledchange",function(){i.changing_||(i.changing_=!0,Nt(i,t),i.changing_=!1,i.trigger("change"))})},t}(Mt),Ft=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].selected=!1)},jt=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y(this,t);for(var r=i.length-1;r>=0;r--)if(i[r].selected){Ft(i,i[r]);break}var n=_(this,e.call(this,i));return n.changing_=!1,Object.defineProperty(n,"selectedIndex",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),n}return t.prototype.addTrack=function(t){var i=this;t.selected&&Ft(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&t.addEventListener("selectedchange",function(){i.changing_||(i.changing_=!0,Ft(i,t),i.changing_=!1,i.trigger("change"))})},t}(Mt),Gt=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.addTrack=function(t){e.prototype.addTrack.call(this,t),t.addEventListener("modechange",Oe(this,function(){this.queueTrigger("change")}));-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",Oe(this,function(){this.trigger("selectedlanguagechange")}))},t}(Mt),Vt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y(this,e),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var i=0,r=t.length;i<r;i++)this.addTrackElement_(t[i])}return e.prototype.addTrackElement_=function(e){var t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},e.prototype.getTrackElementByTrack_=function(e){for(var t=void 0,i=0,r=this.trackElements_.length;i<r;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t},e.prototype.removeTrackElement_=function(e){for(var t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_.splice(t,1);break}},e}(),Ht=function(){function e(t){y(this,e),e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}return e.prototype.setCues_=function(e){var t=this.length||0,i=0,r=e.length;this.cues_=e,this.length_=e.length;var n=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<r)for(i=t;i<r;i++)n.call(this,i)},e.prototype.getCueById=function(e){for(var t=null,i=0,r=this.length;i<r;i++){var n=this[i];if(n.id===e){t=n;break}}return t},e}(),zt={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Wt={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},qt={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Kt={disabled:"disabled",hidden:"hidden",showing:"showing"},Xt=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t);var r=_(this,e.call(this)),n={id:i.id||"vjs_track_"+ue(),kind:i.kind||"",label:i.label||"",language:i.language||""},a=function(e){Object.defineProperty(r,e,{get:function(){return n[e]},set:function(){}})};for(var s in n)a(s);return r}return t}(Pe),Yt=function(e){var t=["protocol","hostname","port","pathname","search","hash","host"],i=l.createElement("a");i.href=e;var r=""===i.host&&"file:"!==i.protocol,a=void 0;r&&((a=l.createElement("div")).innerHTML='<a href="'+e+'"></a>',i=a.firstChild,a.setAttribute("style","display:none; position:absolute;"),l.body.appendChild(a));for(var s={},o=0;o<t.length;o++)s[t[o]]=i[t[o]];return"http:"===s.protocol&&(s.host=s.host.replace(/:80$/,"")),"https:"===s.protocol&&(s.host=s.host.replace(/:443$/,"")),s.protocol||(s.protocol=n.location.protocol),r&&l.body.removeChild(a),s},$t=function(e){if(!e.match(/^https?:\/\//)){var t=l.createElement("div");t.innerHTML='<a href="'+e+'">x</a>',e=t.firstChild.href}return e},Qt=function(e){if("string"==typeof e){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/i.exec(e);if(t)return t.pop().toLowerCase()}return""},Jt=function(e){var t=n.location,i=Yt(e);return(":"===i.protocol?t.protocol:i.protocol)+i.host!==t.protocol+t.host},Zt=Object.freeze({parseUrl:Yt,getAbsoluteURL:$t,getFileExtension:Qt,isCrossOrigin:Jt}),ei=function(e){var t=ti.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},ti=Object.prototype.toString;var ii=Object.freeze({default:ei,__moduleExports:ei}),ri=i(function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),ni=ri.left,ai=ri.right,si=Object.freeze({default:ri,__moduleExports:ri,left:ni,right:ai}),oi=ii&&ei||ii,ui=function(e,t,i){if(!oi(t))throw new TypeError("iterator must be a function");arguments.length<3&&(i=this);"[object Array]"===li.call(e)?function(e,t,i){for(var r=0,n=e.length;r<n;r++)ci.call(e,r)&&t.call(i,e[r],r,e)}(e,t,i):"string"==typeof e?function(e,t,i){for(var r=0,n=e.length;r<n;r++)t.call(i,e.charAt(r),r,e)}(e,t,i):function(e,t,i){for(var r in e)ci.call(e,r)&&t.call(i,e[r],r,e)}(e,t,i)},li=Object.prototype.toString,ci=Object.prototype.hasOwnProperty;var di=Object.freeze({default:ui,__moduleExports:ui}),hi=si&&ri||si,fi=di&&ui||di,pi=function(e){if(!e)return{};var t={};return fi(hi(e).split("\n"),function(e){var i=e.indexOf(":"),r=hi(e.slice(0,i)).toLowerCase(),n=hi(e.slice(i+1));void 0===t[r]?t[r]=n:(a=t[r],"[object Array]"===Object.prototype.toString.call(a)?t[r].push(n):t[r]=[t[r],n]);var a}),t},mi=Object.freeze({default:pi,__moduleExports:pi}),gi=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)yi.call(i,r)&&(e[r]=i[r])}return e},yi=Object.prototype.hasOwnProperty;var vi=Object.freeze({default:gi,__moduleExports:gi}),_i=mi&&pi||mi,bi=vi&&gi||vi,Ti=Ei;Ei.XMLHttpRequest=n.XMLHttpRequest||function(){},Ei.XDomainRequest="withCredentials"in new Ei.XMLHttpRequest?Ei.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],function(e){Ei["delete"===e?"del":e]=function(t,i,r){return(i=Si(t,i,r)).method=e.toUpperCase(),ki(i)}});function Si(e,t,i){var r=e;return oi(t)?(i=t,"string"==typeof e&&(r={uri:e})):r=bi(t,{uri:e}),r.callback=i,r}function Ei(e,t,i){return ki(t=Si(e,t,i))}function ki(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,i=function(i,r,n){t||(t=!0,e.callback(i,r,n))};function r(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,m)}function n(){if(!o){var t;clearTimeout(u),t=e.useXDR&&void 0===a.status?200:1223===a.status?204:a.status;var r=m,n=null;return 0!==t?(r={body:function(){var e=void 0;if(e=a.response?a.response:a.responseText||function(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}(a),p)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:t,method:c,headers:{},url:l,rawRequest:a},a.getAllResponseHeaders&&(r.headers=_i(a.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),i(n,r,r.body)}}var a=e.xhr||null;a||(a=e.cors||e.useXDR?new Ei.XDomainRequest:new Ei.XMLHttpRequest);var s,o,u,l=a.url=e.uri||e.url,c=a.method=e.method||"GET",d=e.body||e.data,h=a.headers=e.headers||{},f=!!e.sync,p=!1,m={body:void 0,headers:{},statusCode:0,method:c,url:l,rawRequest:a};if("json"in e&&!1!==e.json&&(p=!0,h.accept||h.Accept||(h.Accept="application/json"),"GET"!==c&&"HEAD"!==c&&(h["content-type"]||h["Content-Type"]||(h["Content-Type"]="application/json"),d=JSON.stringify(!0===e.json?d:e.json))),a.onreadystatechange=function(){4===a.readyState&&setTimeout(n,0)},a.onload=n,a.onerror=r,a.onprogress=function(){},a.onabort=function(){o=!0},a.ontimeout=r,a.open(c,l,!f,e.username,e.password),f||(a.withCredentials=!!e.withCredentials),!f&&e.timeout>0&&(u=setTimeout(function(){if(!o){o=!0,a.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}},e.timeout)),a.setRequestHeader)for(s in h)h.hasOwnProperty(s)&&a.setRequestHeader(s,h[s]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(a.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(a),a.send(d||null),a}var wi=function(e,t){var i=new n.WebVTT.Parser(n,n.vttjs,n.WebVTT.StringDecoder()),r=[];i.oncue=function(e){t.addCue(e)},i.onparsingerror=function(e){r.push(e)},i.onflush=function(){t.trigger({type:"loadeddata",target:t})},i.parse(e),r.length>0&&(n.console&&n.console.groupCollapsed&&n.console.groupCollapsed("Text Track parsing errors for "+t.src),r.forEach(function(e){return p.error(e)}),n.console&&n.console.groupEnd&&n.console.groupEnd()),i.flush()},Ai=function(e,t){var i={uri:e},r=Jt(e);r&&(i.cors=r),Ti(i,Oe(this,function(e,i,r){if(e)return p.error(e,i);if(t.loaded_=!0,"function"!=typeof n.WebVTT){if(t.tech_){var a=function(){return wi(r,t)};t.tech_.on("vttjsloaded",a),t.tech_.on("vttjserror",function(){p.error("vttjs failed to load, stopping trying to process "+t.src),t.tech_.off("vttjsloaded",a)})}}else wi(r,t)}))},Li=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(y(this,t),!i.tech)throw new Error("A tech was not provided.");var r=Ke(i,{kind:qt[i.kind]||"subtitles",language:i.language||i.srclang||""}),n=Kt[r.mode]||"disabled",a=r.default;"metadata"!==r.kind&&"chapters"!==r.kind||(n="hidden");var s=_(this,e.call(this,r));s.tech_=r.tech,s.cues_=[],s.activeCues_=[];var o=new Ht(s.cues_),u=new Ht(s.activeCues_),l=!1,c=Oe(s,function(){this.activeCues=this.activeCues,l&&(this.trigger("cuechange"),l=!1)});return"disabled"!==n&&s.tech_.ready(function(){s.tech_.on("timeupdate",c)},!0),Object.defineProperties(s,{default:{get:function(){return a},set:function(){}},mode:{get:function(){return n},set:function(e){var t=this;Kt[e]&&("disabled"!==(n=e)?this.tech_.ready(function(){t.tech_.on("timeupdate",c)},!0):this.tech_.off("timeupdate",c),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?o:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return u;for(var e=this.tech_.currentTime(),t=[],i=0,r=this.cues.length;i<r;i++){var n=this.cues[i];n.startTime<=e&&n.endTime>=e?t.push(n):n.startTime===n.endTime&&n.startTime<=e&&n.startTime+.5>=e&&t.push(n)}if(l=!1,t.length!==this.activeCues_.length)l=!0;else for(var a=0;a<t.length;a++)-1===this.activeCues_.indexOf(t[a])&&(l=!0);return this.activeCues_=t,u.setCues_(this.activeCues_),u},set:function(){}}}),r.src?(s.src=r.src,Ai(r.src,s)):s.loaded_=!0,s}return t.prototype.addCue=function(e){var t=e;if(n.vttjs&&!(e instanceof n.vttjs.VTTCue)){t=new n.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(var i in e)i in t||(t[i]=e[i]);t.id=e.id,t.originalCue_=e}for(var r=this.tech_.textTracks(),a=0;a<r.length;a++)r[a]!==this&&r[a].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},t.prototype.removeCue=function(e){for(var t=this.cues_.length;t--;){var i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},t}(Xt);Li.prototype.allowedEvents_={cuechange:"cuechange"};var Ci=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t);var r=Ke(i,{kind:Wt[i.kind]||""}),n=_(this,e.call(this,r)),a=!1;return Object.defineProperty(n,"enabled",{get:function(){return a},set:function(e){"boolean"==typeof e&&e!==a&&(a=e,this.trigger("enabledchange"))}}),r.enabled&&(n.enabled=r.enabled),n.loaded_=!0,n}return t}(Xt),Ri=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t);var r=Ke(i,{kind:zt[i.kind]||""}),n=_(this,e.call(this,r)),a=!1;return Object.defineProperty(n,"selected",{get:function(){return a},set:function(e){"boolean"==typeof e&&e!==a&&(a=e,this.trigger("selectedchange"))}}),r.selected&&(n.selected=r.selected),n}return t}(Xt),Oi=0,Di=2,Ii=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t);var r=_(this,e.call(this)),n=void 0,a=new Li(i);return r.kind=a.kind,r.src=a.src,r.srclang=a.language,r.label=a.label,r.default=a.default,Object.defineProperties(r,{readyState:{get:function(){return n}},track:{get:function(){return a}}}),n=Oi,a.addEventListener("loadeddata",function(){n=Di,r.trigger({type:"load",target:r})}),r}return t}(Pe);Ii.prototype.allowedEvents_={load:"load"},Ii.NONE=Oi,Ii.LOADING=1,Ii.LOADED=Di,Ii.ERROR=3;var Pi={audio:{ListClass:Bt,TrackClass:Ci,capitalName:"Audio"},video:{ListClass:jt,TrackClass:Ri,capitalName:"Video"},text:{ListClass:Gt,TrackClass:Li,capitalName:"Text"}};Object.keys(Pi).forEach(function(e){Pi[e].getterName=e+"Tracks",Pi[e].privateName=e+"Tracks_"});var xi={remoteText:{ListClass:Gt,TrackClass:Li,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:Vt,TrackClass:Ii,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Mi=Ke(Pi,xi);xi.names=Object.keys(xi),Pi.names=Object.keys(Pi),Mi.names=[].concat(xi.names).concat(Pi.names);var Ui=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function Ni(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}Ni.prototype=Ui(Error.prototype),Ni.prototype.constructor=Ni,Ni.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function Bi(e){function t(e,t,i,r){return 3600*(0|e)+60*(0|t)+(0|i)+(0|r)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}function Fi(){this.values=Ui(null)}Fi.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};function ji(e,t,i,r){var n=r?e.split(r):[e];for(var a in n)if("string"==typeof n[a]){var s=n[a].split(i);if(2===s.length){t(s[0],s[1])}}}function Gi(e,t,i){var r=e;function n(){var t=Bi(e);if(null===t)throw new Ni(Ni.Errors.BadTimeStamp,"Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=n(),a(),"--\x3e"!==e.substr(0,3))throw new Ni(Ni.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),a(),t.endTime=n(),a(),function(e,t){var r=new Fi;ji(e,function(e,t){switch(e){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===t){r.set(e,i[n].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start","middle","end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start","middle","end"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start","middle","end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical",""),t.line=r.get("line","auto"),t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align","middle"),t.position=r.get("position",{start:0,left:0,middle:50,end:100,right:100},t.align),t.positionAlign=r.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}(e,t)}var Vi={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},Hi={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},zi={v:"title",lang:"lang"},Wi={rt:"ruby"};function qi(e,t){function i(){if(!t)return null;var e=t.match(/^([^<]*)(<[^>]*>?)?/);return i=e[1]?e[1]:e[2],t=t.substr(i.length),i;var i}function r(e){return Vi[e]}function n(e){for(;h=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)e=e.replace(h[0],r);return e}function a(t,i){var r=Hi[t];if(!r)return null;var n=e.document.createElement(r);n.localName=r;var a=zi[t];return a&&i&&(n[a]=i.trim()),n}for(var s,o=e.document.createElement("div"),u=o,l=[];null!==(s=i());)if("<"!==s[0])u.appendChild(e.document.createTextNode(n(s)));else{if("/"===s[1]){l.length&&l[l.length-1]===s.substr(2).replace(">","")&&(l.pop(),u=u.parentNode);continue}var c,d=Bi(s.substr(1,s.length-2));if(d){c=e.document.createProcessingInstruction("timestamp",d),u.appendChild(c);continue}var h=s.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!h)continue;if(!(c=a(h[1],h[3])))continue;if(f=u,Wi[(p=c).localName]&&Wi[p.localName]!==f.localName)continue;h[2]&&(c.className=h[2].substr(1).replace("."," ")),l.push(h[1]),u.appendChild(c),u=c}var f,p;return o}var Ki=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Xi(e){for(var t=0;t<Ki.length;t++){var i=Ki[t];if(e>=i[0]&&e<=i[1])return!0}return!1}function Yi(){}Yi.prototype.applyStyles=function(e,t){t=t||this.div;for(var i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])},Yi.prototype.formatStyle=function(e,t){return 0===e?0:e+t};function $i(e,t,i){Yi.call(this),this.cue=t,this.cueDiv=qi(e,t.text);var r={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(r,this.cueDiv),this.div=e.document.createElement("div"),r={direction:function(e){var t=[],i="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(var i=t.childNodes.length-1;i>=0;i--)e.push(t.childNodes[i])}function n(e){if(!e||!e.length)return null;var t=e.pop(),i=t.textContent||t.innerText;if(i){var a=i.match(/^.*(\n|\r)/);return a?(e.length=0,a[0]):i}return"ruby"===t.tagName?n(e):t.childNodes?(r(e,t),n(e)):void 0}for(r(t,e);i=n(t);)for(var a=0;a<i.length;a++)if(Xi(i.charCodeAt(a)))return"rtl";return"ltr"}(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:i.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(r),this.div.appendChild(this.cueDiv);var n=0;switch(t.positionAlign){case"start":n=t.position;break;case"middle":n=t.position-t.size/2;break;case"end":n=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(n,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(n,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}$i.prototype=Ui(Yi.prototype),$i.prototype.constructor=$i;function Qi(e){var t,i,r,n;if(e.div){i=e.div.offsetHeight,r=e.div.offsetWidth,n=e.div.offsetTop;var a=(a=e.div.childNodes)&&(a=a[0])&&a.getClientRects&&a.getClientRects();e=e.div.getBoundingClientRect(),t=a?Math.max(a[0]&&a[0].height||0,e.height/a.length):0}this.left=e.left,this.right=e.right,this.top=e.top||n,this.height=e.height||i,this.bottom=e.bottom||n+(e.height||i),this.width=e.width||r,this.lineHeight=void 0!==t?t:e.lineHeight}Qi.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},Qi.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},Qi.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},Qi.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},Qi.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},Qi.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},Qi.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},Qi.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,i=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,r=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||r,height:e.height||t,bottom:e.bottom||r+(e.height||t),width:e.width||i}};function Ji(e,t,i,r){var n=new Qi(t),a=t.cue,s=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,i=t.textTrackList,r=0,n=0;n<i.length&&i[n]!==t;n++)"showing"===i[n].mode&&r++;return-1*++r}(a),o=[];if(a.snapToLines){var u;switch(a.vertical){case"":o=["+y","-y"],u="height";break;case"rl":o=["+x","-x"],u="width";break;case"lr":o=["-x","+x"],u="width"}var l=n.lineHeight,c=l*Math.round(s),d=i[u]+l,h=o[0];Math.abs(c)>d&&(c=c<0?-1:1,c*=Math.ceil(d/l)*l),s<0&&(c+=""===a.vertical?i.height:i.width,o=o.reverse()),n.move(h,c)}else{var f=n.lineHeight/i.height*100;switch(a.lineAlign){case"middle":s-=f/2;break;case"end":s-=f}switch(a.vertical){case"":t.applyStyles({top:t.formatStyle(s,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(s,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(s,"%")})}o=["+y","-x","+x","-y"],n=new Qi(t)}var p=function(e,t){for(var n,a=new Qi(e),s=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(i,t[o])||e.within(i)&&e.overlapsAny(r);)e.move(t[o]);if(e.within(i))return e;var u=e.intersectPercentage(i);s>u&&(n=new Qi(e),s=u),e=new Qi(a)}return n||a}(n,o);t.move(p.toCSSCompatValues(i))}function Zi(){}Zi.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},Zi.convertCueToDOMTree=function(e,t){return e&&t?qi(e,t):null};Zi.processCues=function(e,t,i){if(!e||!t||!i)return null;for(;i.firstChild;)i.removeChild(i.firstChild);var r=e.document.createElement("div");r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin="1.5%",i.appendChild(r);if(function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var n=[],a=Qi.getSimpleBoxPosition(r),s={font:Math.round(.05*a.height*100)/100+"px sans-serif"};!function(){for(var i,o,u=0;u<t.length;u++)o=t[u],i=new $i(e,o,s),r.appendChild(i.div),Ji(0,i,a,n),o.displayState=i.div,n.push(Qi.getSimpleBoxPosition(i))}()}else for(var o=0;o<t.length;o++)r.appendChild(t[o].displayState)},Zi.Parser=function(e,t,i){i||(i=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=i||new TextDecoder("utf8"),this.regionList=[]},Zi.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof Ni))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){for(var e=t.buffer,i=0;i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var r=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),r}function r(e){e.match(/X-TIMESTAMP-MAP/)?ji(e,function(e,i){switch(e){case"X-TIMESTAMP-MAP":!function(e){var i=new Fi;ji(e,function(e,t){switch(e){case"MPEGT":i.integer(e+"S",t);break;case"LOCA":i.set(e+"L",Bi(t))}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:i.get("MPEGTS"),LOCAL:i.get("LOCAL")})}(i)}},/=/):ji(e,function(e,i){switch(e){case"Region":!function(e){var i=new Fi;if(ji(e,function(e,t){switch(e){case"id":i.set(e,t);break;case"width":i.percent(e,t);break;case"lines":i.integer(e,t);break;case"regionanchor":case"viewportanchor":var r=t.split(",");if(2!==r.length)break;var n=new Fi;if(n.percent("x",r[0]),n.percent("y",r[1]),!n.has("x")||!n.has("y"))break;i.set(e+"X",n.get("x")),i.set(e+"Y",n.get("y"));break;case"scroll":i.alt(e,t,["up"])}},/=/,/\s/),i.has("id")){var r=new(t.vttjs.VTTRegion||t.window.VTTRegion);r.width=i.get("width",100),r.lines=i.get("lines",3),r.regionAnchorX=i.get("regionanchorX",0),r.regionAnchorY=i.get("regionanchorY",100),r.viewportAnchorX=i.get("viewportanchorX",0),r.viewportAnchorY=i.get("viewportanchorY",100),r.scroll=i.get("scroll",""),t.onregion&&t.onregion(r),t.regionList.push({id:i.get("id"),region:r})}}(i)}},/:/)}try{var n;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(n=i()).match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Ni(Ni.Errors.BadSignature);t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:n=i(),t.state){case"HEADER":/:/.test(n)?r(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{Gi(n,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==n.indexOf("--\x3e");if(!n||o&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Ni(Ni.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}};var er=Zi,tr=Object.freeze({default:er,__moduleExports:er}),ir="auto",rr={"":1,lr:1,rl:1},nr={start:1,middle:1,end:1,left:1,right:1};function ar(e){if("string"!=typeof e)return!1;return!!nr[e.toLowerCase()]&&e.toLowerCase()}function sr(e,t,i){this.hasBeenReset=!1;var r="",n=!1,a=e,s=t,o=i,u=null,l="",c=!0,d="auto",h="start",f=50,p="middle",m=50,g="middle";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return r},set:function(e){r=""+e}},pauseOnExit:{enumerable:!0,get:function(){return n},set:function(e){n=!!e}},startTime:{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");a=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");s=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(e){o=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return u},set:function(e){u=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return l},set:function(e){var t,i=(t=e,"string"==typeof t&&!!rr[t.toLowerCase()]&&t.toLowerCase());if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");l=i,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e&&e!==ir)throw new SyntaxError("An invalid number or illegal string was specified.");d=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return h},set:function(e){var t=ar(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");h=t,this.hasBeenReset=!0}},position:{enumerable:!0,get:function(){return f},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");f=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return p},set:function(e){var t=ar(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}},size:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");m=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return g},set:function(e){var t=ar(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}}}),this.displayState=void 0}sr.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var or=sr,ur=Object.freeze({default:or,__moduleExports:or}),lr={"":!0,up:!0};function cr(e){return"number"==typeof e&&e>=0&&e<=100}var dr=function(){var e=100,t=3,i=0,r=100,n=0,a=100,s="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!cr(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return r},set:function(e){if(!cr(e))throw new Error("RegionAnchorX must be between 0 and 100.");r=e}},regionAnchorX:{enumerable:!0,get:function(){return i},set:function(e){if(!cr(e))throw new Error("RegionAnchorY must be between 0 and 100.");i=e}},viewportAnchorY:{enumerable:!0,get:function(){return a},set:function(e){if(!cr(e))throw new Error("ViewportAnchorY must be between 0 and 100.");a=e}},viewportAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!cr(e))throw new Error("ViewportAnchorX must be between 0 and 100.");n=e}},scroll:{enumerable:!0,get:function(){return s},set:function(e){var t,i=(t=e,"string"==typeof t&&!!lr[t.toLowerCase()]&&t.toLowerCase());if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");s=i}}})},hr=Object.freeze({default:dr,__moduleExports:dr}),fr=tr&&er||tr,pr=ur&&or||ur,mr=hr&&dr||hr,gr=i(function(e){var t=e.exports={WebVTT:fr,VTTCue:pr,VTTRegion:mr};n.vttjs=t,n.WebVTT=t.WebVTT;var i=t.VTTCue,r=t.VTTRegion,a=n.VTTCue,s=n.VTTRegion;t.shim=function(){n.VTTCue=i,n.VTTRegion=r},t.restore=function(){n.VTTCue=a,n.VTTRegion=s},n.VTTCue||t.shim()});gr.WebVTT,gr.VTTCue,gr.VTTRegion;var yr=function(e){v(t,e);function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};y(this,t),i.reportTouchActivity=!1;var n=_(this,e.call(this,null,i,r));return n.hasStarted_=!1,n.on("playing",function(){this.hasStarted_=!0}),n.on("loadstart",function(){this.hasStarted_=!1}),Mi.names.forEach(function(e){var t=Mi[e];i&&i[t.getterName]&&(n[t.privateName]=i[t.getterName])}),n.featuresProgressEvents||n.manualProgressOn(),n.featuresTimeupdateEvents||n.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(e){!1===i["native"+e+"Tracks"]&&(n["featuresNative"+e+"Tracks"]=!1)}),!1===i.nativeCaptions||!1===i.nativeTextTracks?n.featuresNativeTextTracks=!1:!0!==i.nativeCaptions&&!0!==i.nativeTextTracks||(n.featuresNativeTextTracks=!0),n.featuresNativeTextTracks||n.emulateTextTracks(),n.autoRemoteTextTracks_=new Mi.text.ListClass,n.initTrackListeners(),i.nativeControlsForTouch||n.emitTapEvents(),n.constructor&&(n.name_=n.constructor.name||"Unknown Tech"),n}return t.prototype.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},t.prototype.manualProgressOn=function(){this.on("durationchange",this.onDurationChange),this.manualProgress=!0,this.one("ready",this.trackProgress)},t.prototype.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange)},t.prototype.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Oe(this,function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)},t.prototype.onDurationChange=function(e){this.duration_=this.duration()},t.prototype.buffered=function(){return yt(0,0)},t.prototype.bufferedPercent=function(){return vt(this.buffered(),this.duration_)},t.prototype.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},t.prototype.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime),this.on("pause",this.stopTrackingCurrentTime)},t.prototype.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime),this.off("pause",this.stopTrackingCurrentTime)},t.prototype.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},t.prototype.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},t.prototype.dispose=function(){this.clearTracks(Pi.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),e.prototype.dispose.call(this)},t.prototype.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach(function(e){for(var i=t[e+"Tracks"]()||[],r=i.length;r--;){var n=i[r];"text"===e&&t.removeRemoteTextTrack(n),i.removeTrack(n)}})},t.prototype.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;){var i=e[t];this.removeRemoteTextTrack(i)}},t.prototype.reset=function(){},t.prototype.error=function(e){return void 0!==e&&(this.error_=new wt(e),this.trigger("error")),this.error_},t.prototype.played=function(){return this.hasStarted_?yt(0,0):yt()},t.prototype.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},t.prototype.initTrackListeners=function(){var e=this;Pi.names.forEach(function(t){var i=Pi[t],r=function(){e.trigger(t+"trackchange")},n=e[i.getterName]();n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),e.on("dispose",function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r)})})},t.prototype.addWebVttScript_=function(){var e=this;if(!n.WebVTT)if(l.body.contains(this.el())){if(!this.options_["vtt.js"]&&A(gr)&&Object.keys(gr).length>0)return void this.trigger("vttjsloaded");var t=l.createElement("script");t.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){t.onload=null,t.onerror=null}),n.WebVTT=!0,this.el().parentNode.appendChild(t)}else this.ready(this.addWebVttScript_)},t.prototype.emulateTextTracks=function(){var e=this,t=this.textTracks(),i=this.remoteTextTracks(),r=function(e){return t.addTrack(e.track)},n=function(e){return t.removeTrack(e.track)};i.on("addtrack",r),i.on("removetrack",n),this.addWebVttScript_();var a=function(){return e.trigger("texttrackchange")},s=function(){a();for(var e=0;e<t.length;e++){var i=t[e];i.removeEventListener("cuechange",a),"showing"===i.mode&&i.addEventListener("cuechange",a)}};s(),t.addEventListener("change",s),t.addEventListener("addtrack",s),t.addEventListener("removetrack",s),this.on("dispose",function(){i.off("addtrack",r),i.off("removetrack",n),t.removeEventListener("change",s),t.removeEventListener("addtrack",s),t.removeEventListener("removetrack",s);for(var e=0;e<t.length;e++){t[e].removeEventListener("cuechange",a)}})},t.prototype.addTextTrack=function(e,t,i){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=e.textTracks();n.kind=t,i&&(n.label=i),r&&(n.language=r),n.tech=e;var s=new Mi.text.TrackClass(n);return a.addTrack(s),s}(this,e,t,i)},t.prototype.createRemoteTextTrack=function(e){var t=Ke(e,{tech:this});return new xi.remoteTextEl.TrackClass(t)},t.prototype.addRemoteTextTrack=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1],r=this.createRemoteTextTrack(t);return!0!==i&&!1!==i&&(p.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),i=!0),this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),!0!==i&&this.ready(function(){return e.autoRemoteTextTracks_.addTrack(r.track)}),r},t.prototype.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},t.prototype.getVideoPlaybackQuality=function(){return{}},t.prototype.setPoster=function(){},t.prototype.playsinline=function(){},t.prototype.setPlaysinline=function(){},t.prototype.overrideNativeAudioTracks=function(){},t.prototype.overrideNativeVideoTracks=function(){},t.prototype.canPlayType=function(){return""},t.canPlayType=function(){return""},t.canPlaySource=function(e,i){return t.canPlayType(e.type)},t.isTech=function(e){return e.prototype instanceof t||e instanceof t||e===t},t.registerTech=function(e,i){if(t.techs_||(t.techs_={}),!t.isTech(i))throw new Error("Tech "+e+" must be a Tech");if(!t.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!t.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=qe(e),t.techs_[e]=i,"Tech"!==e&&t.defaultTechOrder_.push(e),i},t.getTech=function(e){if(e)return e=qe(e),t.techs_&&t.techs_[e]?t.techs_[e]:n&&n.videojs&&n.videojs[e]?(p.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),n.videojs[e]):void 0},t}(Xe);Mi.names.forEach(function(e){var t=Mi[e];yr.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),yr.prototype.featuresVolumeControl=!0,yr.prototype.featuresMuteControl=!0,yr.prototype.featuresFullscreenResize=!1,yr.prototype.featuresPlaybackRate=!1,yr.prototype.featuresProgressEvents=!1,yr.prototype.featuresSourceset=!1,yr.prototype.featuresTimeupdateEvents=!1,yr.prototype.featuresNativeTextTracks=!1,yr.withSourceHandlers=function(e){e.registerSourceHandler=function(t,i){var r=e.sourceHandlers;r||(r=e.sourceHandlers=[]),void 0===i&&(i=r.length),r.splice(i,0,t)},e.canPlayType=function(t){for(var i=e.sourceHandlers||[],r=void 0,n=0;n<i.length;n++)if(r=i[n].canPlayType(t))return r;return""},e.selectSourceHandler=function(t,i){for(var r=e.sourceHandlers||[],n=0;n<r.length;n++)if(r[n].canHandleSource(t,i))return r[n];return null},e.canPlaySource=function(t,i){var r=e.selectSourceHandler(t,i);return r?r.canHandleSource(t,i):""};["seekable","seeking","duration"].forEach(function(e){var t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){var i=e.selectSourceHandler(t,this.options_);i||(e.nativeSourceHandler?i=e.nativeSourceHandler:p.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler),i!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=i.handleSource(t,this,this.options_),this.on("dispose",this.disposeSourceHandler)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},Xe.registerComponent("Tech",yr),yr.registerTech("Tech",yr),yr.defaultTechOrder_=[];var vr={},_r={},br={};function Tr(e,t,i){e.setTimeout(function(){return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];var r=arguments[2];var n=arguments[3];var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];var o=i[0],u=i.slice(1);if("string"==typeof o)e(t,vr[o],r,n,a,s);else if(o){var l=function(e,t){var i=_r[e.id()],r=null;if(void 0===i||null===i)return r=t(e),_r[e.id()]=[[t,r]],r;for(var n=0;n<i.length;n++){var a=i[n],s=a[0],o=a[1];s===t&&(r=o)}null===r&&(r=t(e),i.push([t,r]));return r}(n,o);if(!l.setSource)return a.push(l),e(t,u,r,n,a,s);l.setSource(k({},t),function(i,o){if(i)return e(t,u,r,n,a,s);a.push(l),e(o,t.type===o.type?u:vr[o.type],r,n,a,s)})}else u.length?e(t,u,r,n,a,s):s?r(t,a):e(t,vr["*"],r,n,a,!0)}(t,vr[t.type],i,e)},1)}function Sr(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n="call"+qe(i),a=e.reduce(Ar(n),r),s=a===br,o=s?null:t[i](a);return function(e,t,i,r){for(var n=e.length-1;n>=0;n--){var a=e[n];a[t]&&a[t](r,i)}}(e,i,o,s),o}var Er={buffered:1,currentTime:1,duration:1,seekable:1,played:1,paused:1},kr={setCurrentTime:1},wr={play:1,pause:1};function Ar(e){return function(t,i){return t===br?br:i[e]?i[e](t):t}}var Lr={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",mp3:"audio/mpeg",aac:"audio/aac",oga:"audio/ogg",m3u8:"application/x-mpegURL"},Cr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Qt(e);return Lr[t.toLowerCase()]||""};function Rr(e){var t=Cr(e.src);return!e.type&&t&&(e.type=t),e}var Or=function(e){v(t,e);function t(i,r,n){y(this,t);var a=Ke({createEl:!1},r),s=_(this,e.call(this,i,a,n));if(r.playerOptions.sources&&0!==r.playerOptions.sources.length)i.src(r.playerOptions.sources);else for(var o=0,u=r.playerOptions.techOrder;o<u.length;o++){var l=qe(u[o]),c=yr.getTech(l);if(l||(c=Xe.getComponent(l)),c&&c.isSupported()){i.loadTech_(l);break}}return s}return t}(Xe);Xe.registerComponent("MediaLoader",Or);var Dr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.emitTapEvents(),n.enable(),n}return t.prototype.createEl=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i=k({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass(),tabIndex:0},i),"button"===t&&p.error("Creating a ClickableComponent with an HTML element of "+t+" is not supported; use a Button instead."),r=k({role:"button"},r),this.tabIndex_=i.tabIndex;var n=e.prototype.createEl.call(this,t,i,r);return this.createControlTextEl(n),n},t.prototype.dispose=function(){this.controlTextEl_=null,e.prototype.dispose.call(this)},t.prototype.createControlTextEl=function(e){return this.controlTextEl_=M("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},t.prototype.controlText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.el();if(void 0===e)return this.controlText_||"Need Text";var i=this.localize(e);this.controlText_=e,U(this.controlTextEl_,i),this.nonIconControl||t.setAttribute("title",i)},t.prototype.buildCSSClass=function(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)},t.prototype.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick),this.on("focus",this.handleFocus),this.on("blur",this.handleBlur))},t.prototype.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off(["tap","click"],this.handleClick),this.off("focus",this.handleFocus),this.off("blur",this.handleBlur)},t.prototype.handleClick=function(e){},t.prototype.handleFocus=function(e){_e(l,"keydown",Oe(this,this.handleKeyPress))},t.prototype.handleKeyPress=function(t){32===t.which||13===t.which?(t.preventDefault(),this.trigger("click")):e.prototype.handleKeyPress&&e.prototype.handleKeyPress.call(this,t)},t.prototype.handleBlur=function(e){be(l,"keydown",Oe(this,this.handleKeyPress))},t}(Xe);Xe.registerComponent("ClickableComponent",Dr);var Ir=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.update(),i.on("posterchange",Oe(n,n.update)),n}return t.prototype.dispose=function(){this.player().off("posterchange",this.update),e.prototype.dispose.call(this)},t.prototype.createEl=function(){return M("div",{className:"vjs-poster",tabIndex:-1})},t.prototype.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},t.prototype.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},t.prototype.handleClick=function(e){this.player_.controls()&&(this.player_.paused()?Rt(this.player_.play()):this.player_.pause())},t}(Dr);Xe.registerComponent("PosterImage",Ir);var Pr={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function xr(e,t){var i=void 0;if(4===e.length)i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");i=e.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+t+")"}function Mr(e,t,i){try{e.style[t]=i}catch(e){return}}var Ur=function(e){v(t,e);function t(i,r,a){y(this,t);var s=_(this,e.call(this,i,r,a)),o=Oe(s,s.updateDisplay);return i.on("loadstart",Oe(s,s.toggleDisplay)),i.on("texttrackchange",o),i.on("loadstart",Oe(s,s.preselectTrack)),i.ready(Oe(s,function(){if(i.tech_&&i.tech_.featuresNativeTextTracks)this.hide();else{i.on("fullscreenchange",o),i.on("playerresize",o),n.addEventListener("orientationchange",o),i.on("dispose",function(){return n.removeEventListener("orientationchange",o)});for(var e=this.options_.playerOptions.tracks||[],t=0;t<e.length;t++)this.player_.addRemoteTextTrack(e[t],!0);this.preselectTrack()}})),s}return t.prototype.preselectTrack=function(){for(var e={captions:1,subtitles:1},t=this.player_.textTracks(),i=this.player_.cache_.selectedLanguage,r=void 0,n=void 0,a=void 0,s=0;s<t.length;s++){var o=t[s];i&&i.enabled&&i.language===o.language?o.kind===i.kind?a=o:a||(a=o):i&&!i.enabled?(a=null,r=null,n=null):o.default&&("descriptions"!==o.kind||r?o.kind in e&&!n&&(n=o):r=o)}a?a.mode="showing":n?n.mode="showing":r&&(r.mode="showing")},t.prototype.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})},t.prototype.clearDisplay=function(){"function"==typeof n.WebVTT&&n.WebVTT.processCues(n,[],this.el_)},t.prototype.updateDisplay=function(){var e=this.player_.textTracks();this.clearDisplay();for(var t=null,i=null,r=e.length;r--;){var n=e[r];"showing"===n.mode&&("descriptions"===n.kind?t=n:i=n)}i?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(i)):t&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(t))},t.prototype.updateForTrack=function(e){if("function"==typeof n.WebVTT&&e.activeCues){for(var t=[],i=0;i<e.activeCues.length;i++)t.push(e.activeCues[i]);if(n.WebVTT.processCues(n,t,this.el_),this.player_.textTrackSettings)for(var r=this.player_.textTrackSettings.getValues(),a=t.length;a--;){var s=t[a];if(s){var o=s.displayState;if(r.color&&(o.firstChild.style.color=r.color),r.textOpacity&&Mr(o.firstChild,"color",xr(r.color||"#fff",r.textOpacity)),r.backgroundColor&&(o.firstChild.style.backgroundColor=r.backgroundColor),r.backgroundOpacity&&Mr(o.firstChild,"backgroundColor",xr(r.backgroundColor||"#000",r.backgroundOpacity)),r.windowColor&&(r.windowOpacity?Mr(o,"backgroundColor",xr(r.windowColor,r.windowOpacity)):o.style.backgroundColor=r.windowColor),r.edgeStyle&&("dropshadow"===r.edgeStyle?o.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px #222":"raised"===r.edgeStyle?o.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px #222":"depressed"===r.edgeStyle?o.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px #222":"uniform"===r.edgeStyle&&(o.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px #222")),r.fontPercent&&1!==r.fontPercent){var u=n.parseFloat(o.style.fontSize);o.style.fontSize=u*r.fontPercent+"px",o.style.height="auto",o.style.top="auto",o.style.bottom="2px"}r.fontFamily&&"default"!==r.fontFamily&&("small-caps"===r.fontFamily?o.firstChild.style.fontVariant="small-caps":o.firstChild.style.fontFamily=Pr[r.fontFamily])}}}},t}(Xe);Xe.registerComponent("TextTrackDisplay",Ur);var Nr=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){var t=this.player_.isAudio(),i=this.localize(t?"Audio Player":"Video Player"),r=M("span",{className:"vjs-control-text",innerHTML:this.localize("{1} is loading.",[i])}),n=e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return n.appendChild(r),n},t}(Xe);Xe.registerComponent("LoadingSpinner",Nr);var Br=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=k({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass()},t),i=k({type:"button"},i);var r=Xe.prototype.createEl.call(this,"button",t,i);return this.createControlTextEl(r),r},t.prototype.addChild=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.constructor.name;return p.warn("Adding an actionable (user controllable) child to a Button ("+i+") is not supported; use a ClickableComponent instead."),Xe.prototype.addChild.call(this,e,t)},t.prototype.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},t.prototype.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},t.prototype.handleKeyPress=function(t){32!==t.which&&13!==t.which&&e.prototype.handleKeyPress.call(this,t)},t}(Dr);Xe.registerComponent("Button",Br);var Fr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.mouseused_=!1,n.on("mousedown",n.handleMouseDown),n}return t.prototype.buildCSSClass=function(){return"vjs-big-play-button"},t.prototype.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY)Rt(t);else{var i=this.player_.getChild("controlBar"),r=i&&i.getChild("playToggle");if(r){var n=function(){return r.focus()};Ct(t)?t.then(n,function(){}):this.setTimeout(n,1)}else this.player_.focus()}},t.prototype.handleKeyPress=function(t){this.mouseused_=!1,e.prototype.handleKeyPress.call(this,t)},t.prototype.handleMouseDown=function(e){this.mouseused_=!0},t}(Br);Fr.prototype.controlText_="Play Video",Xe.registerComponent("BigPlayButton",Fr);var jr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.controlText(r&&r.controlText||n.localize("Close")),n}return t.prototype.buildCSSClass=function(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)},t.prototype.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},t}(Br);Xe.registerComponent("CloseButton",jr);var Gr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"play",n.handlePlay),n.on(i,"pause",n.handlePause),n.on(i,"ended",n.handleEnded),n}return t.prototype.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},t.prototype.handleClick=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},t.prototype.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},t.prototype.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},t.prototype.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},t.prototype.handleEnded=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",this.handleSeeked)},t}(Br);Gr.prototype.controlText_="Play",Xe.registerComponent("PlayToggle",Gr);var Vr=function(e,t){e=e<0?0:e;var i=Math.floor(e%60),r=Math.floor(e/60%60),n=Math.floor(e/3600),a=Math.floor(t/60%60),s=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(n=r=i="-"),(n=n>0||s>0?n+":":"")+(r=((n||a>=10)&&r<10?"0"+r:r)+":")+(i=i<10?"0"+i:i)},Hr=Vr;function zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return Hr(e,t)}var Wr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.throttledUpdateContent=De(Oe(n,n.updateContent),25),n.on(i,"timeupdate",n.throttledUpdateContent),n}return t.prototype.createEl=function(t){var i=this.buildCSSClass(),r=e.prototype.createEl.call(this,"div",{className:i+" vjs-time-control vjs-control",innerHTML:'<span class="vjs-control-text">'+this.localize(this.labelText_)+" </span>"});return this.contentEl_=M("span",{className:i+"-display"},{"aria-live":"off"}),this.updateTextNode_(),r.appendChild(this.contentEl_),r},t.prototype.dispose=function(){this.contentEl_=null,this.textNode_=null,e.prototype.dispose.call(this)},t.prototype.updateTextNode_=function(){if(this.contentEl_){for(;this.contentEl_.firstChild;)this.contentEl_.removeChild(this.contentEl_.firstChild);this.textNode_=l.createTextNode(this.formattedTime_||this.formatTime_(0)),this.contentEl_.appendChild(this.textNode_)}},t.prototype.formatTime_=function(e){return zr(e)},t.prototype.updateFormattedTime_=function(e){var t=this.formatTime_(e);t!==this.formattedTime_&&(this.formattedTime_=t,this.requestAnimationFrame(this.updateTextNode_))},t.prototype.updateContent=function(e){},t}(Xe);Wr.prototype.labelText_="Time",Wr.prototype.controlText_="Time",Xe.registerComponent("TimeDisplay",Wr);var qr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"ended",n.handleEnded),n}return t.prototype.buildCSSClass=function(){return"vjs-current-time"},t.prototype.updateContent=function(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.updateFormattedTime_(t)},t.prototype.handleEnded=function(e){this.player_.duration()&&this.updateFormattedTime_(this.player_.duration())},t}(Wr);qr.prototype.labelText_="Current Time",qr.prototype.controlText_="Current Time",Xe.registerComponent("CurrentTimeDisplay",qr);var Kr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"durationchange",n.updateContent),n.on(i,"loadedmetadata",n.throttledUpdateContent),n}return t.prototype.buildCSSClass=function(){return"vjs-duration"},t.prototype.updateContent=function(e){var t=this.player_.duration();t&&this.duration_!==t&&(this.duration_=t,this.updateFormattedTime_(t))},t}(Wr);Kr.prototype.labelText_="Duration",Kr.prototype.controlText_="Duration",Xe.registerComponent("DurationDisplay",Kr);var Xr=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"})},t}(Xe);Xe.registerComponent("TimeDivider",Xr);var Yr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"durationchange",n.throttledUpdateContent),n.on(i,"ended",n.handleEnded),n}return t.prototype.buildCSSClass=function(){return"vjs-remaining-time"},t.prototype.formatTime_=function(t){return"-"+e.prototype.formatTime_.call(this,t)},t.prototype.updateContent=function(e){this.player_.duration()&&(this.player_.remainingTimeDisplay?this.updateFormattedTime_(this.player_.remainingTimeDisplay()):this.updateFormattedTime_(this.player_.remainingTime()))},t.prototype.handleEnded=function(e){this.player_.duration()&&this.updateFormattedTime_(0)},t}(Wr);Yr.prototype.labelText_="Remaining Time",Yr.prototype.controlText_="Remaining Time",Xe.registerComponent("RemainingTimeDisplay",Yr);var $r=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.updateShowing(),n.on(n.player(),"durationchange",n.updateShowing),n}return t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=M("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+" </span>"+this.localize("LIVE")},{"aria-live":"off"}),t.appendChild(this.contentEl_),t},t.prototype.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},t.prototype.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},t}(Xe);Xe.registerComponent("LiveDisplay",$r);var Qr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.bar=n.getChild(n.options_.barName),n.vertical(!!n.options_.vertical),n.enable(),n}return t.prototype.enabled=function(){return this.enabled_},t.prototype.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown),this.on("touchstart",this.handleMouseDown),this.on("focus",this.handleFocus),this.on("blur",this.handleBlur),this.on("click",this.handleClick),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},t.prototype.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown),this.off("touchstart",this.handleMouseDown),this.off("focus",this.handleFocus),this.off("blur",this.handleBlur),this.off("click",this.handleClick),this.off(this.player_,"controlsvisible",this.update),this.off(e,"mousemove",this.handleMouseMove),this.off(e,"mouseup",this.handleMouseUp),this.off(e,"touchmove",this.handleMouseMove),this.off(e,"touchend",this.handleMouseUp),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},t.prototype.createEl=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.className=i.className+" vjs-slider",i=k({tabIndex:0},i),r=k({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},r),e.prototype.createEl.call(this,t,i,r)},t.prototype.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||ut||e.preventDefault(),K(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchmove",this.handleMouseMove),this.on(t,"touchend",this.handleMouseUp),this.handleMouseMove(e)},t.prototype.handleMouseMove=function(e){},t.prototype.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;X(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove),this.off(e,"mouseup",this.handleMouseUp),this.off(e,"touchmove",this.handleMouseMove),this.off(e,"touchend",this.handleMouseUp),this.update()},t.prototype.update=function(){if(this.el_){var e=this.getPercent(),t=this.bar;if(t){("number"!=typeof e||e!=e||e<0||e===1/0)&&(e=0);var i=(100*e).toFixed(2)+"%",r=t.el().style;return this.vertical()?r.height=i:r.width=i,e}}},t.prototype.calculateDistance=function(e){var t=Q(this.el_,e);return this.vertical()?t.y:t.x},t.prototype.handleFocus=function(){this.on(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)},t.prototype.handleKeyPress=function(e){37===e.which||40===e.which?(e.preventDefault(),this.stepBack()):38!==e.which&&39!==e.which||(e.preventDefault(),this.stepForward())},t.prototype.handleBlur=function(){this.off(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)},t.prototype.handleClick=function(e){e.stopImmediatePropagation(),e.preventDefault()},t.prototype.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},t}(Xe);Xe.registerComponent("Slider",Qr);var Jr=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.partEls_=[],n.on(i,"progress",n.update),n}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+"</span>: 0%</span>"})},t.prototype.dispose=function(){this.partEls_=null,e.prototype.dispose.call(this)},t.prototype.update=function(e){var t=this.player_.buffered(),i=this.player_.duration(),r=this.player_.bufferedEnd(),n=this.partEls_,a=function(e,t){var i=e/t||0;return 100*(i>=1?1:i)+"%"};this.el_.style.width=a(r,i);for(var s=0;s<t.length;s++){var o=t.start(s),u=t.end(s),l=n[s];l||(l=this.el_.appendChild(M()),n[s]=l),l.style.left=a(o,r),l.style.width=a(u-o,r)}for(var c=n.length;c>t.length;c--)this.el_.removeChild(n[c-1]);n.length=t.length},t}(Xe);Xe.registerComponent("LoadProgressBar",Jr);var Zr=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"})},t.prototype.update=function(e,t,i){var r=Y(this.el_),n=Y(this.player_.el()),a=e.width*t;if(n&&r){var s=e.left-n.left+a,o=e.width-a+(n.right-e.right),u=r.width/2;s<u?u+=u-s:o<u&&(u=o),u<0?u=0:u>r.width&&(u=r.width),this.el_.style.right="-"+u+"px",U(this.el_,i)}},t}(Xe);Xe.registerComponent("TimeTooltip",Zr);var en=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"})},t.prototype.update=function(e,t){var i=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var r=zr(i.player_.scrubbing()?i.player_.getCache().currentTime:i.player_.currentTime(),i.player_.duration()),n=i.getChild("timeTooltip");n&&n.update(e,t,r)})},t}(Xe);en.prototype.options_={children:[]},tt||rt||en.prototype.options_.children.push("timeTooltip"),Xe.registerComponent("PlayProgressBar",en);var tn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.update=De(Oe(n,n.update),25),n}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},t.prototype.update=function(e,t){var i=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var r=i.player_.duration(),n=zr(t*r,r);i.el_.style.left=e.width*t+"px",i.getChild("timeTooltip").update(e,t,n)})},t}(Xe);tn.prototype.options_={children:["timeTooltip"]},Xe.registerComponent("MouseTimeDisplay",tn);var rn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.setEventHandlers_(),n}return t.prototype.setEventHandlers_=function(){var e=this;this.update=De(Oe(this,this.update),30),this.on(this.player_,"timeupdate",this.update),this.on(this.player_,"ended",this.handleEnded),this.updateInterval=null,this.on(this.player_,["playing"],function(){e.clearInterval(e.updateInterval),e.updateInterval=e.setInterval(function(){e.requestAnimationFrame(function(){e.update()})},30)}),this.on(this.player_,["ended","pause","waiting"],function(){e.clearInterval(e.updateInterval)}),this.on(this.player_,["timeupdate","ended"],this.update)},t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},t.prototype.update_=function(e,t){var i=this.player_.duration();this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[zr(e,i),zr(i,i)],"{1} of {2}")),this.bar.update(Y(this.el_),t)},t.prototype.update=function(t){var i=e.prototype.update.call(this);return this.update_(this.getCurrentTime_(),i),i},t.prototype.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},t.prototype.handleEnded=function(e){this.update_(this.player_.duration(),1)},t.prototype.getPercent=function(){var e=this.getCurrentTime_()/this.player_.duration();return e>=1?1:e||0},t.prototype.handleMouseDown=function(t){re(t)&&(t.stopPropagation(),this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),e.prototype.handleMouseDown.call(this,t))},t.prototype.handleMouseMove=function(e){if(re(e)){var t=this.calculateDistance(e)*this.player_.duration();t===this.player_.duration()&&(t-=.1),this.player_.currentTime(t)}},t.prototype.enable=function(){e.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.show()},t.prototype.disable=function(){e.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.hide()},t.prototype.handleMouseUp=function(t){e.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying&&Rt(this.player_.play())},t.prototype.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},t.prototype.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},t.prototype.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},t.prototype.handleKeyPress=function(t){32===t.which||13===t.which?(t.preventDefault(),this.handleAction(t)):e.prototype.handleKeyPress&&e.prototype.handleKeyPress.call(this,t)},t}(Qr);rn.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},tt||rt||rn.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),rn.prototype.playerEvent="timeupdate",Xe.registerComponent("SeekBar",rn);var nn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.handleMouseMove=De(Oe(n,n.handleMouseMove),25),n.throttledHandleMouseSeek=De(Oe(n,n.handleMouseSeek),25),n.enable(),n}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},t.prototype.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var i=t.getChild("mouseTimeDisplay"),r=t.el(),n=Y(r),a=Q(r,e).x;a>1?a=1:a<0&&(a=0),i&&i.update(n,a)}},t.prototype.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},t.prototype.enabled=function(){return this.enabled_},t.prototype.disable=function(){this.children().forEach(function(e){return e.disable&&e.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDown),this.off(this.el_,"mousemove",this.handleMouseMove),this.handleMouseUp(),this.addClass("disabled"),this.enabled_=!1)},t.prototype.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDown),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},t.prototype.handleMouseDown=function(e){var t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchend",this.handleMouseUp)},t.prototype.handleMouseUp=function(e){var t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseUp(e),this.off(t,"mousemove",this.throttledHandleMouseSeek),this.off(t,"touchmove",this.throttledHandleMouseSeek),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},t}(Xe);nn.prototype.options_={children:["seekBar"]},Xe.registerComponent("ProgressControl",nn);var an=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"fullscreenchange",n.handleFullscreenChange),!1===l[_t.fullscreenEnabled]&&n.disable(),n}return t.prototype.buildCSSClass=function(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)},t.prototype.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},t.prototype.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},t}(Br);an.prototype.controlText_="Fullscreen",Xe.registerComponent("FullscreenToggle",an);var sn=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})},on=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},t}(Xe);Xe.registerComponent("VolumeLevel",on);var un=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on("slideractive",n.updateLastVolume_),n.on(i,"volumechange",n.updateARIAAttributes),i.ready(function(){return n.updateARIAAttributes()}),n}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},t.prototype.handleMouseDown=function(t){re(t)&&e.prototype.handleMouseDown.call(this,t)},t.prototype.handleMouseMove=function(e){re(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},t.prototype.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},t.prototype.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},t.prototype.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},t.prototype.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},t.prototype.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},t.prototype.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},t.prototype.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},t}(Qr);un.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},un.prototype.playerEvent="volumechange",Xe.registerComponent("VolumeBar",un);var ln=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,t),r.vertical=r.vertical||!1,(void 0===r.volumeBar||A(r.volumeBar))&&(r.volumeBar=r.volumeBar||{},r.volumeBar.vertical=r.vertical);var n=_(this,e.call(this,i,r));return sn(n,i),n.throttledHandleMouseMove=De(Oe(n,n.handleMouseMove),25),n.on("mousedown",n.handleMouseDown),n.on("touchstart",n.handleMouseDown),n.on(n.volumeBar,["focus","slideractive"],function(){n.volumeBar.addClass("vjs-slider-active"),n.addClass("vjs-slider-active"),n.trigger("slideractive")}),n.on(n.volumeBar,["blur","sliderinactive"],function(){n.volumeBar.removeClass("vjs-slider-active"),n.removeClass("vjs-slider-active"),n.trigger("sliderinactive")}),n}return t.prototype.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},t.prototype.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchend",this.handleMouseUp)},t.prototype.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},t.prototype.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},t}(Xe);ln.prototype.options_={children:["volumeBar"]},Xe.registerComponent("VolumeControl",ln);var cn=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})},dn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return cn(n,i),n.on(i,["loadstart","volumechange"],n.update),n}return t.prototype.buildCSSClass=function(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)},t.prototype.handleClick=function(e){var t=this.player_.volume(),i=this.player_.lastVolume_();if(0===t){var r=i<.1?.1:i;this.player_.volume(r),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},t.prototype.update=function(e){this.updateIcon_(),this.updateControlText_()},t.prototype.updateIcon_=function(){var e=this.player_.volume(),t=3;tt&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var i=0;i<4;i++)j(this.el_,"vjs-vol-"+i);F(this.el_,"vjs-vol-"+t)},t.prototype.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)},t}(Br);dn.prototype.controlText_="Mute",Xe.registerComponent("MuteToggle",dn);var hn=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,t),void 0!==r.inline?r.inline=r.inline:r.inline=!0,(void 0===r.volumeControl||A(r.volumeControl))&&(r.volumeControl=r.volumeControl||{},r.volumeControl.vertical=!r.inline);var n=_(this,e.call(this,i,r));return n.on(i,["loadstart"],n.volumePanelState_),n.on(n.volumeControl,["slideractive"],n.sliderActive_),n.on(n.volumeControl,["sliderinactive"],n.sliderInactive_),n}return t.prototype.sliderActive_=function(){this.addClass("vjs-slider-active")},t.prototype.sliderInactive_=function(){this.removeClass("vjs-slider-active")},t.prototype.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},t.prototype.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},t}(Xe);hn.prototype.options_={children:["muteToggle","volumeControl"]},Xe.registerComponent("VolumePanel",hn);var fn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return r&&(n.menuButton_=r.menuButton),n.focusedChild_=-1,n.on("keydown",n.handleKeyPress),n}return t.prototype.addItem=function(e){this.addChild(e),e.on("click",Oe(this,function(t){this.menuButton_&&(this.menuButton_.unpressButton(),"CaptionSettingsMenuItem"!==e.name()&&this.menuButton_.focus())}))},t.prototype.createEl=function(){var t=this.options_.contentElType||"ul";this.contentEl_=M(t,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var i=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return i.appendChild(this.contentEl_),_e(i,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),i},t.prototype.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},t.prototype.handleKeyPress=function(e){37===e.which||40===e.which?(e.preventDefault(),this.stepForward()):38!==e.which&&39!==e.which||(e.preventDefault(),this.stepBack())},t.prototype.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},t.prototype.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},t.prototype.focus=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.children().slice();t.length&&t[0].className&&/vjs-menu-title/.test(t[0].className)&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},t}(Xe);Xe.registerComponent("Menu",fn);var pn=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,t);var n=_(this,e.call(this,i,r));n.menuButton_=new Br(i,r),n.menuButton_.controlText(n.controlText_),n.menuButton_.el_.setAttribute("aria-haspopup","true");var a=Br.prototype.buildCSSClass();return n.menuButton_.el_.className=n.buildCSSClass()+" "+a,n.menuButton_.removeClass("vjs-control"),n.addChild(n.menuButton_),n.update(),n.enabled_=!0,n.on(n.menuButton_,"tap",n.handleClick),n.on(n.menuButton_,"click",n.handleClick),n.on(n.menuButton_,"focus",n.handleFocus),n.on(n.menuButton_,"blur",n.handleBlur),n.on("keydown",n.handleSubmenuKeyPress),n}return t.prototype.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},t.prototype.createMenu=function(){var e=new fn(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=M("li",{className:"vjs-menu-title",innerHTML:qe(this.options_.title),tabIndex:-1});this.hideThreshold_+=1,e.children_.unshift(t),N(t,e.contentEl())}if(this.items=this.createItems(),this.items)for(var i=0;i<this.items.length;i++)e.addItem(this.items[i]);return e},t.prototype.createItems=function(){},t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},t.prototype.buildWrapperCSSClass=function(){var t="vjs-menu-button";!0===this.options_.inline?t+="-inline":t+="-popup";return"vjs-menu-button "+t+" "+Br.prototype.buildCSSClass()+" "+e.prototype.buildCSSClass.call(this)},t.prototype.buildCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)},t.prototype.controlText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.menuButton_.el();return this.menuButton_.controlText(e,t)},t.prototype.handleClick=function(e){this.one(this.menu.contentEl(),"mouseleave",Oe(this,function(e){this.unpressButton(),this.el_.blur()})),this.buttonPressed_?this.unpressButton():this.pressButton()},t.prototype.focus=function(){this.menuButton_.focus()},t.prototype.blur=function(){this.menuButton_.blur()},t.prototype.handleFocus=function(){_e(l,"keydown",Oe(this,this.handleKeyPress))},t.prototype.handleBlur=function(){be(l,"keydown",Oe(this,this.handleKeyPress))},t.prototype.handleKeyPress=function(e){27===e.which||9===e.which?(this.buttonPressed_&&this.unpressButton(),9!==e.which&&(e.preventDefault(),this.menuButton_.el_.focus())):38!==e.which&&40!==e.which||this.buttonPressed_||(this.pressButton(),e.preventDefault())},t.prototype.handleSubmenuKeyPress=function(e){27!==e.which&&9!==e.which||(this.buttonPressed_&&this.unpressButton(),9!==e.which&&(e.preventDefault(),this.menuButton_.el_.focus()))},t.prototype.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),tt&&P())return;this.menu.focus()}},t.prototype.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},t.prototype.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},t.prototype.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},t}(Xe);Xe.registerComponent("MenuButton",pn);var mn=function(e){v(t,e);function t(i,r){y(this,t);var n=r.tracks,a=_(this,e.call(this,i,r));if(a.items.length<=1&&a.hide(),!n)return _(a);var s=Oe(a,a.update);return n.addEventListener("removetrack",s),n.addEventListener("addtrack",s),a.player_.on("ready",s),a.player_.on("dispose",function(){n.removeEventListener("removetrack",s),n.removeEventListener("addtrack",s)}),a}return t}(pn);Xe.registerComponent("TrackButton",mn);var gn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.selectable=r.selectable,n.isSelected_=r.selected||!1,n.multiSelectable=r.multiSelectable,n.selected(n.isSelected_),n.selectable?n.multiSelectable?n.el_.setAttribute("role","menuitemcheckbox"):n.el_.setAttribute("role","menuitemradio"):n.el_.setAttribute("role","menuitem"),n}return t.prototype.createEl=function(t,i,r){return this.nonIconControl=!0,e.prototype.createEl.call(this,"li",k({className:"vjs-menu-item",innerHTML:'<span class="vjs-menu-item-text">'+this.localize(this.options_.label)+"</span>",tabIndex:-1},i),r)},t.prototype.handleClick=function(e){this.selected(!0)},t.prototype.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(Dr);Xe.registerComponent("MenuItem",gn);var yn=function(e){v(t,e);function t(i,r){y(this,t);var a=r.track,s=i.textTracks();r.label=a.label||a.language||"Unknown",r.selected="showing"===a.mode;var o=_(this,e.call(this,i,r));o.track=a;var u=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];o.handleTracksChange.apply(o,t)},c=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];o.handleSelectedLanguageChange.apply(o,t)};if(i.on(["loadstart","texttrackchange"],u),s.addEventListener("change",u),s.addEventListener("selectedlanguagechange",c),o.on("dispose",function(){i.off(["loadstart","texttrackchange"],u),s.removeEventListener("change",u),s.removeEventListener("selectedlanguagechange",c)}),void 0===s.onchange){var d=void 0;o.on(["tap","click"],function(){if("object"!==g(n.Event))try{d=new n.Event("change")}catch(e){}d||(d=l.createEvent("Event")).initEvent("change",!0,!0),s.dispatchEvent(d)})}return o.handleTracksChange(),o}return t.prototype.handleClick=function(t){var i=this.track.kind,r=this.track.kinds,n=this.player_.textTracks();if(r||(r=[i]),e.prototype.handleClick.call(this,t),n)for(var a=0;a<n.length;a++){var s=n[a];s===this.track&&r.indexOf(s.kind)>-1?"showing"!==s.mode&&(s.mode="showing"):"disabled"!==s.mode&&(s.mode="disabled")}},t.prototype.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},t.prototype.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},t.prototype.dispose=function(){this.track=null,e.prototype.dispose.call(this)},t}(gn);Xe.registerComponent("TextTrackMenuItem",yn);var vn=function(e){v(t,e);function t(i,r){return y(this,t),r.track={player:i,kind:r.kind,kinds:r.kinds,default:!1,mode:"disabled"},r.kinds||(r.kinds=[r.kind]),r.label?r.track.label=r.label:r.track.label=r.kinds.join(" and ")+" off",r.selectable=!0,r.multiSelectable=!1,_(this,e.call(this,i,r))}return t.prototype.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!0,r=0,n=t.length;r<n;r++){var a=t[r];if(this.options_.kinds.indexOf(a.kind)>-1&&"showing"===a.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)},t.prototype.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),i=!0,r=0,n=t.length;r<n;r++){var a=t[r];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&"showing"===a.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(yn);Xe.registerComponent("OffTextTrackMenuItem",vn);var _n=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return y(this,t),r.tracks=i.textTracks(),_(this,e.call(this,i,r))}return t.prototype.createItems=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yn,i=void 0;this.label_&&(i=this.label_+" off"),e.push(new vn(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;var r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var n=0;n<r.length;n++){var a=r[n];if(this.kinds_.indexOf(a.kind)>-1){var s=new t(this.player_,{track:a,selectable:!0,multiSelectable:!1});s.addClass("vjs-"+a.kind+"-menu-item"),e.push(s)}}return e},t}(mn);Xe.registerComponent("TextTrackButton",_n);var bn=function(e){v(t,e);function t(i,r){y(this,t);var n=r.track,a=r.cue,s=i.currentTime();r.selectable=!0,r.multiSelectable=!1,r.label=a.text,r.selected=a.startTime<=s&&s<a.endTime;var o=_(this,e.call(this,i,r));return o.track=n,o.cue=a,n.addEventListener("cuechange",Oe(o,o.update)),o}return t.prototype.handleClick=function(t){e.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},t.prototype.update=function(e){var t=this.cue,i=this.player_.currentTime();this.selected(t.startTime<=i&&i<t.endTime)},t}(gn);Xe.registerComponent("ChaptersTrackMenuItem",bn);var Tn=function(e){v(t,e);function t(i,r,n){return y(this,t),_(this,e.call(this,i,r,n))}return t.prototype.buildCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildWrapperCSSClass.call(this)},t.prototype.update=function(t){this.track_&&(!t||"addtrack"!==t.type&&"removetrack"!==t.type)||this.setTrack(this.findChaptersTrack()),e.prototype.update.call(this)},t.prototype.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var i=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);i&&i.addEventListener("load",this.updateHandler_)}}},t.prototype.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var i=e[t];if(i.kind===this.kind_)return i}},t.prototype.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(qe(this.kind_))},t.prototype.createMenu=function(){return this.options_.title=this.getMenuCaption(),e.prototype.createMenu.call(this)},t.prototype.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var i=0,r=t.length;i<r;i++){var n=t[i],a=new bn(this.player_,{track:this.track_,cue:n});e.push(a)}return e},t}(_n);Tn.prototype.kind_="chapters",Tn.prototype.controlText_="Chapters",Xe.registerComponent("ChaptersButton",Tn);var Sn=function(e){v(t,e);function t(i,r,n){y(this,t);var a=_(this,e.call(this,i,r,n)),s=i.textTracks(),o=Oe(a,a.handleTracksChange);return s.addEventListener("change",o),a.on("dispose",function(){s.removeEventListener("change",o)}),a}return t.prototype.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!1,r=0,n=t.length;r<n;r++){var a=t[r];if(a.kind!==this.kind_&&"showing"===a.mode){i=!0;break}}i?this.disable():this.enable()},t.prototype.buildCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(_n);Sn.prototype.kind_="descriptions",Sn.prototype.controlText_="Descriptions",Xe.registerComponent("DescriptionsButton",Sn);var En=function(e){v(t,e);function t(i,r,n){return y(this,t),_(this,e.call(this,i,r,n))}return t.prototype.buildCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(_n);En.prototype.kind_="subtitles",En.prototype.controlText_="Subtitles",Xe.registerComponent("SubtitlesButton",En);var kn=function(e){v(t,e);function t(i,r){y(this,t),r.track={player:i,kind:r.kind,label:r.kind+" settings",selectable:!1,default:!1,mode:"disabled"},r.selectable=!1,r.name="CaptionSettingsMenuItem";var n=_(this,e.call(this,i,r));return n.addClass("vjs-texttrack-settings"),n.controlText(", opens "+r.kind+" settings dialog"),n}return t.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},t}(yn);Xe.registerComponent("CaptionSettingsMenuItem",kn);var wn=function(e){v(t,e);function t(i,r,n){return y(this,t),_(this,e.call(this,i,r,n))}return t.prototype.buildCSSClass=function(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-captions-button "+e.prototype.buildWrapperCSSClass.call(this)},t.prototype.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new kn(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t)},t}(_n);wn.prototype.kind_="captions",wn.prototype.controlText_="Captions",Xe.registerComponent("CaptionsButton",wn);var An=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(t,i,r){var n='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);"captions"===this.options_.track.kind&&(n+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Captions")+"</span>\n      "),n+="</span>";return e.prototype.createEl.call(this,t,k({innerHTML:n},i),r)},t}(yn);Xe.registerComponent("SubsCapsMenuItem",An);var Ln=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,t);var n=_(this,e.call(this,i,r));return n.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(n.player_.language_)>-1&&(n.label_="captions"),n.menuButton_.controlText(qe(n.label_)),n}return t.prototype.buildCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildWrapperCSSClass.call(this)},t.prototype.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new kn(this.player_,{kind:this.label_})),this.hideThreshold_+=1),t=e.prototype.createItems.call(this,t,An)},t}(_n);Ln.prototype.kinds_=["captions","subtitles"],Ln.prototype.controlText_="Subtitles",Xe.registerComponent("SubsCapsButton",Ln);var Cn=function(e){v(t,e);function t(i,r){y(this,t);var n=r.track,a=i.audioTracks();r.label=n.label||n.language||"Unknown",r.selected=n.enabled;var s=_(this,e.call(this,i,r));s.track=n,s.addClass("vjs-"+n.kind+"-menu-item");var o=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];s.handleTracksChange.apply(s,t)};return a.addEventListener("change",o),s.on("dispose",function(){a.removeEventListener("change",o)}),s}return t.prototype.createEl=function(t,i,r){var n='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);"main-desc"===this.options_.track.kind&&(n+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Descriptions")+"</span>\n      "),n+="</span>";return e.prototype.createEl.call(this,t,k({innerHTML:n},i),r)},t.prototype.handleClick=function(t){var i=this.player_.audioTracks();e.prototype.handleClick.call(this,t);for(var r=0;r<i.length;r++){var n=i[r];n.enabled=n===this.track}},t.prototype.handleTracksChange=function(e){this.selected(this.track.enabled)},t}(gn);Xe.registerComponent("AudioTrackMenuItem",Cn);var Rn=function(e){v(t,e);function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return y(this,t),r.tracks=i.audioTracks(),_(this,e.call(this,i,r))}return t.prototype.buildCSSClass=function(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-audio-button "+e.prototype.buildWrapperCSSClass.call(this)},t.prototype.createItems=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.hideThreshold_=1;for(var t=this.player_.audioTracks(),i=0;i<t.length;i++){var r=t[i];e.push(new Cn(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e},t}(mn);Rn.prototype.controlText_="Audio Track",Xe.registerComponent("AudioTrackButton",Rn);var On=function(e){v(t,e);function t(i,r){y(this,t);var n=r.rate,a=parseFloat(n,10);r.label=n,r.selected=1===a,r.selectable=!0,r.multiSelectable=!1;var s=_(this,e.call(this,i,r));return s.label=n,s.rate=a,s.on(i,"ratechange",s.update),s}return t.prototype.handleClick=function(t){e.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},t.prototype.update=function(e){this.selected(this.player().playbackRate()===this.rate)},t}(gn);On.prototype.contentElType="button",Xe.registerComponent("PlaybackRateMenuItem",On);var Dn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.updateVisibility(),n.updateLabel(),n.on(i,"loadstart",n.updateVisibility),n.on(i,"ratechange",n.updateLabel),n}return t.prototype.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelEl_=M("div",{className:"vjs-playback-rate-value",innerHTML:"1x"}),t.appendChild(this.labelEl_),t},t.prototype.dispose=function(){this.labelEl_=null,e.prototype.dispose.call(this)},t.prototype.buildCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)},t.prototype.buildWrapperCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildWrapperCSSClass.call(this)},t.prototype.createMenu=function(){var e=new fn(this.player()),t=this.playbackRates();if(t)for(var i=t.length-1;i>=0;i--)e.addChild(new On(this.player(),{rate:t[i]+"x"}));return e},t.prototype.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},t.prototype.handleClick=function(e){for(var t=this.player().playbackRate(),i=this.playbackRates(),r=i[0],n=0;n<i.length;n++)if(i[n]>t){r=i[n];break}this.player().playbackRate(r)},t.prototype.playbackRates=function(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates},t.prototype.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},t.prototype.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},t.prototype.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},t}(pn);Dn.prototype.controlText_="Playback Rate",Xe.registerComponent("PlaybackRateMenuButton",Dn);var In=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.buildCSSClass=function(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)},t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},t}(Xe);Xe.registerComponent("Spacer",In);var Pn=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,{className:this.buildCSSClass()});return t.innerHTML=" ",t},t}(In);Xe.registerComponent("CustomControlSpacer",Pn);var xn=function(e){v(t,e);function t(){return y(this,t),_(this,e.apply(this,arguments))}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},t}(Xe);xn.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},Xe.registerComponent("ControlBar",xn);var Mn=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r));return n.on(i,"error",n.open),n}return t.prototype.buildCSSClass=function(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)},t.prototype.content=function(){var e=this.player().error();return e?this.localize(e.message):""},t}(xt);Mn.prototype.options_=Ke(xt.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),Xe.registerComponent("ErrorDisplay",Mn);var Un="vjs-text-track-settings",Nn=["#000","Black"],Bn=["#00F","Blue"],Fn=["#0FF","Cyan"],jn=["#0F0","Green"],Gn=["#F0F","Magenta"],Vn=["#F00","Red"],Hn=["#FFF","White"],zn=["#FF0","Yellow"],Wn=["1","Opaque"],qn=["0.5","Semi-Transparent"],Kn=["0","Transparent"],Xn={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Nn,Hn,Vn,jn,Bn,zn,Gn,Fn]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Wn,qn,Kn]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Hn,Nn,Vn,jn,Bn,zn,Gn,Fn]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(e){return"1.00"===e?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Wn,qn]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[Kn,qn,Wn]}};Xn.windowColor.options=Xn.backgroundColor.options;function Yn(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}var $n=function(e){v(t,e);function t(i,r){y(this,t),r.temporary=!1;var n=_(this,e.call(this,i,r));return n.updateDisplay=Oe(n,n.updateDisplay),n.fill(),n.hasBeenOpened_=n.hasBeenFilled_=!0,n.endDialog=M("p",{className:"vjs-control-text",textContent:n.localize("End of dialog window.")}),n.el().appendChild(n.endDialog),n.setDefaults(),void 0===r.persistTextTrackSettings&&(n.options_.persistTextTrackSettings=n.options_.playerOptions.persistTextTrackSettings),n.on(n.$(".vjs-done-button"),"click",function(){n.saveSettings(),n.close()}),n.on(n.$(".vjs-default-button"),"click",function(){n.setDefaults(),n.updateDisplay()}),E(Xn,function(e){n.on(n.$(e.selector),"change",n.updateDisplay)}),n.options_.persistTextTrackSettings&&n.restoreSettings(),n}return t.prototype.dispose=function(){this.endDialog=null,e.prototype.dispose.call(this)},t.prototype.createElSelect_=function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"label",n=Xn[e],a=n.id.replace("%s",this.id_),s=[i,a].join(" ").trim();return["<"+r+' id="'+a+'" class="'+("label"===r?"vjs-label":"")+'">',this.localize(n.label),"</"+r+">",'<select aria-labelledby="'+s+'">'].concat(n.options.map(function(e){var i=a+"-"+e[1].replace(/\W+/g,"");return['<option id="'+i+'" value="'+e[0]+'" ','aria-labelledby="'+s+" "+i+'">',t.localize(e[1]),"</option>"].join("")})).concat("</select>").join("")},t.prototype.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},t.prototype.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},t.prototype.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},t.prototype.createElColors_=function(){return M("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},t.prototype.createElFont_=function(){return M("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},t.prototype.createElControls_=function(){var e=this.localize("restore all settings to the default values");return M("div",{className:"vjs-track-settings-controls",innerHTML:['<button class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},t.prototype.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},t.prototype.label=function(){return this.localize("Caption Settings Dialog")},t.prototype.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},t.prototype.buildCSSClass=function(){return e.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},t.prototype.getValues=function(){var e=this;return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return S(e).reduce(function(i,r){return t(i,e[r],r)},i)}(Xn,function(t,i,r){var n,a,s=(n=e.$(i.selector),a=i.parser,Yn(n.options[n.options.selectedIndex].value,a));return void 0!==s&&(t[r]=s),t},{})},t.prototype.setValues=function(e){var t=this;E(Xn,function(i,r){!function(e,t,i){if(t)for(var r=0;r<e.options.length;r++)if(Yn(e.options[r].value,i)===t){e.selectedIndex=r;break}}(t.$(i.selector),e[r],i.parser)})},t.prototype.setDefaults=function(){var e=this;E(Xn,function(t){var i=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=i})},t.prototype.restoreSettings=function(){var e=void 0;try{e=JSON.parse(n.localStorage.getItem(Un))}catch(e){p.warn(e)}e&&this.setValues(e)},t.prototype.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?n.localStorage.setItem(Un,JSON.stringify(e)):n.localStorage.removeItem(Un)}catch(e){p.warn(e)}}},t.prototype.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},t.prototype.conditionalBlur_=function(){this.previouslyActiveEl_=null,this.off(l,"keydown",this.handleKeyDown);var e=this.player_.controlBar,t=e&&e.subsCapsButton,i=e&&e.captionsButton;t?t.focus():i&&i.focus()},t}(xt);Xe.registerComponent("TextTrackSettings",$n);var Qn=function(e){v(t,e);function t(i,r){y(this,t);var a=r.ResizeObserver||n.ResizeObserver;null===r.ResizeObserver&&(a=!1);var s=Ke({createEl:!a,reportTouchActivity:!1},r),o=_(this,e.call(this,i,s));return o.ResizeObserver=r.ResizeObserver||n.ResizeObserver,o.loadListener_=null,o.resizeObserver_=null,o.debouncedHandler_=Ie(function(){o.resizeHandler()},100,!1,o),a?(o.resizeObserver_=new o.ResizeObserver(o.debouncedHandler_),o.resizeObserver_.observe(i.el())):(o.loadListener_=function(){o.el_&&o.el_.contentWindow&&_e(o.el_.contentWindow,"resize",o.debouncedHandler_)},o.one("load",o.loadListener_)),o}return t.prototype.createEl=function(){return e.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager"})},t.prototype.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},t.prototype.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.el_&&this.el_.contentWindow&&be(this.el_.contentWindow,"resize",this.debouncedHandler_),this.loadListener_&&this.off("load",this.loadListener_),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null},t}(Xe);Xe.registerComponent("ResizeManager",Qn);var Jn=function(e){var t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;var i=e.$$("source"),r=[],n="";if(!i.length)return!1;for(var a=0;a<i.length;a++){var s=i[a].src;s&&-1===r.indexOf(s)&&r.push(s)}return!!r.length&&(1===r.length&&(n=r[0]),e.triggerSourceset(n),!0)},Zn=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(e){var t=l.createElement(this.nodeName.toLowerCase());t.innerHTML=e;for(var i=l.createDocumentFragment();t.childNodes.length;)i.appendChild(t.childNodes[0]);return this.innerText="",n.Element.prototype.appendChild.call(this,i),this.innerHTML}}),ea=function(e,t){for(var i={},r=0;r<e.length&&!((i=Object.getOwnPropertyDescriptor(e[r],t))&&i.set&&i.get);r++);return i.enumerable=!0,i.configurable=!0,i},ta=function(e){var t=e.el();if(!t.resetSourceWatch_){var i,r={},a=(i=e,ea([i.el(),n.HTMLMediaElement.prototype,n.Element.prototype,Zn],"innerHTML")),s=function(i){return function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];var s=i.apply(t,n);return Jn(e),s}};["append","appendChild","insertAdjacentHTML"].forEach(function(e){t[e]&&(r[e]=t[e],t[e]=s(r[e]))}),Object.defineProperty(t,"innerHTML",Ke(a,{set:s(a.set)})),t.resetSourceWatch_=function(){t.resetSourceWatch_=null,Object.keys(r).forEach(function(e){t[e]=r[e]}),Object.defineProperty(t,"innerHTML",a)},e.one("sourceset",t.resetSourceWatch_)}},ia=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?$t(n.Element.prototype.getAttribute.call(this,"src")):""},set:function(e){return n.Element.prototype.setAttribute.call(this,"src",e),e}}),ra=function(e){if(e.featuresSourceset){var t=e.el();if(!t.resetSourceset_){var i,r=(i=e,ea([i.el(),n.HTMLMediaElement.prototype,ia],"src")),a=t.setAttribute,s=t.load;Object.defineProperty(t,"src",Ke(r,{set:function(i){var n=r.set.call(t,i);return e.triggerSourceset(t.src),n}})),t.setAttribute=function(i,r){var n=a.call(t,i,r);return/src/i.test(i)&&e.triggerSourceset(t.src),n},t.load=function(){var i=s.call(t);return Jn(e)||(e.triggerSourceset(""),ta(e)),i},t.currentSrc?e.triggerSourceset(t.currentSrc):Jn(e)||ta(e),t.resetSourceset_=function(){t.resetSourceset_=null,t.load=s,t.setAttribute=a,Object.defineProperty(t,"src",r),t.resetSourceWatch_&&t.resetSourceWatch_()}}}},na=b(["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."],["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."]),aa=function(e){v(t,e);function t(i,r){y(this,t);var n=_(this,e.call(this,i,r)),a=i.source,s=!1;if(a&&(n.el_.currentSrc!==a.src||i.tag&&3===i.tag.initNetworkState_)?n.setSource(a):n.handleLateInit_(n.el_),i.enableSourceset&&n.setupSourcesetHandling_(),n.el_.hasChildNodes()){for(var o=n.el_.childNodes,u=o.length,l=[];u--;){var c=o[u];"track"===c.nodeName.toLowerCase()&&(n.featuresNativeTextTracks?(n.remoteTextTrackEls().addTrackElement_(c),n.remoteTextTracks().addTrack(c.track),n.textTracks().addTrack(c.track),s||n.el_.hasAttribute("crossorigin")||!Jt(c.src)||(s=!0)):l.push(c))}for(var d=0;d<l.length;d++)n.el_.removeChild(l[d])}return n.proxyNativeTracks_(),n.featuresNativeTextTracks&&s&&p.warn(m(na)),n.restoreMetadataTracksInIOSNativePlayer_(),(ft||Ze||at)&&!0===i.nativeControlsForTouch&&n.setControls(!0),n.proxyWebkitFullscreen_(),n.triggerReady(),n}return t.prototype.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),t.disposeMediaElement(this.el_),this.options_=null,e.prototype.dispose.call(this)},t.prototype.setupSourcesetHandling_=function(){ra(this)},t.prototype.restoreMetadataTracksInIOSNativePlayer_=function(){var e=this.textTracks(),t=void 0,i=function(){t=[];for(var i=0;i<e.length;i++){var r=e[i];"metadata"===r.kind&&t.push({track:r,storedMode:r.mode})}};i(),e.addEventListener("change",i),this.on("dispose",function(){return e.removeEventListener("change",i)});var r=function i(){for(var r=0;r<t.length;r++){var n=t[r];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",i)};this.on("webkitbeginfullscreen",function(){e.removeEventListener("change",i),e.removeEventListener("change",r),e.addEventListener("change",r)}),this.on("webkitendfullscreen",function(){e.removeEventListener("change",i),e.addEventListener("change",i),e.removeEventListener("change",r)})},t.prototype.overrideNative_=function(e,t){var i=this;if(t===this["featuresNative"+e+"Tracks"]){var r=e.toLowerCase();this[r+"TracksListeners_"]&&Object.keys(this[r+"TracksListeners_"]).forEach(function(e){i.el()[r+"Tracks"].removeEventListener(e,i[r+"TracksListeners_"][e])}),this["featuresNative"+e+"Tracks"]=!t,this[r+"TracksListeners_"]=null,this.proxyNativeTracksForType_(r)}},t.prototype.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},t.prototype.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},t.prototype.proxyNativeTracksForType_=function(e){var t=this,i=Pi[e],r=this.el()[i.getterName],n=this[i.getterName]();if(this["featuresNative"+i.capitalName+"Tracks"]&&r&&r.addEventListener){var a={change:function(e){n.trigger({type:"change",target:n,currentTarget:n,srcElement:n})},addtrack:function(e){n.addTrack(e.track)},removetrack:function(e){n.removeTrack(e.track)}},s=function(){for(var e=[],t=0;t<n.length;t++){for(var i=!1,a=0;a<r.length;a++)if(r[a]===n[t]){i=!0;break}i||e.push(n[t])}for(;e.length;)n.removeTrack(e.shift())};this[i.getterName+"Listeners_"]=a,Object.keys(a).forEach(function(e){var i=a[e];r.addEventListener(e,i),t.on("dispose",function(t){return r.removeEventListener(e,i)})}),this.on("loadstart",s),this.on("dispose",function(e){return t.off("loadstart",s)})}},t.prototype.proxyNativeTracks_=function(){var e=this;Pi.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},t.prototype.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var i=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(i,e),t.disposeMediaElement(e),e=i}else{e=l.createElement("video");var r=Ke({},this.options_.tag&&H(this.options_.tag));ft&&!0===this.options_.nativeControlsForTouch||delete r.controls,V(e,k(r,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&W(e,"preload",this.options_.preload);for(var n=["loop","muted","playsinline","autoplay","stretch","fluent"],a=0;a<n.length;a++){var s=n[a],o=this.options_[s];void 0!==o&&(o?W(e,s,s):q(e,s),e[s]=o)}return e},t.prototype.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,i=function(){t=!0};this.on("loadstart",i);var r=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",r),void this.ready(function(){this.off("loadstart",i),this.off("loadedmetadata",r),t||this.trigger("loadstart")})}var n=["loadstart"];n.push("loadedmetadata"),e.readyState>=2&&n.push("loadeddata"),e.readyState>=3&&n.push("canplay"),e.readyState>=4&&n.push("canplaythrough"),this.ready(function(){n.forEach(function(e){this.trigger(e)},this)})}},t.prototype.setCurrentTime=function(e){try{this.el_.currentTime=e}catch(e){p(e,"Video is not ready. (Video.js)")}},t.prototype.duration=function(){var e=this;if(this.el_.duration===1/0&&rt&&ut&&0===this.el_.currentTime){var t=function t(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))};return this.on("timeupdate",t),NaN}return this.el_.duration||NaN},t.prototype.width=function(){return this.el_.offsetWidth},t.prototype.height=function(){return this.el_.offsetHeight},t.prototype.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},i=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0}))};this.on("webkitbeginfullscreen",i),this.on("dispose",function(){e.off("webkitbeginfullscreen",i),e.off("webkitendfullscreen",t)})}},t.prototype.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=n.navigator&&n.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},t.prototype.enterFullScreen=function(){var e=this.el_;e.paused&&e.networkState<=e.HAVE_METADATA?(this.el_.play(),this.setTimeout(function(){e.pause(),e.webkitEnterFullScreen()},0)):e.webkitEnterFullScreen()},t.prototype.exitFullScreen=function(){this.el_.webkitExitFullScreen()},t.prototype.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},t.prototype.reset=function(){t.resetMediaElement(this.el_)},t.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},t.prototype.setControls=function(e){this.el_.controls=!!e},t.prototype.addTextTrack=function(t,i,r){return this.featuresNativeTextTracks?this.el_.addTextTrack(t,i,r):e.prototype.addTextTrack.call(this,t,i,r)},t.prototype.createRemoteTextTrack=function(t){if(!this.featuresNativeTextTracks)return e.prototype.createRemoteTextTrack.call(this,t);var i=l.createElement("track");return t.kind&&(i.kind=t.kind),t.label&&(i.label=t.label),(t.language||t.srclang)&&(i.srclang=t.language||t.srclang),t.default&&(i.default=t.default),t.id&&(i.id=t.id),t.src&&(i.src=t.src),i},t.prototype.addRemoteTextTrack=function(t,i){var r=e.prototype.addRemoteTextTrack.call(this,t,i);return this.featuresNativeTextTracks&&this.el().appendChild(r),r},t.prototype.removeRemoteTextTrack=function(t){if(e.prototype.removeRemoteTextTrack.call(this,t),this.featuresNativeTextTracks)for(var i=this.$$("track"),r=i.length;r--;)t!==i[r]&&t!==i[r].track||this.el().removeChild(i[r])},t.prototype.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),n.performance&&"function"==typeof n.performance.now?e.creationTime=n.performance.now():n.performance&&n.performance.timing&&"number"==typeof n.performance.timing.navigationStart&&(e.creationTime=n.Date.now()-n.performance.timing.navigationStart),e},t}(yr);if(D()){aa.TEST_VID=l.createElement("video");var sa=l.createElement("track");sa.kind="captions",sa.srclang="en",sa.label="English",aa.TEST_VID.appendChild(sa)}aa.isSupported=function(){try{aa.TEST_VID.volume=.5}catch(e){return!1}return!(!aa.TEST_VID||!aa.TEST_VID.canPlayType)},aa.canPlayType=function(e){return aa.TEST_VID.canPlayType(e)},aa.canPlaySource=function(e,t){return aa.canPlayType(e.type)},aa.canControlVolume=function(){try{var e=aa.TEST_VID.volume;return aa.TEST_VID.volume=e/2+.1,e!==aa.TEST_VID.volume}catch(e){return!1}},aa.canMuteVolume=function(){try{var e=aa.TEST_VID.muted;return aa.TEST_VID.muted=!e,aa.TEST_VID.muted?W(aa.TEST_VID,"muted","muted"):q(aa.TEST_VID,"muted"),e!==aa.TEST_VID.muted}catch(e){return!1}},aa.canControlPlaybackRate=function(){if(rt&&ut&&lt<58)return!1;try{var e=aa.TEST_VID.playbackRate;return aa.TEST_VID.playbackRate=e/2+.1,e!==aa.TEST_VID.playbackRate}catch(e){return!1}},aa.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(l.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(l.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(l.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(l.createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},aa.supportsNativeTextTracks=function(){return ht||tt&&ut},aa.supportsNativeVideoTracks=function(){return!(!aa.TEST_VID||!aa.TEST_VID.videoTracks)},aa.supportsNativeAudioTracks=function(){return!(!aa.TEST_VID||!aa.TEST_VID.audioTracks)},aa.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],aa.prototype.featuresVolumeControl=aa.canControlVolume(),aa.prototype.featuresMuteControl=aa.canMuteVolume(),aa.prototype.featuresPlaybackRate=aa.canControlPlaybackRate(),aa.prototype.featuresSourceset=aa.canOverrideAttributes(),aa.prototype.movingMediaElementInDOM=!tt,aa.prototype.featuresFullscreenResize=!0,aa.prototype.featuresProgressEvents=!0,aa.prototype.featuresTimeupdateEvents=!0,aa.prototype.featuresNativeTextTracks=aa.supportsNativeTextTracks(),aa.prototype.featuresNativeVideoTracks=aa.supportsNativeVideoTracks(),aa.prototype.featuresNativeAudioTracks=aa.supportsNativeAudioTracks();var oa=aa.TEST_VID&&aa.TEST_VID.constructor.prototype.canPlayType,ua=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;aa.patchCanPlayType=function(){nt>=4&&!st&&!ut&&(aa.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&ua.test(e)?"maybe":oa.call(this,e)})},aa.unpatchCanPlayType=function(){var e=aa.TEST_VID.constructor.prototype.canPlayType;return aa.TEST_VID.constructor.prototype.canPlayType=oa,e},aa.patchCanPlayType(),aa.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},aa.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll("source"),i=t.length;i--;)e.removeChild(t[i]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},["muted","defaultMuted","autoplay","stretch","fluent","controls","loop","playsinline"].forEach(function(e){aa.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){aa.prototype["set"+qe(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","played","networkState","readyState","videoWidth","videoHeight"].forEach(function(e){aa.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate"].forEach(function(e){aa.prototype["set"+qe(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){aa.prototype[e]=function(){return this.el_[e]()}}),yr.withSourceHandlers(aa),aa.nativeSourceHandler={},aa.nativeSourceHandler.canPlayType=function(e){try{return aa.TEST_VID.canPlayType(e)}catch(e){return""}},aa.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return aa.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=Qt(e.src);return aa.nativeSourceHandler.canPlayType("video/"+i)}return""},aa.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},aa.nativeSourceHandler.dispose=function(){},aa.registerSourceHandler(aa.nativeSourceHandler),yr.registerTech("Html5",aa);var la=b(["\n        Using the tech directly can be dangerous. I hope you know what you're doing.\n        See https://github.com/videojs/video.js/issues/2617 for more info.\n      "],["\n        Using the tech directly can be dangerous. I hope you know what you're doing.\n        See https://github.com/videojs/video.js/issues/2617 for more info.\n      "]),ca=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],da={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},ha=function(t){v(i,t);function i(r,n,a){if(y(this,i),r.id=r.id||n.id||"vjs_video_"+ue(),(n=k(i.getTagSettings(r),n)).initChildren=!1,n.createEl=!1,n.evented=!1,n.reportTouchActivity=!1,!n.language)if("function"==typeof r.closest){var s=r.closest("[lang]");s&&s.getAttribute&&(n.language=s.getAttribute("lang"))}else for(var o=r;o&&1===o.nodeType;){if(H(o).hasOwnProperty("lang")){n.language=o.getAttribute("lang");break}o=o.parentNode}var u=_(this,t.call(this,null,n,a));if(u.isPosterFromTech_=!1,u.queuedCallbacks_=[],u.isReady_=!1,u.hasStarted_=!1,u.userActive_=!1,!u.options_||!u.options_.techOrder||!u.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(u.tag=r,u.tagAttributes=r&&H(r),u.language(u.options_.language),n.languages){var l={};Object.getOwnPropertyNames(n.languages).forEach(function(e){l[e.toLowerCase()]=n.languages[e]}),u.languages_=l}else u.languages_=i.prototype.options_.languages;u.cache_={},u.poster_=n.poster||"",u.controls_=!!n.controls,u.cache_.lastVolume=1,r.controls=!1,r.removeAttribute("controls"),r.hasAttribute("autoplay")?u.options_.autoplay=!0:u.autoplay(u.options_.autoplay),u.scrubbing_=!1,u.el_=u.createEl(),u.cache_.lastPlaybackRate=u.defaultPlaybackRate(),He(u,{eventBusKey:"el_"});var c=Ke(u.options_);if(n.plugins){var d=n.plugins;Object.keys(d).forEach(function(e){if("function"!=typeof this[e])throw new Error('plugin "'+e+'" does not exist');this[e](d[e])},u)}u.options_.playerOptions=c,u.middleware_=[],u.initChildren(),u.isAudio("audio"===r.nodeName.toLowerCase()),u.controls()?u.addClass("vjs-controls-enabled"):u.addClass("vjs-controls-disabled"),u.el_.setAttribute("role","region"),u.isAudio()?u.el_.setAttribute("aria-label",u.localize("Audio Player")):u.el_.setAttribute("aria-label",u.localize("Video Player")),u.isAudio()&&u.addClass("vjs-audio"),u.flexNotSupported_()&&u.addClass("vjs-no-flex"),tt||u.addClass("vjs-workinghover"),i.players[u.id_]=u;var h=e.split(".")[0];return u.addClass("vjs-v"+h),u.userActive(!0),u.reportUserActivity(),u.one("play",u.listenForUserActivity_),u.on("fullscreenchange",u.handleFullscreenChange_),u.on("stageclick",u.handleStageClick_),u.changingSrc_=!1,u.playWaitingForReady_=!1,u.playOnLoadstart_=null,u}return i.prototype.dispose=function(){this.trigger("dispose"),this.off("dispose"),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),i.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),_r[this.id()]=null;t.prototype.dispose.call(this)},i.prototype.createEl=function(){var e=this.tag,i=void 0,r=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player"),a="video-js"===this.tag.tagName.toLowerCase();r?i=this.el_=e.parentNode:a||(i=this.el_=t.prototype.createEl.call(this,"div"));var s=H(e);if(a){for(i=this.el_=e,e=this.tag=l.createElement("video");i.children.length;)e.appendChild(i.firstChild);B(i,"video-js")||F(i,"video-js"),i.appendChild(e),r=this.playerElIngest_=i,Object.keys(i).forEach(function(t){e[t]=i[t]})}if(e.setAttribute("tabindex","-1"),s.tabindex="-1",ct&&(e.setAttribute("role","application"),s.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(t){a&&"class"===t||i.setAttribute(t,s[t]),a&&e.setAttribute(t,s[t])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=i.player=this,this.addClass("vjs-paused"),!0!==n.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Ce("vjs-styles-dimensions");var o=ne(".vjs-styles-defaults"),u=ne("head");u.insertBefore(this.styleEl_,o?o.nextSibling:u.firstChild)}this.width(this.options_.width),this.height(this.options_.height),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio);for(var c=e.getElementsByTagName("a"),d=0;d<c.length;d++){var h=c.item(d);F(h,"vjs-hidden"),h.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!r&&e.parentNode.insertBefore(i,e),N(e,i),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_=i,i},i.prototype.width=function(e){return this.dimension("width",e)},i.prototype.height=function(e){return this.dimension("height",e)},i.prototype.dimension=function(e,t){var i=e+"_";if(void 0===t)return this[i]||0;if(""===t)return this[i]=void 0,void this.updateStyleEl_();var r=parseFloat(t);isNaN(r)?p.error('Improper value "'+t+'" supplied for for '+e):(this[i]=r,this.updateStyleEl_())},i.prototype.fluid=function(e){if(void 0===e)return!!this.fluid_;this.fluid_=!!e,e?this.addClass("vjs-fluid"):this.removeClass("vjs-fluid"),this.updateStyleEl_()},i.prototype.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},i.prototype.updateStyleEl_=function(){if(!0!==n.VIDEOJS_NO_DYNAMIC_STYLE){var e=void 0,t=void 0,i=void 0,r=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),a=r[1]/r[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/a:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*a,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),Re(this.styleEl_,"\n      ."+i+" {\n        width: "+e+"px;\n        height: "+t+"px;\n      }\n\n      ."+i+".vjs-fluid {\n        padding-top: "+100*a+"%;\n      }\n    ")}else{var s="number"==typeof this.width_?this.width_:this.options_.width,o="number"==typeof this.height_?this.height_:this.options_.height,u=this.tech_&&this.tech_.el();u&&(s>=0&&(u.width=s),o>=0&&(u.height=o))}},i.prototype.loadTech_=function(e,t){var i=this;this.tech_&&this.unloadTech_();var r=qe(e),n=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==r&&this.tag&&(yr.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=r,this.isReady_=!1;var a={source:t,autoplay:"string"!=typeof this.autoplay()&&this.autoplay(),nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+n+"_api",playsinline:this.options_.playsinline,stretch:this.options_.stretch,fluent:this.options_.fluent,preload:this.options_.preload,loop:this.options_.loop,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};Mi.names.forEach(function(e){var t=Mi[e];a[t.getterName]=i[t.privateName]}),k(a,this.options_[r]),k(a,this.options_[n]),k(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);var s=yr.getTech(e);if(!s)throw new Error("No Tech named '"+r+"' exists! '"+r+"' should be registered using videojs.registerTech()'");this.tech_=new s(a),this.tech_.ready(Oe(this,this.handleTechReady_),!0),It(this.textTracksJson_||[],this.tech_),ca.forEach(function(e){i.on(i.tech_,e,i["handleTech"+qe(e)+"_"])}),Object.keys(da).forEach(function(e){i.on(i.tech_,e,function(t){0===i.tech_.playbackRate()&&i.tech_.seeking()?i.queuedCallbacks_.push({callback:i["handleTech"+da[e]+"_"].bind(i),event:t}):i["handleTech"+da[e]+"_"](t)})}),this.on(this.tech_,"loadstart",this.handleTechLoadStart_),this.on(this.tech_,"sourceset",this.handleTechSourceset_),this.on(this.tech_,"waiting",this.handleTechWaiting_),this.on(this.tech_,"ended",this.handleTechEnded_),this.on(this.tech_,"seeking",this.handleTechSeeking_),this.on(this.tech_,"play",this.handleTechPlay_),this.on(this.tech_,"firstplay",this.handleTechFirstPlay_),this.on(this.tech_,"pause",this.handleTechPause_),this.on(this.tech_,"durationchange",this.handleTechDurationChange_),this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_),this.on(this.tech_,"fullscreentoggle",this.handleTechFullscreenToggle_),this.on(this.tech_,"error",this.handleTechError_),this.on(this.tech_,"loadedmetadata",this.updateStyleEl_),this.on(this.tech_,"posterchange",this.handleTechPosterChange_),this.on(this.tech_,"textdata",this.handleTechTextData_),this.on(this.tech_,"ratechange",this.handleTechRateChange_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===r&&this.tag||N(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},i.prototype.unloadTech_=function(){var e=this;Mi.names.forEach(function(t){var i=Mi[t];e[i.privateName]=e[i.getterName]()}),this.textTracksJson_=Dt(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},i.prototype.tech=function(e){return void 0===e&&p.warn(m(la)),this.tech_},i.prototype.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"mousedown",this.handleTechClick_),this.on(this.tech_,"dblclick",this.handleTechDoubleClick_),this.on(this.tech_,"touchstart",this.handleTechTouchStart_),this.on(this.tech_,"touchmove",this.handleTechTouchMove_),this.on(this.tech_,"touchend",this.handleTechTouchEnd_),this.on(this.tech_,"tap",this.handleTechTap_)},i.prototype.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.handleTechTap_),this.off(this.tech_,"touchstart",this.handleTechTouchStart_),this.off(this.tech_,"touchmove",this.handleTechTouchMove_),this.off(this.tech_,"touchend",this.handleTechTouchEnd_),this.off(this.tech_,"mousedown",this.handleTechClick_),this.off(this.tech_,"dblclick",this.handleTechDoubleClick_)},i.prototype.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},i.prototype.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay())},i.prototype.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var i=function(){var e=t.muted();t.muted(!0);var i=t.play();if(i&&i.then&&i.catch)return i.catch(function(i){t.muted(e)})},r=void 0;if("any"===e?(r=this.play())&&r.then&&r.catch&&r.catch(function(){return i()}):r="muted"===e?i():this.play(),r&&r.then&&r.catch)return r.then(function(){t.trigger({type:"autoplay-success",autoplay:e})}).catch(function(i){t.trigger({type:"autoplay-failure",autoplay:e})})}},i.prototype.updateSourceCaches_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e,i="";if("string"!=typeof t&&(t=e.src,i=e.type),!/^blob:/.test(t)){this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=function(e,t){if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var i=e.cache_.sources.filter(function(e){return e.src===t});if(i.length)return i[0].type;for(var r=e.$$("source"),n=0;n<r.length;n++){var a=r[n];if(a.type&&a.src&&a.src===t)return a.type}return Cr(t)}(this,t)),this.cache_.source=Ke({},e,{src:t,type:i});for(var r=this.cache_.sources.filter(function(e){return e.src&&e.src===t}),n=[],a=this.$$("source"),s=[],o=0;o<a.length;o++){var u=H(a[o]);n.push(u),u.src&&u.src===t&&s.push(u.src)}s.length&&!r.length?this.cache_.sources=n:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}},i.prototype.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_&&(this.updateSourceCaches_(e.src),!e.src)){var i=function e(i){"sourceset"!==i.type&&t.updateSourceCaches_(t.techGet_("currentSrc")),t.tech_.off(["sourceset","loadstart"],e)};this.tech_.one(["sourceset","loadstart"],i)}this.trigger({src:e.src,type:"sourceset"})},i.prototype.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},i.prototype.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},i.prototype.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},i.prototype.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting"),this.one("timeupdate",function(){return e.removeClass("vjs-waiting")})},i.prototype.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},i.prototype.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},i.prototype.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},i.prototype.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},i.prototype.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.trigger("seeked")},i.prototype.handleTechFirstPlay_=function(){this.options_.starttime&&(p.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},i.prototype.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},i.prototype.handleTechEnded_=function(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},i.prototype.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},i.prototype.handleTechClick_=function(e){re(e)&&this.controls_&&this.paused()},i.prototype.handleTechDoubleClick_=function(e){if(this.controls_){Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(t){return t.contains(e.target)})||(this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}},i.prototype.handleTechTap_=function(){this.userActive(!this.userActive())},i.prototype.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},i.prototype.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},i.prototype.handleTechTouchEnd_=function(e){e.preventDefault()},i.prototype.handleFullscreenChange_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},i.prototype.handleStageClick_=function(){this.reportUserActivity()},i.prototype.handleTechFullscreenChange_=function(e,t){t&&this.isFullscreen(t.isFullscreen),this.trigger("fullscreenchange")},i.prototype.handleTechFullscreenToggle_=function(e,t){this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()},i.prototype.handleTechError_=function(){var e=this.tech_.error();this.error(e)},i.prototype.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},i.prototype.getCache=function(){return this.cache_},i.prototype.techCall_=function(e,t){this.ready(function(){if(e in kr)return i=this.middleware_,r=this.tech_,a=t,r[n=e](i.reduce(Ar(n),a));if(e in wr)return Sr(this.middleware_,this.tech_,e,t);var i,r,n,a;try{this.tech_&&this.tech_[e](t)}catch(e){throw p(e),e}},!0)},i.prototype.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Er)return t=this.middleware_,i=this.tech_,r=e,t.reduceRight(Ar(r),i[r]());if(e in wr)return Sr(this.middleware_,this.tech_,e);var t,i,r;try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw p("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t;if("TypeError"===t.name)throw p("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t;throw p(t),t}}},i.prototype.play=function(){var e=this,t=this.options_.Promise||n.Promise;return t?new t(function(t){e.play_(t)}):this.play_()},i.prototype.play_=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt;if(this.playOnLoadstart_&&this.off("loadstart",this.playOnLoadstart_),this.isReady_){if(!this.changingSrc_&&(this.src()||this.currentSrc()))return void t(this.techGet_("play"));this.playOnLoadstart_=function(){e.playOnLoadstart_=null,t(e.play())},this.one("loadstart",this.playOnLoadstart_)}else{if(this.playWaitingForReady_)return;this.playWaitingForReady_=!0,this.ready(function(){e.playWaitingForReady_=!1,t(e.play())})}},i.prototype.pause=function(){this.techCall_("pause")},i.prototype.paused=function(){return!1!==this.techGet_("paused")},i.prototype.played=function(){return this.techGet_("played")||yt(0,0)},i.prototype.scrubbing=function(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},i.prototype.currentTime=function(e){return void 0!==e?(e<0&&(e=0),void this.techCall_("setCurrentTime",e)):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},i.prototype.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),this.trigger("durationchange"))},i.prototype.remainingTime=function(){return this.duration()-this.currentTime()},i.prototype.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},i.prototype.buffered=function(){var e=this.techGet_("buffered");return e&&e.length||(e=yt(0,0)),e},i.prototype.bufferedPercent=function(){return vt(this.buffered(),this.duration())},i.prototype.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),i=e.end(e.length-1);return i>t&&(i=t),i},i.prototype.volume=function(e){var t=void 0;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},i.prototype.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},i.prototype.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},i.prototype.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},i.prototype.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},i.prototype.isFullscreen=function(e){if(void 0===e)return!!this.isFullscreen_;this.isFullscreen_=!!e},i.prototype.requestFullscreen=function(){var e=_t;this.isFullscreen(!0),e.requestFullscreen?(_e(l,e.fullscreenchange,Oe(this,function t(i){this.isFullscreen(l[e.fullscreenElement]),!1===this.isFullscreen()&&be(l,e.fullscreenchange,t),this.trigger("fullscreenchange")})),this.el_[e.requestFullscreen]()):this.tech_.supportsFullScreen()?this.techCall_("enterFullScreen"):(this.enterFullWindow(),this.trigger("fullscreenchange"))},i.prototype.exitFullscreen=function(){var e=_t;this.isFullscreen(!1),e.requestFullscreen?l[e.exitFullscreen]():this.tech_.supportsFullScreen()?this.techCall_("exitFullScreen"):(this.exitFullWindow(),this.trigger("fullscreenchange"))},i.prototype.enterFullWindow=function(){this.isFullWindow=!0,this.docOrigOverflow=l.documentElement.style.overflow,_e(l,"keydown",Oe(this,this.fullWindowOnEscKey)),l.documentElement.style.overflow="hidden",F(l.body,"vjs-full-window"),this.trigger("enterFullWindow")},i.prototype.fullWindowOnEscKey=function(e){27===e.keyCode&&(!0===this.isFullscreen()?this.exitFullscreen():this.exitFullWindow())},i.prototype.exitFullWindow=function(){this.isFullWindow=!1,be(l,"keydown",this.fullWindowOnEscKey),l.documentElement.style.overflow=this.docOrigOverflow,j(l.body,"vjs-full-window"),this.trigger("exitFullWindow")},i.prototype.canPlayType=function(e){for(var t=void 0,i=0,r=this.options_.techOrder;i<r.length;i++){var n=r[i],a=yr.getTech(n);if(a||(a=Xe.getComponent(n)),a){if(a.isSupported()&&(t=a.canPlayType(e)))return t}else p.error('The "'+n+'" tech is undefined. Skipped browser support check for that tech.')}return""},i.prototype.selectSource=function(e){var t,i=this,r=this.options_.techOrder.map(function(e){return[e,yr.getTech(e)]}).filter(function(e){var t=e[0],i=e[1];return i?i.isSupported():(p.error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),n=function(e,t,i){var r=void 0;return e.some(function(e){return t.some(function(t){if(r=i(e,t))return!0})}),r},a=function(e,t){var r=e[0];if(e[1].canPlaySource(t,i.options_[r.toLowerCase()]))return{source:t,tech:r}};return(this.options_.sourceOrder?n(e,r,(t=a,function(e,i){return t(i,e)})):n(r,e,a))||!1},i.prototype.src=function(e){var t=this;if(void 0===e)return this.cache_.src||"";var i=function e(t){if(Array.isArray(t)){var i=[];t.forEach(function(t){t=e(t),Array.isArray(t)?i=i.concat(t):w(t)&&i.push(t)}),t=i}else t="string"==typeof t&&t.trim()?[Rr({src:t})]:w(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[Rr(t)]:[];return t}(e);i.length?(this.changingSrc_=!0,this.cache_.sources=i,this.updateSourceCaches_(i[0]),Tr(this,i[0],function(e,r){t.middleware_=r,t.cache_.sources=i,t.updateSourceCaches_(e);if(t.src_(e))return i.length>1?t.src(i.slice(1)):(t.changingSrc_=!1,t.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void t.triggerReady());n=r,a=t.tech_,n.forEach(function(e){return e.setTech&&e.setTech(a)});var n,a})):this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)},i.prototype.src_=function(e){var t=this,i=this.selectSource([e]);if(!i)return!0;if(r=i.tech,n=this.techName_,qe(r)!==qe(n))return this.changingSrc_=!0,this.loadTech_(i.tech,i.source),this.tech_.ready(function(){t.changingSrc_=!1}),!1;var r,n;return this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1},i.prototype.load=function(){this.techCall_("load")},i.prototype.reset=function(){this.tech_&&this.tech_.clearTracks("text"),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset")},i.prototype.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},i.prototype.currentSource=function(){return this.cache_.source||{}},i.prototype.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},i.prototype.currentType=function(){return this.currentSource()&&this.currentSource().type||""},i.prototype.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},i.prototype.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t=void 0;"string"==typeof e&&/(any|play|muted)/.test(e)?(this.options_.autoplay=e,this.manualAutoplay_(e),t=!1):this.options_.autoplay=!!e,t=t||this.options_.autoplay,this.tech_&&this.techCall_("setAutoplay",t)},i.prototype.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},i.prototype.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},i.prototype.stretch=function(e){return void 0!==e?(this.techCall_("setStretch",e),this.options_.stretch=e,this):this.techGet_("stretch",e)},i.prototype.fluent=function(e){return void 0!=e?(this.techCall_("setFluent",e),this.options_.fluent=e,this):this.techGet_("fluent",e)},i.prototype.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},i.prototype.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},i.prototype.controls=function(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},i.prototype.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},i.prototype.error=function(e){return void 0===e?this.error_||null:null===e?(this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close())):(this.error_=new wt(e),this.addClass("vjs-error"),p.error("(CODE:"+this.error_.code+" "+wt.errorTypes[this.error_.code]+")",this.error_.message,this.error_),void this.trigger("error"))},i.prototype.reportUserActivity=function(e){this.userActivity_=!0},i.prototype.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},i.prototype.listenForUserActivity_=function(){var e=void 0,t=void 0,i=void 0,r=Oe(this,this.reportUserActivity);this.on("mousedown",function(){r(),this.clearInterval(e),e=this.setInterval(r,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===i||(t=e.screenX,i=e.screenY,r())}),this.on("mouseup",function(t){r(),this.clearInterval(e)}),this.on("keydown",r),this.on("keyup",r);var n=void 0;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(n);var e=this.options_.inactivityTimeout;e<=0||(n=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))}},250)},i.prototype.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},i.prototype.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},i.prototype.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},i.prototype.addTextTrack=function(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)},i.prototype.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},i.prototype.removeRemoteTextTrack=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).track,t=void 0===e?arguments[0]:e;if(this.tech_)return this.tech_.removeRemoteTextTrack(t)},i.prototype.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},i.prototype.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},i.prototype.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},i.prototype.language=function(e){if(void 0===e)return this.language_;this.language_=String(e).toLowerCase()},i.prototype.languages=function(){return Ke(i.prototype.options_.languages,this.languages_)},i.prototype.toJSON=function(){var e=Ke(this.options_),t=e.tracks;e.tracks=[];for(var i=0;i<t.length;i++){var r=t[i];(r=Ke(r)).player=void 0,e.tracks[i]=r}return e},i.prototype.createModal=function(e,t){var i=this;(t=t||{}).content=e||"";var r=new xt(this,t);return this.addChild(r),r.on("dispose",function(){i.removeChild(r)}),r.open(),r},i.getTagSettings=function(e){var t={sources:[],tracks:[]},i=H(e),r=i["data-setup"];if(B(e,"vjs-fluid")&&(i.fluid=!0),null!==r){var n=Lt(r||"{}"),a=n[0],s=n[1];a&&p.error(a),k(i,s)}if(k(t,i),e.hasChildNodes())for(var o=e.childNodes,u=0,l=o.length;u<l;u++){var c=o[u],d=c.nodeName.toLowerCase();"source"===d?t.sources.push(H(c)):"track"===d&&t.tracks.push(H(c))}return t},i.prototype.flexNotSupported_=function(){var e=l.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},i}(Xe);Mi.names.forEach(function(e){var t=Mi[e];ha.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),ha.players={};var fa=n.navigator;ha.prototype.options_={techOrder:yr.defaultTechOrder_,html5:{},flash:{},inactivityTimeout:2e3,playbackRates:[],children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:fa&&(fa.languages&&fa.languages[0]||fa.userLanguage||fa.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media."},["ended","seeking","seekable","networkState","readyState"].forEach(function(e){ha.prototype[e]=function(){return this.techGet_(e)}}),ca.forEach(function(e){ha.prototype["handleTech"+qe(e)+"_"]=function(){return this.trigger(e)}}),Xe.registerComponent("Player",ha);var pa="activePlugins_",ma={},ga=function(e){return ma.hasOwnProperty(e)},ya=function(e){return ga(e)?ma[e]:void 0},va=function(e,t){e[pa]=e[pa]||{},e[pa][t]=!0},_a=function(e,t,i){var r=(i?"before":"")+"pluginsetup";e.trigger(r,t),e.trigger(r+":"+t.name,t)},ba=function(e,t){return t.prototype.name=e,function(){_a(this,{name:e,plugin:t,instance:null},!0);for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];var a=new(Function.prototype.bind.apply(t,[null].concat([this].concat(r))));return this[e]=function(){return a},_a(this,a.getEventHash()),a}},Ta=function(){function e(t){if(y(this,e),this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,He(this),delete this.trigger,We(this,this.constructor.defaultState),va(t,this.name),this.dispose=Oe(this,this.dispose),t.on("dispose",this.dispose)}return e.prototype.version=function(){return this.constructor.VERSION},e.prototype.getEventHash=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.name=this.name,e.plugin=this.constructor,e.instance=this,e},e.prototype.trigger=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Te(this.eventBusEl_,e,this.getEventHash(t))},e.prototype.handleStateChanged=function(e){},e.prototype.dispose=function(){var e=this.name,t=this.player;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[pa][e]=!1,this.player=this.state=null,t[e]=ba(e,ma[e])},e.isBasic=function(t){var i="string"==typeof t?ya(t):t;return"function"==typeof i&&!e.prototype.isPrototypeOf(i.prototype)},e.registerPlugin=function(t,i){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+(void 0===t?"undefined":g(t))+".");if(ga(t))p.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(ha.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof i)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+(void 0===i?"undefined":g(i))+".");return ma[t]=i,"plugin"!==t&&(e.isBasic(i)?ha.prototype[t]=function(e,t){var i=function(){_a(this,{name:e,plugin:t,instance:null},!0);var i=t.apply(this,arguments);return va(this,e),_a(this,{name:e,plugin:t,instance:i}),i};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i}(t,i):ha.prototype[t]=ba(t,i)),i},e.deregisterPlugin=function(e){if("plugin"===e)throw new Error("Cannot de-register base plugin.");ga(e)&&(delete ma[e],delete ha.prototype[e])},e.getPlugins=function(){var e=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(ma)).forEach(function(t){var i=ya(t);i&&((e=e||{})[t]=i)}),e},e.getPluginVersion=function(e){var t=ya(e);return t&&t.VERSION||""},e}();Ta.getPlugin=ya,Ta.BASE_PLUGIN_NAME="plugin",Ta.registerPlugin("plugin",Ta),ha.prototype.usingPlugin=function(e){return!!this[pa]&&!0===this[pa][e]},ha.prototype.hasPlugin=function(e){return!!ga(e)};var Sa=function(e){return 0===e.indexOf("#")?e.slice(1):e};function Ea(e,t,i){var r=Ea.getPlayer(e);if(r)return t&&p.warn('Player "'+e+'" is already initialised. Options will not be applied.'),i&&r.ready(i),r;var n="string"==typeof e?ne("#"+Sa(e)):e;if(!I(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");l.body.contains(n)||p.warn("The element supplied is not included in the DOM"),t=t||{},Ea.hooks("beforesetup").forEach(function(e){var i=e(n,Ke(t));w(i)&&!Array.isArray(i)?t=Ke(t,i):p.error("please return an object in beforesetup hooks")});var a=Xe.getComponent("Player");return r=new a(n,t,i),Ea.hooks("setup").forEach(function(e){return e(r)}),r}if(Ea.hooks_={},Ea.hooks=function(e,t){return Ea.hooks_[e]=Ea.hooks_[e]||[],t&&(Ea.hooks_[e]=Ea.hooks_[e].concat(t)),Ea.hooks_[e]},Ea.hook=function(e,t){Ea.hooks(e,t)},Ea.hookOnce=function(e,t){Ea.hooks(e,[].concat(t).map(function(t){return function i(){return Ea.removeHook(e,i),t.apply(void 0,arguments)}}))},Ea.removeHook=function(e,t){var i=Ea.hooks(e).indexOf(t);return!(i<=-1)&&(Ea.hooks_[e]=Ea.hooks_[e].slice(),Ea.hooks_[e].splice(i,1),!0)},!0!==n.VIDEOJS_NO_DYNAMIC_STYLE&&D()){var ka=ne(".vjs-styles-defaults");if(!ka){ka=Ce("vjs-styles-defaults");var wa=ne("head");wa&&wa.insertBefore(ka,wa.firstChild),Re(ka,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}Le(1,Ea),Ea.VERSION=e,Ea.options=ha.prototype.options_,Ea.getPlayers=function(){return ha.players},Ea.getPlayer=function(e){var t=ha.players,i=void 0;if("string"==typeof e){var r=Sa(e),n=t[r];if(n)return n;i=ne("#"+r)}else i=e;if(I(i)){var a=i,s=a.player,o=a.playerId;if(s||t[o])return s||t[o]}},Ea.getAllPlayers=function(){return Object.keys(ha.players).map(function(e){return ha.players[e]}).filter(Boolean)},Ea.players=ha.players,Ea.getComponent=Xe.getComponent,Ea.registerComponent=function(e,t){yr.isTech(t)&&p.warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),Xe.registerComponent.call(Xe,e,t)},Ea.getTech=yr.getTech,Ea.registerTech=yr.registerTech,Ea.use=function(e,t){vr[e]=vr[e]||[],vr[e].push(t)},Object.defineProperty(Ea,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(Ea.middleware,"TERMINATOR",{value:br,writeable:!1,enumerable:!0}),Ea.browser=pt,Ea.TOUCH_ENABLED=ft,Ea.extend=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=function(){e.apply(this,arguments)},r={};"object"===(void 0===t?"undefined":g(t))?(t.constructor!==Object.prototype.constructor&&(i=t.constructor),r=t):"function"==typeof t&&(i=t),function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":g(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.super_=t)}(i,e);for(var n in r)r.hasOwnProperty(n)&&(i.prototype[n]=r[n]);return i},Ea.mergeOptions=Ke,Ea.bind=Oe,Ea.registerPlugin=Ta.registerPlugin,Ea.deregisterPlugin=Ta.deregisterPlugin,Ea.plugin=function(e,t){return p.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Ta.registerPlugin(e,t)},Ea.getPlugins=Ta.getPlugins,Ea.getPlugin=Ta.getPlugin,Ea.getPluginVersion=Ta.getPluginVersion,Ea.addLanguage=function(e,t){var i;return e=(""+e).toLowerCase(),Ea.options.languages=Ke(Ea.options.languages,(i={},i[e]=t,i)),Ea.options.languages[e]},Ea.log=p,Ea.createTimeRange=Ea.createTimeRanges=yt,Ea.formatTime=zr,Ea.setFormatTime=function(e){Hr=e},Ea.resetFormatTime=function(){Hr=Vr},Ea.parseUrl=Yt,Ea.isCrossOrigin=Jt,Ea.EventTarget=Pe,Ea.on=_e,Ea.one=Se,Ea.off=be,Ea.trigger=Te,Ea.xhr=Ti,Ea.TextTrack=Li,Ea.AudioTrack=Ci,Ea.VideoTrack=Ri,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(e){Ea[e]=function(){return p.warn("videojs."+e+"() is deprecated; use videojs.dom."+e+"() instead"),se[e].apply(null,arguments)}}),Ea.computedStyle=L,Ea.dom=se,Ea.url=Zt;var Aa=i(function(e,t){!function(t){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=s.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=r.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;l.path=s.normalizePath(d)}else l.path=o.path,a.params||(l.params=o.params,a.query||(l.query=o.query));return null===l.path&&(l.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(l)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()}),La=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ca=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Ra=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":g(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Oa=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":g(t))&&"function"!=typeof t?e:t},Da=function(){function e(){La(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e].splice(i,1),i>-1},e.prototype.trigger=function(e){var t=this.listeners[e],i=void 0,r=void 0,n=void 0;if(t)if(2===arguments.length)for(r=t.length,i=0;i<r;++i)t[i].call(this,arguments[1]);else for(n=Array.prototype.slice.call(arguments,1),r=t.length,i=0;i<r;++i)t[i].apply(this,n)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),Ia=function(e){Ra(t,e);function t(){La(this,t);var i=Oa(this,e.call(this));return i.buffer="",i}return t.prototype.push=function(e){var t=void 0;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(Da),Pa=function(e){for(var t=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},r=t.length,n=void 0;r--;)""!==t[r]&&((n=/([^=]*)=(.*)/.exec(t[r]).slice(1))[0]=n[0].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^['"](.*)['"]$/g,"$1"),i[n[0]]=n[1]);return i},xa=function(e){Ra(t,e);function t(){La(this,t);var i=Oa(this,e.call(this));return i.customParsers=[],i}return t.prototype.push=function(e){var t=void 0,i=void 0;if(0!==(e=e.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"")).length)if("#"===e[0]){for(var r=0;r<this.customParsers.length;r++)if(this.customParsers[r].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),void this.trigger("data",i);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"totalduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),void this.trigger("data",i);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"byterange"},t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),void this.trigger("data",i);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"map"},t[1]){var n=Pa(t[1]);if(n.URI&&(i.uri=n.URI),n.BYTERANGE){var a=n.BYTERANGE.split("@"),s=a[0],o=a[1];i.byterange={},s&&(i.byterange.length=parseInt(s,10)),o&&(i.byterange.offset=parseInt(o,10))}}this.trigger("data",i)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"stream-inf"},t[1]){if(i.attributes=Pa(t[1]),i.attributes.RESOLUTION){var u=i.attributes.RESOLUTION.split("x"),l={};u[0]&&(l.width=parseInt(u[0],10)),u[1]&&(l.height=parseInt(u[1],10)),i.attributes.RESOLUTION=l}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}this.trigger("data",i)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return i={type:"tag",tagType:"media"},t[1]&&(i.attributes=Pa(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-ENDLIST/.exec(e))this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return i={type:"tag",tagType:"key"},t[1]&&(i.attributes=Pa(t[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void this.trigger("data",i);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return i={type:"tag",tagType:"start"},t[1]&&(i.attributes=Pa(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);this.trigger("data",{type:"tag",data:e.slice(4)})}}}else this.trigger("data",{type:"comment",text:e.slice(1)})}else this.trigger("data",{type:"uri",uri:e})},t.prototype.addParser=function(e){var t=this,i=e.expression,r=e.customType,n=e.dataParser,a=e.segment;"function"!=typeof n&&(n=function(e){return e}),this.customParsers.push(function(e){if(i.exec(e))return t.trigger("data",{type:"custom",data:n(e),customType:r,segment:a}),!0})},t}(Da),Ma=function(e){Ra(t,e);function t(){La(this,t);var i=Oa(this,e.call(this));i.lineStream=new Ia,i.parseStream=new xa,i.lineStream.pipe(i.parseStream);var r=i,n=[],a={},s=void 0,o=void 0,u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},l=0;return i.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},i.parseStream.on("data",function(e){var t=void 0,i=void 0;({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(a.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(a.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(a.duration=e.duration),0===e.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key:function(){e.attributes?"NONE"!==e.attributes.METHOD?e.attributes.URI?(e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),o={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(o.iv=e.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):o=null:this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,l=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){s={},e.uri&&(s.uri=e.uri),e.byterange&&(s.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes?(a.attributes||(a.attributes={}),Ca(a.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var r=this.manifest.mediaGroups[e.attributes.TYPE];r[e.attributes["GROUP-ID"]]=r[e.attributes["GROUP-ID"]]||{},t=r[e.attributes["GROUP-ID"]],(i={default:/yes/i.test(e.attributes.DEFAULT)}).default?i.autoselect=!0:i.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(i.language=e.attributes.LANGUAGE),e.attributes.URI&&(i.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(i.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(i.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(i.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=i}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){l+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),a.dateTimeString=e.dateTimeString,a.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=e.data},"cue-out-cont":function(){a.cueOutCont=e.data},"cue-in":function(){a.cueIn=e.data}})[e.tagType]||function(){}).call(r)},uri:function(){a.uri=e.uri,n.push(a),!this.manifest.targetDuration||"duration"in a||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),o&&(a.key=o),a.timeline=l,s&&(a.map=s),a={}},comment:function(){},custom:function(){e.segment?(a.custom=a.custom||{},a.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(r)}),i}return t.prototype.push=function(e){this.lineStream.push(e)},t.prototype.end=function(){this.lineStream.push("\n")},t.prototype.addParser=function(e){this.parseStream.addParser(e)},t}(Da),Ua=function(e){var t,i=e.attributes,r=e.segments,n={attributes:(t={NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:"",targetDuration:i.duration,segments:r,mediaSequence:r.length?r[0].number:1};return i.contentProtection&&(n.contentProtection=i.contentProtection),n},Na="function"==typeof Symbol&&"symbol"===g(Symbol.iterator)?function(e){return void 0===e?"undefined":g(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":g(e)},Ba=function(e){return!!e&&"object"===(void 0===e?"undefined":Na(e))},Fa=function e(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return i.reduce(function(t,i){return Object.keys(i).forEach(function(r){Array.isArray(t[r])&&Array.isArray(i[r])?t[r]=t[r].concat(i[r]):Ba(t[r])&&Ba(i[r])?t[r]=e(t[r],i[r]):t[r]=i[r]}),t},{})},ja=function(e,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=Aa.buildAbsoluteURL(n.location.href,e)),Aa.buildAbsoluteURL(e,t))},Ga=function(e){var t=e.baseUrl,i=void 0===t?"":t,r=e.source,n=void 0===r?"":r,a=e.range,s=void 0===a?"":a,o={uri:n,resolvedUri:ja(i||"",n)};if(s){var u=s.split("-"),l=parseInt(u[0],10),c=parseInt(u[1],10);o.byterange={length:c-l,offset:l}}return o},Va=function(e,t,i){var r=e.NOW,n=e.clientOffset,a=e.availabilityStartTime,s=e.timescale,o=void 0===s?1:s,u=e.start,l=void 0===u?0:u,c=e.minimumUpdatePeriod,d=(r+n)/1e3+(void 0===c?0:c)-(a+l);return Math.ceil((d*o-t)/i)},Ha=function(e,t){for(var i=e.type,r=void 0===i?"static":i,n=e.minimumUpdatePeriod,a=void 0===n?0:n,s=e.media,o=void 0===s?"":s,u=e.sourceDuration,l=e.timescale,c=void 0===l?1:l,d=e.startNumber,h=void 0===d?1:d,f=e.periodIndex,p=[],m=-1,g=0;g<t.length;g++){var y=t[g],v=y.d,_=y.r||0,b=y.t||0;m<0&&(m=b),b&&b>m&&(m=b);var T=void 0;if(_<0){var S=g+1;T=S===t.length?"dynamic"===r&&a>0&&o.indexOf("$Number$")>0?Va(e,m,v):(u*c-m)/v:(t[S].t-m)/v}else T=_+1;for(var E=h+p.length+T,k=h+p.length;k<E;)p.push({number:k,duration:v/c,time:m,timeline:f}),m+=v,k++}return p},za=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},Wa=function(e){if(!e.length)return[];for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t},qa={static:function(e){var t=e.duration,i=e.timescale,r=void 0===i?1:i,n=e.sourceDuration;return{start:0,end:Math.ceil(n/(t/r))}},dynamic:function(e){var t=e.NOW,i=e.clientOffset,r=e.availabilityStartTime,n=e.timescale,a=void 0===n?1:n,s=e.duration,o=e.start,u=void 0===o?0:o,l=e.minimumUpdatePeriod,c=void 0===l?0:l,d=e.timeShiftBufferDepth,h=void 0===d?1/0:d,f=(t+i)/1e3,p=r+u,m=f+c-p,g=Math.ceil(m*a/s),y=Math.floor((f-p-h)*a/s),v=Math.floor((f-p)*a/s);return{start:Math.max(0,y),end:Math.min(g,v)}}},Ka=function(e){var t,i=e.type,r=void 0===i?"static":i,n=e.duration,a=e.timescale,s=void 0===a?1:a,o=e.sourceDuration,u=qa[r](e),l=function(e,t){for(var i=[],r=e;r<t;r++)i.push(r);return i}(u.start,u.end).map((t=e,function(e,i){var r=t.duration,n=t.timescale,a=void 0===n?1:n,s=t.periodIndex,o=t.startNumber;return{number:(void 0===o?1:o)+e,duration:r/a,timeline:s,time:i*r}}));if("static"===r){var c=l.length-1;l[c].duration=o-n/s*c}return l},Xa=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Ya=function(e,t){return e.replace(Xa,(i=t,function(e,t,r,n){if("$$"===e)return"$";if(void 0===i[t])return e;var a=""+i[t];return"RepresentationID"===t?a:(n=r?parseInt(n,10):1,a.length>=n?a:""+new Array(n-a.length+1).join("0")+a)}));var i},$a=function(e,t){var i,r,n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},a=e.initialization,s=void 0===a?{sourceURL:"",range:""}:a,o=Ga({baseUrl:e.baseUrl,source:Ya(s.sourceURL,n),range:s.range});return(i=e,r=t,i.duration||r?i.duration?Ka(i):Ha(i,r):[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodIndex}]).map(function(t){n.Number=t.number,n.Time=t.time;var i=Ya(e.media||"",n);return{uri:i,timeline:t.timeline,duration:t.duration,resolvedUri:ja(e.baseUrl||"",i),map:o,number:t.number}})},Qa="INVALID_NUMBER_OF_PERIOD",Ja="DASH_EMPTY_MANIFEST",Za="DASH_INVALID_XML",es="NO_BASE_URL",ts="SEGMENT_TIME_UNSPECIFIED",is="UNSUPPORTED_UTC_TIMING_SCHEME",rs=function(e,t){var i=e.duration,r=e.segmentUrls,n=void 0===r?[]:r;if(!i&&!t||i&&t)throw new Error(ts);var a=n.map(function(t){return function(e,t){var i=e.baseUrl,r=e.initialization,n=void 0===r?{}:r,a=Ga({baseUrl:i,source:n.sourceURL,range:n.range}),s=Ga({baseUrl:i,source:t.media,range:t.mediaRange});return s.map=a,s}(e,t)}),s=void 0;i&&(s=Ka(e)),t&&(s=Ha(e,t));return s.map(function(e,t){if(a[t]){var i=a[t];return i.timeline=e.timeline,i.duration=e.duration,i.number=e.number,i}}).filter(function(e){return e})},ns=function(e){var t=e.baseUrl,i=e.initialization,r=void 0===i?{}:i,n=e.sourceDuration,a=e.timescale,s=void 0===a?1:a,o=e.indexRange,u=void 0===o?"":o,l=e.duration;if(!t)throw new Error(es);var c=Ga({baseUrl:t,source:r.sourceURL,range:r.range}),d=Ga({baseUrl:t,source:t,range:u});if(d.map=c,l){var h=Ka(e);h.length&&(d.duration=h[0].duration,d.timeline=h[0].timeline)}else n&&(d.duration=n/s,d.timeline=0);return d.number=0,[d]},as=function(e){var t=e.attributes,i=e.segmentInfo,r=void 0,n=void 0;if(i.template?(n=$a,r=Fa(t,i.template)):i.base?(n=ns,r=Fa(t,i.base)):i.list&&(n=rs,r=Fa(t,i.list)),!n)return{attributes:t};var a=n(r,i.timeline);if(r.duration){var s=r,o=s.duration,u=s.timescale,l=void 0===u?1:u;r.duration=o/l}else a.length?r.duration=a.reduce(function(e,t){return Math.max(e,Math.ceil(t.duration))},0):r.duration=0;return{attributes:r,segments:a}},ss=function(e,t){return Wa(e.childNodes).filter(function(e){return e.tagName===t})},os=function(e){return e.textContent.trim()},us=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var i=t.slice(1),r=i[0],n=i[1],a=i[2],s=i[3],o=i[4],u=i[5];return 31536e3*parseFloat(r||0)+2592e3*parseFloat(n||0)+86400*parseFloat(a||0)+3600*parseFloat(s||0)+60*parseFloat(o||0)+parseFloat(u||0)},ls={mediaPresentationDuration:function(e){return us(e)},availabilityStartTime:function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:function(e){return us(e)},timeShiftBufferDepth:function(e){return us(e)},start:function(e){return us(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?us(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},cs=function(e){return e&&e.attributes?Wa(e.attributes).reduce(function(e,t){var i=ls[t.name]||ls.DEFAULT;return e[t.name]=i(t.value),e},{}):{}};var ds,hs,fs,ps,ms,gs,ys,vs,_s,bs,Ts,Ss,Es,ks,ws,As,Ls,Cs,Rs,Os,Ds,Is,Ps,xs,Ms,Us,Ns,Bs,Fs,js,Gs,Vs,Hs,zs,Ws,qs,Ks,Xs,Ys={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},$s=function(e,t){return t.length?za(e.map(function(e){return t.map(function(t){return ja(e,os(t))})})):e},Qs=function(e){var t=ss(e,"SegmentTemplate")[0],i=ss(e,"SegmentList")[0],r=i&&ss(i,"SegmentURL").map(function(e){return Fa({tag:"SegmentURL"},cs(e))}),n=ss(e,"SegmentBase")[0],a=i||t,s=a&&ss(a,"SegmentTimeline")[0],o=i||n||t,u=o&&ss(o,"Initialization")[0],l=t&&cs(t);l&&u?l.initialization=u&&cs(u):l&&l.initialization&&(l.initialization={sourceURL:l.initialization});var c={template:l,timeline:s&&ss(s,"S").map(function(e){return cs(e)}),list:i&&Fa(cs(i),{segmentUrls:r,initialization:cs(u)}),base:n&&Fa(cs(n),{initialization:cs(u)})};return Object.keys(c).forEach(function(e){c[e]||delete c[e]}),c},Js=function(e){return e.reduce(function(e,t){var i=cs(t),r=Ys[i.schemeIdUri];if(r){e[r]={attributes:i};var a=ss(t,"cenc:pssh")[0];if(a){var s=os(a),o=s&&function(e){for(var t=n.atob(e),i=new Uint8Array(t.length),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(s);e[r].pssh=o}}return e},{})},Zs=function(e,t,i){return function(r){var n=cs(r),a=$s(t,ss(r,"BaseURL")),s=ss(r,"Role")[0],o={role:cs(s)},u=Fa(e,n,o),l=Js(ss(r,"ContentProtection"));Object.keys(l).length&&(u=Fa(u,{contentProtection:l}));var c=Qs(r),d=ss(r,"Representation"),h=Fa(i,c);return za(d.map((f=u,p=a,m=h,function(e){var t=ss(e,"BaseURL"),i=$s(p,t),r=Fa(f,cs(e)),n=Qs(e);return i.map(function(e){return{segmentInfo:Fa(m,n),attributes:Fa(r,{baseUrl:e})}})})));var f,p,m}},eo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.manifestUri,r=void 0===i?"":i,n=t.NOW,a=void 0===n?Date.now():n,s=t.clientOffset,o=void 0===s?0:s,u=ss(e,"Period");if(1!==u.length)throw new Error(Qa);var l=cs(e),c=$s([r],ss(e,"BaseURL"));return l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=a,l.clientOffset=o,za(u.map((d=l,h=c,function(e,t){var i=$s(h,ss(e,"BaseURL")),r=cs(e),n=Fa(d,r,{periodIndex:t}),a=ss(e,"AdaptationSet"),s=Qs(e);return za(a.map(Zs(n,i,s)))})));var d,h},to=function(e){if(""===e)throw new Error(Ja);var t=(new n.DOMParser).parseFromString(e,"application/xml"),i=t&&"MPD"===t.documentElement.tagName?t.documentElement:null;if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(Za);return i},io=function(e,t){return function(e){var t;if(!e.length)return{};var i=e[0].attributes,r=i.sourceDuration,n=i.minimumUpdatePeriod,a=void 0===n?0:n,s=e.filter(function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video"===t.contentType}).map(Ua),o=e.filter(function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio"===t.contentType}),u=e.filter(function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType}),l={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(t={AUDIO:{},VIDEO:{}},t["CLOSED-CAPTIONS"]={},t.SUBTITLES={},t),uri:"",duration:r,playlists:s,minimumUpdatePeriod:1e3*a};o.length&&(l.mediaGroups.AUDIO.audio=(c=o,c.reduce(function(e,t){var i=t.attributes.role&&t.attributes.role.value||"main",r=t.attributes.lang||"",n="main";return r&&(n=t.attributes.lang+" ("+i+")"),e[n]&&e[n].playlists[0].attributes.BANDWIDTH>t.attributes.bandwidth?e:(e[n]={language:r,autoselect:!0,default:"main"===i,playlists:[function(e){var t,i=e.attributes,r=e.segments,n={attributes:(t={NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:"",targetDuration:i.duration,segments:r,mediaSequence:r.length?r[0].number:1};return i.contentProtection&&(n.contentProtection=i.contentProtection),n}(t)],uri:""},e)},{})));var c;u.length&&(l.mediaGroups.SUBTITLES.subs=(d=u,d.reduce(function(e,t){var i=t.attributes.lang||"text";return e[i]?e:(e[i]={language:i,default:!1,autoselect:!1,playlists:[function(e){var t,i=e.attributes,r=e.segments;return void 0===r&&(r=[{uri:i.baseUrl,timeline:i.periodIndex,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration),{attributes:(t={NAME:i.id,BANDWIDTH:i.bandwidth},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:i.baseUrl||"",targetDuration:i.duration,segments:r,mediaSequence:r.length?r[0].number:1}}(t)],uri:""},e)},{})));var d;return l}(eo(to(e),t).map(as))},ro=function(e){return function(e){var t=ss(e,"UTCTiming")[0];if(!t)return null;var i=cs(t);switch(i.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":i.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":i.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":i.method="DIRECT",i.value=Date.parse(i.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(is)}return i}(to(e))},no={toUnsigned:function(e){return e>>>0}},ao=no.toUnsigned,so=Object.freeze({default:no,__moduleExports:no,toUnsigned:ao}),oo=(so&&no||so).toUnsigned,uo={findBox:ds=function(e,t){var i,r,n,a,s,o=[];if(!t.length)return null;for(i=0;i<e.byteLength;)r=oo(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]),n=hs(e.subarray(i+4,i+8)),a=r>1?i+r:e.byteLength,n===t[0]&&(1===t.length?o.push(e.subarray(i+8,a)):(s=ds(e.subarray(i+8,a),t.slice(1))).length&&(o=o.concat(s))),i=a;return o},parseType:hs=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},timescale:function(e){return ds(e,["moov","trak"]).reduce(function(e,t){var i,r,n,a,s;return(i=ds(t,["tkhd"])[0])?(r=i[0],a=oo(i[n=0===r?12:20]<<24|i[n+1]<<16|i[n+2]<<8|i[n+3]),(s=ds(t,["mdia","mdhd"])[0])?(n=0===(r=s[0])?12:20,e[a]=oo(s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]),e):null):null},{})},startTime:function(e,t){var i,r,n;return i=ds(t,["moof","traf"]),r=[].concat.apply([],i.map(function(t){return ds(t,["tfhd"]).map(function(i){var r,n;return r=oo(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),n=e[r]||9e4,(ds(t,["tfdt"]).map(function(e){var t,i;return t=e[0],i=oo(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(i*=Math.pow(2,32),i+=oo(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),i})[0]||1/0)/n})})),n=Math.min.apply(null,r),isFinite(n)?n:0},videoTrackIds:function(e){var t=[];return ds(e,["moov","trak"]).forEach(function(e){var i=ds(e,["mdia","hdlr"]),r=ds(e,["tkhd"]);i.forEach(function(e,i){var n,a,s=hs(e.subarray(8,12)),o=r[i];"vide"===s&&(a=0===(n=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?n.getUint32(12):n.getUint32(20),t.push(a))})}),t}},lo=Math.pow(2,32)-1;!function(){var e;if(Ms={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in Ms)Ms.hasOwnProperty(e)&&(Ms[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);Us=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),Bs=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Ns=new Uint8Array([0,0,0,1]),Fs=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),js=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Gs={video:Fs,audio:js},zs=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Hs=new Uint8Array([0,0,0,0,0,0,0,0]),Ws=new Uint8Array([0,0,0,0,0,0,0,0]),qs=Ws,Ks=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Xs=Ws,Vs=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),fs=function(e){var t,i,r=[],n=0;for(t=1;t<arguments.length;t++)r.push(arguments[t]);for(t=r.length;t--;)n+=r[t].byteLength;for(i=new Uint8Array(n+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(e,4),t=0,n=8;t<r.length;t++)i.set(r[t],n),n+=r[t].byteLength;return i},ps=function(){return fs(Ms.dinf,fs(Ms.dref,zs))},ms=function(e){return fs(Ms.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},gs=function(){return fs(Ms.ftyp,Us,Ns,Us,Bs)},Cs=function(e){return fs(Ms.hdlr,Gs[e])},ys=function(e){return fs(Ms.mdat,e)},Ls=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),fs(Ms.mdhd,t)},As=function(e){return fs(Ms.mdia,Ls(e),Cs(e.type),_s(e))},vs=function(e){return fs(Ms.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},_s=function(e){return fs(Ms.minf,"video"===e.type?fs(Ms.vmhd,Vs):fs(Ms.smhd,Hs),ps(),Os(e))},bs=function(e,t){for(var i=[],r=t.length;r--;)i[r]=Is(t[r]);return fs.apply(null,[Ms.moof,vs(e)].concat(i))},Ts=function(e){for(var t=e.length,i=[];t--;)i[t]=ks(e[t]);return fs.apply(null,[Ms.moov,Es(4294967295)].concat(i).concat(Ss(e)))},Ss=function(e){for(var t=e.length,i=[];t--;)i[t]=Ps(e[t]);return fs.apply(null,[Ms.mvex].concat(i))},Es=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return fs(Ms.mvhd,t)},Rs=function(e){var t,i,r=e.samples||[],n=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)t=r[i].flags,n[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return fs(Ms.sdtp,n)},Os=function(e){return fs(Ms.stbl,Ds(e),fs(Ms.stts,Xs),fs(Ms.stsc,qs),fs(Ms.stsz,Ks),fs(Ms.stco,Ws))},function(){var e,t;Ds=function(i){return fs(Ms.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===i.type?e(i):t(i))},e=function(e){var t,i=e.sps||[],r=e.pps||[],n=[],a=[];for(t=0;t<i.length;t++)n.push((65280&i[t].byteLength)>>>8),n.push(255&i[t].byteLength),n=n.concat(Array.prototype.slice.call(i[t]));for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));return fs(Ms.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),fs(Ms.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([i.length]).concat(n).concat([r.length]).concat(a))),fs(Ms.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},t=function(e){return fs(Ms.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),ms(e))}}(),ws=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return fs(Ms.tkhd,t)},Is=function(e){var t,i,r,n,a,s;return t=fs(Ms.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/(lo+1)),s=Math.floor(e.baseMediaDecodeTime%(lo+1)),i=fs(Ms.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),92,"audio"===e.type?(r=xs(e,92),fs(Ms.traf,t,i,r)):(n=Rs(e),r=xs(e,n.length+92),fs(Ms.traf,t,i,r,n))},ks=function(e){return e.duration=e.duration||4294967295,fs(Ms.trak,ws(e),As(e))},Ps=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),fs(Ms.trex,t)},function(){var e,t,i;i=function(e,t){var i=0,r=0,n=0,a=0;return e.length&&(void 0!==e[0].duration&&(i=1),void 0!==e[0].size&&(r=2),void 0!==e[0].flags&&(n=4),void 0!==e[0].compositionTimeOffset&&(a=8)),[0,0,i|r|n|a,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t=function(e,t){var r,n,a,s;for(t+=20+16*(n=e.samples||[]).length,r=i(n,t),s=0;s<n.length;s++)a=n[s],r=r.concat([(4278190080&a.duration)>>>24,(16711680&a.duration)>>>16,(65280&a.duration)>>>8,255&a.duration,(4278190080&a.size)>>>24,(16711680&a.size)>>>16,(65280&a.size)>>>8,255&a.size,a.flags.isLeading<<2|a.flags.dependsOn,a.flags.isDependedOn<<6|a.flags.hasRedundancy<<4|a.flags.paddingValue<<1|a.flags.isNonSyncSample,61440&a.flags.degradationPriority,15&a.flags.degradationPriority,(4278190080&a.compositionTimeOffset)>>>24,(16711680&a.compositionTimeOffset)>>>16,(65280&a.compositionTimeOffset)>>>8,255&a.compositionTimeOffset]);return fs(Ms.trun,new Uint8Array(r))},e=function(e,t){var r,n,a,s;for(t+=20+8*(n=e.samples||[]).length,r=i(n,t),s=0;s<n.length;s++)a=n[s],r=r.concat([(4278190080&a.duration)>>>24,(16711680&a.duration)>>>16,(65280&a.duration)>>>8,255&a.duration,(4278190080&a.size)>>>24,(16711680&a.size)>>>16,(65280&a.size)>>>8,255&a.size]);return fs(Ms.trun,new Uint8Array(r))},xs=function(i,r){return"audio"===i.type?e(i,r):t(i,r)}}();var co={ftyp:gs,mdat:ys,moof:bs,moov:Ts,initSegment:function(e){var t,i=gs(),r=Ts(e);return(t=new Uint8Array(i.byteLength+r.byteLength)).set(i),t.set(r,i.byteLength),t}},ho=co.ftyp,fo=co.mdat,po=co.moof,mo=co.moov,go=co.initSegment,yo=Object.freeze({default:co,__moduleExports:co,ftyp:ho,mdat:fo,moof:po,moov:mo,initSegment:go}),vo=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var r;return!!e[t]&&(r=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(r,1),r>-1)},this.trigger=function(t){var i,r,n,a;if(i=e[t])if(2===arguments.length)for(n=i.length,r=0;r<n;++r)i[r].call(this,arguments[1]);else{for(a=[],r=arguments.length,r=1;r<arguments.length;++r)a.push(arguments[r]);for(n=i.length,r=0;r<n;++r)i[r].apply(this,a)}},this.dispose=function(){e={}}}};vo.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},vo.prototype.push=function(e){this.trigger("data",e)},vo.prototype.flush=function(e){this.trigger("done",e)};var _o=vo,bo=Object.freeze({default:_o,__moduleExports:_o}),To=function(e,t){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},So={groupNalsIntoFrames:function(e){var t,i,r=[],n=[];for(r.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(i=e[t]).nalUnitType?(r.length&&(r.duration=i.dts-r.dts,n.push(r)),(r=[i]).byteLength=i.data.byteLength,r.pts=i.pts,r.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(r.keyFrame=!0),r.duration=i.dts-r.dts,r.byteLength+=i.data.byteLength,r.push(i));return n.length&&(!r.duration||r.duration<=0)&&(r.duration=n[n.length-1].duration),n.push(r),n},groupFramesIntoGops:function(e){var t,i,r=[],n=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,t=0;t<e.length;t++)(i=e[t]).keyFrame?(r.length&&(n.push(r),n.byteLength+=r.byteLength,n.nalCount+=r.nalCount,n.duration+=r.duration),(r=[i]).nalCount=i.length,r.byteLength=i.byteLength,r.pts=i.pts,r.dts=i.dts,r.duration=i.duration):(r.duration+=i.duration,r.nalCount+=i.length,r.byteLength+=i.byteLength,r.push(i));return n.length&&r.duration<=0&&(r.duration=n[n.length-1].duration),n.byteLength+=r.byteLength,n.nalCount+=r.nalCount,n.duration+=r.duration,n.push(r),n},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var i,r,n,a,s,o=t||0,u=[];for(i=0;i<e.length;i++)for(a=e[i],r=0;r<a.length;r++)s=a[r],o+=(n=To(s,o)).size,u.push(n);return u},concatenateNalData:function(e){var t,i,r,n,a,s,o=0,u=e.byteLength,l=e.nalCount,c=new Uint8Array(u+4*l),d=new DataView(c.buffer);for(t=0;t<e.length;t++)for(n=e[t],i=0;i<n.length;i++)for(a=n[i],r=0;r<a.length;r++)s=a[r],d.setUint32(o,s.data.byteLength),o+=4,c.set(s.data,o),o+=s.data.byteLength;return c}},Eo=So.groupNalsIntoFrames,ko=So.groupFramesIntoGops,wo=So.extendFirstKeyFrame,Ao=So.generateSampleTable,Lo=So.concatenateNalData,Co=Object.freeze({default:So,__moduleExports:So,groupNalsIntoFrames:Eo,groupFramesIntoGops:ko,extendFirstKeyFrame:wo,generateSampleTable:Ao,concatenateNalData:Lo}),Ro={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var i,r=e.minSegmentDts;return t||(r-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=r,i=Math.max(0,i),"audio"===e.type&&(i*=e.samplerate/9e4,i=Math.floor(i)),i},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},Oo=Ro.clearDtsInfo,Do=Ro.calculateTrackBaseMediaDecodeTime,Io=Ro.collectDtsInfo,Po=Object.freeze({default:Ro,__moduleExports:Ro,clearDtsInfo:Oo,calculateTrackBaseMediaDecodeTime:Do,collectDtsInfo:Io}),xo={parseSei:function(e){for(var t=0,i={payloadType:-1,payloadSize:0},r=0,n=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)r+=255,t++;for(r+=e[t++];255===e[t];)n+=255,t++;if(n+=e[t++],!i.payload&&4===r){i.payloadType=r,i.payloadSize=n,i.payload=e.subarray(t,t+n);break}t+=n,r=0,n=0}return i},parseUserData:function(e){return 181!==e.payload[0]?null:49!=(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var i,r,n,a,s=[];if(!(64&t[0]))return s;for(r=31&t[0],i=0;i<r;i++)a={type:3&t[2+(n=3*i)],pts:e},4&t[n+2]&&(a.ccData=t[n+3]<<8|t[n+4],s.push(a));return s},discardEmulationPreventionBytes:function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},USER_DATA_REGISTERED_ITU_T_T35:4},Mo=xo.parseSei,Uo=xo.parseUserData,No=xo.parseCaptionPackets,Bo=xo.discardEmulationPreventionBytes,Fo=xo.USER_DATA_REGISTERED_ITU_T_T35,jo=Object.freeze({default:xo,__moduleExports:xo,parseSei:Mo,parseUserData:Uo,parseCaptionPackets:No,discardEmulationPreventionBytes:Bo,USER_DATA_REGISTERED_ITU_T_T35:Fo}),Go=bo&&_o||bo,Vo=jo&&xo||jo,Ho=function e(){e.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new Xo(0,0),new Xo(0,1),new Xo(1,0),new Xo(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("done",this.trigger.bind(this,"done"))},this)};(Ho.prototype=new Go).push=function(e){var t,i,r;if("sei_rbsp"===e.nalUnitType&&(t=Vo.parseSei(e.escapedRBSP)).payloadType===Vo.USER_DATA_REGISTERED_ITU_T_T35&&(i=Vo.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));r=Vo.parseCaptionPackets(e.pts,i),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},Ho.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.ccStreams_.forEach(function(e){e.flush()},this)):this.ccStreams_.forEach(function(e){e.flush()},this)},Ho.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},Ho.prototype.dispatchCea608Packet=function(e){this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},Ho.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},Ho.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)};var zo={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Wo=function(e){return null===e?"":(e=zo[e]||e,String.fromCharCode(e))},qo=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ko=function(){for(var e=[],t=15;t--;)e.push("");return e},Xo=function e(t,i){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,i,r,n,a;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),r=t>>>8,n=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Ko();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ko();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Ko()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(r,n))a=Wo((r=(3&r)<<8)|n),this[this.mode_](e.pts,a),this.column_++;else if(this.isExtCharacter(r,n))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=Wo((r=(3&r)<<8)|n),this[this.mode_](e.pts,a),this.column_++;else if(this.isMidRowCode(r,n))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&n)&&this.addFormatting(e.pts,["i"]),1==(1&n)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(r,n))this.column_+=3&n;else if(this.isPAC(r,n)){var s=qo.indexOf(7968&t);"rollUp"===this.mode_&&this.setRollUp(e.pts,s),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&n&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(n)&&14==(14&n)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(r)&&(0===n&&(n=null),a=Wo(r),a+=Wo(n),this[this.mode_](e.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};Xo.prototype=new Go,Xo.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){return e.trim()}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},Xo.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ko(),this.nonDisplayed_=Ko(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Xo.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Xo.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Xo.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Xo.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Xo.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Xo.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Xo.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Xo.prototype.isNormalChar=function(e){return e>=32&&e<=127},Xo.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Ko(),this.displayed_=Ko()),void 0!==t&&t!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[t-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Xo.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)},Xo.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Xo.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t,this.nonDisplayed_[this.row_]=i},Xo.prototype.rollUp=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i},Xo.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},Xo.prototype.paintOn=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i};var Yo={CaptionStream:Ho,Cea608Stream:Xo},$o=Yo.CaptionStream,Qo=Yo.Cea608Stream,Jo=Object.freeze({default:Yo,__moduleExports:Yo,CaptionStream:$o,Cea608Stream:Qo}),Zo={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},eu=Zo.H264_STREAM_TYPE,tu=Zo.ADTS_STREAM_TYPE,iu=Zo.METADATA_STREAM_TYPE,ru=Object.freeze({default:Zo,__moduleExports:Zo,H264_STREAM_TYPE:eu,ADTS_STREAM_TYPE:tu,METADATA_STREAM_TYPE:iu}),nu=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>4294967296;)e+=8589934592*i;return e},au=function e(t){var i,r;e.prototype.init.call(this),this.type_=t,this.push=function(e){e.type===this.type_&&(void 0===r&&(r=e.dts),e.dts=nu(e.dts,r),e.pts=nu(e.pts,r),i=e.dts,this.trigger("data",e))},this.flush=function(){r=i,this.trigger("done")},this.discontinuity=function(){r=void 0,i=void 0}};au.prototype=new Go;var su,ou={TimestampRolloverStream:au,handleRollover:nu},uu=ou.TimestampRolloverStream,lu=ou.handleRollover,cu=Object.freeze({default:ou,__moduleExports:ou,TimestampRolloverStream:uu,handleRollover:lu}),du=ru&&Zo||ru,hu=function(e,t,i){var r,n="";for(r=t;r<i;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n},fu=function(e,t,i){return decodeURIComponent(hu(e,t,i))},pu=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},mu={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=fu(e.data,1,t),e.value=fu(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=fu(e.data,1,t),e.url=fu(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=(i=e.data,r=0,n=t,unescape(hu(i,r,n)));break}var i,r,n;e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(su=function(e){var t,i={debug:!(!e||!e.debug),descriptor:e&&e.descriptor},r=0,n=[],a=0;if(su.prototype.init.call(this),this.dispatchType=du.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(t=0;t<i.descriptor.length;t++)this.dispatchType+=("00"+i.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,s,o,u,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(a=0,n.length=0),0===n.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))i.debug&&console.log("Skipping unrecognized metadata packet");else if(n.push(e),a+=e.data.byteLength,1===n.length&&(r=pu(e.data.subarray(6,10)),r+=10),!(a<r)){for(t={data:new Uint8Array(r),frames:[],pts:n[0].pts,dts:n[0].dts},l=0;l<r;)t.data.set(n[0].data.subarray(0,r-l),l),l+=n[0].data.byteLength,a-=n[0].data.byteLength,n.shift();s=10,64&t.data[5]&&(s+=4,s+=pu(t.data.subarray(10,14)),r-=pu(t.data.subarray(16,20)));do{if((o=pu(t.data.subarray(s+4,s+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((u={id:String.fromCharCode(t.data[s],t.data[s+1],t.data[s+2],t.data[s+3]),data:t.data.subarray(s+10,s+o+10)}).key=u.id,mu[u.id]&&(mu[u.id](u),"com.apple.streaming.transportStreamTimestamp"===u.owner)){var c=u.data,d=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;d*=4,d+=3&c[7],u.timeStamp=d,void 0===t.pts&&void 0===t.dts&&(t.pts=u.timeStamp,t.dts=u.timeStamp),this.trigger("timestamp",u)}t.frames.push(u),s+=10,s+=o}while(s<r);this.trigger("data",t)}}}).prototype=new Go;var gu,yu,vu,_u=su,bu=Object.freeze({default:_u,__moduleExports:_u}),Tu=Jo&&Yo||Jo,Su=cu&&ou||cu,Eu=bu&&_u||bu,ku=Su.TimestampRolloverStream;(gu=function(){var e=new Uint8Array(188),t=0;gu.prototype.init.call(this),this.push=function(i){var r,n=0,a=188;for(t?((r=new Uint8Array(i.byteLength+t)).set(e.subarray(0,t)),r.set(i,t),t=0):r=i;a<r.byteLength;)71!==r[n]||71!==r[a]?(n++,a++):(this.trigger("data",r.subarray(n,a)),n+=188,a+=188);n<r.byteLength&&(e.set(r.subarray(n),0),t=r.byteLength-n)},this.flush=function(){188===t&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")}}).prototype=new Go,(yu=function(){var e,t,i,r;yu.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,r){var n=0;r.payloadUnitStartIndicator&&(n+=e[n]+1),"pat"===r.type?t(e.subarray(n),r):i(e.subarray(n),r)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],r.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=r.pmtPid},i=function(e,t){var i,n;if(1&e[5]){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&e[1])<<8|e[2])-4,n=12+((15&e[10])<<8|e[11]);n<i;){var a=e[n],s=(31&e[n+1])<<8|e[n+2];a===du.H264_STREAM_TYPE&&null===r.programMapTable.video?r.programMapTable.video=s:a===du.ADTS_STREAM_TYPE&&null===r.programMapTable.audio?r.programMapTable.audio=s:a===du.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][s]=a),n+=5+((15&e[n+3])<<8|e[n+4])}t.programMapTable=r.programMapTable}},this.push=function(t){var i={},r=4;if(i.payloadUnitStartIndicator=!!(64&t[1]),i.pid=31&t[1],i.pid<<=8,i.pid|=t[2],(48&t[3])>>>4>1&&(r+=t[r]+1),0===i.pid)i.type="pat",e(t.subarray(r),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",e(t.subarray(r),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,r,i]):this.processPes_(t,r,i)},this.processPes_=function(e,t,i){i.pid===this.programMapTable.video?i.streamType=du.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=du.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=e.subarray(t),this.trigger("data",i)}}).prototype=new Go,yu.STREAM_TYPES={h264:27,adts:15},(vu=function(){var e=this,t={data:[],size:0},i={data:[],size:0},r={data:[],size:0},n=function(t,i,r){var n,a=new Uint8Array(t.size),s={type:i},o=0,u=0,l=!1;if(t.data.length&&!(t.size<9)){for(s.trackId=t.data[0].pid,o=0;o<t.data.length;o++)n=t.data[o],a.set(n.data,u),u+=n.data.byteLength;!function(e,t){var i;t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),192&(i=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&i&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8])}(a,s),l="video"===i||s.packetLength<=t.size,(r||l)&&(t.size=0,t.data.length=0),l&&e.trigger("data",s)}};vu.prototype.init.call(this),this.push=function(a){({pat:function(){},pes:function(){var e,s;switch(a.streamType){case du.H264_STREAM_TYPE:case du.H264_STREAM_TYPE:e=t,s="video";break;case du.ADTS_STREAM_TYPE:e=i,s="audio";break;case du.METADATA_STREAM_TYPE:e=r,s="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&n(e,s,!0),e.data.push(a),e.size+=a.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},i=a.programMapTable;null!==i.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+i.video,codec:"avc",type:"video"}),null!==i.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+i.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[a.type]()},this.flush=function(){n(t,"video"),n(i,"audio"),n(r,"timed-metadata"),this.trigger("done")}}).prototype=new Go;var wu={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:gu,TransportParseStream:yu,ElementaryStream:vu,TimestampRolloverStream:ku,CaptionStream:Tu.CaptionStream,Cea608Stream:Tu.Cea608Stream,MetadataStream:Eu};for(var Au in du)du.hasOwnProperty(Au)&&(wu[Au]=du[Au]);var Lu,Cu=wu,Ru=Object.freeze({default:Cu,__moduleExports:Cu}),Ou=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(Lu=function(){var e;Lu.prototype.init.call(this),this.push=function(t){var i,r,n,a,s,o,u=0,l=0;if("audio"===t.type)for(e?(a=e,(e=new Uint8Array(a.byteLength+t.data.byteLength)).set(a),e.set(t.data,a.byteLength)):e=t.data;u+5<e.length;)if(255===e[u]&&240==(246&e[u+1])){if(r=2*(1&~e[u+1]),i=(3&e[u+3])<<11|e[u+4]<<3|(224&e[u+5])>>5,o=9e4*(s=1024*(1+(3&e[u+6])))/Ou[(60&e[u+2])>>>2],n=u+i,e.byteLength<n)return;if(this.trigger("data",{pts:t.pts+l*o,dts:t.dts+l*o,sampleCount:s,audioobjecttype:1+(e[u+2]>>>6&3),channelcount:(1&e[u+2])<<2|(192&e[u+3])>>>6,samplerate:Ou[(60&e[u+2])>>>2],samplingfrequencyindex:(60&e[u+2])>>>2,samplesize:16,data:e.subarray(u+7+r,n)}),e.byteLength===n)return void(e=void 0);l++,e=e.subarray(n)}else u++},this.flush=function(){this.trigger("done")}}).prototype=new Go;var Du,Iu,Pu,xu=Lu,Mu=Object.freeze({default:xu,__moduleExports:xu}),Uu=function(e){var t=e.byteLength,i=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var n=e.byteLength-t,a=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");a.set(e.subarray(n,n+s)),i=new DataView(a.buffer).getUint32(0),r=8*s,t-=s},this.skipBits=function(e){var n;r>e?(i<<=e,r-=e):(e-=r,e-=8*(n=Math.floor(e/8)),t-=n,this.loadWord(),i<<=e,r-=e)},this.readBits=function(e){var n=Math.min(r,e),a=i>>>32-n;return(r-=n)>0?i<<=n:t>0&&this.loadWord(),(n=e-n)>0?a<<n|this.readBits(n):a},this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e)if(0!=(i&2147483648>>>e))return i<<=e,r-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},Nu=Object.freeze({default:Uu,__moduleExports:Uu}),Bu=Nu&&Uu||Nu;(Iu=function(){var e,t,i=0;Iu.prototype.init.call(this),this.push=function(r){var n;for(t?((n=new Uint8Array(t.byteLength+r.data.byteLength)).set(t),n.set(r.data,t.byteLength),t=n):t=r.data;i<t.byteLength-3;i++)if(1===t[i+2]){e=i+5;break}for(;e<t.byteLength;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}i+3!==e-2&&this.trigger("data",t.subarray(i+3,e-2));do{e++}while(1!==t[e]&&e<t.length);i=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(i+3,e-2)),i=e-2,e+=3;break;default:e+=3}t=t.subarray(i),e-=i,i=0},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(i+3)),t=null,i=0,this.trigger("done")}}).prototype=new Go,Pu={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(Du=function(){var e,t,i,r,n,a,s,o=new Iu;Du.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,i=e.pts,r=e.dts,o.push(e))},o.on("data",function(s){var o={trackId:t,pts:i,dts:r,data:s};switch(31&s[0]){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=n(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=n(s.subarray(1)),o.config=a(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),this.flush=function(){o.flush()},s=function(e,t){var i,r=8,n=8;for(i=0;i<e;i++)0!==n&&(n=(r+t.readExpGolomb()+256)%256),r=0===n?r:n},n=function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},a=function(e){var t,i,r,n,a,o,u,l,c,d,h,f,p,m=0,g=0,y=0,v=0,_=1;if(i=(t=new Bu(e)).readUnsignedByte(),n=t.readUnsignedByte(),r=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),Pu[i]&&(3===(a=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==a?8:12,p=0;p<h;p++)t.readBoolean()&&s(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),u=t.readUnsignedExpGolomb(),p=0;p<u;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),l=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),0===(d=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}f&&(_=f[0]/f[1])}return{profileIdc:i,levelIdc:r,profileCompatibility:n,width:Math.ceil((16*(l+1)-2*m-2*g)*_),height:(2-d)*(c+1)*16-2*y-2*v}}}).prototype=new Go;var Fu,ju={H264Stream:Du,NalByteStream:Iu},Gu=ju.H264Stream,Vu=ju.NalByteStream,Hu=Object.freeze({default:ju,__moduleExports:ju,H264Stream:Gu,NalByteStream:Vu});(Fu=function(){var e=new Uint8Array,t=0;Fu.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.parseId3TagSize=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&e[t+5])>>4?i+20:i+10},this.parseAdtsSize=function(e,t){var i=(224&e[t+5])>>5,r=e[t+4]<<3;return 6144&e[t+3]|r|i},this.push=function(i){var r,n,a,s,o=0,u=0;for(e.length?(s=e.length,(e=new Uint8Array(i.byteLength+s)).set(e.subarray(0,s)),e.set(i,s)):e=i;e.length-u>=3;)if(e[u]!=="I".charCodeAt(0)||e[u+1]!=="D".charCodeAt(0)||e[u+2]!=="3".charCodeAt(0))if(!0&e[u]&&240==(240&e[u+1])){if(e.length-u<7)break;if((o=this.parseAdtsSize(e,u))>e.length)break;a={type:"audio",data:e.subarray(u,u+o),pts:t,dts:t},this.trigger("data",a),u+=o}else u++;else{if(e.length-u<10)break;if((o=this.parseId3TagSize(e,u))>e.length)break;n={type:"timed-metadata",data:e.subarray(u,u+o)},this.trigger("data",n),u+=o}r=e.length-u,e=r>0?e.subarray(u):new Uint8Array}}).prototype=new Go;var zu,Wu,qu,Ku,Xu,Yu,$u,Qu,Ju,Zu,el,tl,il=Fu,rl=Object.freeze({default:il,__moduleExports:il}),nl=[33,16,5,32,164,27],al=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],sl=function(e){for(var t=[];e--;)t.push(0);return t},ol={96e3:[nl,[227,64],sl(154),[56]],88200:[nl,[231],sl(170),[56]],64e3:[nl,[248,192],sl(240),[56]],48e3:[nl,[255,192],sl(268),[55,148,128],sl(54),[112]],44100:[nl,[255,192],sl(268),[55,163,128],sl(84),[112]],32e3:[nl,[255,192],sl(268),[55,234],sl(226),[112]],24e3:[nl,[255,192],sl(268),[55,255,128],sl(268),[111,112],sl(126),[224]],16e3:[nl,[255,192],sl(268),[55,255,128],sl(268),[111,255],sl(269),[223,108],sl(195),[1,192]],12e3:[al,sl(268),[3,127,248],sl(268),[6,255,240],sl(268),[13,255,224],sl(268),[27,253,128],sl(259),[56]],11025:[al,sl(268),[3,127,248],sl(268),[6,255,240],sl(268),[13,255,224],sl(268),[27,255,192],sl(268),[55,175,128],sl(108),[112]],8e3:[al,sl(268),[3,121,16],sl(47),[7]]},ul=(zu=ol,Object.keys(zu).reduce(function(e,t){return e[t]=new Uint8Array(zu[t].reduce(function(e,t){return e.concat(t)},[])),e},{})),ll=Object.freeze({default:ul,__moduleExports:ul}),cl={secondsToVideoTs:Wu=function(e){return 9e4*e},secondsToAudioTs:qu=function(e,t){return e*t},videoTsToSeconds:Ku=function(e){return e/9e4},audioTsToSeconds:Xu=function(e,t){return e/t},audioTsToVideoTs:function(e,t){return Wu(Xu(e,t))},videoTsToAudioTs:function(e,t){return qu(Ku(e),t)}},dl=cl.secondsToVideoTs,hl=cl.secondsToAudioTs,fl=cl.videoTsToSeconds,pl=cl.audioTsToSeconds,ml=cl.audioTsToVideoTs,gl=cl.videoTsToAudioTs,yl=Object.freeze({default:cl,__moduleExports:cl,secondsToVideoTs:dl,secondsToAudioTs:hl,videoTsToSeconds:fl,audioTsToSeconds:pl,audioTsToVideoTs:ml,videoTsToAudioTs:gl}),vl=yo&&co||yo,_l=Co&&So||Co,bl=Po&&Ro||Po,Tl=Ru&&Cu||Ru,Sl=Mu&&xu||Mu,El=rl&&il||rl,kl=ll&&ul||ll,wl=yl&&cl||yl,Al=(Hu&&ju||Hu).H264Stream,Ll=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Cl=["width","height","profileIdc","levelIdc","profileCompatibility"];Zu=function(e){return e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)},el=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},tl=function(e){var t,i=0;for(t=0;t<e.length;t++)i+=e[t].data.byteLength;return i},($u=function(e,t){var i=[],r=0,n=0,a=0,s=1/0;t=t||{},$u.prototype.init.call(this),this.push=function(t){bl.collectDtsInfo(e,t),e&&Ll.forEach(function(i){e[i]=t[i]}),i.push(t)},this.setEarliestDts=function(t){n=t-e.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){a=e},this.flush=function(){var n,a,s,o;0!==i.length?(n=this.trimAdtsFramesByEarliestDts_(i),e.baseMediaDecodeTime=bl.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.prefixWithSilence_(e,n),e.samples=this.generateSampleTable_(n),s=vl.mdat(this.concatenateFrameData_(n)),i=[],a=vl.moof(r,[e]),o=new Uint8Array(a.byteLength+s.byteLength),r++,o.set(a),o.set(s,a.byteLength),bl.clearDtsInfo(e),this.trigger("data",{track:e,boxes:o}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.prefixWithSilence_=function(e,t){var i,r,n,o=0,u=0,l=0,c=0;if(t.length&&(i=wl.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o=Math.ceil(9e4/(e.samplerate/1024)),a&&s&&(u=i-Math.max(a,s),c=(l=Math.floor(u/o))*o),!(l<1||c>45e3))){for((r=kl[e.samplerate])||(r=t[0].data),n=0;n<l;n++)t.splice(n,0,{data:r});e.baseMediaDecodeTime-=Math.floor(wl.videoTsToAudioTs(c,e.samplerate))}},this.trimAdtsFramesByEarliestDts_=function(t){return e.minSegmentDts>=n?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=n&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},this.generateSampleTable_=function(e){var t,i,r=[];for(t=0;t<e.length;t++)i=e[t],r.push({size:i.data.byteLength,duration:1024});return r},this.concatenateFrameData_=function(e){var t,i,r=0,n=new Uint8Array(tl(e));for(t=0;t<e.length;t++)i=e[t],n.set(i.data,r),r+=i.data.byteLength;return n}}).prototype=new Go,(Yu=function(e,t){var i,r,n=0,a=[],s=[];t=t||{},Yu.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){bl.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],Cl.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),a.push(t)},this.flush=function(){for(var i,r,o,u,l,c;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=_l.groupNalsIntoFrames(a),(o=_l.groupFramesIntoGops(i))[0][0].keyFrame||((r=this.getGopForFusion_(a[0],e))?(o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=_l.extendFirstKeyFrame(o)),s.length){var d;if(!(d=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");bl.clearDtsInfo(e),o=d}bl.collectDtsInfo(e,o),e.samples=_l.generateSampleTable(o),l=vl.mdat(_l.concatenateNalData(o)),e.baseMediaDecodeTime=bl.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),u=vl.moof(n,[e]),c=new Uint8Array(u.byteLength+l.byteLength),n++,c.set(u),c.set(l,u.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){bl.clearDtsInfo(e),i=void 0,r=void 0},this.getGopForFusion_=function(t){var i,r,n,a,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)n=(a=this.gopCache_[s]).gop,e.pps&&el(e.pps[0],a.pps[0])&&e.sps&&el(e.sps[0],a.sps[0])&&(n.dts<e.timelineStartInfo.dts||(i=t.dts-n.dts-n.duration)>=-1e4&&i<=45e3&&(!r||o>i)&&(r=a,o=i));return r?r.gop:null},this.alignGopsAtStart_=function(e){var t,i,r,n,a,o,u,l;for(a=e.byteLength,o=e.nalCount,u=e.duration,t=i=0;t<s.length&&i<e.length&&(r=s[t],n=e[i],r.pts!==n.pts);)n.pts>r.pts?t++:(i++,a-=n.byteLength,o-=n.nalCount,u-=n.duration);return 0===i?e:i===e.length?null:((l=e.slice(i)).byteLength=a,l.duration=u,l.nalCount=o,l.pts=l[0].pts,l.dts=l[0].dts,l)},this.alignGopsAtEnd_=function(e){var t,i,r,n,a,o;for(t=s.length-1,i=e.length-1,a=null,o=!1;t>=0&&i>=0;){if(r=s[t],n=e[i],r.pts===n.pts){o=!0;break}r.pts>n.pts?t--:(t===s.length-1&&(a=i),i--)}if(!o&&null===a)return null;var u;if(0===(u=o?i:a))return e;var l=e.slice(u),c=l.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return l.byteLength=c.byteLength,l.duration=c.duration,l.nalCount=c.nalCount,l.pts=l[0].pts,l.dts=l[0].dts,l},this.alignGopsWith=function(e){s=e}}).prototype=new Go,(Ju=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==e.remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Ju.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBoxes.push(e.boxes),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track),void("audio"===e.track.type&&(this.audioTrack=e.track)))}}).prototype=new Go,Ju.prototype.flush=function(e){var t,i,r,n,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Cl.forEach(function(e){s.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Ll.forEach(function(e){s.info[e]=this.audioTrack[e]},this)),1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,r=vl.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(r.byteLength),s.initSegment.set(r),s.data=new Uint8Array(this.pendingBytes),n=0;n<this.pendingBoxes.length;n++)s.data.set(this.pendingBoxes[n],a),a+=this.pendingBoxes[n].byteLength;for(n=0;n<this.pendingCaptions.length;n++)(t=this.pendingCaptions[n]).startTime=t.startPts-o,t.startTime/=9e4,t.endTime=t.endPts-o,t.endTime/=9e4,s.captionStreams[t.stream]=!0,s.captions.push(t);for(n=0;n<this.pendingMetadata.length;n++)(i=this.pendingMetadata[n]).cueTime=i.pts-o,i.cueTime/=9e4,s.metadata.push(i);s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(Qu=function(e){var t,i,r=this,n=!0;Qu.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t,t.type="aac",t.metadataStream=new Tl.MetadataStream,t.aacStream=new El,t.audioTimestampRolloverStream=new Tl.TimestampRolloverStream("audio"),t.timedMetadataTimestampRolloverStream=new Tl.TimestampRolloverStream("timed-metadata"),t.adtsStream=new Sl,t.coalesceStream=new Ju(e,t.metadataStream),t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)}),t.aacStream.on("data",function(n){"timed-metadata"!==n.type||t.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:r.baseMediaDecodeTime},codec:"adts",type:"audio"},t.coalesceStream.numberOfTracks++,t.audioSegmentStream=new $u(i,e),t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream))}),t.coalesceStream.on("data",this.trigger.bind(this,"data")),t.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var n={};this.transmuxPipeline_=n,n.type="ts",n.metadataStream=new Tl.MetadataStream,n.packetStream=new Tl.TransportPacketStream,n.parseStream=new Tl.TransportParseStream,n.elementaryStream=new Tl.ElementaryStream,n.videoTimestampRolloverStream=new Tl.TimestampRolloverStream("video"),n.audioTimestampRolloverStream=new Tl.TimestampRolloverStream("audio"),n.timedMetadataTimestampRolloverStream=new Tl.TimestampRolloverStream("timed-metadata"),n.adtsStream=new Sl,n.h264Stream=new Al,n.captionStream=new Tl.CaptionStream,n.coalesceStream=new Ju(e,n.metadataStream),n.headOfPipeline=n.packetStream,n.packetStream.pipe(n.parseStream).pipe(n.elementaryStream),n.elementaryStream.pipe(n.videoTimestampRolloverStream).pipe(n.h264Stream),n.elementaryStream.pipe(n.audioTimestampRolloverStream).pipe(n.adtsStream),n.elementaryStream.pipe(n.timedMetadataTimestampRolloverStream).pipe(n.metadataStream).pipe(n.coalesceStream),n.h264Stream.pipe(n.captionStream).pipe(n.coalesceStream),n.elementaryStream.on("data",function(a){var s;if("metadata"===a.type){for(s=a.tracks.length;s--;)t||"video"!==a.tracks[s].type?i||"audio"!==a.tracks[s].type||((i=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime):(t=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime;t&&!n.videoSegmentStream&&(n.coalesceStream.numberOfTracks++,n.videoSegmentStream=new Yu(t,e),n.videoSegmentStream.on("timelineStartInfo",function(e){i&&(i.timelineStartInfo=e,n.audioSegmentStream.setEarliestDts(e.dts))}),n.videoSegmentStream.on("processedGopsInfo",r.trigger.bind(r,"gopInfo")),n.videoSegmentStream.on("baseMediaDecodeTime",function(e){i&&n.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),n.h264Stream.pipe(n.videoSegmentStream).pipe(n.coalesceStream)),i&&!n.audioSegmentStream&&(n.coalesceStream.numberOfTracks++,n.audioSegmentStream=new $u(i,e),n.adtsStream.pipe(n.audioSegmentStream).pipe(n.coalesceStream))}}),n.coalesceStream.on("data",this.trigger.bind(this,"data")),n.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(e){var r=this.transmuxPipeline_;this.baseMediaDecodeTime=e,i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,bl.clearDtsInfo(i),i.timelineStartInfo.baseMediaDecodeTime=e,r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[],r.videoTimestampRolloverStream.discontinuity()),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,bl.clearDtsInfo(t),r.captionStream.reset(),t.timelineStartInfo.baseMediaDecodeTime=e),r.timedMetadataTimestampRolloverStream&&r.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(e){if(n){var t=Zu(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),n=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){n=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new Go;var Rl,Ol,Dl={Transmuxer:Qu,VideoSegmentStream:Yu,AudioSegmentStream:$u,AUDIO_PROPERTIES:Ll,VIDEO_PROPERTIES:Cl},Il=Dl.Transmuxer,Pl=Dl.VideoSegmentStream,xl=Dl.AudioSegmentStream,Ml=Dl.AUDIO_PROPERTIES,Ul=Dl.VIDEO_PROPERTIES,Nl=Object.freeze({default:Dl,__moduleExports:Dl,Transmuxer:Il,VideoSegmentStream:Pl,AudioSegmentStream:xl,AUDIO_PROPERTIES:Ml,VIDEO_PROPERTIES:Ul}),Bl=uo.parseType,Fl=function(e){return new Date(1e3*e-20828448e5)},jl=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},Gl={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:Rl(e.subarray(78,e.byteLength))}},avcC:function(e){var t,i,r,n,a=new DataView(e.buffer,e.byteOffset,e.byteLength),s={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},o=31&e[5];for(r=6,n=0;n<o;n++)i=a.getUint16(r),r+=2,s.sps.push(new Uint8Array(e.subarray(r,r+i))),r+=i;for(t=e[r],r++,n=0;n<t;n++)i=a.getUint16(r),r+=2,s.pps.push(new Uint8Array(e.subarray(r,r+i))),r+=i;return s},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={majorBrand:Bl(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},r=8;r<e.byteLength;)i.compatibleBrands.push(Bl(e.subarray(r,r+4))),r+=4;return i},dinf:function(e){return{boxes:Rl(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:Rl(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:Bl(e.subarray(8,12)),name:""},i=8;for(i=24;i<e.byteLength;i++){if(0===e[i]){i++;break}t.name+=String.fromCharCode(e[i])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:function(e){var t,i,r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=[];for(t=0;t+4<e.length;t+=i)if(i=r.getUint32(t),t+=4,i<=0)n.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:n.push("slice_layer_without_partitioning_rbsp");break;case 5:n.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:n.push("sei_rbsp");break;case 7:n.push("seq_parameter_set_rbsp");break;case 8:n.push("pic_parameter_set_rbsp");break;case 9:n.push("access_unit_delimiter_rbsp");break;default:n.push("UNKNOWN NAL - "+e[t]&31)}return n}(e)}},mdhd:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:i.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===n.version?(r+=4,n.creationTime=Fl(i.getUint32(r)),r+=8,n.modificationTime=Fl(i.getUint32(r)),r+=4,n.timescale=i.getUint32(r),r+=8,n.duration=i.getUint32(r)):(n.creationTime=Fl(i.getUint32(r)),r+=4,n.modificationTime=Fl(i.getUint32(r)),r+=4,n.timescale=i.getUint32(r),r+=4,n.duration=i.getUint32(r)),r+=4,t=i.getUint16(r),n.language+=String.fromCharCode(96+(t>>10)),n.language+=String.fromCharCode(96+((992&t)>>5)),n.language+=String.fromCharCode(96+(31&t)),n},mdia:function(e){return{boxes:Rl(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:Rl(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(i.streamDescriptor=Rl(e.subarray(28))[0]),i},moof:function(e){return{boxes:Rl(e)}},moov:function(e){return{boxes:Rl(e)}},mvex:function(e){return{boxes:Rl(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===r.version?(i+=4,r.creationTime=Fl(t.getUint32(i)),i+=8,r.modificationTime=Fl(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=8,r.duration=t.getUint32(i)):(r.creationTime=Fl(t.getUint32(i)),i+=4,r.modificationTime=Fl(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=4,r.duration=t.getUint32(i)),i+=4,r.rate=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,i+=8,r.matrix=new Uint32Array(e.subarray(i,i+36)),i+=36,i+=24,r.nextTrackId=t.getUint32(i),r},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)i.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return i},sidx:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},n=i.getUint16(22);for(t=24;n;t+=12,n--)r.references.push({referenceType:(128&e[t])>>>7,referencedSize:2147483647&i.getUint32(t),subsegmentDuration:i.getUint32(t+4),startsWithSap:!!(128&e[t+8]),sapType:(112&e[t+8])>>>4,sapDeltaTime:268435455&i.getUint32(t+8)});return r},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:Rl(e)}},stco:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},n=i.getUint32(4);for(t=8;n;t+=4,n--)r.chunkOffsets.push(i.getUint32(t));return r},stsc:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=i.getUint32(4),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;r;t+=12,r--)n.sampleToChunks.push({firstChunk:i.getUint32(t),samplesPerChunk:i.getUint32(t+4),sampleDescriptionIndex:i.getUint32(t+8)});return n},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:Rl(e.subarray(8))}},stsz:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)r.entries.push(i.getUint32(t));return r},stts:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},n=i.getUint32(4);for(t=8;n;t+=8,n--)r.timeToSamples.push({sampleCount:i.getUint32(t),sampleDelta:i.getUint32(t+4)});return r},styp:function(e){return Gl.ftyp(e)},tfdt:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:e[4]<<24|e[5]<<16|e[6]<<8|e[7]};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),t},tfhd:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:i.getUint32(4)},n=1&r.flags[2],a=2&r.flags[2],s=8&r.flags[2],o=16&r.flags[2],u=32&r.flags[2],l=65536&r.flags[0],c=131072&r.flags[0];return t=8,n&&(t+=4,r.baseDataOffset=i.getUint32(12),t+=4),a&&(r.sampleDescriptionIndex=i.getUint32(t),t+=4),s&&(r.defaultSampleDuration=i.getUint32(t),t+=4),o&&(r.defaultSampleSize=i.getUint32(t),t+=4),u&&(r.defaultSampleFlags=i.getUint32(t)),l&&(r.durationIsEmpty=!0),!n&&c&&(r.baseDataOffsetIsMoof=!0),r},tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===r.version?(i+=4,r.creationTime=Fl(t.getUint32(i)),i+=8,r.modificationTime=Fl(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=8,r.duration=t.getUint32(i)):(r.creationTime=Fl(t.getUint32(i)),i+=4,r.modificationTime=Fl(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=4,r.duration=t.getUint32(i)),i+=4,i+=8,r.layer=t.getUint16(i),i+=2,r.alternateGroup=t.getUint16(i),i+=2,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,r.matrix=new Uint32Array(e.subarray(i,i+36)),i+=36,r.width=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.height=t.getUint16(i)+t.getUint16(i+2)/16,r},traf:function(e){return{boxes:Rl(e)}},trak:function(e){return{boxes:Rl(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],u=4&i.flags[1],l=8&i.flags[1],c=r.getUint32(4),d=8;for(n&&(i.dataOffset=r.getInt32(d),d+=4),a&&c&&(t={flags:jl(e.subarray(d,d+4))},d+=4,s&&(t.duration=r.getUint32(d),d+=4),o&&(t.size=r.getUint32(d),d+=4),l&&(t.compositionTimeOffset=r.getUint32(d),d+=4),i.samples.push(t),c--);c--;)t={},s&&(t.duration=r.getUint32(d),d+=4),o&&(t.size=r.getUint32(d),d+=4),u&&(t.flags=jl(e.subarray(d,d+4)),d+=4),l&&(t.compositionTimeOffset=r.getUint32(d),d+=4),i.samples.push(t);return i},"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}},Vl={inspect:Rl=function(e){for(var t,i,r,n,a,s=0,o=[],u=new ArrayBuffer(e.length),l=new Uint8Array(u),c=0;c<e.length;++c)l[c]=e[c];for(t=new DataView(u);s<e.byteLength;)i=t.getUint32(s),r=Bl(e.subarray(s+4,s+8)),n=i>1?s+i:e.byteLength,(a=(Gl[r]||function(e){return{data:e}})(e.subarray(s+8,n))).size=i,a.type=r,o.push(a),s=n;return o},textify:Ol=function(e,t){var i;return t=t||0,i=new Array(2*t+1).join(" "),e.map(function(e,r){return i+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var r=i+"  "+t+": ",n=e[t];if(n instanceof Uint8Array||n instanceof Uint32Array){var a=Array.prototype.slice.call(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return a?1===a.length?r+"<"+a.join("").slice(1)+">":r+"<\n"+a.map(function(e){return i+"  "+e}).join("\n")+"\n"+i+"  >":r+"<>"}return r+JSON.stringify(n,null,2).split("\n").map(function(e,t){return 0===t?e:i+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+Ol(e.boxes,t+1):"")}).join("\n")},parseTfdt:Gl.tfdt,parseHdlr:Gl.hdlr,parseTfhd:Gl.tfhd,parseTrun:Gl.trun},Hl=Vl.inspect,zl=Vl.textify,Wl=Vl.parseTfdt,ql=Vl.parseHdlr,Kl=Vl.parseTfhd,Xl=Vl.parseTrun,Yl=Object.freeze({default:Vl,__moduleExports:Vl,inspect:Hl,textify:zl,parseTfdt:Wl,parseHdlr:ql,parseTfhd:Kl,parseTrun:Xl}),$l=Yl&&Vl||Yl,Ql=Vo.discardEmulationPreventionBytes,Jl=Tu.CaptionStream,Zl=function(e,t){for(var i=e,r=0;r<t.length;r++){var n=t[r];if(i<n.size)return n;i-=n.size}return null},ec=function(e,t){var i=uo.findBox(e,["moof","traf"]),r={},n=[];return uo.findBox(e,["mdat"]).forEach(function(e,t){var r=i[t];n.push({mdat:e,traf:r})}),n.forEach(function(e){var i,n=e.mdat,a=e.traf,s=uo.findBox(a,["tfhd"]),o=$l.parseTfhd(s[0]),u=o.trackId,l=uo.findBox(a,["tfdt"]),c=l.length>0?$l.parseTfdt(l[0]).baseMediaDecodeTime:0,d=uo.findBox(a,["trun"]);t===u&&d.length>0&&(i=function(e,t,i){var r,n,a,s,o=new DataView(e.buffer,e.byteOffset,e.byteLength),u=[];for(n=0;n+4<e.length;n+=a)if(a=o.getUint32(n),n+=4,!(a<=0))switch(31&e[n]){case 6:var l=e.subarray(n+1,n+1+a),c=Zl(n,t);r={nalUnitType:"sei_rbsp",size:a,data:l,escapedRBSP:Ql(l),trackId:i},c?(r.pts=c.pts,r.dts=c.dts,s=c):(r.pts=s.pts,r.dts=s.dts),u.push(r)}return u}(n,function(e,t,i){var r=t,n=i.defaultSampleDuration||0,a=i.defaultSampleSize||0,s=i.trackId,o=[];return e.forEach(function(e){var t=$l.parseTrun(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=n),void 0===e.size&&(e.size=a),e.trackId=s,e.dts=r,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=r+e.compositionTimeOffset,r+=e.duration}),o=o.concat(t)}),o}(d,c,o),u),r[u]||(r[u]=[]),r[u]=r[u].concat(i))}),r},tc=function(){var e,t,i,r,n,a=!1;this.isInitialized=function(){return a},this.init=function(){e=new Jl,a=!0,e.on("data",function(e){e.startTime=e.startPts/r,e.endTime=e.endPts/r,n.captions.push(e),n.captionStreams[e.stream]=!0})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"===(void 0===t?"undefined":g(t))&&0===Object.keys(t).length||i===e[0]&&r===t[i])},this.parse=function(e,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],r=s[i];else if(!i||!r)return t.push(e),null;for(;t.length>0;){var u=t.shift();this.parse(u,a,s)}c=r;var l,c;return null!==(o=(l=i)?{seiNals:ec(e,l)[l],timescale:c}:null)&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),n):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;e.flush()},this.clearParsedCaptions=function(){n.captions=[],n.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],i=null,r=null,n?this.clearParsedCaptions():n={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()},ic=Object.freeze({default:tc,__moduleExports:tc}),rc=Nl&&Dl||Nl,nc=ic&&tc||ic,ac={generator:vl,probe:uo,Transmuxer:rc.Transmuxer,AudioSegmentStream:rc.AudioSegmentStream,VideoSegmentStream:rc.VideoSegmentStream,CaptionParser:nc}.CaptionParser,sc=function(e){var t=31&e[1];return t<<=8,t|=e[2]},oc=function(e){return!!(64&e[1])},uc=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},lc=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},cc={parseType:function(e,t){var i=sc(e);return 0===i?"pat":i===t?"pmt":t?"pes":null},parsePat:function(e){var t=oc(e),i=4+uc(e);return t&&(i+=e[i]+1),(31&e[i+10])<<8|e[i+11]},parsePmt:function(e){var t={},i=oc(e),r=4+uc(e);if(i&&(r+=e[r]+1),1&e[r+5]){var n;n=3+((15&e[r+1])<<8|e[r+2])-4;for(var a=12+((15&e[r+10])<<8|e[r+11]);a<n;){var s=r+a;t[(31&e[s+1])<<8|e[s+2]]=e[s],a+=5+((15&e[s+3])<<8|e[s+4])}return t}},parsePayloadUnitStartIndicator:oc,parsePesType:function(e,t){switch(t[sc(e)]){case du.H264_STREAM_TYPE:return"video";case du.ADTS_STREAM_TYPE:return"audio";case du.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!oc(e))return null;var t=4+uc(e);if(t>=e.byteLength)return null;var i,r=null;return 192&(i=e[t+7])&&((r={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,r.pts*=4,r.pts+=(6&e[t+13])>>>1,r.dts=r.pts,64&i&&(r.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,r.dts*=4,r.dts+=(6&e[t+18])>>>1)),r},videoPacketContainsKeyFrame:function(e){for(var t=4+uc(e),i=e.subarray(t),r=0,n=0,a=!1;n<i.byteLength-3;n++)if(1===i[n+2]){r=n+5;break}for(;r<i.byteLength;)switch(i[r]){case 0:if(0!==i[r-1]){r+=2;break}if(0!==i[r-2]){r++;break}n+3!==r-2&&"slice_layer_without_partitioning_rbsp_idr"===lc(31&i[n+3])&&(a=!0);do{r++}while(1!==i[r]&&r<i.length);n=r-2,r+=3;break;case 1:if(0!==i[r-1]||0!==i[r-2]){r+=3;break}"slice_layer_without_partitioning_rbsp_idr"===lc(31&i[n+3])&&(a=!0),n=r-2,r+=3;break;default:r+=3}return i=i.subarray(n),r-=n,n=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===lc(31&i[n+3])&&(a=!0),a}},dc=cc.parseType,hc=cc.parsePat,fc=cc.parsePmt,pc=cc.parsePayloadUnitStartIndicator,mc=cc.parsePesType,gc=cc.parsePesTime,yc=cc.videoPacketContainsKeyFrame,vc=Object.freeze({default:cc,__moduleExports:cc,parseType:dc,parsePat:hc,parsePmt:fc,parsePayloadUnitStartIndicator:pc,parsePesType:mc,parsePesTime:gc,videoPacketContainsKeyFrame:yc}),_c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],bc=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Tc={parseId3TagSize:function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&e[t+5])>>4?i+20:i+10},parseAdtsSize:function(e,t){var i=(224&e[t+5])>>5,r=e[t+4]<<3;return 6144&e[t+3]|r|i},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return _c[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,i,r;t=10,64&e[5]&&(t+=4,t+=bc(e.subarray(10,14)));do{if((i=bc(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){r=e.subarray(t+10,t+i+10);for(var n=0;n<r.byteLength;n++)if(0===r[n]){if("com.apple.streaming.transportStreamTimestamp"===(o=r,u=0,l=n,unescape(function(e,t,i){var r,n="";for(r=t;r<i;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n}(o,u,l)))){var a=r.subarray(n+1),s=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;return s*=4,s+=3&a[7]}break}}t+=10,t+=i}while(t<e.byteLength);var o,u,l;return null}},Sc=Tc.parseId3TagSize,Ec=Tc.parseAdtsSize,kc=Tc.parseType,wc=Tc.parseSampleRate,Ac=Tc.parseAacTimestamp,Lc=Object.freeze({default:Tc,__moduleExports:Tc,parseId3TagSize:Sc,parseAdtsSize:Ec,parseType:kc,parseSampleRate:wc,parseAacTimestamp:Ac}),Cc=vc&&cc||vc,Rc=Lc&&Tc||Lc,Oc=Su.handleRollover,Dc={};Dc.ts=Cc,Dc.aac=Rc;var Ic=function(e,t,i){for(var r,n,a,s,o=0,u=188,l=!1;u<e.byteLength;)if(71!==e[o]||71!==e[u])o++,u++;else{switch(r=e.subarray(o,u),Dc.ts.parseType(r,t.pid)){case"pes":n=Dc.ts.parsePesType(r,t.table),a=Dc.ts.parsePayloadUnitStartIndicator(r),"audio"===n&&a&&(s=Dc.ts.parsePesTime(r))&&(s.type="audio",i.audio.push(s),l=!0)}if(l)break;o+=188,u+=188}for(o=(u=e.byteLength)-188,l=!1;o>=0;)if(71!==e[o]||71!==e[u])o--,u--;else{switch(r=e.subarray(o,u),Dc.ts.parseType(r,t.pid)){case"pes":n=Dc.ts.parsePesType(r,t.table),a=Dc.ts.parsePayloadUnitStartIndicator(r),"audio"===n&&a&&(s=Dc.ts.parsePesTime(r))&&(s.type="audio",i.audio.push(s),l=!0)}if(l)break;o-=188,u-=188}},Pc=function(e,t,i){for(var r,n,a,s,o,u,l,c=0,d=188,h=!1,f={data:[],size:0};d<e.byteLength;)if(71!==e[c]||71!==e[d])c++,d++;else{switch(r=e.subarray(c,d),Dc.ts.parseType(r,t.pid)){case"pes":if(n=Dc.ts.parsePesType(r,t.table),a=Dc.ts.parsePayloadUnitStartIndicator(r),"video"===n&&(a&&!h&&(s=Dc.ts.parsePesTime(r))&&(s.type="video",i.video.push(s),h=!0),!i.firstKeyFrame)){if(a&&0!==f.size){for(o=new Uint8Array(f.size),u=0;f.data.length;)l=f.data.shift(),o.set(l,u),u+=l.byteLength;Dc.ts.videoPacketContainsKeyFrame(o)&&(i.firstKeyFrame=Dc.ts.parsePesTime(o),i.firstKeyFrame.type="video"),f.size=0}f.data.push(r),f.size+=r.byteLength}}if(h&&i.firstKeyFrame)break;c+=188,d+=188}for(c=(d=e.byteLength)-188,h=!1;c>=0;)if(71!==e[c]||71!==e[d])c--,d--;else{switch(r=e.subarray(c,d),Dc.ts.parseType(r,t.pid)){case"pes":n=Dc.ts.parsePesType(r,t.table),a=Dc.ts.parsePayloadUnitStartIndicator(r),"video"===n&&a&&(s=Dc.ts.parsePesTime(r))&&(s.type="video",i.video.push(s),h=!0)}if(h)break;c-=188,d-=188}},xc=function(e){var t={pid:null,table:null},i={};!function(e,t){for(var i,r=0,n=188;n<e.byteLength;)if(71!==e[r]||71!==e[n])r++,n++;else{switch(i=e.subarray(r,n),Dc.ts.parseType(i,t.pid)){case"pat":t.pid||(t.pid=Dc.ts.parsePat(i));break;case"pmt":t.table||(t.table=Dc.ts.parsePmt(i))}if(t.pid&&t.table)return;r+=188,n+=188}}(e,t);for(var r in t.table)if(t.table.hasOwnProperty(r)){switch(t.table[r]){case du.H264_STREAM_TYPE:i.video=[],Pc(e,t,i),0===i.video.length&&delete i.video;break;case du.ADTS_STREAM_TYPE:i.audio=[],Ic(e,t,i),0===i.audio.length&&delete i.audio}}return i},Mc=function(e,t){var i,r;return i=e,(r=i[0]==="I".charCodeAt(0)&&i[1]==="D".charCodeAt(0)&&i[2]==="3".charCodeAt(0)?function(e){for(var t,i=!1,r=0,n=null,a=null,s=0,o=0;e.length-o>=3;){switch(Dc.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){i=!0;break}if((s=Dc.aac.parseId3TagSize(e,o))>e.length){i=!0;break}null===a&&(t=e.subarray(o,o+s),a=Dc.aac.parseAacTimestamp(t)),o+=s;break;case"audio":if(e.length-o<7){i=!0;break}if((s=Dc.aac.parseAdtsSize(e,o))>e.length){i=!0;break}null===n&&(t=e.subarray(o,o+s),n=Dc.aac.parseSampleRate(t)),r++,o+=s;break;default:o++}if(i)return null}if(null===n||null===a)return null;var u=9e4/n;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*r*u,pts:a+1024*r*u}]}}(e):xc(e))&&(r.audio||r.video)?(function(e,t){if(e.audio&&e.audio.length){var i=t;void 0===i&&(i=e.audio[0].dts),e.audio.forEach(function(e){e.dts=Oc(e.dts,i),e.pts=Oc(e.pts,i),e.dtsTime=e.dts/9e4,e.ptsTime=e.pts/9e4})}if(e.video&&e.video.length){var r=t;if(void 0===r&&(r=e.video[0].dts),e.video.forEach(function(e){e.dts=Oc(e.dts,r),e.pts=Oc(e.pts,r),e.dtsTime=e.dts/9e4,e.ptsTime=e.pts/9e4}),e.firstKeyFrame){var n=e.firstKeyFrame;n.dts=Oc(n.dts,r),n.pts=Oc(n.pts,r),n.dtsTime=n.dts/9e4,n.ptsTime=n.dts/9e4}}}(r,t),r):null};var Uc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Nc=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Bc=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":g(t))&&"function"!=typeof t?e:t},Fc=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],i=e[1],r=t[4],n=i[4],a=void 0,s=void 0,o=void 0,u=[],l=[],c=void 0,d=void 0,h=void 0,f=void 0,p=void 0;for(a=0;a<256;a++)l[(u[a]=a<<1^283*(a>>7))^a]=a;for(s=o=0;!r[s];s^=c||1,o=l[o]||1)for(h=(h=o^o<<1^o<<2^o<<3^o<<4)>>8^255&h^99,r[s]=h,n[h]=s,p=16843009*u[d=u[c=u[s]]]^65537*d^257*c^16843008*s,f=257*u[h]^16843008*h,a=0;a<4;a++)t[a][s]=f=f<<24^f>>>8,i[a][h]=p=p<<24^p>>>8;for(a=0;a<5;a++)t[a]=t[a].slice(0),i[a]=i[a].slice(0);return e},jc=null,Gc=function(){function e(t){Uc(this,e),jc||(jc=Fc()),this._tables=[[jc[0][0].slice(),jc[0][1].slice(),jc[0][2].slice(),jc[0][3].slice(),jc[0][4].slice()],[jc[1][0].slice(),jc[1][1].slice(),jc[1][2].slice(),jc[1][3].slice(),jc[1][4].slice()]];var i=void 0,r=void 0,n=void 0,a=void 0,s=void 0,o=this._tables[0][4],u=this._tables[1],l=t.length,c=1;if(4!==l&&6!==l&&8!==l)throw new Error("Invalid aes key size");for(a=t.slice(0),s=[],this._key=[a,s],i=l;i<4*l+28;i++)n=a[i-1],(i%l==0||8===l&&i%l==4)&&(n=o[n>>>24]<<24^o[n>>16&255]<<16^o[n>>8&255]<<8^o[255&n],i%l==0&&(n=n<<8^n>>>24^c<<24,c=c<<1^283*(c>>7))),a[i]=a[i-l]^n;for(r=0;i;r++,i--)n=a[3&r?i:i-4],s[r]=i<=4||r<4?n:u[0][o[n>>>24]]^u[1][o[n>>16&255]]^u[2][o[n>>8&255]]^u[3][o[255&n]]}return e.prototype.decrypt=function(e,t,i,r,n,a){var s=this._key[1],o=e^s[0],u=r^s[1],l=i^s[2],c=t^s[3],d=void 0,h=void 0,f=void 0,p=s.length/4-2,m=void 0,g=4,y=this._tables[1],v=y[0],_=y[1],b=y[2],T=y[3],S=y[4];for(m=0;m<p;m++)d=v[o>>>24]^_[u>>16&255]^b[l>>8&255]^T[255&c]^s[g],h=v[u>>>24]^_[l>>16&255]^b[c>>8&255]^T[255&o]^s[g+1],f=v[l>>>24]^_[c>>16&255]^b[o>>8&255]^T[255&u]^s[g+2],c=v[c>>>24]^_[o>>16&255]^b[u>>8&255]^T[255&l]^s[g+3],g+=4,o=d,u=h,l=f;for(m=0;m<4;m++)n[(3&-m)+a]=S[o>>>24]<<24^S[u>>16&255]<<16^S[l>>8&255]<<8^S[255&c]^s[g++],d=o,o=u,u=l,l=c,c=d},e}(),Vc=function(){function e(){Uc(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e].splice(i,1),i>-1},e.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,r=0;r<i;++r)t[r].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),a=t.length,s=0;s<a;++s)t[s].apply(this,n)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),Hc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":g(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e);function t(){Uc(this,t);var i=Bc(this,e.call(this,Vc));return i.jobs=[],i.delay=1,i.timeout_=null,i}return t.prototype.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},t.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(Vc),zc=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},Wc=function(e,t,i){var r=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),n=new Gc(Array.prototype.slice.call(t)),a=new Uint8Array(e.byteLength),s=new Int32Array(a.buffer),o=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=void 0,f=void 0,p=void 0,m=void 0;for(o=i[0],u=i[1],l=i[2],c=i[3],m=0;m<r.length;m+=4)d=zc(r[m]),h=zc(r[m+1]),f=zc(r[m+2]),p=zc(r[m+3]),n.decrypt(d,h,f,p,s,m),s[m]=zc(s[m]^o),s[m+1]=zc(s[m+1]^u),s[m+2]=zc(s[m+2]^l),s[m+3]=zc(s[m+3]^c),o=d,u=h,l=f,c=p;return a},qc=function(){function e(t,i,r,n){Uc(this,e);var a=e.STEP,s=new Int32Array(t.buffer),o=new Uint8Array(t.byteLength),u=0;for(this.asyncStream_=new Hc,this.asyncStream_.push(this.decryptChunk_(s.subarray(u,u+a),i,r,o)),u=a;u<s.length;u+=a)r=new Uint32Array([zc(s[u-4]),zc(s[u-3]),zc(s[u-2]),zc(s[u-1])]),this.asyncStream_.push(this.decryptChunk_(s.subarray(u,u+a),i,r,o));this.asyncStream_.push(function(){n(null,(e=o).subarray(0,e.byteLength-e[e.byteLength-1]));var e})}return e.prototype.decryptChunk_=function(e,t,i,r){return function(){var n=Wc(e,t,i);r.set(n,e.byteOffset)}},Nc(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}(),Kc=function(e,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=Aa.buildAbsoluteURL(n.location.href,e)),Aa.buildAbsoluteURL(e,t))},Xc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Yc=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),$c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":g(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qc=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":g(t))&&"function"!=typeof t?e:t},Jc=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Zc=Ea.mergeOptions,ed=Ea.EventTarget,td=Ea.log,id=function(e,t){["AUDIO","SUBTITLES"].forEach(function(i){for(var r in e.mediaGroups[i])for(var n in e.mediaGroups[i][r]){var a=e.mediaGroups[i][r][n];t(a,i,r,n)}})},rd=function(e,t){var i=Zc(e,{}),r=i.playlists[t.uri];if(!r)return null;if(r.segments&&t.segments&&r.segments.length===t.segments.length&&r.mediaSequence===t.mediaSequence)return null;var n=Zc(r,t);r.segments&&(n.segments=function(e,t,i){var r=t.slice();i=i||0;for(var n=Math.min(e.length,t.length+i),a=i;a<n;a++)r[a-i]=Zc(e[a],r[a-i]);return r}(r.segments,t.segments,t.mediaSequence-r.mediaSequence)),n.segments.forEach(function(e){t=e,i=n.resolvedUri,t.resolvedUri||(t.resolvedUri=Kc(i,t.uri)),t.key&&!t.key.resolvedUri&&(t.key.resolvedUri=Kc(i,t.key.uri)),t.map&&!t.map.resolvedUri&&(t.map.resolvedUri=Kc(i,t.map.uri));var t,i});for(var a=0;a<i.playlists.length;a++)i.playlists[a].uri===t.uri&&(i.playlists[a]=n);return i.playlists[t.uri]=n,i},nd=function(e){for(var t=e.playlists.length;t--;){var i=e.playlists[t];e.playlists[i.uri]=i,i.resolvedUri=Kc(e.uri,i.uri),i.id=t,i.attributes||(i.attributes={},td.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))}},ad=function(e){id(e,function(t){t.uri&&(t.resolvedUri=Kc(e.uri,t.uri))})},sd=function(e,t){var i=e.segments[e.segments.length-1];return t&&i&&i.duration?1e3*i.duration:500*(e.targetDuration||10)},od=function(e){$c(t,ed);function t(e,i,r){Xc(this,t);var n=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(n.srcUrl=e,n.hls_=i,n.withCredentials=r,!n.srcUrl)throw new Error("A non-empty playlist URL is required");return n.state="HAVE_NOTHING",n.on("mediaupdatetimeout",function(){"HAVE_METADATA"===n.state&&(n.state="HAVE_CURRENT_METADATA",n.request=n.hls_.xhr({uri:Kc(n.master.uri,n.media().uri),withCredentials:n.withCredentials},function(e,t){if(n.request)return e?n.playlistRequestError(n.request,n.media().uri,"HAVE_METADATA"):void n.haveMetadata(n.request,n.media().uri)}))}),n}return Yc(t,[{key:"playlistRequestError",value:function(e,t,i){this.request=null,i&&(this.state=i),this.error={playlist:this.master.playlists[t],status:e.status,message:"HLS playlist request error at URL: "+t,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}},{key:"haveMetadata",value:function(e,t){var i=this;this.request=null,this.state="HAVE_METADATA";var r=new Ma;r.push(e.responseText),r.end(),r.manifest.uri=t,r.manifest.attributes=r.manifest.attributes||{};var a=rd(this.master,r.manifest);this.targetDuration=r.manifest.targetDuration,a?(this.master=a,this.media_=this.master.playlists[r.manifest.uri]):this.trigger("playlistunchanged"),this.media().endList||(n.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=n.setTimeout(function(){i.trigger("mediaupdatetimeout")},sd(this.media(),!!a))),this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.stopRequest(),n.clearTimeout(this.mediaUpdateTimeout)}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"media",value:function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var i=this.state;if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}var r=!this.media_||e.uri!==this.media_.uri;if(this.master.playlists[e.uri].endList)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(r&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(r){if(this.state="SWITCHING_MEDIA",this.request){if(Kc(this.master.uri,e.uri)===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.hls_.xhr({uri:Kc(this.master.uri,e.uri),withCredentials:this.withCredentials},function(r,n){if(t.request){if(r)return t.playlistRequestError(t.request,e.uri,i);t.haveMetadata(n,e.uri),"HAVE_MASTER"===i?t.trigger("loadedmetadata"):t.trigger("mediachange")}})}}},{key:"pause",value:function(){this.stopRequest(),n.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}},{key:"load",value:function(e){var t=this;n.clearTimeout(this.mediaUpdateTimeout);var i=this.media();if(e){var r=i?i.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=n.setTimeout(function(){return t.load()},r)}else this.started?i&&!i.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}},{key:"start",value:function(){var e=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,i){if(e.request){if(e.request=null,t)return e.error={status:i.status,message:"HLS playlist request error at URL: "+e.srcUrl,responseText:i.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");var r=new Ma;return r.push(i.responseText),r.end(),e.state="HAVE_MASTER",r.manifest.uri=e.srcUrl,r.manifest.playlists?(e.master=r.manifest,nd(e.master),ad(e.master),e.trigger("loadedplaylist"),void(e.request||e.media(r.manifest.playlists[0]))):(e.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:n.location.href,playlists:[{uri:e.srcUrl,id:0}]},e.master.playlists[e.srcUrl]=e.master.playlists[0],e.master.playlists[0].resolvedUri=e.srcUrl,e.master.playlists[0].attributes=e.master.playlists[0].attributes||{},e.haveMetadata(i,e.srcUrl),e.trigger("loadedmetadata"))}})}}]),t}(),ud=Ea.createTimeRange,ld=function(e,t,i){var r=void 0,n=void 0;return void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence?0:(r=function(e,t){var i=0,r=t-e.mediaSequence,n=e.segments[r];if(n){if(void 0!==n.start)return{result:n.start,precise:!0};if(void 0!==n.end)return{result:n.end-n.duration,precise:!0}}for(;r--;){if(void 0!==(n=e.segments[r]).end)return{result:i+n.end,precise:!0};if(i+=n.duration,void 0!==n.start)return{result:i+n.start,precise:!0}}return{result:i,precise:!1}}(e,t)).precise?r.result:(n=function(e,t){for(var i=0,r=void 0,n=t-e.mediaSequence;n<e.segments.length;n++){if(void 0!==(r=e.segments[n]).start)return{result:r.start-i,precise:!0};if(i+=r.duration,void 0!==r.end)return{result:r.end-i,precise:!0}}return{result:-1,precise:!1}}(e,t)).precise?n.result:r.result+i},cd=function(e,t,i){if(!e)return 0;if("number"!=typeof i&&(i=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return n.Infinity}return ld(e,t,i)},dd=function(e,t,i){var r=0;if(t>i){var n=[i,t];t=n[0],i=n[1]}if(t<0){for(var a=t;a<Math.min(0,i);a++)r+=e.targetDuration;t=0}for(var s=t;s<i;s++)r+=e.segments[s].duration;return r},hd=function(e){if(!e.segments.length)return 0;for(var t=e.segments.length-1,i=e.segments[t].duration||e.targetDuration,r=i+2*e.targetDuration;t--&&!((i+=e.segments[t].duration)>=r););return Math.max(0,t)},fd=function(e,t,i){if(!e||!e.segments)return null;if(e.endList)return cd(e);if(null===t)return null;t=t||0;var r=i?hd(e):e.segments.length;return ld(e,e.mediaSequence+r,t)},pd=function(e){return e-Math.floor(e)==0},md=function(e,t){if(pd(t))return t+.1*e;for(var i=t.toString().split(".")[1].length,r=1;r<=i;r++){var n=Math.pow(10,r),a=t*n;if(pd(a)||r===i)return(a+e)/n}},gd=md.bind(null,1),yd=md.bind(null,-1),vd=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},_d=function(e){return e.excludeUntil&&e.excludeUntil===1/0},bd=function(e){var t=vd(e);return!e.disabled&&!t},Td=function(e,t){return t.attributes&&t.attributes[e]},Sd=function(e,t){if(1===e.playlists.length)return!0;var i=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(function(e){return!!bd(e)&&(e.attributes.BANDWIDTH||0)<i}).length},Ed={duration:cd,seekable:function(e,t){var i=t||0,r=fd(e,t,!0);return null===r?ud():ud(i,r)},safeLiveIndex:hd,getMediaInfoForTime:function(e,t,i,r){var n=void 0,a=void 0,s=e.segments.length,o=t-r;if(o<0){if(i>0)for(n=i-1;n>=0;n--)if(a=e.segments[n],(o+=yd(a.duration))>0)return{mediaIndex:n,startTime:r-dd(e,i,n)};return{mediaIndex:0,startTime:t}}if(i<0){for(n=i;n<0;n++)if((o-=e.targetDuration)<0)return{mediaIndex:0,startTime:t};i=0}for(n=i;n<s;n++)if(a=e.segments[n],(o-=gd(a.duration))<0)return{mediaIndex:n,startTime:r+dd(e,i,n)};return{mediaIndex:s-1,startTime:t}},isEnabled:bd,isDisabled:function(e){return e.disabled},isBlacklisted:vd,isIncompatible:_d,playlistEnd:fd,isAes:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},isFmp4:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].map)return!0;return!1},hasAttribute:Td,estimateSegmentRequestTime:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Td("BANDWIDTH",i))return NaN;return(e*i.attributes.BANDWIDTH-8*r)/t},isLowestEnabledRendition:Sd},kd=Ea.xhr,wd=Ea.mergeOptions,Ad=function(){return function e(t,i){t=wd({timeout:45e3},t);var r=e.beforeRequest||Ea.Hls.xhr.beforeRequest;if(r&&"function"==typeof r){var n=r(t);n&&(t=n)}var a=kd(t,function(e,t){var r=a.response;!e&&r&&(a.responseTime=Date.now(),a.roundTripTime=a.responseTime-a.requestTime,a.bytesReceived=r.byteLength||r.length,a.bandwidth||(a.bandwidth=Math.floor(a.bytesReceived/a.roundTripTime*8*1e3))),t.headers&&(a.responseHeaders=t.headers),e&&"ETIMEDOUT"===e.code&&(a.timedout=!0),e||a.aborted||200===t.statusCode||206===t.statusCode||0===t.statusCode||(e=new Error("XHR Failed with a response of: "+(a&&(r||a.responseText)))),i(e,a)}),s=a.abort;return a.abort=function(){return a.aborted=!0,s.apply(a,arguments)},a.uri=t.uri,a.requestTime=Date.now(),a}},Ld=function(e,t){var i=e.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")},Cd=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},Rd=function(e){var t={};return Object.keys(e).forEach(function(i){var r=e[i];ArrayBuffer.isView(r)?t[i]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[i]=r}),t},Od=function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Dd=function(e){for(var t=Array.prototype.slice.call(e),i="",r=0;r<t.length/16;r++)i+=t.slice(16*r,16*r+16).map(Ld).join("")+" "+t.slice(16*r,16*r+16).map(Cd).join("")+"\n";return i},Id=Object.freeze({createTransferableMessage:Rd,initSegmentId:Od,hexDump:Dd,tagDump:function(e){var t=e.bytes;return Dd(t)},textRanges:function(e){var t="",i=void 0;for(i=0;i<e.length;i++)t+=(r=e,n=i,r.start(n)+"-"+r.end(n)+" ");var r,n;return t}}),Pd=function(e,t){var i=[],r=void 0;if(e&&e.length)for(r=0;r<e.length;r++)t(e.start(r),e.end(r))&&i.push([e.start(r),e.end(r)]);return Ea.createTimeRanges(i)},xd=function(e,t){return Pd(e,function(e,i){return e-1/30<=t&&i+1/30>=t})},Md=function(e,t){return Pd(e,function(e){return e-1/30>=t})},Ud=function(e){var t=[];if(!e||!e.length)return"";for(var i=0;i<e.length;i++)t.push(e.start(i)+" => "+e.end(i));return t.join(", ")},Nd=function(e){for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t},Bd=function(e,t,i){var r=void 0,n=void 0;if(i&&i.cues)for(r=i.cues.length;r--;)(n=i.cues[r]).startTime<=t&&n.endTime>=e&&i.removeCue(n)},Fd=function(e){return isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e},jd=function(e,t,i){var r=n.WebKitDataCue||n.VTTCue;if(t&&t.forEach(function(e){var t=e.stream;this.inbandTextTracks_[t].addCue(new r(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},e),i){var a=Fd(e.mediaSource_.duration);if(i.forEach(function(e){var t=e.cueTime+this.timestampOffset;e.frames.forEach(function(e){var i=new r(t,t,e.value||e.url||e.data||"");i.frame=e,i.value=e,n=i,Object.defineProperties(n.frame,{id:{get:function(){return Ea.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),n.value.key}},value:{get:function(){return Ea.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),n.value.data}},privateData:{get:function(){return Ea.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),n.value.data}}});var n;this.metadataTrack_.addCue(i)},this)},e),e.metadataTrack_&&e.metadataTrack_.cues&&e.metadataTrack_.cues.length){for(var s=e.metadataTrack_.cues,o=[],u=0;u<s.length;u++)s[u]&&o.push(s[u]);var l=o.reduce(function(e,t){var i=e[t.startTime]||[];return i.push(t),e[t.startTime]=i,e},{}),c=Object.keys(l).sort(function(e,t){return Number(e)-Number(t)});c.forEach(function(e,t){var i=l[e],r=Number(c[t+1])||a;i.forEach(function(e){e.endTime=r})})}}},Gd="undefined"!=typeof window?window:{},Vd="undefined"==typeof Symbol?"__target":Symbol(),Hd="application/javascript",zd=Gd.BlobBuilder||Gd.WebKitBlobBuilder||Gd.MozBlobBuilder||Gd.MSBlobBuilder,Wd=Gd.URL||Gd.webkitURL||Wd&&Wd.msURL,qd=Gd.Worker;function Kd(e,t){return function(i){var r=this;if(!t)return new qd(e);if(qd&&!i){var n=Qd(t.toString().replace(/^function.+?{/,"").slice(0,-1));return this[Vd]=new qd(n),function(e,t){if(!e||!t)return;var i=e.terminate;e.objURL=t,e.terminate=function(){e.objURL&&Wd.revokeObjectURL(e.objURL),i.call(e)}}(this[Vd],n),this[Vd]}var a={postMessage:function(e){r.onmessage&&setTimeout(function(){r.onmessage({data:e,target:a})})}};t.call(a),this.postMessage=function(e){setTimeout(function(){a.onmessage({data:e,target:r})})},this.isThisThread=!0}}if(qd){var Xd,Yd=Qd("self.onmessage = function () {}"),$d=new Uint8Array(1);try{(Xd=new qd(Yd)).postMessage($d,[$d.buffer])}catch(e){qd=null}finally{Wd.revokeObjectURL(Yd),Xd&&Xd.terminate()}}function Qd(e){try{return Wd.createObjectURL(new Blob([e],{type:Hd}))}catch(i){var t=new zd;return t.append(e),Wd.createObjectURL(t.getBlob(type))}}var Jd=new Kd("./transmuxer-worker.worker.js",function(e,t){var i=this;!function(){var e,t,r,n,a,s,o,u,l,c,d,h,f,p,m,y,v,_,b,T,S,E,k,w,A,L,C,R,O,D,I,P,x,M,U,N,B=Math.pow(2,32)-1;!function(){var e;if(k={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in k)k.hasOwnProperty(e)&&(k[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);w=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),L=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),O={video:C,audio:R},P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]),x=new Uint8Array([0,0,0,0,0,0,0,0]),M=x,U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N=x,D=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),e=function(e){var t,i,r=[],n=0;for(t=1;t<arguments.length;t++)r.push(arguments[t]);for(t=r.length;t--;)n+=r[t].byteLength;for(i=new Uint8Array(n+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(e,4),t=0,n=8;t<r.length;t++)i.set(r[t],n),n+=r[t].byteLength;return i},t=function(){return e(k.dinf,e(k.dref,P))},r=function(t){return e(k.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},n=function(){return e(k.ftyp,w,A,w,L)},y=function(t){return e(k.hdlr,O[t])},a=function(t){return e(k.mdat,t)},m=function(t){var i=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(i[12]=t.samplerate>>>24&255,i[13]=t.samplerate>>>16&255,i[14]=t.samplerate>>>8&255,i[15]=255&t.samplerate),e(k.mdhd,i)},p=function(t){return e(k.mdia,m(t),y(t.type),o(t))},s=function(t){return e(k.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},o=function(i){return e(k.minf,"video"===i.type?e(k.vmhd,D):e(k.smhd,I),t(),_(i))},u=function(t,i){for(var r=[],n=i.length;n--;)r[n]=T(i[n]);return e.apply(null,[k.moof,s(t)].concat(r))},l=function(t){for(var i=t.length,r=[];i--;)r[i]=h(t[i]);return e.apply(null,[k.moov,d(4294967295)].concat(r).concat(c(t)))},c=function(t){for(var i=t.length,r=[];i--;)r[i]=S(t[i]);return e.apply(null,[k.mvex].concat(r))},d=function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e(k.mvhd,i)},v=function(t){var i,r,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e(k.sdtp,a)},_=function(t){return e(k.stbl,b(t),e(k.stts,N),e(k.stsc,M),e(k.stsz,U),e(k.stco,x))},function(){var t,i;b=function(r){return e(k.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===r.type?t(r):i(r))},t=function(t){var i,r=t.sps||[],n=t.pps||[],a=[],s=[];for(i=0;i<r.length;i++)a.push((65280&r[i].byteLength)>>>8),a.push(255&r[i].byteLength),a=a.concat(Array.prototype.slice.call(r[i]));for(i=0;i<n.length;i++)s.push((65280&n[i].byteLength)>>>8),s.push(255&n[i].byteLength),s=s.concat(Array.prototype.slice.call(n[i]));return e(k.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),e(k.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([r.length]).concat(a).concat([n.length]).concat(s))),e(k.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},i=function(t){return e(k.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),r(t))}}(),f=function(t){var i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return e(k.tkhd,i)},T=function(t){var i,r,n,a,s,o;return i=e(k.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),s=Math.floor(t.baseMediaDecodeTime/(B+1)),o=Math.floor(t.baseMediaDecodeTime%(B+1)),r=e(k.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),92,"audio"===t.type?(n=E(t,92),e(k.traf,i,r,n)):(a=v(t),n=E(t,a.length+92),e(k.traf,i,r,n,a))},h=function(t){return t.duration=t.duration||4294967295,e(k.trak,f(t),p(t))},S=function(t){var i=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(i[i.length-1]=0),e(k.trex,i)},function(){var t,i,r;r=function(e,t){var i=0,r=0,n=0,a=0;return e.length&&(void 0!==e[0].duration&&(i=1),void 0!==e[0].size&&(r=2),void 0!==e[0].flags&&(n=4),void 0!==e[0].compositionTimeOffset&&(a=8)),[0,0,i|r|n|a,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},i=function(t,i){var n,a,s,o;for(i+=20+16*(a=t.samples||[]).length,n=r(a,i),o=0;o<a.length;o++)s=a[o],n=n.concat([(4278190080&s.duration)>>>24,(16711680&s.duration)>>>16,(65280&s.duration)>>>8,255&s.duration,(4278190080&s.size)>>>24,(16711680&s.size)>>>16,(65280&s.size)>>>8,255&s.size,s.flags.isLeading<<2|s.flags.dependsOn,s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,61440&s.flags.degradationPriority,15&s.flags.degradationPriority,(4278190080&s.compositionTimeOffset)>>>24,(16711680&s.compositionTimeOffset)>>>16,(65280&s.compositionTimeOffset)>>>8,255&s.compositionTimeOffset]);return e(k.trun,new Uint8Array(n))},t=function(t,i){var n,a,s,o;for(i+=20+8*(a=t.samples||[]).length,n=r(a,i),o=0;o<a.length;o++)s=a[o],n=n.concat([(4278190080&s.duration)>>>24,(16711680&s.duration)>>>16,(65280&s.duration)>>>8,255&s.duration,(4278190080&s.size)>>>24,(16711680&s.size)>>>16,(65280&s.size)>>>8,255&s.size]);return e(k.trun,new Uint8Array(n))},E=function(e,r){return"audio"===e.type?t(e,r):i(e,r)}}();var F,j,G={ftyp:n,mdat:a,moof:u,moov:l,initSegment:function(e){var t,i=n(),r=l(e);return(t=new Uint8Array(i.byteLength+r.byteLength)).set(i),t.set(r,i.byteLength),t}},V=function(e){return e>>>0},H={findBox:F=function(e,t){var i,r,n,a,s,o=[];if(!t.length)return null;for(i=0;i<e.byteLength;)r=V(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]),n=j(e.subarray(i+4,i+8)),a=r>1?i+r:e.byteLength,n===t[0]&&(1===t.length?o.push(e.subarray(i+8,a)):(s=F(e.subarray(i+8,a),t.slice(1))).length&&(o=o.concat(s))),i=a;return o},parseType:j=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},timescale:function(e){return F(e,["moov","trak"]).reduce(function(e,t){var i,r,n,a,s;return(i=F(t,["tkhd"])[0])?(r=i[0],a=V(i[n=0===r?12:20]<<24|i[n+1]<<16|i[n+2]<<8|i[n+3]),(s=F(t,["mdia","mdhd"])[0])?(n=0===(r=s[0])?12:20,e[a]=V(s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]),e):null):null},{})},startTime:function(e,t){var i,r,n;return i=F(t,["moof","traf"]),r=[].concat.apply([],i.map(function(t){return F(t,["tfhd"]).map(function(i){var r,n;return r=V(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),n=e[r]||9e4,(F(t,["tfdt"]).map(function(e){var t,i;return t=e[0],i=V(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(i*=Math.pow(2,32),i+=V(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),i})[0]||1/0)/n})})),n=Math.min.apply(null,r),isFinite(n)?n:0},videoTrackIds:function(e){var t=[];return F(e,["moov","trak"]).forEach(function(e){var i=F(e,["mdia","hdlr"]),r=F(e,["tkhd"]);i.forEach(function(e,i){var n,a,s=j(e.subarray(8,12)),o=r[i];"vide"===s&&(a=0===(n=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?n.getUint32(12):n.getUint32(20),t.push(a))})}),t}},z=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var r;return!!e[t]&&(r=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(r,1),r>-1)},this.trigger=function(t){var i,r,n,a;if(i=e[t])if(2===arguments.length)for(n=i.length,r=0;r<n;++r)i[r].call(this,arguments[1]);else{for(a=[],r=arguments.length,r=1;r<arguments.length;++r)a.push(arguments[r]);for(n=i.length,r=0;r<n;++r)i[r].apply(this,a)}},this.dispose=function(){e={}}}};z.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},z.prototype.push=function(e){this.trigger("data",e)},z.prototype.flush=function(e){this.trigger("done",e)};var W=z,q=function(e,t){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},K=function(e){var t,i,r=[],n=[];for(r.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(i=e[t]).nalUnitType?(r.length&&(r.duration=i.dts-r.dts,n.push(r)),(r=[i]).byteLength=i.data.byteLength,r.pts=i.pts,r.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(r.keyFrame=!0),r.duration=i.dts-r.dts,r.byteLength+=i.data.byteLength,r.push(i));return n.length&&(!r.duration||r.duration<=0)&&(r.duration=n[n.length-1].duration),n.push(r),n},X=function(e){var t,i,r=[],n=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,t=0;t<e.length;t++)(i=e[t]).keyFrame?(r.length&&(n.push(r),n.byteLength+=r.byteLength,n.nalCount+=r.nalCount,n.duration+=r.duration),(r=[i]).nalCount=i.length,r.byteLength=i.byteLength,r.pts=i.pts,r.dts=i.dts,r.duration=i.duration):(r.duration+=i.duration,r.nalCount+=i.length,r.byteLength+=i.byteLength,r.push(i));return n.length&&r.duration<=0&&(r.duration=n[n.length-1].duration),n.byteLength+=r.byteLength,n.nalCount+=r.nalCount,n.duration+=r.duration,n.push(r),n},Y=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},$=function(e,t){var i,r,n,a,s,o=t||0,u=[];for(i=0;i<e.length;i++)for(a=e[i],r=0;r<a.length;r++)s=a[r],o+=(n=q(s,o)).size,u.push(n);return u},Q=function(e){var t,i,r,n,a,s,o=0,u=e.byteLength,l=e.nalCount,c=new Uint8Array(u+4*l),d=new DataView(c.buffer);for(t=0;t<e.length;t++)for(n=e[t],i=0;i<n.length;i++)for(a=n[i],r=0;r<a.length;r++)s=a[r],d.setUint32(o,s.data.byteLength),o+=4,c.set(s.data,o),o+=s.data.byteLength;return c},J=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Z=function(e,t){var i,r=e.minSegmentDts;return t||(r-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=r,i=Math.max(0,i),"audio"===e.type&&(i*=e.samplerate/9e4,i=Math.floor(i)),i},ee=function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},te=function(e){for(var t=0,i={payloadType:-1,payloadSize:0},r=0,n=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)r+=255,t++;for(r+=e[t++];255===e[t];)n+=255,t++;if(n+=e[t++],!i.payload&&4===r){i.payloadType=r,i.payloadSize=n,i.payload=e.subarray(t,t+n);break}t+=n,r=0,n=0}return i},ie=function(e){return 181!==e.payload[0]?null:49!=(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},re=function(e,t){var i,r,n,a,s=[];if(!(64&t[0]))return s;for(r=31&t[0],i=0;i<r;i++)a={type:3&t[2+(n=3*i)],pts:e},4&t[n+2]&&(a.ccData=t[n+3]<<8|t[n+4],s.push(a));return s},ne=function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},ae=4,se=function e(){e.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new de(0,0),new de(0,1),new de(1,0),new de(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("done",this.trigger.bind(this,"done"))},this)};(se.prototype=new W).push=function(e){var t,i,r;if("sei_rbsp"===e.nalUnitType&&(t=te(e.escapedRBSP)).payloadType===ae&&(i=ie(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));r=re(e.pts,i),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},se.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.ccStreams_.forEach(function(e){e.flush()},this)):this.ccStreams_.forEach(function(e){e.flush()},this)},se.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},se.prototype.dispatchCea608Packet=function(e){this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},se.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},se.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)};var oe={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ue=function(e){return null===e?"":(e=oe[e]||e,String.fromCharCode(e))},le=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],ce=function(){for(var e=[],t=15;t--;)e.push("");return e},de=function e(t,i){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,i,r,n,a;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),r=t>>>8,n=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=ce();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=ce();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=ce()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(r,n))a=ue((r=(3&r)<<8)|n),this[this.mode_](e.pts,a),this.column_++;else if(this.isExtCharacter(r,n))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=ue((r=(3&r)<<8)|n),this[this.mode_](e.pts,a),this.column_++;else if(this.isMidRowCode(r,n))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&n)&&this.addFormatting(e.pts,["i"]),1==(1&n)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(r,n))this.column_+=3&n;else if(this.isPAC(r,n)){var s=le.indexOf(7968&t);"rollUp"===this.mode_&&this.setRollUp(e.pts,s),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&n&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(n)&&14==(14&n)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(r)&&(0===n&&(n=null),a=ue(r),a+=ue(n),this[this.mode_](e.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};de.prototype=new W,de.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){return e.trim()}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},de.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=ce(),this.nonDisplayed_=ce(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},de.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},de.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},de.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},de.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},de.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},de.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},de.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},de.prototype.isNormalChar=function(e){return e>=32&&e<=127},de.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=ce(),this.displayed_=ce()),void 0!==t&&t!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[t-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},de.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)},de.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},de.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t,this.nonDisplayed_[this.row_]=i},de.prototype.rollUp=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i},de.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},de.prototype.paintOn=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i};var he={CaptionStream:se,Cea608Stream:de},fe={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},pe=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>4294967296;)e+=8589934592*i;return e},me=function e(t){var i,r;e.prototype.init.call(this),this.type_=t,this.push=function(e){e.type===this.type_&&(void 0===r&&(r=e.dts),e.dts=pe(e.dts,r),e.pts=pe(e.pts,r),i=e.dts,this.trigger("data",e))},this.flush=function(){r=i,this.trigger("done")},this.discontinuity=function(){r=void 0,i=void 0}};me.prototype=new W;var ge,ye=me,ve=function(e,t,i){var r,n="";for(r=t;r<i;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n},_e=function(e,t,i){return decodeURIComponent(ve(e,t,i))},be=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Te={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=_e(e.data,1,t),e.value=_e(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=_e(e.data,1,t),e.url=_e(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=(i=e.data,r=0,n=t,unescape(ve(i,r,n)));break}var i,r,n;e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(ge=function(e){var t,i={debug:!(!e||!e.debug),descriptor:e&&e.descriptor},r=0,n=[],a=0;if(ge.prototype.init.call(this),this.dispatchType=fe.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(t=0;t<i.descriptor.length;t++)this.dispatchType+=("00"+i.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,s,o,u,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(a=0,n.length=0),0===n.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))i.debug&&console.log("Skipping unrecognized metadata packet");else if(n.push(e),a+=e.data.byteLength,1===n.length&&(r=be(e.data.subarray(6,10)),r+=10),!(a<r)){for(t={data:new Uint8Array(r),frames:[],pts:n[0].pts,dts:n[0].dts},l=0;l<r;)t.data.set(n[0].data.subarray(0,r-l),l),l+=n[0].data.byteLength,a-=n[0].data.byteLength,n.shift();s=10,64&t.data[5]&&(s+=4,s+=be(t.data.subarray(10,14)),r-=be(t.data.subarray(16,20)));do{if((o=be(t.data.subarray(s+4,s+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((u={id:String.fromCharCode(t.data[s],t.data[s+1],t.data[s+2],t.data[s+3]),data:t.data.subarray(s+10,s+o+10)}).key=u.id,Te[u.id]&&(Te[u.id](u),"com.apple.streaming.transportStreamTimestamp"===u.owner)){var c=u.data,d=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;d*=4,d+=3&c[7],u.timeStamp=d,void 0===t.pts&&void 0===t.dts&&(t.pts=u.timeStamp,t.dts=u.timeStamp),this.trigger("timestamp",u)}t.frames.push(u),s+=10,s+=o}while(s<r);this.trigger("data",t)}}}).prototype=new W;var Se,Ee,ke,we=ge,Ae=ye;(Se=function(){var e=new Uint8Array(188),t=0;Se.prototype.init.call(this),this.push=function(i){var r,n=0,a=188;for(t?((r=new Uint8Array(i.byteLength+t)).set(e.subarray(0,t)),r.set(i,t),t=0):r=i;a<r.byteLength;)71!==r[n]||71!==r[a]?(n++,a++):(this.trigger("data",r.subarray(n,a)),n+=188,a+=188);n<r.byteLength&&(e.set(r.subarray(n),0),t=r.byteLength-n)},this.flush=function(){188===t&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")}}).prototype=new W,(Ee=function(){var e,t,i,r;Ee.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,r){var n=0;r.payloadUnitStartIndicator&&(n+=e[n]+1),"pat"===r.type?t(e.subarray(n),r):i(e.subarray(n),r)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],r.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=r.pmtPid},i=function(e,t){var i,n;if(1&e[5]){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&e[1])<<8|e[2])-4,n=12+((15&e[10])<<8|e[11]);n<i;){var a=e[n],s=(31&e[n+1])<<8|e[n+2];a===fe.H264_STREAM_TYPE&&null===r.programMapTable.video?r.programMapTable.video=s:a===fe.ADTS_STREAM_TYPE&&null===r.programMapTable.audio?r.programMapTable.audio=s:a===fe.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][s]=a),n+=5+((15&e[n+3])<<8|e[n+4])}t.programMapTable=r.programMapTable}},this.push=function(t){var i={},r=4;if(i.payloadUnitStartIndicator=!!(64&t[1]),i.pid=31&t[1],i.pid<<=8,i.pid|=t[2],(48&t[3])>>>4>1&&(r+=t[r]+1),0===i.pid)i.type="pat",e(t.subarray(r),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",e(t.subarray(r),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,r,i]):this.processPes_(t,r,i)},this.processPes_=function(e,t,i){i.pid===this.programMapTable.video?i.streamType=fe.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=fe.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=e.subarray(t),this.trigger("data",i)}}).prototype=new W,Ee.STREAM_TYPES={h264:27,adts:15},(ke=function(){var e=this,t={data:[],size:0},i={data:[],size:0},r={data:[],size:0},n=function(t,i,r){var n,a=new Uint8Array(t.size),s={type:i},o=0,u=0,l=!1;if(t.data.length&&!(t.size<9)){for(s.trackId=t.data[0].pid,o=0;o<t.data.length;o++)n=t.data[o],a.set(n.data,u),u+=n.data.byteLength;!function(e,t){var i;t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),192&(i=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&i&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8])}(a,s),l="video"===i||s.packetLength<=t.size,(r||l)&&(t.size=0,t.data.length=0),l&&e.trigger("data",s)}};ke.prototype.init.call(this),this.push=function(a){({pat:function(){},pes:function(){var e,s;switch(a.streamType){case fe.H264_STREAM_TYPE:case fe.H264_STREAM_TYPE:e=t,s="video";break;case fe.ADTS_STREAM_TYPE:e=i,s="audio";break;case fe.METADATA_STREAM_TYPE:e=r,s="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&n(e,s,!0),e.data.push(a),e.size+=a.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},i=a.programMapTable;null!==i.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+i.video,codec:"avc",type:"video"}),null!==i.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+i.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[a.type]()},this.flush=function(){n(t,"video"),n(i,"audio"),n(r,"timed-metadata"),this.trigger("done")}}).prototype=new W;var Le={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:Se,TransportParseStream:Ee,ElementaryStream:ke,TimestampRolloverStream:Ae,CaptionStream:he.CaptionStream,Cea608Stream:he.Cea608Stream,MetadataStream:we};for(var Ce in fe)fe.hasOwnProperty(Ce)&&(Le[Ce]=fe[Ce]);var Re,Oe=Le,De=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(Re=function(){var e;Re.prototype.init.call(this),this.push=function(t){var i,r,n,a,s,o,u=0,l=0;if("audio"===t.type)for(e?(a=e,(e=new Uint8Array(a.byteLength+t.data.byteLength)).set(a),e.set(t.data,a.byteLength)):e=t.data;u+5<e.length;)if(255===e[u]&&240==(246&e[u+1])){if(r=2*(1&~e[u+1]),i=(3&e[u+3])<<11|e[u+4]<<3|(224&e[u+5])>>5,o=9e4*(s=1024*(1+(3&e[u+6])))/De[(60&e[u+2])>>>2],n=u+i,e.byteLength<n)return;if(this.trigger("data",{pts:t.pts+l*o,dts:t.dts+l*o,sampleCount:s,audioobjecttype:1+(e[u+2]>>>6&3),channelcount:(1&e[u+2])<<2|(192&e[u+3])>>>6,samplerate:De[(60&e[u+2])>>>2],samplingfrequencyindex:(60&e[u+2])>>>2,samplesize:16,data:e.subarray(u+7+r,n)}),e.byteLength===n)return void(e=void 0);l++,e=e.subarray(n)}else u++},this.flush=function(){this.trigger("done")}}).prototype=new W;var Ie,Pe,xe,Me=Re,Ue=function(e){var t=e.byteLength,i=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var n=e.byteLength-t,a=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");a.set(e.subarray(n,n+s)),i=new DataView(a.buffer).getUint32(0),r=8*s,t-=s},this.skipBits=function(e){var n;r>e?(i<<=e,r-=e):(e-=r,e-=8*(n=Math.floor(e/8)),t-=n,this.loadWord(),i<<=e,r-=e)},this.readBits=function(e){var n=Math.min(r,e),a=i>>>32-n;return(r-=n)>0?i<<=n:t>0&&this.loadWord(),(n=e-n)>0?a<<n|this.readBits(n):a},this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e)if(0!=(i&2147483648>>>e))return i<<=e,r-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(Pe=function(){var e,t,i=0;Pe.prototype.init.call(this),this.push=function(r){var n;for(t?((n=new Uint8Array(t.byteLength+r.data.byteLength)).set(t),n.set(r.data,t.byteLength),t=n):t=r.data;i<t.byteLength-3;i++)if(1===t[i+2]){e=i+5;break}for(;e<t.byteLength;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}i+3!==e-2&&this.trigger("data",t.subarray(i+3,e-2));do{e++}while(1!==t[e]&&e<t.length);i=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(i+3,e-2)),i=e-2,e+=3;break;default:e+=3}t=t.subarray(i),e-=i,i=0},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(i+3)),t=null,i=0,this.trigger("done")}}).prototype=new W,xe={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(Ie=function(){var e,t,i,r,n,a,s,o=new Pe;Ie.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,i=e.pts,r=e.dts,o.push(e))},o.on("data",function(s){var o={trackId:t,pts:i,dts:r,data:s};switch(31&s[0]){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=n(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=n(s.subarray(1)),o.config=a(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),this.flush=function(){o.flush()},s=function(e,t){var i,r=8,n=8;for(i=0;i<e;i++)0!==n&&(n=(r+t.readExpGolomb()+256)%256),r=0===n?r:n},n=function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},a=function(e){var t,i,r,n,a,o,u,l,c,d,h,f,p,m=0,g=0,y=0,v=0,_=1;if(i=(t=new Ue(e)).readUnsignedByte(),n=t.readUnsignedByte(),r=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),xe[i]&&(3===(a=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==a?8:12,p=0;p<h;p++)t.readBoolean()&&s(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),u=t.readUnsignedExpGolomb(),p=0;p<u;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),l=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),0===(d=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}f&&(_=f[0]/f[1])}return{profileIdc:i,levelIdc:r,profileCompatibility:n,width:Math.ceil((16*(l+1)-2*m-2*g)*_),height:(2-d)*(c+1)*16-2*y-2*v}}}).prototype=new W;var Ne,Be={H264Stream:Ie,NalByteStream:Pe};(Ne=function(){var e=new Uint8Array,t=0;Ne.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.parseId3TagSize=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&e[t+5])>>4?i+20:i+10},this.parseAdtsSize=function(e,t){var i=(224&e[t+5])>>5,r=e[t+4]<<3;return 6144&e[t+3]|r|i},this.push=function(i){var r,n,a,s,o=0,u=0;for(e.length?(s=e.length,(e=new Uint8Array(i.byteLength+s)).set(e.subarray(0,s)),e.set(i,s)):e=i;e.length-u>=3;)if(e[u]!=="I".charCodeAt(0)||e[u+1]!=="D".charCodeAt(0)||e[u+2]!=="3".charCodeAt(0))if(!0&e[u]&&240==(240&e[u+1])){if(e.length-u<7)break;if((o=this.parseAdtsSize(e,u))>e.length)break;a={type:"audio",data:e.subarray(u,u+o),pts:t,dts:t},this.trigger("data",a),u+=o}else u++;else{if(e.length-u<10)break;if((o=this.parseId3TagSize(e,u))>e.length)break;n={type:"timed-metadata",data:e.subarray(u,u+o)},this.trigger("data",n),u+=o}r=e.length-u,e=r>0?e.subarray(u):new Uint8Array}}).prototype=new W;var Fe,je,Ge,Ve,He,ze,We,qe,Ke,Xe,Ye,$e,Qe=Ne,Je=[33,16,5,32,164,27],Ze=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],et=function(e){for(var t=[];e--;)t.push(0);return t},tt={96e3:[Je,[227,64],et(154),[56]],88200:[Je,[231],et(170),[56]],64e3:[Je,[248,192],et(240),[56]],48e3:[Je,[255,192],et(268),[55,148,128],et(54),[112]],44100:[Je,[255,192],et(268),[55,163,128],et(84),[112]],32e3:[Je,[255,192],et(268),[55,234],et(226),[112]],24e3:[Je,[255,192],et(268),[55,255,128],et(268),[111,112],et(126),[224]],16e3:[Je,[255,192],et(268),[55,255,128],et(268),[111,255],et(269),[223,108],et(195),[1,192]],12e3:[Ze,et(268),[3,127,248],et(268),[6,255,240],et(268),[13,255,224],et(268),[27,253,128],et(259),[56]],11025:[Ze,et(268),[3,127,248],et(268),[6,255,240],et(268),[13,255,224],et(268),[27,255,192],et(268),[55,175,128],et(108),[112]],8e3:[Ze,et(268),[3,121,16],et(47),[7]]},it=(Fe=tt,Object.keys(Fe).reduce(function(e,t){return e[t]=new Uint8Array(Fe[t].reduce(function(e,t){return e.concat(t)},[])),e},{})),rt=(je=function(e){return 9e4*e},Ge=function(e,t){return e*t},Ve=function(e){return e/9e4},He=function(e,t){return e/t},function(e,t){return je(He(e,t))}),nt=function(e,t){return Ge(Ve(e),t)},at=Be.H264Stream,st=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],ot=["width","height","profileIdc","levelIdc","profileCompatibility"];Xe=function(e){return e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)},Ye=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},$e=function(e){var t,i=0;for(t=0;t<e.length;t++)i+=e[t].data.byteLength;return i},(We=function(e,t){var i=[],r=0,n=0,a=0,s=1/0;t=t||{},We.prototype.init.call(this),this.push=function(t){ee(e,t),e&&st.forEach(function(i){e[i]=t[i]}),i.push(t)},this.setEarliestDts=function(t){n=t-e.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){a=e},this.flush=function(){var n,a,s,o;0!==i.length?(n=this.trimAdtsFramesByEarliestDts_(i),e.baseMediaDecodeTime=Z(e,t.keepOriginalTimestamps),this.prefixWithSilence_(e,n),e.samples=this.generateSampleTable_(n),s=G.mdat(this.concatenateFrameData_(n)),i=[],a=G.moof(r,[e]),o=new Uint8Array(a.byteLength+s.byteLength),r++,o.set(a),o.set(s,a.byteLength),J(e),this.trigger("data",{track:e,boxes:o}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.prefixWithSilence_=function(e,t){var i,r,n,o=0,u=0,l=0,c=0;if(t.length&&(i=rt(e.baseMediaDecodeTime,e.samplerate),o=Math.ceil(9e4/(e.samplerate/1024)),a&&s&&(u=i-Math.max(a,s),c=(l=Math.floor(u/o))*o),!(l<1||c>45e3))){for((r=it[e.samplerate])||(r=t[0].data),n=0;n<l;n++)t.splice(n,0,{data:r});e.baseMediaDecodeTime-=Math.floor(nt(c,e.samplerate))}},this.trimAdtsFramesByEarliestDts_=function(t){return e.minSegmentDts>=n?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=n&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},this.generateSampleTable_=function(e){var t,i,r=[];for(t=0;t<e.length;t++)i=e[t],r.push({size:i.data.byteLength,duration:1024});return r},this.concatenateFrameData_=function(e){var t,i,r=0,n=new Uint8Array($e(e));for(t=0;t<e.length;t++)i=e[t],n.set(i.data,r),r+=i.data.byteLength;return n}}).prototype=new W,(ze=function(e,t){var i,r,n=0,a=[],s=[];t=t||{},ze.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){ee(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],ot.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),a.push(t)},this.flush=function(){for(var i,r,o,u,l,c;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=K(a),(o=X(i))[0][0].keyFrame||((r=this.getGopForFusion_(a[0],e))?(o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=Y(o)),s.length){var d;if(!(d=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");J(e),o=d}ee(e,o),e.samples=$(o),l=G.mdat(Q(o)),e.baseMediaDecodeTime=Z(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),u=G.moof(n,[e]),c=new Uint8Array(u.byteLength+l.byteLength),n++,c.set(u),c.set(l,u.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){J(e),i=void 0,r=void 0},this.getGopForFusion_=function(t){var i,r,n,a,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)n=(a=this.gopCache_[s]).gop,e.pps&&Ye(e.pps[0],a.pps[0])&&e.sps&&Ye(e.sps[0],a.sps[0])&&(n.dts<e.timelineStartInfo.dts||(i=t.dts-n.dts-n.duration)>=-1e4&&i<=45e3&&(!r||o>i)&&(r=a,o=i));return r?r.gop:null},this.alignGopsAtStart_=function(e){var t,i,r,n,a,o,u,l;for(a=e.byteLength,o=e.nalCount,u=e.duration,t=i=0;t<s.length&&i<e.length&&(r=s[t],n=e[i],r.pts!==n.pts);)n.pts>r.pts?t++:(i++,a-=n.byteLength,o-=n.nalCount,u-=n.duration);return 0===i?e:i===e.length?null:((l=e.slice(i)).byteLength=a,l.duration=u,l.nalCount=o,l.pts=l[0].pts,l.dts=l[0].dts,l)},this.alignGopsAtEnd_=function(e){var t,i,r,n,a,o;for(t=s.length-1,i=e.length-1,a=null,o=!1;t>=0&&i>=0;){if(r=s[t],n=e[i],r.pts===n.pts){o=!0;break}r.pts>n.pts?t--:(t===s.length-1&&(a=i),i--)}if(!o&&null===a)return null;var u;if(0===(u=o?i:a))return e;var l=e.slice(u),c=l.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return l.byteLength=c.byteLength,l.duration=c.duration,l.nalCount=c.nalCount,l.pts=l[0].pts,l.dts=l[0].dts,l},this.alignGopsWith=function(e){s=e}}).prototype=new W,(Ke=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==e.remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Ke.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBoxes.push(e.boxes),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track),void("audio"===e.track.type&&(this.audioTrack=e.track)))}}).prototype=new W,Ke.prototype.flush=function(e){var t,i,r,n,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,ot.forEach(function(e){s.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,st.forEach(function(e){s.info[e]=this.audioTrack[e]},this)),1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,r=G.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(r.byteLength),s.initSegment.set(r),s.data=new Uint8Array(this.pendingBytes),n=0;n<this.pendingBoxes.length;n++)s.data.set(this.pendingBoxes[n],a),a+=this.pendingBoxes[n].byteLength;for(n=0;n<this.pendingCaptions.length;n++)(t=this.pendingCaptions[n]).startTime=t.startPts-o,t.startTime/=9e4,t.endTime=t.endPts-o,t.endTime/=9e4,s.captionStreams[t.stream]=!0,s.captions.push(t);for(n=0;n<this.pendingMetadata.length;n++)(i=this.pendingMetadata[n]).cueTime=i.pts-o,i.cueTime/=9e4,s.metadata.push(i);s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(qe=function(e){var t,i,r=this,n=!0;qe.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t,t.type="aac",t.metadataStream=new Oe.MetadataStream,t.aacStream=new Qe,t.audioTimestampRolloverStream=new Oe.TimestampRolloverStream("audio"),t.timedMetadataTimestampRolloverStream=new Oe.TimestampRolloverStream("timed-metadata"),t.adtsStream=new Me,t.coalesceStream=new Ke(e,t.metadataStream),t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)}),t.aacStream.on("data",function(n){"timed-metadata"!==n.type||t.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:r.baseMediaDecodeTime},codec:"adts",type:"audio"},t.coalesceStream.numberOfTracks++,t.audioSegmentStream=new We(i,e),t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream))}),t.coalesceStream.on("data",this.trigger.bind(this,"data")),t.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var n={};this.transmuxPipeline_=n,n.type="ts",n.metadataStream=new Oe.MetadataStream,n.packetStream=new Oe.TransportPacketStream,n.parseStream=new Oe.TransportParseStream,n.elementaryStream=new Oe.ElementaryStream,n.videoTimestampRolloverStream=new Oe.TimestampRolloverStream("video"),n.audioTimestampRolloverStream=new Oe.TimestampRolloverStream("audio"),n.timedMetadataTimestampRolloverStream=new Oe.TimestampRolloverStream("timed-metadata"),n.adtsStream=new Me,n.h264Stream=new at,n.captionStream=new Oe.CaptionStream,n.coalesceStream=new Ke(e,n.metadataStream),n.headOfPipeline=n.packetStream,n.packetStream.pipe(n.parseStream).pipe(n.elementaryStream),n.elementaryStream.pipe(n.videoTimestampRolloverStream).pipe(n.h264Stream),n.elementaryStream.pipe(n.audioTimestampRolloverStream).pipe(n.adtsStream),n.elementaryStream.pipe(n.timedMetadataTimestampRolloverStream).pipe(n.metadataStream).pipe(n.coalesceStream),n.h264Stream.pipe(n.captionStream).pipe(n.coalesceStream),n.elementaryStream.on("data",function(a){var s;if("metadata"===a.type){for(s=a.tracks.length;s--;)t||"video"!==a.tracks[s].type?i||"audio"!==a.tracks[s].type||((i=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime):(t=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime;t&&!n.videoSegmentStream&&(n.coalesceStream.numberOfTracks++,n.videoSegmentStream=new ze(t,e),n.videoSegmentStream.on("timelineStartInfo",function(e){i&&(i.timelineStartInfo=e,n.audioSegmentStream.setEarliestDts(e.dts))}),n.videoSegmentStream.on("processedGopsInfo",r.trigger.bind(r,"gopInfo")),n.videoSegmentStream.on("baseMediaDecodeTime",function(e){i&&n.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),n.h264Stream.pipe(n.videoSegmentStream).pipe(n.coalesceStream)),i&&!n.audioSegmentStream&&(n.coalesceStream.numberOfTracks++,n.audioSegmentStream=new We(i,e),n.adtsStream.pipe(n.audioSegmentStream).pipe(n.coalesceStream))}}),n.coalesceStream.on("data",this.trigger.bind(this,"data")),n.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(e){var r=this.transmuxPipeline_;this.baseMediaDecodeTime=e,i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,J(i),i.timelineStartInfo.baseMediaDecodeTime=e,r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[],r.videoTimestampRolloverStream.discontinuity()),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,J(t),r.captionStream.reset(),t.timelineStartInfo.baseMediaDecodeTime=e),r.timedMetadataTimestampRolloverStream&&r.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(e){if(n){var t=Xe(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),n=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){n=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new W;var ut,lt,ct={Transmuxer:qe,VideoSegmentStream:ze,AudioSegmentStream:We,AUDIO_PROPERTIES:st,VIDEO_PROPERTIES:ot},dt=H.parseType,ht=function(e){return new Date(1e3*e-20828448e5)},ft=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},pt={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:ut(e.subarray(78,e.byteLength))}},avcC:function(e){var t,i,r,n,a=new DataView(e.buffer,e.byteOffset,e.byteLength),s={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},o=31&e[5];for(r=6,n=0;n<o;n++)i=a.getUint16(r),r+=2,s.sps.push(new Uint8Array(e.subarray(r,r+i))),r+=i;for(t=e[r],r++,n=0;n<t;n++)i=a.getUint16(r),r+=2,s.pps.push(new Uint8Array(e.subarray(r,r+i))),r+=i;return s},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={majorBrand:dt(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},r=8;r<e.byteLength;)i.compatibleBrands.push(dt(e.subarray(r,r+4))),r+=4;return i},dinf:function(e){return{boxes:ut(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:ut(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:dt(e.subarray(8,12)),name:""},i=8;for(i=24;i<e.byteLength;i++){if(0===e[i]){i++;break}t.name+=String.fromCharCode(e[i])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:function(e){var t,i,r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=[];for(t=0;t+4<e.length;t+=i)if(i=r.getUint32(t),t+=4,i<=0)n.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:n.push("slice_layer_without_partitioning_rbsp");break;case 5:n.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:n.push("sei_rbsp");break;case 7:n.push("seq_parameter_set_rbsp");break;case 8:n.push("pic_parameter_set_rbsp");break;case 9:n.push("access_unit_delimiter_rbsp");break;default:n.push("UNKNOWN NAL - "+e[t]&31)}return n}(e)}},mdhd:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=4,n={version:i.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===n.version?(r+=4,n.creationTime=ht(i.getUint32(r)),r+=8,n.modificationTime=ht(i.getUint32(r)),r+=4,n.timescale=i.getUint32(r),r+=8,n.duration=i.getUint32(r)):(n.creationTime=ht(i.getUint32(r)),r+=4,n.modificationTime=ht(i.getUint32(r)),r+=4,n.timescale=i.getUint32(r),r+=4,n.duration=i.getUint32(r)),r+=4,t=i.getUint16(r),n.language+=String.fromCharCode(96+(t>>10)),n.language+=String.fromCharCode(96+((992&t)>>5)),n.language+=String.fromCharCode(96+(31&t)),n},mdia:function(e){return{boxes:ut(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:ut(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(i.streamDescriptor=ut(e.subarray(28))[0]),i},moof:function(e){return{boxes:ut(e)}},moov:function(e){return{boxes:ut(e)}},mvex:function(e){return{boxes:ut(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===r.version?(i+=4,r.creationTime=ht(t.getUint32(i)),i+=8,r.modificationTime=ht(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=8,r.duration=t.getUint32(i)):(r.creationTime=ht(t.getUint32(i)),i+=4,r.modificationTime=ht(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=4,r.duration=t.getUint32(i)),i+=4,r.rate=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,i+=8,r.matrix=new Uint32Array(e.subarray(i,i+36)),i+=36,i+=24,r.nextTrackId=t.getUint32(i),r},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)i.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return i},sidx:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},n=i.getUint16(22);for(t=24;n;t+=12,n--)r.references.push({referenceType:(128&e[t])>>>7,referencedSize:2147483647&i.getUint32(t),subsegmentDuration:i.getUint32(t+4),startsWithSap:!!(128&e[t+8]),sapType:(112&e[t+8])>>>4,sapDeltaTime:268435455&i.getUint32(t+8)});return r},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:ut(e)}},stco:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},n=i.getUint32(4);for(t=8;n;t+=4,n--)r.chunkOffsets.push(i.getUint32(t));return r},stsc:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=i.getUint32(4),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;r;t+=12,r--)n.sampleToChunks.push({firstChunk:i.getUint32(t),samplesPerChunk:i.getUint32(t+4),sampleDescriptionIndex:i.getUint32(t+8)});return n},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:ut(e.subarray(8))}},stsz:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)r.entries.push(i.getUint32(t));return r},stts:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},n=i.getUint32(4);for(t=8;n;t+=8,n--)r.timeToSamples.push({sampleCount:i.getUint32(t),sampleDelta:i.getUint32(t+4)});return r},styp:function(e){return pt.ftyp(e)},tfdt:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:e[4]<<24|e[5]<<16|e[6]<<8|e[7]};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),t},tfhd:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:i.getUint32(4)},n=1&r.flags[2],a=2&r.flags[2],s=8&r.flags[2],o=16&r.flags[2],u=32&r.flags[2],l=65536&r.flags[0],c=131072&r.flags[0];return t=8,n&&(t+=4,r.baseDataOffset=i.getUint32(12),t+=4),a&&(r.sampleDescriptionIndex=i.getUint32(t),t+=4),s&&(r.defaultSampleDuration=i.getUint32(t),t+=4),o&&(r.defaultSampleSize=i.getUint32(t),t+=4),u&&(r.defaultSampleFlags=i.getUint32(t)),l&&(r.durationIsEmpty=!0),!n&&c&&(r.baseDataOffsetIsMoof=!0),r},tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===r.version?(i+=4,r.creationTime=ht(t.getUint32(i)),i+=8,r.modificationTime=ht(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=8,r.duration=t.getUint32(i)):(r.creationTime=ht(t.getUint32(i)),i+=4,r.modificationTime=ht(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=4,r.duration=t.getUint32(i)),i+=4,i+=8,r.layer=t.getUint16(i),i+=2,r.alternateGroup=t.getUint16(i),i+=2,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,r.matrix=new Uint32Array(e.subarray(i,i+36)),i+=36,r.width=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.height=t.getUint16(i)+t.getUint16(i+2)/16,r},traf:function(e){return{boxes:ut(e)}},trak:function(e){return{boxes:ut(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],u=4&i.flags[1],l=8&i.flags[1],c=r.getUint32(4),d=8;for(n&&(i.dataOffset=r.getInt32(d),d+=4),a&&c&&(t={flags:ft(e.subarray(d,d+4))},d+=4,s&&(t.duration=r.getUint32(d),d+=4),o&&(t.size=r.getUint32(d),d+=4),l&&(t.compositionTimeOffset=r.getUint32(d),d+=4),i.samples.push(t),c--);c--;)t={},s&&(t.duration=r.getUint32(d),d+=4),o&&(t.size=r.getUint32(d),d+=4),u&&(t.flags=ft(e.subarray(d,d+4)),d+=4),l&&(t.compositionTimeOffset=r.getUint32(d),d+=4),i.samples.push(t);return i},"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}},mt={inspect:ut=function(e){for(var t,i,r,n,a,s=0,o=[],u=new ArrayBuffer(e.length),l=new Uint8Array(u),c=0;c<e.length;++c)l[c]=e[c];for(t=new DataView(u);s<e.byteLength;)i=t.getUint32(s),r=dt(e.subarray(s+4,s+8)),n=i>1?s+i:e.byteLength,(a=(pt[r]||function(e){return{data:e}})(e.subarray(s+8,n))).size=i,a.type=r,o.push(a),s=n;return o},textify:lt=function(e,t){var i;return t=t||0,i=new Array(2*t+1).join(" "),e.map(function(e,r){return i+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var r=i+"  "+t+": ",n=e[t];if(n instanceof Uint8Array||n instanceof Uint32Array){var a=Array.prototype.slice.call(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return a?1===a.length?r+"<"+a.join("").slice(1)+">":r+"<\n"+a.map(function(e){return i+"  "+e}).join("\n")+"\n"+i+"  >":r+"<>"}return r+JSON.stringify(n,null,2).split("\n").map(function(e,t){return 0===t?e:i+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+lt(e.boxes,t+1):"")}).join("\n")},parseTfdt:pt.tfdt,parseHdlr:pt.hdlr,parseTfhd:pt.tfhd,parseTrun:pt.trun},gt=ne,yt=he.CaptionStream,vt=function(e,t){for(var i=e,r=0;r<t.length;r++){var n=t[r];if(i<n.size)return n;i-=n.size}return null},_t=function(e,t){var i=H.findBox(e,["moof","traf"]),r={},n=[];return H.findBox(e,["mdat"]).forEach(function(e,t){var r=i[t];n.push({mdat:e,traf:r})}),n.forEach(function(e){var i,n=e.mdat,a=e.traf,s=H.findBox(a,["tfhd"]),o=mt.parseTfhd(s[0]),u=o.trackId,l=H.findBox(a,["tfdt"]),c=l.length>0?mt.parseTfdt(l[0]).baseMediaDecodeTime:0,d=H.findBox(a,["trun"]);t===u&&d.length>0&&(i=function(e,t,i){var r,n,a,s,o=new DataView(e.buffer,e.byteOffset,e.byteLength),u=[];for(n=0;n+4<e.length;n+=a)if(a=o.getUint32(n),n+=4,!(a<=0))switch(31&e[n]){case 6:var l=e.subarray(n+1,n+1+a),c=vt(n,t);r={nalUnitType:"sei_rbsp",size:a,data:l,escapedRBSP:gt(l),trackId:i},c?(r.pts=c.pts,r.dts=c.dts,s=c):(r.pts=s.pts,r.dts=s.dts),u.push(r)}return u}(n,function(e,t,i){var r=t,n=i.defaultSampleDuration||0,a=i.defaultSampleSize||0,s=i.trackId,o=[];return e.forEach(function(e){var t=mt.parseTrun(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=n),void 0===e.size&&(e.size=a),e.trackId=s,e.dts=r,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=r+e.compositionTimeOffset,r+=e.duration}),o=o.concat(t)}),o}(d,c,o),u),r[u]||(r[u]=[]),r[u]=r[u].concat(i))}),r},bt={generator:G,probe:H,Transmuxer:ct.Transmuxer,AudioSegmentStream:ct.AudioSegmentStream,VideoSegmentStream:ct.VideoSegmentStream,CaptionParser:function(){var e,t,i,r,n,a=!1;this.isInitialized=function(){return a},this.init=function(){e=new yt,a=!0,e.on("data",function(e){e.startTime=e.startPts/r,e.endTime=e.endPts/r,n.captions.push(e),n.captionStreams[e.stream]=!0})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"===(void 0===t?"undefined":g(t))&&0===Object.keys(t).length||i===e[0]&&r===t[i])},this.parse=function(e,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],r=s[i];else if(!i||!r)return t.push(e),null;for(;t.length>0;){var u=t.shift();this.parse(u,a,s)}c=r;var l,c;return null!==(o=(l=i)?{seiNals:_t(e,l)[l],timescale:c}:null)&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),n):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;e.flush()},this.clearParsedCaptions=function(){n.captions=[],n.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],i=null,r=null,n?this.clearParsedCaptions():n={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}},Tt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},St=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Et=function(){function e(t,i){Tt(this,e),this.options=i||{},this.self=t,this.init()}return St(e,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new bt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",function(t){var i=t.initSegment;t.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};var r=t.data;t.data=r.buffer,e.postMessage({action:"data",segment:t,byteOffset:r.byteOffset,byteLength:r.byteLength},[t.data])}),t.captionStream&&t.captionStream.on("data",function(t){e.postMessage({action:"caption",data:t})}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})});var e,t}},{key:"push",value:function(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(e){var t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4*t))}},{key:"setAudioAppendStart",value:function(e){this.transmuxer.setAudioAppendStart(Math.ceil(9e4*e.appendStart))}},{key:"flush",value:function(e){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}]),e}();new function(e){e.onmessage=function(t){"init"===t.data.action&&t.data.options?this.messageHandlers=new Et(e,t.data.options):(this.messageHandlers||(this.messageHandlers=new Et(e)),t.data&&t.data.action&&"init"!==t.data.action&&this.messageHandlers[t.data.action]&&this.messageHandlers[t.data.action](t.data))}}(i)}()}),Zd={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},eh=function(e){return e.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(i).toString(16)).slice(-2)})})},th=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={codecCount:0},i=void 0;return t.codecCount=e.split(",").length,t.codecCount=t.codecCount||2,(i=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(e))&&(t.videoCodec=i[2],t.videoObjectTypeIndicator=i[3]),t.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(e),t.audioProfile=t.audioProfile&&t.audioProfile[2],t},ih=function(e,t,i){return e+"/"+t+'; codecs="'+i.filter(function(e){return!!e}).join(", ")+'"'},rh=function(e,t){var i,r=(i=t,i.segments&&i.segments.length&&i.segments[0].map?"mp4":"mp2t"),n=function(e){var t=e.attributes||{};return t.CODECS?th(t.CODECS):Zd}(t),a=t.attributes||{},s=!0,o=!1;if(!t)return[];if(e.mediaGroups.AUDIO&&a.AUDIO){var u=e.mediaGroups.AUDIO[a.AUDIO];if(u){o=!0,s=!1;for(var l in u)if(!u[l].uri&&!u[l].playlists){s=!0;break}}}o&&!n.audioProfile&&(s||(n.audioProfile=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var i=e.mediaGroups.AUDIO[t];if(!i)return null;for(var r in i){var n=i[r];if(n.default&&n.playlists)return th(n.playlists[0].attributes.CODECS).audioProfile}return null}(e,a.AUDIO)),n.audioProfile||(Ea.log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),n.audioProfile=Zd.audioProfile));var c={};n.videoCodec&&(c.video=""+n.videoCodec+n.videoObjectTypeIndicator),n.audioProfile&&(c.audio="mp4a.40."+n.audioProfile);var d=ih("audio",r,[c.audio]),h=ih("video",r,[c.video]),f=ih("video",r,[c.video,c.audio]);return o?!s&&c.video?[h,d]:s||c.video?[f,d]:[d,d]:c.video?[f]:[d]},nh=function(e){return/mp4a\.\d+.\d+/i.test(e)},ah=function(e){return/avc1\.[\da-f]+/i.test(e)},sh=function(e,t,i){var r=null,n=null,a=0,s=[],o=[];if(!e&&!t)return Ea.createTimeRange();if(!e)return t.buffered;if(!t)return e.buffered;if(i)return e.buffered;if(0===e.buffered.length&&0===t.buffered.length)return Ea.createTimeRange();for(var u=e.buffered,l=t.buffered,c=u.length;c--;)s.push({time:u.start(c),type:"start"}),s.push({time:u.end(c),type:"end"});for(c=l.length;c--;)s.push({time:l.start(c),type:"start"}),s.push({time:l.end(c),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),c=0;c<s.length;c++)"start"===s[c].type?2===++a&&(r=s[c].time):"end"===s[c].type&&1===--a&&(n=s[c].time),null!==r&&null!==n&&(o.push([r,n]),r=null,n=null);return Ea.createTimeRanges(o)},oh=function(e){$c(t,e);function t(e,i){Xc(this,t);var r=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Ea.EventTarget));r.timestampOffset_=0,r.pendingBuffers_=[],r.bufferUpdating_=!1,r.mediaSource_=e,r.codecs_=i,r.audioCodec_=null,r.videoCodec_=null,r.audioDisabled_=!1,r.appendAudioInitSegment_=!0,r.gopBuffer_=[],r.timeMapping_=0,r.safeAppend_=Ea.browser.IE_VERSION>=11;var n={remux:!1,alignGopsAtEnd:r.safeAppend_};return r.codecs_.forEach(function(e){nh(e)?r.audioCodec_=e:ah(e)&&(r.videoCodec_=e)}),r.transmuxer_=new Jd,r.transmuxer_.postMessage({action:"init",options:n}),r.transmuxer_.onmessage=function(e){return"data"===e.data.action?r.data_(e):"done"===e.data.action?r.done_(e):"gopInfo"===e.data.action?r.appendGopInfo_(e):void 0},Object.defineProperty(r,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(e){"number"==typeof e&&e>=0&&(this.timestampOffset_=e,this.appendAudioInitSegment_=!0,this.gopBuffer_.length=0,this.timeMapping_=0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e}))}}),Object.defineProperty(r,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(e){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=e),this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=e)}}),Object.defineProperty(r,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}}),Object.defineProperty(r,"buffered",{get:function(){return sh(this.videoBuffer_,this.audioBuffer_,this.audioDisabled_)}}),r}return Yc(t,[{key:"data_",value:function(e){var t=e.data.segment;t.data=new Uint8Array(t.data,e.data.byteOffset,e.data.byteLength),t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength),function(e,t,i){var r=t.player_;if(i.captions&&i.captions.length){e.inbandTextTracks_||(e.inbandTextTracks_={});for(var n in i.captionStreams)if(!e.inbandTextTracks_[n]){r.tech_.trigger({type:"usage",name:"hls-608"});var a=r.textTracks().getTrackById(n);e.inbandTextTracks_[n]=a||r.addRemoteTextTrack({kind:"captions",id:n,label:n},!1).track}}i.metadata&&i.metadata.length&&!e.metadataTrack_&&(e.metadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=i.metadata.dispatchType)}(this,this.mediaSource_,t),this.pendingBuffers_.push(t)}},{key:"done_",value:function(e){"closed"!==this.mediaSource_.readyState?this.processPendingSegments_():this.pendingBuffers_.length=0}},{key:"createRealSourceBuffers_",value:function(){var e=this,t=["audio","video"];t.forEach(function(i){if(e[i+"Codec_"]&&!e[i+"Buffer_"]){var r=null;if(e.mediaSource_[i+"Buffer_"])(r=e.mediaSource_[i+"Buffer_"]).updating=!1;else{var n=i+'/mp4;codecs="'+e[i+"Codec_"]+'"';r=function(e,t){var i=e.addSourceBuffer(t),r=Object.create(null);r.updating=!1,r.realBuffer_=i;var n=function(e){"function"==typeof i[e]?r[e]=function(){return i[e].apply(i,arguments)}:void 0===r[e]&&Object.defineProperty(r,e,{get:function(){return i[e]},set:function(t){return i[e]=t}})};for(var a in i)n(a);return r}(e.mediaSource_.nativeMediaSource_,n),e.mediaSource_[i+"Buffer_"]=r}e[i+"Buffer_"]=r,["update","updatestart","updateend"].forEach(function(n){r.addEventListener(n,function(){if("audio"!==i||!e.audioDisabled_){"updateend"===n&&(e[i+"Buffer_"].updating=!1);return t.every(function(t){return!("audio"!==t||!e.audioDisabled_)||(i===t||!e[t+"Buffer_"]||!e[t+"Buffer_"].updating)})?e.trigger(n):void 0}})})}})}},{key:"appendBuffer",value:function(e){if(this.bufferUpdating_=!0,this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.videoBuffer_&&this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:function(e,t,i){if(void 0===t||null===t||!e.length)return[];var r=Math.ceil(9e4*(t-i+3)),n=void 0;for(n=0;n<e.length&&!(e[n].pts>r);n++);return e.slice(n)}(this.gopBuffer_,this.mediaSource_.player_?this.mediaSource_.player_.currentTime():null,this.timeMapping_)}),this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]),this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(e){this.gopBuffer_=function(e,t,i){if(!t.length)return e;if(i)return t.slice();for(var r=t[0].pts,n=0;n<e.length&&!(e[n].pts>=r);n++);return e.slice(0,n).concat(t)}(this.gopBuffer_,e.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(e,t){if(this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(e,t),this.gopBuffer_=function(e,t,i,r){for(var n=Math.ceil(9e4*(t-r)),a=Math.ceil(9e4*(i-r)),s=e.slice(),o=e.length;o--&&!(e[o].pts<=a););if(-1===o)return s;for(var u=o+1;u--&&!(e[u].pts<=n););return u=Math.max(u,0),s.splice(u,o-u+1),s}(this.gopBuffer_,e,t,this.timeMapping_)),!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(e,t)),Bd(e,t,this.metadataTrack_),this.inbandTextTracks_)for(var i in this.inbandTextTracks_)Bd(e,t,this.inbandTextTracks_[i])}},{key:"processPendingSegments_",value:function(){var e={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};e=this.pendingBuffers_.reduce(function(e,t){var i=t.type,r=t.data,n=t.initSegment;return e[i].segments.push(r),e[i].bytes+=r.byteLength,e[i].initSegment=n,t.captions&&(e.captions=e.captions.concat(t.captions)),t.info&&(e[i].info=t.info),t.metadata&&(e.metadata=e.metadata.concat(t.metadata)),e},e),this.videoBuffer_||this.audioBuffer_||(0===e.video.bytes&&(this.videoCodec_=null),0===e.audio.bytes&&(this.audioCodec_=null),this.createRealSourceBuffers_()),e.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:e.audio.info}),e.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:e.video.info}),this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(e.audio.segments.unshift(e.audio.initSegment),e.audio.bytes+=e.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);var t=!1;this.videoBuffer_&&e.video.bytes?(e.video.segments.unshift(e.video.initSegment),e.video.bytes+=e.video.initSegment.byteLength,this.concatAndAppendSegments_(e.video,this.videoBuffer_),jd(this,e.captions,e.metadata)):!this.videoBuffer_||!this.audioDisabled_&&this.audioBuffer_||(t=!0),!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(e.audio,this.audioBuffer_),this.pendingBuffers_.length=0,t&&this.trigger("updateend"),this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(e,t){var i=0,r=void 0;if(e.bytes){r=new Uint8Array(e.bytes),e.segments.forEach(function(e){r.set(e,i),i+=e.byteLength});try{t.updating=!0,t.appendBuffer(r)}catch(e){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:e.message,originalError:e})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort(),!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"}),this.pendingBuffers_.length=0,this.bufferUpdating_=!1}}]),t}(Ea.EventTarget),uh=function(e){$c(t,e);function t(){Xc(this,t);var e=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=void 0;e.nativeMediaSource_=new n.MediaSource;for(i in e.nativeMediaSource_)i in t.prototype||"function"!=typeof e.nativeMediaSource_[i]||(e[i]=e.nativeMediaSource_[i].bind(e.nativeMediaSource_));return e.duration_=NaN,Object.defineProperty(e,"duration",{get:function(){return this.duration_===1/0?this.duration_:this.nativeMediaSource_.duration},set:function(e){this.duration_=e,e===1/0||(this.nativeMediaSource_.duration=e)}}),Object.defineProperty(e,"seekable",{get:function(){return this.duration_===1/0?Ea.createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}}),Object.defineProperty(e,"readyState",{get:function(){return this.nativeMediaSource_.readyState}}),Object.defineProperty(e,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}}),e.sourceBuffers=[],e.activeSourceBuffers_=[],e.updateActiveSourceBuffers_=function(){if(e.activeSourceBuffers_.length=0,1===e.sourceBuffers.length){var t=e.sourceBuffers[0];return t.appendAudioInitSegment_=!0,t.audioDisabled_=!t.audioCodec_,void e.activeSourceBuffers_.push(t)}for(var i=!1,r=!0,n=0;n<e.player_.audioTracks().length;n++){var a=e.player_.audioTracks()[n];if(a.enabled&&"main"!==a.kind){i=!0,r=!1;break}}e.sourceBuffers.forEach(function(t,n){if(t.appendAudioInitSegment_=!0,t.videoCodec_&&t.audioCodec_)t.audioDisabled_=i;else if(t.videoCodec_&&!t.audioCodec_)t.audioDisabled_=!0,r=!1;else if(!t.videoCodec_&&t.audioCodec_&&(t.audioDisabled_=n?r:!r,t.audioDisabled_))return;e.activeSourceBuffers_.push(t)})},e.onPlayerMediachange_=function(){e.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=!0})},e.onHlsReset_=function(){e.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.postMessage({action:"resetCaptions"})})},e.onHlsSegmentTimeMapping_=function(t){e.sourceBuffers.forEach(function(e){return e.timeMapping_=t.mapping})},["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},e),e.on("sourceopen",function(t){var i=l.querySelector('[src="'+e.url_+'"]');i&&(e.player_=Ea(i.parentNode),e.player_.tech_.on("hls-reset",e.onHlsReset_),e.player_.tech_.on("hls-segment-time-mapping",e.onHlsSegmentTimeMapping_),e.player_.audioTracks&&e.player_.audioTracks()&&(e.player_.audioTracks().on("change",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("addtrack",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("removetrack",e.updateActiveSourceBuffers_)),e.player_.on("mediachange",e.onPlayerMediachange_))}),e.on("sourceended",function(t){for(var i=Fd(e.duration),r=0;r<e.sourceBuffers.length;r++){var n=e.sourceBuffers[r],a=n.metadataTrack_&&n.metadataTrack_.cues;a&&a.length&&(a[a.length-1].endTime=i)}}),e.on("sourceclose",function(e){this.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.terminate()}),this.sourceBuffers.length=0,this.player_&&(this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&(this.player_.off("mediachange",this.onPlayerMediachange_),this.player_.tech_.off("hls-reset",this.onHlsReset_),this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)))}),e}return Yc(t,[{key:"addSeekableRange_",value:function(e,t){var i=void 0;if(this.duration!==1/0)throw(i=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity")).name="InvalidStateError",i.code=11,i;(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))&&(this.nativeMediaSource_.duration=t)}},{key:"addSourceBuffer",value:function(e){var t=void 0,i=function(e){var t={type:"",parameters:{}},i=e.trim().split(";");return t.type=i.shift().trim(),i.forEach(function(e){var i=e.trim().split("=");if(i.length>1){var r=i[0].replace(/"/g,"").trim(),n=i[1].replace(/"/g,"").trim();t.parameters[r]=n}}),t}(e);if(/^(video|audio)\/mp2t$/i.test(i.type)){var r=[];i.parameters&&i.parameters.codecs&&(r=i.parameters.codecs.split(","),r=(r=eh(r)).filter(function(e){return nh(e)||ah(e)})),0===r.length&&(r=["avc1.4d400d","mp4a.40.2"]),t=new oh(this,r),0!==this.sourceBuffers.length&&(this.sourceBuffers[0].createRealSourceBuffers_(),t.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)}else t=this.nativeMediaSource_.addSourceBuffer(e);return this.sourceBuffers.push(t),t}}]),t}(Ea.EventTarget),lh=0;Ea.mediaSources={};var ch=function(e,t){var i=Ea.mediaSources[e];if(!i)throw new Error("Media Source not found (Video.js)");i.trigger({type:"sourceopen",swfId:t})},dh=function(){return!!n.MediaSource&&!!n.MediaSource.isTypeSupported&&n.MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')},hh=function(){if(this.MediaSource={open:ch,supportsNativeMediaSources:dh},dh())return new uh;throw new Error("Cannot use create a virtual MediaSource for this video")};hh.open=ch,hh.supportsNativeMediaSources=dh;var fh={createObjectURL:function(e){var t=void 0;return e instanceof uh?(t=n.URL.createObjectURL(e.nativeMediaSource_),e.url_=t,t):e instanceof uh?(t="blob:vjs-media-source/"+lh,lh++,Ea.mediaSources[t]=e,t):(t=n.URL.createObjectURL(e),e.url_=t,t)}};Ea.MediaSource=hh,Ea.URL=fh;var ph=Ea.EventTarget,mh=Ea.mergeOptions,gh=function(e,t){for(var i=mh(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod}),r=0;r<t.playlists.length;r++){var n=rd(i,t.playlists[r]);n&&(i=n)}return id(t,function(e,t,r,n){if(e.playlists&&e.playlists.length){var a=e.playlists[0].uri,s=rd(i,e.playlists[0]);s&&((i=s).mediaGroups[t][r][n].playlists[0]=i.playlists[a])}}),i},yh=function(e){$c(t,ph);function t(e,i,r,a){Xc(this,t);var s=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(s.hls_=i,s.withCredentials=r,!e)throw new Error("A non-empty playlist URL or playlist is required");return s.on("minimumUpdatePeriod",function(){s.refreshXml_()}),s.on("mediaupdatetimeout",function(){s.refreshMedia_()}),"string"==typeof e?(s.srcUrl=e,s.state="HAVE_NOTHING",Qc(s)):(s.masterPlaylistLoader_=a,s.state="HAVE_METADATA",s.started=!0,s.media(e),n.setTimeout(function(){s.trigger("loadedmetadata")},0),s)}return Yc(t,[{key:"dispose",value:function(){this.stopRequest(),n.clearTimeout(this.mediaUpdateTimeout)}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"media",value:function(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var t=this.state;if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}var i=!this.media_||e.uri!==this.media_.uri;this.state="HAVE_METADATA",i&&(this.media_&&this.trigger("mediachanging"),this.media_=e,this.refreshMedia_(),"HAVE_MASTER"!==t&&this.trigger("mediachange"))}},{key:"pause",value:function(){this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1)}},{key:"load",value:function(){this.started?this.trigger("loadedplaylist"):this.start()}},{key:"parseMasterXml",value:function(){var e=io(this.masterXml_,{manifestUri:this.srcUrl,clientOffset:this.clientOffset_});e.uri=this.srcUrl;for(var t=0;t<e.playlists.length;t++){var i="placeholder-uri-"+t;e.playlists[t].uri=i,e.playlists[i]=e.playlists[t]}return id(e,function(t,i,r,n){if(t.playlists&&t.playlists.length){var a="placeholder-uri-"+i+"-"+r+"-"+n;t.playlists[0].uri=a,e.playlists[a]=t.playlists[0]}}),nd(e),ad(e),e}},{key:"start",value:function(){var e=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,i){if(e.request){if(e.request=null,t)return e.error={status:i.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:i.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.masterXml_=i.responseText,i.responseHeaders&&i.responseHeaders.date?e.masterLoaded_=Date.parse(i.responseHeaders.date):e.masterLoaded_=Date.now(),e.syncClientServerClock_(e.onClientServerClockSync_.bind(e))}})}},{key:"syncClientServerClock_",value:function(e){var t=this,i=ro(this.masterXml_);return null===i?(this.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===i.method?(this.clientOffset_=i.value-Date.now(),e()):void(this.request=this.hls_.xhr({uri:Kc(this.srcUrl,i.value),method:i.method,withCredentials:this.withCredentials},function(r,n){if(t.request){if(r)return t.clientOffset_=t.masterLoaded_-Date.now(),e();var a=void 0;a="HEAD"===i.method?n.responseHeaders&&n.responseHeaders.date?Date.parse(n.responseHeaders.date):t.masterLoaded_:Date.parse(n.responseText),t.clientOffset_=a-Date.now(),e()}}))}},{key:"onClientServerClockSync_",value:function(){var e=this;this.master=this.parseMasterXml(),this.state="HAVE_MASTER",this.trigger("loadedplaylist"),this.media_||this.media(this.master.playlists[0]),n.setTimeout(function(){e.trigger("loadedmetadata")},0),this.master.minimumUpdatePeriod&&n.setTimeout(function(){e.trigger("minimumUpdatePeriod")},this.master.minimumUpdatePeriod)}},{key:"refreshXml_",value:function(){var e=this;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,i){if(e.request){if(e.request=null,t)return e.error={status:i.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:i.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.masterXml_=i.responseText;var r=e.parseMasterXml();e.master=gh(e.master,r),n.setTimeout(function(){e.trigger("minimumUpdatePeriod")},e.master.minimumUpdatePeriod)}})}},{key:"refreshMedia_",value:function(){var e=this,t=void 0,i=void 0;this.masterPlaylistLoader_?(t=this.masterPlaylistLoader_.master,i=this.masterPlaylistLoader_.parseMasterXml()):(t=this.master,i=this.parseMasterXml());var r=gh(t,i);r?(this.masterPlaylistLoader_?this.masterPlaylistLoader_.master=r:this.master=r,this.media_=r.playlists[this.media_.uri]):this.trigger("playlistunchanged"),this.media().endList||(this.mediaUpdateTimeout=n.setTimeout(function(){e.trigger("mediaupdatetimeout")},sd(this.media(),!!r))),this.trigger("loadedplaylist")}}]),t}(),vh=function(e){return Ea.log.debug?Ea.log.debug.bind(Ea,"VHS:",e+" >"):function(){}};function _h(){}var bh=function(){function e(t,i,r,n){Xc(this,e),this.callbacks_=[],this.pendingCallback_=null,this.timestampOffset_=0,this.mediaSource=t,this.processedAppend_=!1,this.type_=r,this.mimeType_=i,this.logger_=vh("SourceUpdater["+r+"]["+i+"]"),"closed"===t.readyState?t.addEventListener("sourceopen",this.createSourceBuffer_.bind(this,i,n)):this.createSourceBuffer_(i,n)}return Yc(e,[{key:"createSourceBuffer_",value:function(e,t){var i=this;this.sourceBuffer_=this.mediaSource.addSourceBuffer(e),this.logger_("created SourceBuffer"),t&&(t.trigger("sourcebufferadded"),this.mediaSource.sourceBuffers.length<2)?t.on("sourcebufferadded",function(){i.start_()}):this.start_()}},{key:"start_",value:function(){var e=this;this.started_=!0,this.onUpdateendCallback_=function(){var t=e.pendingCallback_;e.pendingCallback_=null,e.logger_("buffered ["+Ud(e.buffered())+"]"),t&&t(),e.runCallback_()},this.sourceBuffer_.addEventListener("updateend",this.onUpdateendCallback_),this.runCallback_()}},{key:"abort",value:function(e){var t=this;this.processedAppend_&&this.queueCallback_(function(){t.sourceBuffer_.abort()},e)}},{key:"appendBuffer",value:function(e,t){var i=this;this.processedAppend_=!0,this.queueCallback_(function(){i.sourceBuffer_.appendBuffer(e)},t)}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:Ea.createTimeRanges()}},{key:"remove",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_h;this.processedAppend_&&this.queueCallback_(function(){i.logger_("remove ["+e+" => "+t+"]"),i.sourceBuffer_.remove(e,t)},r)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||this.pendingCallback_}},{key:"timestampOffset",value:function(e){var t=this;return void 0!==e&&(this.queueCallback_(function(){t.sourceBuffer_.timestampOffset=e}),this.timestampOffset_=e),this.timestampOffset_}},{key:"queueCallback_",value:function(e,t){this.callbacks_.push([e.bind(this),t]),this.runCallback_()}},{key:"runCallback_",value:function(){var e=void 0;!this.updating()&&this.callbacks_.length&&this.started_&&(e=this.callbacks_.shift(),this.pendingCallback_=e[1],e[0]())}},{key:"dispose",value:function(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_),this.sourceBuffer_&&"open"===this.mediaSource.readyState&&this.sourceBuffer_.abort()}}]),e}(),Th={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},Sh=2,Eh=-101,kh=-102,wh=function(e){var t={};return e.byterange&&(t.Range=function(e){var t=void 0;return t=e.offset+e.length-1,"bytes="+e.offset+"-"+t}(e.byterange)),t},Ah=function(e){e.forEach(function(e){e.abort()})},Lh=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:Eh,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:kh,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:Sh,xhr:t}:null},Ch=function(e,t,i){var r=[],n=0;return function(a,s){if(a&&(Ah(e),r.push(a)),(n+=1)===e.length){if(s.endOfAllRequests=Date.now(),r.length>0){var o=(d=r,d.reduce(function(e,t){return t.code>e.code?t:e}));return i(o,s)}return s.encryptedBytes?(l=s,c=i,(u=t).addEventListener("message",function e(t){if(t.data.source===l.requestId){u.removeEventListener("message",e);var i=t.data.decrypted;return l.bytes=new Uint8Array(i.bytes,i.byteOffset,i.byteLength),c(null,l)}}),void u.postMessage(Rd({source:l.requestId,encrypted:l.encryptedBytes,key:l.key.bytes,iv:l.key.iv}),[l.encryptedBytes.buffer,l.key.bytes.buffer])):i(null,s)}var u,l,c,d}},Rh=function(e,t){return function(i){return e.stats=Ea.mergeOptions(e.stats,function(e){var t=e.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i}(i)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(i,e)}},Oh=function(e,t,i,r,n,a,s){var o=[],u=Ch(o,i,s);if(n.key){var l=e(Ea.mergeOptions(t,{uri:n.key.resolvedUri,responseType:"arraybuffer"}),(c=n,d=u,function(e,t){var i=t.response,r=Lh(e,t);if(r)return d(r,c);if(16!==i.byteLength)return d({status:t.status,message:"Invalid HLS key at URL: "+t.uri,code:Sh,xhr:t},c);var n=new DataView(i);return c.key.bytes=new Uint32Array([n.getUint32(0),n.getUint32(4),n.getUint32(8),n.getUint32(12)]),d(null,c)}));o.push(l)}var c,d;if(n.map&&!n.map.bytes){var h=e(Ea.mergeOptions(t,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:wh(n.map)}),(f=n,p=r,m=u,function(e,t){var i=t.response,r=Lh(e,t);return r?m(r,f):0===i.byteLength?m({status:t.status,message:"Empty HLS segment content at URL: "+t.uri,code:Sh,xhr:t},f):(f.map.bytes=new Uint8Array(t.response),p.isInitialized()||p.init(),f.map.timescales=uo.timescale(f.map.bytes),f.map.videoTrackIds=uo.videoTrackIds(f.map.bytes),m(null,f))}));o.push(h)}var f,p,m,g,y,v,_=e(Ea.mergeOptions(t,{uri:n.resolvedUri,responseType:"arraybuffer",headers:wh(n)}),(g=n,y=r,v=u,function(e,t){var i=t.response,r=Lh(e,t),n=void 0;if(r)return v(r,g);if(0===i.byteLength)return v({status:t.status,message:"Empty HLS segment content at URL: "+t.uri,code:Sh,xhr:t},g);g.stats=(a=t,{bandwidth:a.bandwidth,bytesReceived:a.bytesReceived||0,roundTripTime:a.roundTripTime||0});var a;return g.key?g.encryptedBytes=new Uint8Array(t.response):g.bytes=new Uint8Array(t.response),g.map&&g.map.bytes&&(y.isInitialized()||y.init(),(n=y.parse(g.bytes,g.map.videoTrackIds,g.map.timescales))&&n.captions&&(g.captionStreams=n.captionStreams,g.fmp4Captions=n.captions)),v(null,g)}));return _.addEventListener("progress",Rh(n,a)),o.push(_),function(){return Ah(o)}},Dh=function(e,t){var i=void 0;return e&&(i=n.getComputedStyle(e))?i[t]:""},Ih=function(e,t){var i=e.slice();e.sort(function(e,r){var n=t(e,r);return 0===n?i.indexOf(e)-i.indexOf(r):n})},Ph=function(e,t){var i=void 0,r=void 0;return e.attributes.BANDWIDTH&&(i=e.attributes.BANDWIDTH),i=i||n.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(r=t.attributes.BANDWIDTH),i-(r=r||n.Number.MAX_VALUE)},xh=function(e,t,i){if(!e||!t)return!1;var r=i===e.segments.length;return e.endList&&"open"===t.readyState&&r},Mh=function(e){return"number"==typeof e&&isFinite(e)},Uh=function(e){$c(t,e);function t(e){Xc(this,t);var i=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");return i.bandwidth=e.bandwidth,i.throughput={rate:0,count:0},i.roundTrip=NaN,i.resetStats_(),i.mediaIndex=null,i.hasPlayed_=e.hasPlayed,i.currentTime_=e.currentTime,i.seekable_=e.seekable,i.seeking_=e.seeking,i.duration_=e.duration,i.mediaSource_=e.mediaSource,i.hls_=e.hls,i.loaderType_=e.loaderType,i.startingMedia_=void 0,i.segmentMetadataTrack_=e.segmentMetadataTrack,i.goalBufferLength_=e.goalBufferLength,i.sourceType_=e.sourceType,i.inbandTextTracks_=e.inbandTextTracks,i.state_="INIT",i.checkBufferTimeout_=null,i.error_=void 0,i.currentTimeline_=-1,i.pendingSegment_=null,i.mimeType_=null,i.sourceUpdater_=null,i.xhrOptions_=null,i.activeInitSegmentId_=null,i.initSegments_={},i.captionParser_=new ac,i.decrypter_=e.decrypter,i.syncController_=e.syncController,i.syncPoint_={segmentIndex:0,time:0},i.syncController_.on("syncinfoupdate",function(){return i.trigger("syncinfoupdate")}),i.mediaSource_.addEventListener("sourceopen",function(){return i.ended_=!1}),i.fetchAtBuffer_=!1,i.logger_=vh("SegmentLoader["+i.loaderType_+"]"),Object.defineProperty(i,"state",{get:function(){return this.state_},set:function(e){e!==this.state_&&(this.logger_(this.state_+" -> "+e),this.state_=e)}}),i}return Yc(t,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.state="DISPOSED",this.pause(),this.abort_(),this.sourceUpdater_&&this.sourceUpdater_.dispose(),this.resetStats_(),this.captionParser_.reset()}},{key:"abort",value:function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null}},{key:"error",value:function(e){return void 0!==e&&(this.error_=e),this.pendingSegment_=null,this.error_}},{key:"endOfStream",value:function(){this.ended_=!0,this.pause(),this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():Ea.createTimeRanges()}},{key:"initSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var i=Od(e),r=this.initSegments_[i];return t&&!r&&e.bytes&&(this.initSegments_[i]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,timescales:e.timescales,videoTrackIds:e.videoTrackIds}),r||e}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){if(this.monitorBuffer_(),this.playlist_){if(this.syncController_.setDateTimeMapping(this.playlist_),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}}},{key:"init_",value:function(){return this.state="READY",this.sourceUpdater_=new bh(this.mediaSource_,this.mimeType_,this.loaderType_,this.sourceBufferEmitter_),this.resetEverything(),this.monitorBuffer_()}},{key:"playlist",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var i=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.hasPlayed_()||(e.syncInfo={mediaSequence:e.mediaSequence,time:0});var n=i?i.id:null;if(this.logger_("playlist update ["+n+" => "+e.id+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(i&&i.uri===e.uri){var a=e.mediaSequence-i.mediaSequence;this.logger_("live window shift ["+a+"]"),null!==this.mediaIndex&&(this.mediaIndex-=a),r&&(r.mediaIndex-=a,r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(i,e)}else null!==this.mediaIndex&&this.resyncLoader()}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(n.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(e,t){this.mimeType_||(this.mimeType_=e,this.sourceBufferEmitter_=t,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(e){this.ended_=!1,this.resetLoader(),this.remove(0,this.duration_(),e),this.captionParser_.clearAllCaptions(),this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1,this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null,this.syncPoint_=null,this.abort()}},{key:"remove",value:function(e,t,i){if(this.sourceUpdater_&&this.sourceUpdater_.remove(e,t,i),Bd(e,t,this.segmentMetadataTrack_),this.inbandTextTracks_)for(var r in this.inbandTextTracks_)Bd(e,t,this.inbandTextTracks_[r])}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&n.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=n.setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&n.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=n.setTimeout(this.monitorBufferTick_.bind(this),500)}},{key:"fillBuffer_",value:function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(e){xh(this.playlist_,this.mediaSource_,e.mediaIndex)?this.endOfStream():(e.mediaIndex!==this.playlist_.segments.length-1||"ended"!==this.mediaSource_.readyState||this.seeking_())&&((e.timeline!==this.currentTimeline_||null!==e.startOfSegment&&e.startOfSegment<this.sourceUpdater_.timestampOffset())&&(this.syncController_.reset(),e.timestampOffset=e.startOfSegment,this.captionParser_.clearAllCaptions()),this.loadSegment_(e))}}}},{key:"checkBuffer_",value:function(e,t,i,r,n,a){var s=0,o=void 0;e.length&&(s=e.end(e.length-1));var u=Math.max(0,s-n);if(!t.segments.length)return null;if(u>=this.goalBufferLength_())return null;if(!r&&u>=1)return null;if(null===a)return i=this.getSyncSegmentCandidate_(t),this.generateSegmentInfo_(t,i,null,!0);if(null!==i){var l=t.segments[i];return o=l&&l.end?l.end:s,this.generateSegmentInfo_(t,i+1,o,!1)}if(this.fetchAtBuffer_){var c=Ed.getMediaInfoForTime(t,s,a.segmentIndex,a.time);i=c.mediaIndex,o=c.startTime}else{var d=Ed.getMediaInfoForTime(t,n,a.segmentIndex,a.time);i=d.mediaIndex,o=d.startTime}return this.generateSegmentInfo_(t,i,o,!1)}},{key:"getSyncSegmentCandidate_",value:function(e){var t=this;if(-1===this.currentTimeline_)return 0;var i=e.segments.map(function(e,t){return{timeline:e.timeline,segmentIndex:t}}).filter(function(e){return e.timeline===t.currentTimeline_});return i.length?i[Math.min(i.length-1,1)].segmentIndex:Math.max(e.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(e,t,i,r){if(t<0||t>=e.segments.length)return null;var n=e.segments[t];return{requestId:"segment-loader-"+Math.random(),uri:n.resolvedUri,mediaIndex:t,isSyncRequest:r,startOfSegment:i,playlist:e,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:n.timeline,duration:n.duration,segment:n}}},{key:"abortRequestEarly_",value:function(e){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return!1;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return!1;var t=this.currentTime_(),i=e.bandwidth,r=this.pendingSegment_.duration,n=Ed.estimateSegmentRequestTime(r,i,this.playlist_,e.bytesReceived),a=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return((e.length?e.end(e.length-1):0)-t)/i}(this.buffered_(),t,this.hls_.tech_.playbackRate())-1;if(n<=a)return!1;var s=function(e){var t=e.master,i=e.currentTime,r=e.bandwidth,n=e.duration,a=e.segmentDuration,s=e.timeUntilRebuffer,o=e.currentTimeline,u=e.syncController,l=t.playlists.filter(function(e){return!Ed.isIncompatible(e)}),c=l.filter(Ed.isEnabled);c.length||(c=l.filter(function(e){return!Ed.isDisabled(e)}));var d=c.filter(Ed.hasAttribute.bind(null,"BANDWIDTH")).map(function(e){var t=u.getSyncPoint(e,n,o,i)?1:2;return{playlist:e,rebufferingImpact:Ed.estimateSegmentRequestTime(a,r,e)*t-s}}),h=d.filter(function(e){return e.rebufferingImpact<=0});return Ih(h,function(e,t){return Ph(t.playlist,e.playlist)}),h.length?h[0]:(Ih(d,function(e,t){return e.rebufferingImpact-t.rebufferingImpact}),d[0]||null)}({master:this.hls_.playlists.master,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(s){var o=n-a-s.rebufferingImpact,u=.5;return a<=1/30&&(u=1),!s.playlist||s.playlist.uri===this.playlist_.uri||o<u?!1:(this.bandwidth=s.playlist.attributes.BANDWIDTH*Th.BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),!0)}}},{key:"handleProgress_",value:function(e,t){this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId&&!this.abortRequestEarly_(t.stats)&&this.trigger("progress")}},{key:"loadSegment_",value:function(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),e.abortRequests=Oh(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.captionParser_,this.createSimplifiedSegmentObj_(e),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(e){var t=function(e,t,i){var r=void 0;return r=e.length&&e.start(0)>0&&e.start(0)<t?e.start(0):t-30,Math.min(r,t-i)}(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}},{key:"createSimplifiedSegmentObj_",value:function(e){var t=e.segment,i={resolvedUri:t.resolvedUri,byterange:t.byterange,requestId:e.requestId};if(t.key){var r=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);i.key={resolvedUri:t.key.resolvedUri,iv:r}}return t.map&&(i.map=this.initSegment(t.map)),i}},{key:"segmentRequestFinished_",value:function(e,t){if(this.mediaRequests+=1,t.stats&&(this.mediaBytesTransferred+=t.stats.bytesReceived,this.mediaTransferDuration+=t.stats.roundTripTime),this.pendingSegment_){if(t.requestId===this.pendingSegment_.requestId){if(e)return this.pendingSegment_=null,this.state="READY",e.code===kh?void(this.mediaRequestsAborted+=1):(this.pause(),e.code===Eh?(this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,void this.trigger("bandwidthupdate")):(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error")));this.bandwidth=t.stats.bandwidth,this.roundTrip=t.stats.roundTripTime,t.map&&(t.map=this.initSegment(t.map,!0)),this.processSegmentResponse_(t)}}else this.mediaRequestsAborted+=1}},{key:"processSegmentResponse_",value:function(e){var t=this.pendingSegment_;t.bytes=e.bytes,e.map&&(t.segment.map.bytes=e.map.bytes),t.endOfAllRequests=e.endOfAllRequests,e.fmp4Captions&&(!function(e,t,i){for(var r in i)if(!e[r]){t.trigger({type:"usage",name:"hls-608"});var n=t.textTracks().getTrackById(r);e[r]=n||t.addRemoteTextTrack({kind:"captions",id:r,label:r},!1).track}}(this.inbandTextTracks_,this.hls_.tech_,e.captionStreams),function(e){var t=e.inbandTextTracks,i=e.captionArray,r=e.timestampOffset;if(i){var n=window.WebKitDataCue||window.VTTCue;i.forEach(function(e){var i=e.stream,a=e.startTime,s=e.endTime;t[i]&&(a+=r,s+=r,t[i].addCue(new n(a,s,e.text)))})}}({inbandTextTracks:this.inbandTextTracks_,captionArray:e.fmp4Captions,timestampOffset:0}),this.captionParser_.clearParsedCaptions()),this.handleSegment_()}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_){var t=this.pendingSegment_,i=t.segment,r=this.syncController_.probeSegmentInfo(t);void 0===this.startingMedia_&&r&&(r.containsAudio||r.containsVideo)&&(this.startingMedia_={containsAudio:r.containsAudio,containsVideo:r.containsVideo});var n,a,s,o=(n=this.loaderType_,a=this.startingMedia_,s=r,"main"===n&&a&&s?s.containsAudio||s.containsVideo?a.containsVideo&&!s.containsVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!a.containsVideo&&s.containsVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null);if(o)return this.error({message:o,blacklistDuration:1/0}),void this.trigger("error");if(t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");null!==t.timestampOffset&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()&&(this.sourceUpdater_.timestampOffset(t.timestampOffset),this.trigger("timestampoffset"));var u=this.syncController_.mappingForTimeline(t.timeline);if(null!==u&&this.trigger({type:"segmenttimemapping",mapping:u}),this.state="APPENDING",i.map){var l=Od(i.map);if(!this.activeInitSegmentId_||this.activeInitSegmentId_!==l){var c=this.initSegment(i.map);this.sourceUpdater_.appendBuffer(c.bytes,function(){e.activeInitSegmentId_=l})}}t.byteLength=t.bytes.byteLength,"number"==typeof i.start&&"number"==typeof i.end?this.mediaSecondsLoaded+=i.end-i.start:this.mediaSecondsLoaded+=i.duration,this.logger_(function(e){var t=e.segment,i=t.start,r=t.end,n=e.playlist,a=n.mediaSequence,s=n.id,o=n.segments,u=void 0===o?[]:o,l=e.mediaIndex,c=e.timeline;return["appending ["+l+"] of ["+a+", "+(a+u.length)+"] from playlist ["+s+"]","["+i+" => "+r+"] in timeline ["+c+"]"].join(" ")}(t)),this.sourceUpdater_.appendBuffer(t.bytes,this.handleUpdateEnd_.bind(this))}else this.state="READY"}},{key:"handleUpdateEnd_",value:function(){if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_,t=e.segment,i=null!==this.mediaIndex;if(this.pendingSegment_=null,this.recordThroughput_(e),this.addSegmentMetadataCue_(e),this.state="READY",this.mediaIndex=e.mediaIndex,this.fetchAtBuffer_=!0,this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate"),t.end&&this.currentTime_()-t.end>3*e.playlist.targetDuration)this.resetEverything();else{i&&this.trigger("bandwidthupdate"),this.trigger("progress");xh(e.playlist,this.mediaSource_,e.mediaIndex+1)&&this.endOfStream(),this.paused()||this.monitorBuffer_()}}},{key:"recordThroughput_",value:function(e){var t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}},{key:"addSegmentMetadataCue_",value:function(e){if(this.segmentMetadataTrack_){var t=e.segment,i=t.start,r=t.end;if(Mh(i)&&Mh(r)){Bd(i,r,this.segmentMetadataTrack_);var a=n.WebKitDataCue||n.VTTCue,s={bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.uri,start:i,end:r},o=new a(i,r,JSON.stringify(s));o.value=s,this.segmentMetadataTrack_.addCue(o)}}}}]),t}(Ea.EventTarget),Nh=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))},Bh=new Uint8Array("\n\n".split("").map(function(e){return e.charCodeAt(0)})),Fh=function(e){$c(t,Uh);function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Xc(this,t);var r=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.mediaSource_=null,r.subtitlesTrack_=null,r}return Yc(t,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return Ea.createTimeRanges();var e=this.subtitlesTrack_.cues,t=e[0].startTime,i=e[e.length-1].startTime;return Ea.createTimeRanges([[t,i]])}},{key:"initSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var i=Od(e),r=this.initSegments_[i];if(t&&!r&&e.bytes){var n=Bh.byteLength+e.bytes.byteLength,a=new Uint8Array(n);a.set(e.bytes),a.set(Bh,e.bytes.byteLength),this.initSegments_[i]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}},{key:"track",value:function(e){return void 0===e?this.subtitlesTrack_:(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}},{key:"remove",value:function(e,t){Bd(e,t,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var e=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var t=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(t=this.skipEmptySegments_(t)){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline)){var i=function(){e.state="READY",e.paused()||e.monitorBuffer_()};return this.syncController_.one("timestampoffset",i),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(t)}}},{key:"skipEmptySegments_",value:function(e){for(;e&&e.segment.empty;)e=this.generateSegmentInfo_(e.playlist,e.mediaIndex+1,e.startOfSegment+e.duration,e.isSyncRequest);return e}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_&&this.subtitlesTrack_){this.state="APPENDING";var t=this.pendingSegment_,i=t.segment;if("function"!=typeof n.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var r=function(){e.handleSegment_()};return this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",r),void this.subtitlesTrack_.tech_.one("vttjserror",function(){e.subtitlesTrack_.tech_.off("vttjsloaded",r),e.error({message:"Error loading vtt.js"}),e.state="READY",e.pause(),e.trigger("error")})}i.requested=!0;try{this.parseVTTCues_(t)}catch(e){return this.error({message:e.message}),this.state="READY",this.pause(),this.trigger("error")}if(this.updateTimeMapping_(t,this.syncController_.timelines[t.timeline],this.playlist_),t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");t.byteLength=t.bytes.byteLength,this.mediaSecondsLoaded+=i.duration,t.cues.length&&this.remove(t.cues[0].endTime,t.cues[t.cues.length-1].endTime),t.cues.forEach(function(t){e.subtitlesTrack_.addCue(t)}),this.handleUpdateEnd_()}else this.state="READY"}},{key:"parseVTTCues_",value:function(e){var t=void 0,i=!1;"function"==typeof n.TextDecoder?t=new n.TextDecoder("utf8"):(t=n.WebVTT.StringDecoder(),i=!0);var r=new n.WebVTT.Parser(n,n.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=function(t){return e.timestampmap=t},r.onparsingerror=function(e){Ea.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){var a=e.segment.map.bytes;i&&(a=Nh(a)),r.parse(a)}var s=e.bytes;i&&(s=Nh(s)),r.parse(s),r.flush()}},{key:"updateTimeMapping_",value:function(e,t,i){var r=e.segment;if(t)if(e.cues.length){var n=e.timestampmap,a=n.MPEGTS/9e4-n.LOCAL+t.mapping;if(e.cues.forEach(function(e){e.startTime+=a,e.endTime+=a}),!i.syncInfo){var s=e.cues[0].startTime,o=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(s,o-r.duration)}}}else r.empty=!0}}]),t}(),jh=function(e,t){for(var i=e.cues,r=0;r<i.length;r++){var n=i[r];if(t>=n.adStartTime&&t<=n.adEndTime)return n}return null},Gh=Mc,Vh=[{name:"VOD",run:function(e,t,i,r,n){if(i!==1/0){return{time:0,segmentIndex:0}}return null}},{name:"ProgramDateTime",run:function(e,t,i,r,n){if(!e.datetimeToDisplayTime)return null;var a=t.segments||[],s=null,o=null;n=n||0;for(var u=0;u<a.length;u++){var l=a[u];if(l.dateTimeObject){var c=l.dateTimeObject.getTime()/1e3+e.datetimeToDisplayTime,d=Math.abs(n-c);if(null!==o&&o<d)break;o=d,s={time:c,segmentIndex:u}}}return s}},{name:"Segment",run:function(e,t,i,r,n){var a=t.segments||[],s=null,o=null;n=n||0;for(var u=0;u<a.length;u++){var l=a[u];if(l.timeline===r&&void 0!==l.start){var c=Math.abs(n-l.start);if(null!==o&&o<c)break;(!s||null===o||o>=c)&&(o=c,s={time:l.start,segmentIndex:u})}}return s}},{name:"Discontinuity",run:function(e,t,i,r,n){var a=null;if(n=n||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var s=null,o=0;o<t.discontinuityStarts.length;o++){var u=t.discontinuityStarts[o],l=t.discontinuitySequence+o+1,c=e.discontinuities[l];if(c){var d=Math.abs(n-c.time);if(null!==s&&s<d)break;(!a||null===s||s>=d)&&(s=d,a={time:c.time,segmentIndex:u})}}return a}},{name:"Playlist",run:function(e,t,i,r,n){if(t.syncInfo){return{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence}}return null}}],Hh=function(e){$c(t,e);function t(){Xc(this,t);var e=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.inspectCache_=void 0,e.timelines=[],e.discontinuities=[],e.datetimeToDisplayTime=null,e.logger_=vh("SyncController"),e}return Yc(t,[{key:"getSyncPoint",value:function(e,t,i,r){var n=this.runStrategies_(e,t,i,r);return n.length?this.selectSyncPoint_(n,{key:"time",value:r}):null}},{key:"getExpiredTime",value:function(e,t){if(!e||!e.segments)return null;var i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;var r=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+dd(e,r.segmentIndex,0))}},{key:"runStrategies_",value:function(e,t,i,r){for(var n=[],a=0;a<Vh.length;a++){var s=Vh[a],o=s.run(this,e,t,i,r);o&&(o.strategy=s.name,n.push({strategy:s.name,syncPoint:o}))}return n}},{key:"selectSyncPoint_",value:function(e,t){for(var i=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),n=e[0].strategy,a=1;a<e.length;a++){var s=Math.abs(e[a].syncPoint[t.key]-t.value);s<r&&(r=s,i=e[a].syncPoint,n=e[a].strategy)}return this.logger_("syncPoint for ["+t.key+": "+t.value+"] chosen with strategy ["+n+"]: [time:"+i.time+", segmentIndex:"+i.segmentIndex+"]"),i}},{key:"saveExpiredSegmentInfo",value:function(e,t){for(var i=t.mediaSequence-e.mediaSequence-1;i>=0;i--){var r=e.segments[i];if(r&&void 0!==r.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:r.start},this.logger_("playlist refresh sync: [time:"+t.syncInfo.time+", mediaSequence: "+t.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function(e){if(!this.datetimeToDisplayTime&&e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var t=e.segments[0].dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(e){var t=e.segment,i=e.playlist,r=void 0;return(r=t.map?this.probeMp4Segment_(e):this.probeTsSegment_(e))&&this.calculateSegmentTimeMapping_(e,r)&&(this.saveDiscontinuitySyncInfo_(e),i.syncInfo||(i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:t.start})),r}},{key:"probeMp4Segment_",value:function(e){var t=e.segment,i=uo.timescale(t.map.bytes),r=uo.startTime(i,e.bytes);return null!==e.timestampOffset&&(e.timestampOffset-=r),{start:r,end:r+t.duration}}},{key:"probeTsSegment_",value:function(e){var t=Gh(e.bytes,this.inspectCache_),i=void 0,r=void 0;return t?(t.video&&2===t.video.length?(this.inspectCache_=t.video[1].dts,i=t.video[0].dtsTime,r=t.video[1].dtsTime):t.audio&&2===t.audio.length&&(this.inspectCache_=t.audio[1].dts,i=t.audio[0].dtsTime,r=t.audio[1].dtsTime),{start:i,end:r,containsVideo:t.video&&2===t.video.length,containsAudio:t.audio&&2===t.audio.length}):null}},{key:"timestampOffsetForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].time}},{key:"mappingForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}},{key:"calculateSegmentTimeMapping_",value:function(e,t){var i=e.segment,r=this.timelines[e.timeline];if(null!==e.timestampOffset)r={time:e.startOfSegment,mapping:e.startOfSegment-t.start},this.timelines[e.timeline]=r,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": [time: "+r.time+"] [mapping: "+r.mapping+"]"),i.start=e.startOfSegment,i.end=t.end+r.mapping;else{if(!r)return!1;i.start=t.start+r.mapping,i.end=t.end+r.mapping}return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(e){var t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(var r=0;r<t.discontinuityStarts.length;r++){var n=t.discontinuityStarts[r],a=t.discontinuitySequence+r+1,s=n-e.mediaIndex,o=Math.abs(s);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>o){var u=void 0;u=s<0?i.start-dd(t,e.mediaIndex,n):i.end+dd(t,e.mediaIndex+1,n),this.discontinuities[a]={time:u,accuracy:o}}}}}]),t}(Ea.EventTarget),zh=new Kd("./decrypter-worker.worker.js",function(e,t){var i=this;!function(){var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":g(t))&&"function"!=typeof t?e:t},n=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],i=e[1],r=t[4],n=i[4],a=void 0,s=void 0,o=void 0,u=[],l=[],c=void 0,d=void 0,h=void 0,f=void 0,p=void 0;for(a=0;a<256;a++)l[(u[a]=a<<1^283*(a>>7))^a]=a;for(s=o=0;!r[s];s^=c||1,o=l[o]||1)for(h=(h=o^o<<1^o<<2^o<<3^o<<4)>>8^255&h^99,r[s]=h,n[h]=s,p=16843009*u[d=u[c=u[s]]]^65537*d^257*c^16843008*s,f=257*u[h]^16843008*h,a=0;a<4;a++)t[a][s]=f=f<<24^f>>>8,i[a][h]=p=p<<24^p>>>8;for(a=0;a<5;a++)t[a]=t[a].slice(0),i[a]=i[a].slice(0);return e},a=null,s=function(){function t(i){e(this,t),a||(a=n()),this._tables=[[a[0][0].slice(),a[0][1].slice(),a[0][2].slice(),a[0][3].slice(),a[0][4].slice()],[a[1][0].slice(),a[1][1].slice(),a[1][2].slice(),a[1][3].slice(),a[1][4].slice()]];var r=void 0,s=void 0,o=void 0,u=void 0,l=void 0,c=this._tables[0][4],d=this._tables[1],h=i.length,f=1;if(4!==h&&6!==h&&8!==h)throw new Error("Invalid aes key size");for(u=i.slice(0),l=[],this._key=[u,l],r=h;r<4*h+28;r++)o=u[r-1],(r%h==0||8===h&&r%h==4)&&(o=c[o>>>24]<<24^c[o>>16&255]<<16^c[o>>8&255]<<8^c[255&o],r%h==0&&(o=o<<8^o>>>24^f<<24,f=f<<1^283*(f>>7))),u[r]=u[r-h]^o;for(s=0;r;s++,r--)o=u[3&s?r:r-4],l[s]=r<=4||s<4?o:d[0][c[o>>>24]]^d[1][c[o>>16&255]]^d[2][c[o>>8&255]]^d[3][c[255&o]]}return t.prototype.decrypt=function(e,t,i,r,n,a){var s=this._key[1],o=e^s[0],u=r^s[1],l=i^s[2],c=t^s[3],d=void 0,h=void 0,f=void 0,p=s.length/4-2,m=void 0,g=4,y=this._tables[1],v=y[0],_=y[1],b=y[2],T=y[3],S=y[4];for(m=0;m<p;m++)d=v[o>>>24]^_[u>>16&255]^b[l>>8&255]^T[255&c]^s[g],h=v[u>>>24]^_[l>>16&255]^b[c>>8&255]^T[255&o]^s[g+1],f=v[l>>>24]^_[c>>16&255]^b[o>>8&255]^T[255&u]^s[g+2],c=v[c>>>24]^_[o>>16&255]^b[u>>8&255]^T[255&l]^s[g+3],g+=4,o=d,u=h,l=f;for(m=0;m<4;m++)n[(3&-m)+a]=S[o>>>24]<<24^S[u>>16&255]<<16^S[l>>8&255]<<8^S[255&c]^s[g++],d=o,o=u,u=l,l=c,c=d},t}(),o=function(){function t(){e(this,t),this.listeners={}}return t.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.prototype.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e].splice(i,1),i>-1},t.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,r=0;r<i;++r)t[r].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),a=t.length,s=0;s<a;++s)t[s].apply(this,n)},t.prototype.dispose=function(){this.listeners={}},t.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},t}(),u=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":g(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,t);function i(){e(this,i);var n=r(this,t.call(this,o));return n.jobs=[],n.delay=1,n.timeout_=null,n}return i.prototype.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},i.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},i}(o),l=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},c=function(){function i(t,r,n,a){e(this,i);var s=i.STEP,o=new Int32Array(t.buffer),c=new Uint8Array(t.byteLength),d=0;for(this.asyncStream_=new u,this.asyncStream_.push(this.decryptChunk_(o.subarray(d,d+s),r,n,c)),d=s;d<o.length;d+=s)n=new Uint32Array([l(o[d-4]),l(o[d-3]),l(o[d-2]),l(o[d-1])]),this.asyncStream_.push(this.decryptChunk_(o.subarray(d,d+s),r,n,c));this.asyncStream_.push(function(){a(null,(e=c).subarray(0,e.byteLength-e[e.byteLength-1]));var e})}return i.prototype.decryptChunk_=function(e,t,i,r){return function(){var n=function(e,t,i){var r=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),n=new s(Array.prototype.slice.call(t)),a=new Uint8Array(e.byteLength),o=new Int32Array(a.buffer),u=void 0,c=void 0,d=void 0,h=void 0,f=void 0,p=void 0,m=void 0,g=void 0,y=void 0;for(u=i[0],c=i[1],d=i[2],h=i[3],y=0;y<r.length;y+=4)f=l(r[y]),p=l(r[y+1]),m=l(r[y+2]),g=l(r[y+3]),n.decrypt(f,p,m,g,o,y),o[y]=l(o[y]^u),o[y+1]=l(o[y+1]^c),o[y+2]=l(o[y+2]^d),o[y+3]=l(o[y+3]^h),u=f,c=p,d=m,h=g;return a}(e,t,i);r.set(n,e.byteOffset)}},t(i,null,[{key:"STEP",get:function(){return 32e3}}]),i}();new function(e){e.onmessage=function(t){var i=t.data,r=new Uint8Array(i.encrypted.bytes,i.encrypted.byteOffset,i.encrypted.byteLength),n=new Uint32Array(i.key.bytes,i.key.byteOffset,i.key.byteLength/4),a=new Uint32Array(i.iv.bytes,i.iv.byteOffset,i.iv.byteLength/4);new c(r,n,a,function(t,r){e.postMessage(function(e){var t={};return Object.keys(e).forEach(function(i){var r=e[i];ArrayBuffer.isView(r)?t[i]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[i]=r}),t}({source:i.source,decrypted:r}),[r.buffer])})}}(i)}()}),Wh=function(e){var t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},qh=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},Kh=function(e,t){t.activePlaylistLoader=e,e.load()},Xh={AUDIO:function(e,t){return function(){var i=t.segmentLoaders[e],r=t.mediaTypes[e],n=t.blacklistCurrentPlaylist;qh(i,r);var a=r.activeTrack(),s=r.activeGroup(),o=(s.filter(function(e){return e.default})[0]||s[0]).id,u=r.tracks[o];if(a!==u){Ea.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(var l in r.tracks)r.tracks[l].enabled=r.tracks[l]===u;r.onTrackChanged()}else n({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(e,t){return function(){var i=t.segmentLoaders[e],r=t.mediaTypes[e];Ea.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),qh(i,r);var n=r.activeTrack();n&&(n.mode="disabled"),r.onTrackChanged()}}},Yh={AUDIO:function(e,t,i){if(t){var r=i.tech,n=i.requestOptions,a=i.segmentLoaders[e];t.on("loadedmetadata",function(){var e=t.media();a.playlist(e,n),(!r.paused()||e.endList&&"none"!==r.preload())&&a.load()}),t.on("loadedplaylist",function(){a.playlist(t.media(),n),r.paused()||a.load()}),t.on("error",Xh[e](e,i))}},SUBTITLES:function(e,t,i){var r=i.tech,n=i.requestOptions,a=i.segmentLoaders[e],s=i.mediaTypes[e];t.on("loadedmetadata",function(){var e=t.media();a.playlist(e,n),a.track(s.activeTrack()),(!r.paused()||e.endList&&"none"!==r.preload())&&a.load()}),t.on("loadedplaylist",function(){a.playlist(t.media(),n),r.paused()||a.load()}),t.on("error",Xh[e](e,i))}},$h=function(e,t){return function(i){return i.attributes[e]===t}},Qh=function(e){return function(t){return t.resolvedUri===e}},Jh={AUDIO:function(e,t){var i=t.hls,r=t.sourceType,n=t.segmentLoaders[e],a=t.requestOptions.withCredentials,s=t.master,o=s.mediaGroups,u=s.playlists,l=t.mediaTypes[e],c=l.groups,d=l.tracks,h=t.masterPlaylistLoader;o[e]&&0!==Object.keys(o[e]).length||(o[e]={main:{default:{default:!0}}});for(var f in o[e]){c[f]||(c[f]=[]);var p=u.filter($h(e,f));for(var m in o[e][f]){var g=o[e][f][m];p.filter(Qh(g.resolvedUri)).length&&delete g.resolvedUri;var y=void 0;if(y=g.resolvedUri?new od(g.resolvedUri,i,a):g.playlists&&"dash"===r?new yh(g.playlists[0],i,a,h):null,g=Ea.mergeOptions({id:m,playlistLoader:y},g),Yh[e](e,g.playlistLoader,t),c[f].push(g),void 0===d[m]){var v=new Ea.AudioTrack({id:m,kind:Wh(g),enabled:!1,language:g.language,default:g.default,label:m});d[m]=v}}}n.on("error",Xh[e](e,t))},SUBTITLES:function(e,t){var i=t.tech,r=t.hls,n=t.sourceType,a=t.segmentLoaders[e],s=t.requestOptions.withCredentials,o=t.master.mediaGroups,u=t.mediaTypes[e],l=u.groups,c=u.tracks,d=t.masterPlaylistLoader;for(var h in o[e]){l[h]||(l[h]=[]);for(var f in o[e][h])if(!o[e][h][f].forced){var p=o[e][h][f],m=void 0;if("hls"===n?m=new od(p.resolvedUri,r,s):"dash"===n&&(m=new yh(p.playlists[0],r,s,d)),p=Ea.mergeOptions({id:f,playlistLoader:m},p),Yh[e](e,p.playlistLoader,t),l[h].push(p),void 0===c[f]){var g=i.addRemoteTextTrack({id:f,kind:"subtitles",enabled:!1,language:p.language,label:f},!1).track;c[f]=g}}}a.on("error",Xh[e](e,t))},"CLOSED-CAPTIONS":function(e,t){var i=t.tech,r=t.master.mediaGroups,n=t.mediaTypes[e],a=n.groups,s=n.tracks;for(var o in r[e]){a[o]||(a[o]=[]);for(var u in r[e][o]){var l=r[e][o][u];if(l.instreamId.match(/CC\d/)&&(a[o].push(Ea.mergeOptions({id:u},l)),void 0===s[u])){var c=i.addRemoteTextTrack({id:l.instreamId,kind:"captions",enabled:!1,language:l.language,label:u},!1).track;s[u]=c}}}}},Zh={AUDIO:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var r in i)if(i[r].enabled)return i[r];return null}},SUBTITLES:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var r in i)if("showing"===i[r].mode)return i[r];return null}}},ef=function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){Jh[t](t,e)});var t=e.mediaTypes,i=e.masterPlaylistLoader,r=e.tech,n=e.hls;["AUDIO","SUBTITLES"].forEach(function(i){t[i].activeGroup=(r=i,n=e,function(e){var t=n.masterPlaylistLoader,i=n.mediaTypes[r].groups,a=t.media();if(!a)return null;var s=null;return a.attributes[r]&&(s=i[a.attributes[r]]),s=s||i.main,void 0===e?s:null===e?null:s.filter(function(t){return t.id===e.id})[0]||null});var r,n;t[i].activeTrack=Zh[i](i,e),t[i].onGroupChanged=(a=i,s=e,function(){var e=s.segmentLoaders,t=e[a],i=e.main,r=s.mediaTypes[a],n=r.activeTrack(),o=r.activeGroup(n),u=r.activePlaylistLoader;qh(t,r),o&&(o.playlistLoader?(t.resyncLoader(),Kh(o.playlistLoader,r)):u&&i.resetEverything())});var a,s;t[i].onTrackChanged=(o=i,u=e,function(){var e=u.segmentLoaders,t=e[o],i=e.main,r=u.mediaTypes[o],n=r.activeTrack(),a=r.activeGroup(n),s=r.activePlaylistLoader;qh(t,r),a&&(a.playlistLoader?s!==a.playlistLoader?(t.track&&t.track(n),t.resetEverything(),Kh(a.playlistLoader,r)):Kh(a.playlistLoader,r):i.resetEverything())});var o,u});var a=t.AUDIO.activeGroup(),s=(a.filter(function(e){return e.default})[0]||a[0]).id;t.AUDIO.tracks[s].enabled=!0,t.AUDIO.onTrackChanged(),i.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanged()})});var o=function(){t.AUDIO.onTrackChanged(),r.trigger({type:"usage",name:"hls-audio-change"})};r.audioTracks().addEventListener("change",o),r.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),n.on("dispose",function(){r.audioTracks().removeEventListener("change",o),r.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),r.clearTracks("audio");for(var u in t.AUDIO.tracks)r.audioTracks().addTrack(t.AUDIO.tracks[u])},tf=function(){var e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:_h,activeTrack:_h,onGroupChanged:_h,onTrackChanged:_h}}),e},rf=void 0,nf=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],af=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},sf=function(e){$c(t,e);function t(e){Xc(this,t);var i=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e.url,n=e.withCredentials,a=e.tech,s=e.bandwidth,o=e.externHls,u=e.useCueTags,l=e.blacklistDuration,c=e.enableLowInitialPlaylist,d=e.sourceType,h=e.seekTo;if(!r)throw new Error("A non-empty playlist URL is required");rf=o,i.withCredentials=n,i.tech_=a,i.hls_=a.hls,i.seekTo_=h,i.sourceType_=d,i.useCueTags_=u,i.blacklistDuration=l,i.enableLowInitialPlaylist=c,i.useCueTags_&&(i.cueTagsTrack_=i.tech_.addTextTrack("metadata","ad-cues"),i.cueTagsTrack_.inBandMetadataTrackDispatchType=""),i.requestOptions_={withCredentials:i.withCredentials,timeout:null},i.mediaTypes_=tf(),i.mediaSource=new Ea.MediaSource,i.mediaSource.addEventListener("sourceopen",i.handleSourceOpen_.bind(i)),i.seekable_=Ea.createTimeRanges(),i.hasPlayed_=function(){return!1},i.syncController_=new Hh(e),i.segmentMetadataTrack_=a.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,i.decrypter_=new zh,i.inbandTextTracks_={};var f={hls:i.hls_,mediaSource:i.mediaSource,currentTime:i.tech_.currentTime.bind(i.tech_),seekable:function(){return i.seekable()},seeking:function(){return i.tech_.seeking()},duration:function(){return i.mediaSource.duration},hasPlayed:function(){return i.hasPlayed_()},goalBufferLength:function(){return i.goalBufferLength()},bandwidth:s,syncController:i.syncController_,decrypter:i.decrypter_,sourceType:i.sourceType_,inbandTextTracks:i.inbandTextTracks_};return i.masterPlaylistLoader_="dash"===i.sourceType_?new yh(r,i.hls_,i.withCredentials):new od(r,i.hls_,i.withCredentials),i.setupMasterPlaylistLoaderListeners_(),i.mainSegmentLoader_=new Uh(Ea.mergeOptions(f,{segmentMetadataTrack:i.segmentMetadataTrack_,loaderType:"main"}),e),i.audioSegmentLoader_=new Uh(Ea.mergeOptions(f,{loaderType:"audio"}),e),i.subtitleSegmentLoader_=new Fh(Ea.mergeOptions(f,{loaderType:"vtt"}),e),i.setupSegmentLoaderListeners_(),nf.forEach(function(e){i[e+"_"]=af.bind(i,e)}),i.logger_=vh("MPC"),i.masterPlaylistLoader_.load(),i}return Yc(t,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*e.masterPlaylistLoader_.targetDuration*1e3;Sd(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,t.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load()),ef({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,hls:e.hls_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),t);try{e.setupSourceBuffers_()}catch(t){return Ea.log.warn("Failed to create SourceBuffers",t),e.mediaSource.endOfStream("decode")}e.setupFirstPlay(),e.trigger("selectedinitialmedia")}),this.masterPlaylistLoader_.on("loadedplaylist",function(){var t=e.masterPlaylistLoader_.media();if(!t){e.excludeUnsupportedVariants_();var i=void 0;return e.enableLowInitialPlaylist&&(i=e.selectInitialPlaylist()),i||(i=e.selectPlaylist()),e.initialMedia_=i,void e.masterPlaylistLoader_.media(e.initialMedia_)}if(e.useCueTags_&&e.updateAdCues_(t),e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.updateDuration(),e.tech_.paused()||(e.mainSegmentLoader_.load(),e.audioSegmentLoader_&&e.audioSegmentLoader_.load()),!t.endList){var r=function(){var t=e.seekable();0!==t.length&&e.mediaSource.addSeekableRange_(t.start(0),t.end(0))};if(e.duration()!==1/0){var n=function t(){e.duration()===1/0?r():e.tech_.one("durationchange",t)};e.tech_.one("durationchange",n)}else r()}}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*e.masterPlaylistLoader_.targetDuration*1e3;Sd(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=e.masterPlaylistLoader_.media();e.stuckAtPlaylistEnd_(t)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),e.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(e,t){var i=e.mediaGroups||{},r=!0,n=Object.keys(i.AUDIO);for(var a in i.AUDIO)for(var s in i.AUDIO[a]){i.AUDIO[a][s].uri||(r=!1)}r&&this.tech_.trigger({type:"usage",name:"hls-demuxed"}),Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"}),rf.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"hls-aes"}),rf.Playlist.isFmp4(t)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"}),n.length&&Object.keys(i.AUDIO[n[0]]).length>1&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var t=e.selectPlaylist(),i=e.masterPlaylistLoader_.media(),r=e.tech_.buffered(),n=r.length?r.end(r.length-1)-e.tech_.currentTime():0,a=e.bufferLowWaterLine();(!i.endList||e.duration()<Th.MAX_BUFFER_LOW_WATER_LINE||t.attributes.BANDWIDTH<i.attributes.BANDWIDTH||n>=a)&&e.masterPlaylistLoader_.media(t),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("ended",function(){e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(){e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120)}),this.mainSegmentLoader_.on("reseteverything",function(){e.tech_.trigger("hls-reset")}),this.mainSegmentLoader_.on("segmenttimemapping",function(t){e.tech_.trigger({type:"hls-segment-time-mapping",mapping:t.mapping})}),this.audioSegmentLoader_.on("ended",function(){e.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}},{key:"smoothQualityChange_",value:function(){var e=this.selectPlaylist();e!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(e),this.mainSegmentLoader_.resetLoader())}},{key:"fastQualityChange_",value:function(){var e=this,t=this.selectPlaylist();t!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(t),this.mainSegmentLoader_.resetEverything(function(){Ea.browser.IE_VERSION||Ea.browser.IS_EDGE?e.tech_.setCurrentTime(e.tech_.currentTime()+.04):e.tech_.setCurrentTime(e.tech_.currentTime())}))}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.seekTo_(0),this.hasPlayed_()&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.seekTo_(e.end(e.length-1)):void 0}}},{key:"setupFirstPlay",value:function(){var e=this,t=this.masterPlaylistLoader_.media();if(!t||this.tech_.paused()||this.hasPlayed_())return!1;if(!t.endList){var i=this.seekable();if(!i.length)return!1;if(Ea.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.seekTo_(i.end(0)),e.hasPlayed_=function(){return!0}}),!1;this.trigger("firstplay"),this.seekTo_(i.end(0))}return this.hasPlayed_=function(){return!0},this.load(),!0}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(e){return Ea.log.warn("Failed to create Source Buffers",e),this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,function(e){})}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var e=this.mainSegmentLoader_.ended_;this.mediaTypes_.AUDIO.activePlaylistLoader&&(e=!this.mainSegmentLoader_.startingMedia_||this.mainSegmentLoader_.startingMedia_.containsVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_),e&&this.mediaSource.endOfStream()}},{key:"stuckAtPlaylistEnd_",value:function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.mediaSource.duration);if(null===t)return!1;var i=rf.Playlist.playlistEnd(e,t),r=this.tech_.currentTime(),n=this.tech_.buffered();if(!n.length)return i-r<=.1;var a=n.end(n.length-1);return a-r<=.1&&i-a<=.1}},{key:"blacklistCurrentPlaylist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=void 0,r=void 0;if(i=e.playlist||this.masterPlaylistLoader_.media(),t=t||e.blacklistDuration||this.blacklistDuration,!i){this.error=e;try{return this.mediaSource.endOfStream("network")}catch(e){return this.trigger("error")}}var n=1===this.masterPlaylistLoader_.master.playlists.filter(bd).length;return n?(Ea.log.warn("Problem encountered with the current HLS playlist. Trying again since it is the final playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(n)):(i.excludeUntil=Date.now()+1e3*t,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),r=this.selectPlaylist(),Ea.log.warn("Problem encountered with the current HLS playlist."+(e.message?" "+e.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(r))}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(e){var t=xd(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:rf.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var e=void 0,t=void 0;if(this.masterPlaylistLoader_){var i=this.masterPlaylistLoader_.media();if(i){var r=this.syncController_.getExpiredTime(i,this.mediaSource.duration);if(null!==r&&0!==(e=rf.Playlist.seekable(i,r)).length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(i=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(r=this.syncController_.getExpiredTime(i,this.mediaSource.duration)))return;if(0===(t=rf.Playlist.seekable(i,r)).length)return}t?t.start(0)>e.end(0)||e.start(0)>t.end(0)?this.seekable_=e:this.seekable_=Ea.createTimeRanges([[t.start(0)>e.start(0)?t.start(0):e.start(0),t.end(0)<e.end(0)?t.end(0):e.end(0)]]):this.seekable_=e,this.logger_("seekable updated ["+Ud(this.seekable_)+"]"),this.tech_.trigger("seekablechanged")}}}}},{key:"updateDuration",value:function(){var e=this,t=this.mediaSource.duration,i=rf.Playlist.duration(this.masterPlaylistLoader_.media()),r=this.tech_.buffered(),n=function t(){e.mediaSource.duration=i,e.tech_.trigger("durationchange"),e.mediaSource.removeEventListener("sourceopen",t)};r.length>0&&(i=Math.max(i,r.end(r.length-1))),t!==i&&("open"!==this.mediaSource.readyState?this.mediaSource.addEventListener("sourceopen",n):n())}},{key:"dispose",value:function(){var e=this;this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),["AUDIO","SUBTITLES"].forEach(function(t){var i=e.mediaTypes_[t].groups;for(var r in i)i[r].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var e=this.masterPlaylistLoader_.media(),t=void 0;if(e&&"open"===this.mediaSource.readyState){if((t=rh(this.masterPlaylistLoader_.master,e)).length<1)return this.error="No compatible SourceBuffer configuration for the variant stream:"+e.resolvedUri,this.mediaSource.endOfStream("decode");this.configureLoaderMimeTypes_(t),this.excludeIncompatibleVariants_(e)}}},{key:"configureLoaderMimeTypes_",value:function(e){var t=e.length>1&&-1===e[0].indexOf(",")&&e[0]!==e[1]?new Ea.EventTarget:null;this.mainSegmentLoader_.mimeType(e[0],t),e[1]&&this.audioSegmentLoader_.mimeType(e[1],t)}},{key:"excludeUnsupportedVariants_",value:function(){this.master().playlists.forEach(function(e){e.attributes.CODECS&&n.MediaSource&&n.MediaSource.isTypeSupported&&!n.MediaSource.isTypeSupported('video/mp4; codecs="'+(t=e.attributes.CODECS,t.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return eh([e])[0]}))+'"')&&(e.excludeUntil=1/0);var t})}},{key:"excludeIncompatibleVariants_",value:function(e){var t=2,i=null,r=void 0;e.attributes.CODECS&&(r=th(e.attributes.CODECS),i=r.videoCodec,t=r.codecCount),this.master().playlists.forEach(function(e){var r={codecCount:2,videoCodec:null};e.attributes.CODECS&&(r=th(e.attributes.CODECS)),r.codecCount!==t&&(e.excludeUntil=1/0),r.videoCodec!==i&&(e.excludeUntil=1/0)})}},{key:"updateAdCues_",value:function(e){var t=0,i=this.seekable();i.length&&(t=i.start(0)),function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e.segments)for(var r=i,a=void 0,s=0;s<e.segments.length;s++){var o=e.segments[s];if(a||(a=jh(t,r+o.duration/2)),a){if("cueIn"in o){a.endTime=r,a.adEndTime=r,r+=o.duration,a=null;continue}if(r<a.endTime){r+=o.duration;continue}a.endTime+=o.duration}else if("cueOut"in o&&((a=new n.VTTCue(r,r+o.duration,o.cueOut)).adStartTime=r,a.adEndTime=r+parseFloat(o.cueOut),t.addCue(a)),"cueOutCont"in o){var u=void 0,l=void 0,c=o.cueOutCont.split("/").map(parseFloat),d=Jc(c,2);u=d[0],l=d[1],(a=new n.VTTCue(r,r+o.duration,"")).adStartTime=r-u,a.adEndTime=a.adStartTime+l,t.addCue(a)}r+=o.duration}}(e,this.cueTagsTrack_,t)}},{key:"goalBufferLength",value:function(){var e=this.tech_.currentTime(),t=Th.GOAL_BUFFER_LENGTH,i=Th.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Th.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,r)}},{key:"bufferLowWaterLine",value:function(){var e=this.tech_.currentTime(),t=Th.BUFFER_LOW_WATER_LINE,i=Th.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Th.MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,r)}}]),t}(Ea.EventTarget),of=function e(t,i,r){Xc(this,e);var n=t.masterPlaylistController_.fastQualityChange_.bind(t.masterPlaylistController_);if(i.attributes.RESOLUTION){var a=i.attributes.RESOLUTION;this.width=a.width,this.height=a.height}this.bandwidth=i.attributes.BANDWIDTH,this.id=r,this.enabled=(s=t.playlists,o=i.uri,u=n,function(e){var t=s.master.playlists[o],i=_d(t),r=bd(t);return void 0===e?r:(e?delete t.disabled:t.disabled=!0,e===r||i||(u(),e?s.trigger("renditionenabled"):s.trigger("renditiondisabled")),e)});var s,o,u},uf=["seeking","seeked","pause","playing","error"],lf=function(){function e(t){var i=this;Xc(this,e),this.tech_=t.tech,this.seekable=t.seekable,this.seekTo=t.seekTo,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=vh("PlaybackWatcher"),this.logger_("initialize");var r=function(){return i.monitorCurrentTime_()},a=function(){return i.techWaiting_()},s=function(){return i.cancelTimer_()},o=function(){return i.fixesBadSeeks_()};this.tech_.on("seekablechanged",o),this.tech_.on("waiting",a),this.tech_.on(uf,s),this.tech_.on("canplay",r),this.dispose=function(){i.logger_("dispose"),i.tech_.off("seekablechanged",o),i.tech_.off("waiting",a),i.tech_.off(uf,s),i.tech_.off("canplay",r),i.checkCurrentTimeTimeout_&&n.clearTimeout(i.checkCurrentTimeTimeout_),i.cancelTimer_()}}return Yc(e,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&n.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=n.setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+.1>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var e=this.tech_.seeking(),t=this.seekable(),i=this.tech_.currentTime(),r=void 0;if(e&&this.afterSeekableWindow_(t,i)){r=t.end(t.length-1)}if(e&&this.beforeSeekableWindow_(t,i)){r=t.start(0)+.1}return void 0!==r&&(this.logger_("Trying to seek outside of seekable at time "+i+" with seekable range "+Ud(t)+". Seeking to "+r+"."),this.seekTo(r),!0)}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),i=xd(t,e);return i.length&&e+3<=i.end(0)?(this.cancelTimer_(),this.seekTo(e),this.logger_("Stopped at "+e+" while inside a buffered region ["+i.start(0)+" -> "+i.end(0)+"]. Attempting to resume playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}}},{key:"techWaiting_",value:function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var i=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to live point (seekable end) "+i),this.cancelTimer_(),this.seekTo(i),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var r=this.tech_.buffered(),n=Md(r,t);if(this.videoUnderflow_(n,r,t))return this.cancelTimer_(),this.seekTo(t),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;if(n.length>0){var a=n.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+a+", seeking to "+n.start(0)),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*a,t),!0}return!1}},{key:"afterSeekableWindow_",value:function(e,t){return!!e.length&&t>e.end(e.length-1)+.1}},{key:"beforeSeekableWindow_",value:function(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-.1)}},{key:"videoUnderflow_",value:function(e,t,i){if(0===e.length){var r=this.gapFromVideoUnderflow_(t,i);if(r)return this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". Seeking to current time "+i),!0}return!1}},{key:"skipTheGap_",value:function(e){var t=this.tech_.buffered(),i=this.tech_.currentTime(),r=Md(t,i);this.cancelTimer_(),0!==r.length&&i===e&&(this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.seekTo(r.start(0)+1/30),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(e,t){for(var i=function(e){if(e.length<2)return Ea.createTimeRanges();for(var t=[],i=1;i<e.length;i++){var r=e.end(i-1),n=e.start(i);t.push([r,n])}return Ea.createTimeRanges(t)}(e),r=0;r<i.length;r++){var n=i.start(r),a=i.end(r);if(t-n<4&&t-n>2)return{start:n,end:a}}return null}}]),e}(),cf={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_)}},df=function(e){!function e(t,i){var r=0,n=0,a=Ea.mergeOptions(cf,i);t.ready(function(){t.trigger({type:"usage",name:"hls-error-reload-initialized"})});var s=function(){n&&t.currentTime(n)},o=function(e){null!==e&&void 0!==e&&(n=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",s),t.src(e),t.trigger({type:"usage",name:"hls-error-reload"}),t.play())},u=function(){if(Date.now()-r<1e3*a.errorInterval)t.trigger({type:"usage",name:"hls-error-reload-canceled"});else{if(a.getSource&&"function"==typeof a.getSource)return r=Date.now(),a.getSource.call(t,o);Ea.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function e(){t.off("loadedmetadata",s),t.off("error",u),t.off("dispose",e)};t.on("error",u),t.on("dispose",l),t.reloadSourceOnError=function(i){l(),e(t,i)}}(this,e)};Ea.use("*",function(e){return{setSource:function(e,t){t(null,e)},setCurrentTime:function(t){return e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(t),t},play:function(){e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(e.currentTime())}}});var hf={PlaylistLoader:od,Playlist:Ed,Decrypter:qc,AsyncStream:Hc,decrypt:Wc,utils:Id,STANDARD_PLAYLIST_SELECTOR:function(){return function(e,t,i,r){var a=e.playlists.map(function(e){var t=void 0,i=void 0;return t=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,i=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height,{bandwidth:e.attributes.BANDWIDTH||n.Number.MAX_VALUE,width:t,height:i,playlist:e}});Ih(a,function(e,t){return e.bandwidth-t.bandwidth});var s=(a=a.filter(function(e){return!Ed.isIncompatible(e.playlist)})).filter(function(e){return Ed.isEnabled(e.playlist)});s.length||(s=a.filter(function(e){return!Ed.isDisabled(e.playlist)}));var o=s.filter(function(e){return e.bandwidth*Th.BANDWIDTH_VARIANCE<t}),u=o[o.length-1],l=o.filter(function(e){return e.bandwidth===u.bandwidth})[0],c=o.filter(function(e){return e.width&&e.height});Ih(c,function(e,t){return e.width-t.width});var d=c.filter(function(e){return e.width===i&&e.height===r});u=d[d.length-1];var h=d.filter(function(e){return e.bandwidth===u.bandwidth})[0],f=void 0,p=void 0,m=void 0;h||(p=(f=c.filter(function(e){return e.width>i||e.height>r})).filter(function(e){return e.width===f[0].width&&e.height===f[0].height}),u=p[p.length-1],m=p.filter(function(e){return e.bandwidth===u.bandwidth})[0]);var g=m||h||l||s[0]||a[0];return g?g.playlist:null}(this.playlists.master,this.systemBandwidth,parseInt(Dh(this.tech_.el(),"width"),10),parseInt(Dh(this.tech_.el(),"height"),10))},INITIAL_PLAYLIST_SELECTOR:function(){var e=this.playlists.master.playlists.filter(Ed.isEnabled);Ih(e,function(e,t){return Ph(e,t)});return e.filter(function(e){return th(e.attributes.CODECS).videoCodec})[0]||null},comparePlaylistBandwidth:Ph,comparePlaylistResolution:function(e,t){var i=void 0,r=void 0;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(i=e.attributes.RESOLUTION.width),i=i||n.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(r=t.attributes.RESOLUTION.width),i===(r=r||n.Number.MAX_VALUE)&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:i-r},xhr:Ad()};["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(e){Object.defineProperty(hf,e,{get:function(){return Ea.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),Th[e]},set:function(t){Ea.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?Ea.log.warn("value of Hls."+e+" must be greater than or equal to 0"):Th[e]=t}})});var ff=function(e){if(/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(e))return"hls";return/^application\/dash\+xml/i.test(e)?"dash":null},pf=function(e,t){for(var i=t.media(),r=-1,n=0;n<e.length;n++)if(e[n].id===i.uri){r=n;break}e.selectedIndex_=r,e.trigger({selectedIndex:r,type:"change"})};hf.canPlaySource=function(){return Ea.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var mf=function(e){if("dash"===e.options_.sourceType){var t=Ea.players[e.tech_.options_.playerId];if(t.eme){var i=function(e,t,i){if(!e)return e;var r={};for(var n in e)r[n]={audioContentType:'audio/mp4; codecs="'+i.attributes.CODECS+'"',videoContentType:'video/mp4; codecs="'+t.attributes.CODECS+'"'},t.contentProtection&&t.contentProtection[n]&&t.contentProtection[n].pssh&&(r[n].pssh=t.contentProtection[n].pssh),"string"==typeof e[n]&&(r[n].url=e[n]);return Ea.mergeOptions(e,r)}(e.source_.keySystems,e.playlists.media(),e.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader.media());i&&(t.currentSource().keySystems=i)}}};hf.supportsNativeHls=function(){var e=l.createElement("video");if(!Ea.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),hf.supportsNativeDash=!!Ea.getTech("Html5").isSupported()&&/maybe|probably/i.test(l.createElement("video").canPlayType("application/dash+xml")),hf.supportsTypeNatively=function(e){return"hls"===e?hf.supportsNativeHls:"dash"===e&&hf.supportsNativeDash},hf.isSupported=function(){return Ea.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var gf=Ea.getComponent("Component"),yf=function(e){$c(t,gf);function t(e,i,r){Xc(this,t);var n=Qc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,r.hls));if(i.options_&&i.options_.playerId){var a=Ea(i.options_.playerId);a.hasOwnProperty("hls")||Object.defineProperty(a,"hls",{get:function(){return Ea.log.warn("player.hls is deprecated. Use player.tech().hls instead."),i.trigger({type:"usage",name:"hls-player-access"}),n}}),a.vhs=n,a.dash=n}if(n.tech_=i,n.source_=e,n.stats={},n.setOptions_(),n.options_.overrideNative&&i.overrideNativeAudioTracks&&i.overrideNativeVideoTracks)i.overrideNativeAudioTracks(!0),i.overrideNativeVideoTracks(!0);else if(n.options_.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return n.on(l,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var t=l.fullscreenElement||l.webkitFullscreenElement||l.mozFullScreenElement||l.msFullscreenElement;t&&t.contains(n.tech_.el())&&n.masterPlaylistController_.smoothQualityChange_()}),n.on(n.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),n.on(n.tech_,"play",n.play),n}return Yc(t,[{key:"setOptions_",value:function(){var e=this;this.options_.withCredentials=this.options_.withCredentials||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=4194304),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&4194304===this.options_.bandwidth,["withCredentials","bandwidth"].forEach(function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])}),this.bandwidth=this.options_.bandwidth}},{key:"src",value:function(e,t){var i=this;e&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=hf,this.options_.sourceType=ff(t),this.options_.seekTo=function(e){i.tech_.setCurrentTime(e),i.setCurrentTime(e)},this.masterPlaylistController_=new sf(this.options_),this.playbackWatcher_=new lf(Ea.mergeOptions(this.options_,{seekable:function(){return i.seekable()}})),this.masterPlaylistController_.on("error",function(){Ea.players[i.tech_.options_.playerId].error(i.masterPlaylistController_.error)}),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):hf.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=hf.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e=1/(this.bandwidth||1),t=void 0;t=this.throughput>0?1/this.throughput:0;return Math.floor(1/(e+t))},set:function(){Ea.log.error('The "systemBandwidth" property is read-only')}}}),Object.defineProperties(this.stats,{bandwidth:{get:function(){return i.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return i.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return i.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return i.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return i.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return i.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return i.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return i.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return Nd(i.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return i.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return i.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return i.tech_.name_},enumerable:!0},duration:{get:function(){return i.tech_.duration()},enumerable:!0},master:{get:function(){return i.playlists.master},enumerable:!0},playerDimensions:{get:function(){return i.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Nd(i.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return i.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.masterPlaylistController_.on("selectedinitialmedia",function(){!function(e){var t=e.playlists;e.representations=function(){return t.master.playlists.filter(function(e){return!_d(e)}).map(function(t,i){return new of(e,t,t.uri)})}}(i),mf(i)}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.tech_.ready(function(){return i.setupQualityLevels_()}),this.tech_.el()&&this.tech_.src(Ea.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var e=this,t=Ea.players[this.tech_.options_.playerId];t&&t.qualityLevels&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){t=e.qualityLevels_,(i=e).representations().forEach(function(e){t.addQualityLevel(e)}),pf(t,i.playlists);var t,i}),this.playlists.on("mediachange",function(){pf(e.qualityLevels_,e.playlists)}))}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]),t}(),vf={name:"videojs-http-streaming",VERSION:"1.2.6",canHandleSource:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Ea.mergeOptions(Ea.options,t);return vf.canPlayType(e.type,i)},handleSource:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Ea.mergeOptions(Ea.options,i);return t.hls=new yf(e,t,r),t.hls.xhr=Ad(),t.hls.src(e.src,e.type),t.hls},canPlayType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Ea.mergeOptions(Ea.options,t).hls.overrideNative,r=ff(e);return r&&(!hf.supportsTypeNatively(r)||i)?"maybe":""}};return void 0!==Ea.MediaSource&&void 0!==Ea.URL||(Ea.MediaSource=hh,Ea.URL=fh),hh.supportsNativeMediaSources()&&Ea.getTech("Html5").registerSourceHandler(vf,0),Ea.HlsHandler=yf,Ea.HlsSourceHandler=vf,Ea.Hls=hf,Ea.use||Ea.registerComponent("Hls",hf),Ea.options.hls=Ea.options.hls||{},Ea.registerPlugin?Ea.registerPlugin("reloadSourceOnError",df):Ea.plugin("reloadSourceOnError",df),Ea}),function(e){var t=e&&e.videojs;t&&(t.CDN_VERSION="7.2.4")}(window),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).flvjs=e()}}(function(){return function(){return function e(t,i,r){function n(s,o){if(!i[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){return n(t[s][1][e]||e)},c,c.exports,e,t,i,r)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}}()({1:[function(e,t,i){(function(r,n){a=this,s=function(){"use strict";function t(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=0,s=void 0,o=void 0,u=function(e,t){m[a]=e,m[a+1]=t,2===(a+=2)&&(o?o(g):v())};var l="undefined"!=typeof window?window:void 0,c=l||{},d=c.MutationObserver||c.WebKitMutationObserver,h="undefined"==typeof self&&void 0!==r&&"[object process]"==={}.toString.call(r),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(g,1)}}var m=new Array(1e3);function g(){for(var e=0;e<a;e+=2){(0,m[e])(m[e+1]),m[e]=void 0,m[e+1]=void 0}a=0}function y(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(g)}:p()}catch(e){return p()}}var v=void 0;v=h?function(){return r.nextTick(g)}:d?function(){var e=0,t=new d(g),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():f?function(){var e=new MessageChannel;return e.port1.onmessage=g,function(){return e.port2.postMessage(0)}}():void 0===l&&"function"==typeof e?y():p();function _(e,t){var i=this,r=new this.constructor(S);void 0===r[T]&&N(r);var n=i._state;if(n){var a=arguments[n-1];u(function(){return M(n,r,a,i._result)})}else P(i,r,e,t);return r}function b(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return R(t,e),t}var T=Math.random().toString(36).substring(2);function S(){}var E=void 0,k=1,w=2,A={error:null};function L(e){try{return e.then}catch(e){return A.error=e,A}}function C(e,i,r){i.constructor===e.constructor&&r===_&&i.constructor.resolve===b?(s=e,(o=i)._state===k?D(s,o._result):o._state===w?I(s,o._result):P(o,void 0,function(e){return R(s,e)},function(e){return I(s,e)})):r===A?(I(e,A.error),A.error=null):void 0===r?D(e,i):t(r)?(n=i,a=r,u(function(e){var t=!1,i=function(e,t,i,r){try{e.call(t,i,r)}catch(e){return e}}(a,n,function(i){t||(t=!0,n!==i?R(e,i):D(e,i))},function(i){t||(t=!0,I(e,i))},e._label);!t&&i&&(t=!0,I(e,i))},e)):D(e,i);var n,a,s,o}function R(e,t){e===t?I(e,new TypeError("You cannot resolve a promise with itself")):!function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)?D(e,t):C(e,t,L(t))}function O(e){e._onerror&&e._onerror(e._result),x(e)}function D(e,t){e._state===E&&(e._result=t,e._state=k,0!==e._subscribers.length&&u(x,e))}function I(e,t){e._state===E&&(e._state=w,e._result=t,u(O,e))}function P(e,t,i,r){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+k]=i,n[a+w]=r,0===a&&e._state&&u(x,e)}function x(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r=void 0,n=void 0,a=e._result,s=0;s<t.length;s+=3)r=t[s],n=t[s+i],r?M(i,r,n,a):n(a);e._subscribers.length=0}}function M(e,i,r,n){var a=t(r),s=void 0,o=void 0,u=void 0,l=void 0;if(a){if((s=function(e,t){try{return e(t)}catch(e){return A.error=e,A}}(r,n))===A?(l=!0,o=s.error,s.error=null):u=!0,i===s)return void I(i,new TypeError("A promises callback cannot return that same promise."))}else s=n,u=!0;i._state!==E||(a&&u?R(i,s):l?I(i,o):e===k?D(i,s):e===w&&I(i,s))}var U=0;function N(e){e[T]=U++,e._state=void 0,e._result=void 0,e._subscribers=[]}var B=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(S),this.promise[T]||N(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&D(this.promise,this._result))):I(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===E&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===b){var n=L(e);if(n===_&&e._state!==E)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(i===F){var a=new i(S);C(a,e,n),this._willSettleAt(a,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===E&&(this._remaining--,e===w?I(r,i):this._result[t]=i),0===this._remaining&&D(r,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;P(e,void 0,function(e){return i._settledAt(k,t,e)},function(e){return i._settledAt(w,t,e)})},e}();var F=function(){function e(t){this[T]=U++,this._result=this._state=void 0,this._subscribers=[],S!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){R(e,t)},function(t){I(e,t)})}catch(t){I(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var i=this.constructor;return t(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();F.prototype.then=_,F.all=function(e){return new B(this,e).promise},F.race=function(e){var t=this;return i(e)?new t(function(i,r){for(var n=e.length,a=0;a<n;a++)t.resolve(e[a]).then(i,r)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},F.resolve=b,F.reject=function(e){var t=new this(S);return I(t,e),t},F._setScheduler=function(e){o=e},F._setAsap=function(e){u=e},F._asap=u;return F.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=F},F.Promise=F,F},"object"==typeof i&&void 0!==t?t.exports=s():a.ES6Promise=s();var a,s}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,i){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,i,r,o,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(s(i=this._events[e]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(a(i))for(o=Array.prototype.slice.call(arguments,1),r=(l=i.slice()).length,u=0;u<r;u++)l[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var i,r,s,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(i=this._events[e]).length,r=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(i)){for(o=s;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){r=o;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)};function n(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}},{}],3:[function(e,t,i){var r,n,a=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var l,c=[],d=!1,h=-1;function f(){d&&l&&(d=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!d){var e=u(f);d=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||d||u(p)};function m(e,t){this.fun=e,this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={};function g(){}a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(e,t,i){var r=arguments[3],n=arguments[4],a=arguments[5],s=JSON.stringify;t.exports=function(e,t){for(var i,o=Object.keys(a),u=0,l=o.length;u<l;u++){var c=o[u],d=a[c].exports;if(d===e||d&&d.default===e){i=c;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(u=0,l=o.length;u<l;u++){h[c=o[u]]=c}n[i]=["function(require,module,exports){"+e+"(self); }",h]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[i]=i,n[f]=["function(require,module,exports){var f = require("+s(i)+");(f.default ? f.default : f)(self);}",p];var m={};!function e(t){m[t]=!0;for(var i in n[t][1]){var r=n[t][1][i];m[r]||e(r)}}(f);var g="("+r+")({"+Object.keys(m).map(function(e){return s(e)+":["+n[e][0]+","+s(n[e][1])+"]"}).join(",")+"},{},["+s(f)+"])",y=window.URL||window.webkitURL||window.mozURL||window.msURL,v=new Blob([g],{type:"text/javascript"});if(t&&t.bare)return v;var _=y.createObjectURL(v),b=new Worker(_);return b.objectURL=_,b}},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createDefaultConfig=function(){return Object.assign({},r)};var r=i.defaultConfig={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0}},{}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("../io/io-controller.js"),s=(r=a,r&&r.__esModule?r:{default:r}),o=e("../config.js");var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var e=new s.default({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new s.default({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(t){void 0==e.videoElement&&(e.videoElement=window.document.createElement("video"));var i=e.videoElement.canPlayType(t);return"probably"===i||"maybe"==i}},{key:"getFeatureList",value:function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t}}]),e}();i.default=u},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return r(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}}},{key:"_search",value:function(e,t){var i=0,r=e.length-1,n=0,a=0,s=r;for(t<e[0]&&(i=0,a=s+1);a<=s;){if((n=a+Math.floor((s-a)/2))===r||t>=e[n]&&t<e[n+1]){i=n;break}e[n]<t?a=n+1:s=n-1}return i}}]),e}();i.default=n},{}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.SampleInfo=function e(t,i,r,a,s){n(this,e),this.dts=t,this.pts=i,this.duration=r,this.originalDts=a,this.isSyncPoint=s,this.fileposition=null},i.MediaSegmentInfo=function(){function e(){n(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return r(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),i.IDRSampleList=function(){function e(){n(this,e),this._list=[]}return r(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,i=0,r=t.length-1,n=0,a=0,s=r;for(e<t[0].dts&&(i=0,a=s+1);a<=s;){if((n=a+Math.floor((s-a)/2))===r||e>=t[n].dts&&e<t[n+1].dts){i=n;break}t[n].dts<e?a=n+1:s=n-1}return this._list[i]}}]),e}(),i.MediaSegmentInfoList=function(){function e(t){n(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return r(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,n=0,a=i,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>t[r].lastSample.originalDts&&e<t[r+1].originalBeginDts){s=r;break}t[r].originalBeginDts<e?n=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=e,r=this._lastAppendLocation,n=0;-1!==r&&r<t.length&&i.originalBeginDts>=t[r].lastSample.originalDts&&(r===t.length-1||r<t.length-1&&i.originalBeginDts<t[r+1].originalBeginDts)?n=r+1:t.length>0&&(n=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,i)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&t>0;)t--,i=this._list[t].syncPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},{}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=c(e("events")),a=c(e("../utils/logger.js")),s=c(e("../utils/browser.js")),o=c(e("./mse-events.js")),u=e("./media-segment-info.js"),l=e("../utils/exception.js");function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="MSEController",this._config=t,this._emitter=new n.default,this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new u.IDRSampleList}return r(e,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new l.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var i=this._pendingSegments[t];i.splice(0,i.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var r=this._sourceBuffers[t];if(r){if("closed"!==e.readyState){try{e.removeSourceBuffer(r)}catch(e){a.default.e(this.TAG,e.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){a.default.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var i=e,r=""+i.container;i.codec&&i.codec.length>0&&(r+=";codecs="+i.codec);var n=!1;if(a.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[i.type]=i,r!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])a.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+r);else{n=!0;try{var u=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(r);u.addEventListener("error",this.e.onSourceBufferError),u.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return a.default.e(this.TAG,e.message),void this._emitter.emit(o.default.ERROR,{code:e.code,msg:e.message})}}this._mimeTypes[i.type]=r}t||this._pendingSegments[i.type].push(i),n||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),s.default.safari&&"audio/mpeg"===i.container&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[t.type];!i||i.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var i=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{i.abort()}catch(e){a.default.e(this.TAG,e.message)}this._idrList.clear();var r=this._pendingSegments[t];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var n=0;n<i.buffered.length;n++){var o=i.buffered.start(n),u=i.buffered.end(n);this._pendingRemoveRanges[t].push({start:o,end:u})}if(i.updating||this._doRemoveRanges(),s.default.safari){var l=this._lastInitSegments[t];l&&(this._pendingSegments[t].push(l),i.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){var r=i.buffered;if(r.length>=1&&e-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){for(var r=i.buffered,n=!1,a=0;a<r.length;a++){var s=r.start(a),o=r.end(a);if(s<=e&&e<o+3){if(e-s>=this._config.autoCleanupMaxBackwardDuration){n=!0;var u=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:s,end:u})}}else o<e&&(n=!0,this._pendingRemoveRanges[t].push({start:s,end:o}))}n&&!i.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(t)||i>t)&&(a.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],i=this._pendingRemoveRanges[e];i.length&&!t.updating;){var r=i.shift();t.remove(r.start,r.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var i=e[t].shift();if(i.timestampOffset){var r=this._sourceBuffers[t].timestampOffset,n=i.timestampOffset/1e3;Math.abs(r-n)>.1&&(a.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+n),this._sourceBuffers[t].timestampOffset=n),delete i.timestampOffset}if(!i.data||0===i.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(i.data),this._isBufferFull=!1,"video"===t&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(i),22===e.code?(this._isBufferFull||this._emitter.emit(o.default.BUFFER_FULL),this._isBufferFull=!0):(a.default.e(this.TAG,e.message),this._emitter.emit(o.default.ERROR,{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(a.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(o.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){a.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){a.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(o.default.UPDATE_END)}},{key:"_onSourceBufferError",value:function(e){a.default.e(this.TAG,"SourceBuffer Error: "+e)}}]),e}();i.default=d},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=d(e("events")),a=d(e("../utils/logger.js")),s=d(e("../utils/logging-control.js")),o=d(e("./transmuxing-controller.js")),u=d(e("./transmuxing-events.js")),l=d(e("./transmuxing-worker.js")),c=d(e("./media-info.js"));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function t(i,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.TAG="Transmuxer",this._emitter=new n.default,r.enableWorker&&"undefined"!=typeof Worker)try{var c=e("webworkify");this._worker=c(l.default),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},s.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:s.default.getConfig()})}catch(e){a.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new o.default(i,r)}else this._controller=new o.default(i,r);if(this._controller){var d=this._controller;d.on(u.default.IO_ERROR,this._onIOError.bind(this)),d.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),d.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),d.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),d.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),d.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),d.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),d.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),d.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),d.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),d.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return r(t,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),s.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(e,t){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.INIT_SEGMENT,e,t)})}},{key:"_onMediaSegment",value:function(e,t){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.MEDIA_SEGMENT,e,t)})}},{key:"_onLoadingComplete",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.MEDIA_INFO,e)})}},{key:"_onMetaDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.METADATA_ARRIVED,e)})}},{key:"_onScriptDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.SCRIPTDATA_ARRIVED,e)})}},{key:"_onStatisticsInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.STATISTICS_INFO,e)})}},{key:"_onIOError",value:function(e,t){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.IO_ERROR,e,t)})}},{key:"_onDemuxError",value:function(e,t){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.DEMUX_ERROR,e,t)})}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.RECOMMEND_SEEKPOINT,e)})}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,i=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,i.type,i.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(i,c.default.prototype),this._emitter.emit(t.msg,i);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(t.msg,i);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(t.msg,i.type,i.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,i);break;case"logcat_callback":a.default.emitter.emit("log",i.type,i.logcat)}}}]),t}();i.default=h},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=f(e("events")),a=f(e("../utils/logger.js")),s=f(e("../utils/browser.js")),o=f(e("./media-info.js")),u=f(e("../demux/flv-demuxer.js")),l=f(e("../remux/mp4-remuxer.js")),c=f(e("../demux/demux-errors.js")),d=f(e("../io/io-controller.js")),h=f(e("./transmuxing-events.js"));e("../io/loader.js");function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="TransmuxingController",this._emitter=new n.default,this._config=i,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=r,r+=e.duration,e.cors=t.cors,e.withCredentials=t.withCredentials,i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy)}),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return r(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var i=this._mediaDataSource.segments[e],r=this._ioctl=new d.default(i,this._config,e);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var i=this._mediaInfo.segments[t];if(void 0==i)this._pendingSeekTime=e;else{var r=i.getNearestKeyframe(e);this._remuxer.seek(r.milliseconds),this._ioctl.seek(r.fileposition),this._pendingResolveSeekPoint=r.milliseconds}}else{var n=this._mediaInfo.segments[t];if(void 0==n)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var a=n.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(t)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,i=t.length-1,r=0;r<t.length;r++)if(e<t[r].timestampBase){i=r-1;break}return i}},{key:"_onInitChunkArrival",value:function(e,t){var i=this,r=null,n=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,n=this._demuxer.parseChunks(e,t);else if((r=u.default.probe(e)).match){this._demuxer=new u.default(r,this._config),this._remuxer||(this._remuxer=new l.default(this._config));var s=this._mediaDataSource;void 0==s.duration||isNaN(s.duration)||(this._demuxer.overridedDuration=s.duration),"boolean"==typeof s.hasAudio&&(this._demuxer.overridedHasAudio=s.hasAudio),"boolean"==typeof s.hasVideo&&(this._demuxer.overridedHasVideo=s.hasVideo),this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),n=this._demuxer.parseChunks(e,t)}else r=null,a.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){i._internalAbort()}),this._emitter.emit(h.default.DEMUX_ERROR,c.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),n=0;return n}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.default.prototype));var i=Object.assign({},e);Object.setPrototypeOf(i,o.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=i,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)})}},{key:"_onMetaDataArrived",value:function(e){this._emitter.emit(h.default.METADATA_ARRIVED,e)}},{key:"_onScriptDataArrived",value:function(e){this._emitter.emit(h.default.SCRIPTDATA_ARRIVED,e)}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(h.default.LOADING_COMPLETE),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(h.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function(e,t){a.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(h.default.IO_ERROR,e,t),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(e,t){a.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(h.default.DEMUX_ERROR,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(h.default.INIT_SEGMENT,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(h.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var i=t.info.syncPoints,r=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&i.length>0&&i[0].originalDts===r&&(r=i[0].pts),this._emitter.emit(h.default.RECOMMEND_SEEKPOINT,r)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],i=Object.assign({},t);i.duration=this._mediaInfo.duration,i.segmentCount=this._mediaInfo.segmentCount,delete i.segments,delete i.keyframesIndex,this._emitter.emit(h.default.MEDIA_INFO,i)}},{key:"_reportStatisticsInfo",value:function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(h.default.STATISTICS_INFO,e)}}]),e}();i.default=p},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},{}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});o(e("../utils/logger.js"));var r=o(e("../utils/logging-control.js")),n=o(e("../utils/polyfill.js")),a=o(e("./transmuxing-controller.js")),s=o(e("./transmuxing-events.js"));function o(e){return e&&e.__esModule?e:{default:e}}i.default=function(e){var t=null,i=function(t,i){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:i}})}.bind(this);n.default.install(),e.addEventListener("message",function(n){switch(n.data.cmd){case"init":(t=new a.default(n.data.param[0],n.data.param[1])).on(s.default.IO_ERROR,function(t,i){e.postMessage({msg:s.default.IO_ERROR,data:{type:t,info:i}})}.bind(this)),t.on(s.default.DEMUX_ERROR,function(t,i){e.postMessage({msg:s.default.DEMUX_ERROR,data:{type:t,info:i}})}.bind(this)),t.on(s.default.INIT_SEGMENT,function(t,i){var r={msg:s.default.INIT_SEGMENT,data:{type:t,data:i}};e.postMessage(r,[i.data])}.bind(this)),t.on(s.default.MEDIA_SEGMENT,function(t,i){var r={msg:s.default.MEDIA_SEGMENT,data:{type:t,data:i}};e.postMessage(r,[i.data])}.bind(this)),t.on(s.default.LOADING_COMPLETE,function(){var t={msg:s.default.LOADING_COMPLETE};e.postMessage(t)}.bind(this)),t.on(s.default.RECOVERED_EARLY_EOF,function(){var t={msg:s.default.RECOVERED_EARLY_EOF};e.postMessage(t)}.bind(this)),t.on(s.default.MEDIA_INFO,function(t){var i={msg:s.default.MEDIA_INFO,data:t};e.postMessage(i)}.bind(this)),t.on(s.default.METADATA_ARRIVED,function(t){var i={msg:s.default.METADATA_ARRIVED,data:t};e.postMessage(i)}.bind(this)),t.on(s.default.SCRIPTDATA_ARRIVED,function(t){var i={msg:s.default.SCRIPTDATA_ARRIVED,data:t};e.postMessage(i)}.bind(this)),t.on(s.default.STATISTICS_INFO,function(t){var i={msg:s.default.STATISTICS_INFO,data:t};e.postMessage(i)}.bind(this)),t.on(s.default.RECOMMEND_SEEKPOINT,function(t){e.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:t})}.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(n.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var o=n.data.param;r.default.applyConfig(o),!0===o.enableCallback?r.default.addLogListener(i):r.default.removeLogListener(i)}})}},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=o(e("../utils/logger.js")),a=o(e("../utils/utf8-conv.js")),s=e("../utils/exception.js");function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"parseScriptData",value:function(t,i,r){var a={};try{var s=e.parseValue(t,i,r),o=e.parseValue(t,i+s.size,r-s.size);a[s.data]=o.data}catch(e){n.default.e("AMF",e.toString())}return a}},{key:"parseObject",value:function(t,i,r){if(r<3)throw new s.IllegalStateException("Data not enough when parse ScriptDataObject");var n=e.parseString(t,i,r),a=e.parseValue(t,i+n.size,r-n.size),o=a.objectEnd;return{data:{name:n.data,value:a.data},size:n.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,i,r){return e.parseObject(t,i,r)}},{key:"parseString",value:function(e,t,i){if(i<2)throw new s.IllegalStateException("Data not enough when parse String");var r=new DataView(e,t,i).getUint16(0,!u);return{data:r>0?(0,a.default)(new Uint8Array(e,t+2,r)):"",size:2+r}}},{key:"parseLongString",value:function(e,t,i){if(i<4)throw new s.IllegalStateException("Data not enough when parse LongString");var r=new DataView(e,t,i).getUint32(0,!u);return{data:r>0?(0,a.default)(new Uint8Array(e,t+4,r)):"",size:4+r}}},{key:"parseDate",value:function(e,t,i){if(i<10)throw new s.IllegalStateException("Data size invalid when parse Date");var r=new DataView(e,t,i),n=r.getFloat64(0,!u),a=r.getInt16(8,!u);return{data:new Date(n+=60*a*1e3),size:10}}},{key:"parseValue",value:function(t,i,r){if(r<1)throw new s.IllegalStateException("Data not enough when parse Value");var a=new DataView(t,i,r),o=1,l=a.getUint8(0),c=void 0,d=!1;try{switch(l){case 0:c=a.getFloat64(1,!u),o+=8;break;case 1:c=!!a.getUint8(1),o+=1;break;case 2:var h=e.parseString(t,i+1,r-1);c=h.data,o+=h.size;break;case 3:c={};var f=0;for(9==(16777215&a.getUint32(r-4,!u))&&(f=3);o<r-4;){var p=e.parseObject(t,i+o,r-o-f);if(p.objectEnd)break;c[p.data.name]=p.data.value,o+=p.size}if(o<=r-3){9===(16777215&a.getUint32(o-1,!u))&&(o+=3)}break;case 8:c={},o+=4;var m=0;for(9==(16777215&a.getUint32(r-4,!u))&&(m=3);o<r-8;){var g=e.parseVariable(t,i+o,r-o-m);if(g.objectEnd)break;c[g.data.name]=g.data.value,o+=g.size}if(o<=r-3){9===(16777215&a.getUint32(o-1,!u))&&(o+=3)}break;case 9:c=void 0,o=1,d=!0;break;case 10:c=[];var y=a.getUint32(1,!u);o+=4;for(var v=0;v<y;v++){var _=e.parseValue(t,i+o,r-o);c.push(_.data),o+=_.size}break;case 11:var b=e.parseDate(t,i+1,r-1);c=b.data,o+=b.size;break;case 12:var T=e.parseString(t,i+1,r-1);c=T.data,o+=T.size;break;default:o=r,n.default.w("AMF","Unsupported AMF value type "+l)}}catch(e){n.default.e("AMF",e.toString())}return{data:c,size:o,objectEnd:d}}}]),e}();i.default=l},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},{}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=e("../utils/exception.js");var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return r(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new n.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new n.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(r,this._current_word_bits_left),s=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,i=i<<a|s}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();i.default=a},{"../utils/exception.js":40}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=d(e("../utils/logger.js")),s=d(e("./amf-parser.js")),o=d(e("./sps-parser.js")),u=d(e("./demux-errors.js")),l=d(e("../core/media-info.js")),c=e("../utils/exception.js");function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new l.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return n(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new l.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,i){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0,n=this._littleEndian;if(0===i){if(!(t.byteLength>13))return 0;r=e.probe(t).dataOffset}if(this._firstParse){this._firstParse=!1,i+r!==this._dataOffset&&a.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(t,r).getUint32(0,!n)&&a.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4}for(;r<t.byteLength;){this._dispatch=!0;var s=new DataView(t,r);if(r+11+4>t.byteLength)break;var o=s.getUint8(0),u=16777215&s.getUint32(0,!n);if(r+11+u+4>t.byteLength)break;if(8===o||9===o||18===o){var l=s.getUint8(4),d=s.getUint8(5),h=s.getUint8(6)|d<<8|l<<16|s.getUint8(7)<<24;0!==(16777215&s.getUint32(7,!n))&&a.default.w(this.TAG,"Meet tag which has StreamID != 0!");var f=r+11;switch(o){case 8:this._parseAudioData(t,f,u,h);break;case 9:this._parseVideoData(t,f,u,h,i+r);break;case 18:this._parseScriptData(t,f,u)}var p=s.getUint32(11+u,!n);p!==11+u&&a.default.w(this.TAG,"Invalid PrevTagSize "+p),r+=11+u+4}else a.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),r+=11+u+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),r}},{key:"_parseScriptData",value:function(e,t,i){var n=s.default.parseScriptData(e,t,i);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!==r(n.onMetaData))return void a.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&a.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=n;var o=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},o)),"boolean"==typeof o.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=o.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof o.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=o.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof o.audiodatarate&&(this._mediaInfo.audioDataRate=o.audiodatarate),"number"==typeof o.videodatarate&&(this._mediaInfo.videoDataRate=o.videodatarate),"number"==typeof o.width&&(this._mediaInfo.width=o.width),"number"==typeof o.height&&(this._mediaInfo.height=o.height),"number"==typeof o.duration){if(!this._durationOverrided){var u=Math.floor(o.duration*this._timescale);this._duration=u,this._mediaInfo.duration=u}}else this._mediaInfo.duration=0;if("number"==typeof o.framerate){var l=Math.floor(1e3*o.framerate);if(l>0){var c=l/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=c,this._referenceFrameRate.fps_num=l,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=c}}if("object"===r(o.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var d=o.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(d),o.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=o,a.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(n).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},n))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],i=[],r=1;r<e.times.length;r++){var n=this._timestampBase+Math.floor(1e3*e.times[r]);t.push(n),i.push(e.filepositions[r])}return{times:t,filepositions:i}}},{key:"_parseAudioData",value:function(e,t,i,r){if(i<=1)a.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var n=new DataView(e,t,i).getUint8(0),s=n>>>4;if(2===s||10===s){var o=0,l=(12&n)>>>2;if(l>=0&&l<=4){o=this._flvSoundRateTable[l];var c=1&n,d=this._audioMetadata,h=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(d=this._audioMetadata={}).type="audio",d.id=h.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=o,d.channelCount=0===c?1:2),10===s){var f=this._parseAACAudioData(e,t+1,i-1);if(void 0==f)return;if(0===f.packetType){d.config&&a.default.w(this.TAG,"Found another AudioSpecificConfig!");var p=f.data;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.config=p.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,a.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d);var m=this._mediaInfo;m.audioCodec=d.originalCodec,m.audioSampleRate=d.audioSampleRate,m.audioChannelCount=d.channelCount,m.hasVideo?null!=m.videoCodec&&(m.mimeType='video/x-flv; codecs="'+m.videoCodec+","+m.audioCodec+'"'):m.mimeType='video/x-flv; codecs="'+m.audioCodec+'"',m.isComplete()&&this._onMediaInfo(m)}else if(1===f.packetType){var g=this._timestampBase+r,y={unit:f.data,length:f.data.byteLength,dts:g,pts:g};h.samples.push(y),h.length+=f.data.length}else a.default.e(this.TAG,"Flv: Unsupported AAC data type "+f.packetType)}else if(2===s){if(!d.codec){var v=this._parseMP3AudioData(e,t+1,i-1,!0);if(void 0==v)return;d.audioSampleRate=v.samplingRate,d.channelCount=v.channelCount,d.codec=v.codec,d.originalCodec=v.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,a.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d);var _=this._mediaInfo;_.audioCodec=d.codec,_.audioSampleRate=d.audioSampleRate,_.audioChannelCount=d.channelCount,_.audioDataRate=v.bitRate,_.hasVideo?null!=_.videoCodec&&(_.mimeType='video/x-flv; codecs="'+_.videoCodec+","+_.audioCodec+'"'):_.mimeType='video/x-flv; codecs="'+_.audioCodec+'"',_.isComplete()&&this._onMediaInfo(_)}var b=this._parseMP3AudioData(e,t+1,i-1,!1);if(void 0==b)return;var T=this._timestampBase+r,S={unit:b,length:b.byteLength,dts:T,pts:T};h.samples.push(S),h.length+=b.length}}else this._onError(u.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l)}else this._onError(u.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s)}}},{key:"_parseAACAudioData",value:function(e,t,i){if(!(i<=1)){var r={},n=new Uint8Array(e,t,i);return r.packetType=n[0],0===n[0]?r.data=this._parseAACAudioSpecificConfig(e,t+1,i-1):r.data=n.subarray(1),r}a.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,i){var r=new Uint8Array(e,t,i),n=null,a=0,s=0,o=0,l=null;if(a=s=r[0]>>>3,(o=(7&r[0])<<1|r[1]>>>7)<0||o>=this._mpegSamplingRates.length)this._onError(u.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var c=this._mpegSamplingRates[o],d=(120&r[1])>>>3;if(!(d<0||d>=8)){5===a&&(l=(7&r[1])<<1|r[2]>>>7,(124&r[2])>>>2);var h=self.navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?o>=6?(a=5,n=new Array(4),l=o-3):(a=2,n=new Array(2),l=o):-1!==h.indexOf("android")?(a=2,n=new Array(2),l=o):(a=5,l=o,n=new Array(4),o>=6?l=o-3:1===d&&(a=2,n=new Array(2),l=o)),n[0]=a<<3,n[0]|=(15&o)>>>1,n[1]=(15&o)<<7,n[1]|=(15&d)<<3,5===a&&(n[1]|=(15&l)>>>1,n[2]=(1&l)<<7,n[2]|=8,n[3]=0),{config:n,samplingRate:c,channelCount:d,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+s}}this._onError(u.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}}},{key:"_parseMP3AudioData",value:function(e,t,i,r){if(!(i<4)){this._littleEndian;var n=new Uint8Array(e,t,i),s=null;if(r){if(255!==n[0])return;var o=n[1]>>>3&3,u=(6&n[1])>>1,l=(240&n[2])>>>4,c=(12&n[2])>>>2,d=3!==(n[3]>>>6&3)?2:1,h=0,f=0;switch(o){case 0:h=this._mpegAudioV25SampleRateTable[c];break;case 2:h=this._mpegAudioV20SampleRateTable[c];break;case 3:h=this._mpegAudioV10SampleRateTable[c]}switch(u){case 1:34,l<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[l]);break;case 2:33,l<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[l]);break;case 3:32,l<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[l])}s={bitRate:f,samplingRate:h,channelCount:d,codec:"mp3",originalCodec:"mp3"}}else s=n;return s}a.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")}},{key:"_parseVideoData",value:function(e,t,i,r,n){if(i<=1)a.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(e,t,i)[0],o=(240&s)>>>4,l=15&s;7===l?this._parseAVCVideoPacket(e,t+1,i-1,r,n,o):this._onError(u.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+l)}}},{key:"_parseAVCVideoPacket",value:function(e,t,i,r,n,s){if(i<4)a.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var o=this._littleEndian,l=new DataView(e,t,i),c=l.getUint8(0),d=(16777215&l.getUint32(0,!o))<<8>>8;if(0===c)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===c)this._parseAVCVideoData(e,t+4,i-4,r,n,s,d);else if(2!==c)return void this._onError(u.default.FORMAT_ERROR,"Flv: Invalid video packet type "+c)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){if(i<7)a.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var r=this._videoMetadata,n=this._videoTrack,s=this._littleEndian,l=new DataView(e,t,i);r?void 0!==r.avcc&&a.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(r=this._videoMetadata={}).type="video",r.id=n.id,r.timescale=this._timescale,r.duration=this._duration);var c=l.getUint8(0),d=l.getUint8(1);l.getUint8(2),l.getUint8(3);if(1===c&&0!==d)if(this._naluLengthSize=1+(3&l.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&l.getUint8(5);if(0!==h){h>1&&a.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var f=6,p=0;p<h;p++){var m=l.getUint16(f,!s);if(f+=2,0!==m){var g=new Uint8Array(e,t+f,m);f+=m;var y=o.default.parseSPS(g);if(0===p){r.codecWidth=y.codec_size.width,r.codecHeight=y.codec_size.height,r.presentWidth=y.present_size.width,r.presentHeight=y.present_size.height,r.profile=y.profile_string,r.level=y.level_string,r.bitDepth=y.bit_depth,r.chromaFormat=y.chroma_format,r.sarRatio=y.sar_ratio,r.frameRate=y.frame_rate,!1!==y.frame_rate.fixed&&0!==y.frame_rate.fps_num&&0!==y.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var v=r.frameRate.fps_den,_=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(v/_);for(var b=g.subarray(1,4),T="avc1.",S=0;S<3;S++){var E=b[S].toString(16);E.length<2&&(E="0"+E),T+=E}r.codec=T;var k=this._mediaInfo;k.width=r.codecWidth,k.height=r.codecHeight,k.fps=r.frameRate.fps,k.profile=r.profile,k.level=r.level,k.refFrames=y.ref_frames,k.chromaFormat=y.chroma_format_string,k.sarNum=r.sarRatio.width,k.sarDen=r.sarRatio.height,k.videoCodec=T,k.hasAudio?null!=k.audioCodec&&(k.mimeType='video/x-flv; codecs="'+k.videoCodec+","+k.audioCodec+'"'):k.mimeType='video/x-flv; codecs="'+k.videoCodec+'"',k.isComplete()&&this._onMediaInfo(k)}}}var w=l.getUint8(f);if(0!==w){w>1&&a.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+w),f++;for(var A=0;A<w;A++){var L=l.getUint16(f,!s);f+=2,0!==L&&(f+=L)}r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(e,t,i),0),a.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}else this._onError(u.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(u.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(u.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(u.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"_parseAVCVideoData",value:function(e,t,i,r,n,s,o){for(var u=this._littleEndian,l=new DataView(e,t,i),c=[],d=0,h=0,f=this._naluLengthSize,p=this._timestampBase+r,m=1===s;h<i;){if(h+4>=i){a.default.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+h+", dataSize = "+i);break}var g=l.getUint32(h,!u);if(3===f&&(g>>>=8),g>i-f)return void a.default.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var y=31&l.getUint8(h+f);5===y&&(m=!0);var v=new Uint8Array(e,t+h,f+g),_={type:y,data:v};c.push(_),d+=v.byteLength,h+=f+g}if(c.length){var b=this._videoTrack,T={units:c,length:d,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(T.fileposition=n),b.samples.push(T),b.length+=d}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var r,n,a=(4&t[4])>>>2!=0,s=0!=(1&t[4]),o=(r=t,n=5,r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3]);return o<9?i:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:a,hasVideoTrack:s}}}]),e}();i.default=h},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("./exp-golomb.js"),s=(r=a,r&&r.__esModule?r:{default:r});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),r=new s.default(i);r.readByte();var n=r.readByte();r.readByte();var a=r.readByte();r.readUEG();var o=e.getProfileString(n),u=e.getLevelString(a),l=1,c=420,d=[0,420,422,444],h=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(l=r.readUEG())&&r.readBits(1),l<=3&&(c=d[l]),h=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var f=3!==l?8:12,p=0;p<f;p++)r.readBool()&&(p<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var m=r.readUEG();if(0===m)r.readUEG();else if(1===m){r.readBits(1),r.readSEG(),r.readSEG();for(var g=r.readUEG(),y=0;y<g;y++)r.readSEG()}var v=r.readUEG();r.readBits(1);var _=r.readUEG(),b=r.readUEG(),T=r.readBits(1);0===T&&r.readBits(1),r.readBits(1);var S=0,E=0,k=0,w=0;r.readBool()&&(S=r.readUEG(),E=r.readUEG(),k=r.readUEG(),w=r.readUEG());var A=1,L=1,C=0,R=!0,O=0,D=0;if(r.readBool()){if(r.readBool()){var I=r.readByte();I>0&&I<16?(A=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][I-1],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][I-1]):255===I&&(A=r.readByte()<<8|r.readByte(),L=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var P=r.readBits(32),x=r.readBits(32);R=r.readBool(),C=(O=x)/(D=2*P)}}var M=1;1===A&&1===L||(M=A/L);var U=0,N=0;if(0===l)U=1,N=2-T;else{U=3===l?1:2,N=(1===l?2:1)*(2-T)}var B=16*(_+1),F=16*(b+1)*(2-T);B-=(S+E)*U,F-=(k+w)*N;var j=Math.ceil(B*M);return r.destroy(),r=null,{profile_string:o,level_string:u,bit_depth:h,ref_frames:v,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:R,fps:C,fps_den:D,fps_num:O},sar_ratio:{width:A,height:L},codec_size:{width:B,height:F},present_size:{width:j,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();i.default=o},{"./exp-golomb.js":17}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=f(e("./utils/polyfill.js")),a=f(e("./core/features.js")),s=e("./io/loader.js"),o=f(e("./player/flv-player.js")),u=f(e("./player/native-player.js")),l=f(e("./player/player-events.js")),c=e("./player/player-errors.js"),d=f(e("./utils/logging-control.js")),h=e("./utils/exception.js");function f(e){return e&&e.__esModule?e:{default:e}}n.default.install();var p={};p.createPlayer=function(e,t){var i=e;if(null==i||"object"!==(void 0===i?"undefined":r(i)))throw new h.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!i.hasOwnProperty("type"))throw new h.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(i.type){case"flv":return new o.default(i,t);default:return new u.default(i,t)}},p.isSupported=function(){return a.default.supportMSEH264Playback()},p.getFeatureList=function(){return a.default.getFeatureList()},p.BaseLoader=s.BaseLoader,p.LoaderStatus=s.LoaderStatus,p.LoaderErrors=s.LoaderErrors,p.Events=l.default,p.ErrorTypes=c.ErrorTypes,p.ErrorDetails=c.ErrorDetails,p.FlvPlayer=o.default,p.NativePlayer=u.default,p.LoggingControl=d.default,Object.defineProperty(p,"version",{enumerable:!0,get:function(){return"1.4.2"}}),i.default=p},{"./core/features.js":6,"./io/loader.js":24,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,t,i){"use strict";t.exports=e("./flv.js").default},{"./flv.js":20}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=(u(e("../utils/logger.js")),u(e("../utils/browser.js"))),s=e("./loader.js"),o=e("../utils/exception.js");function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.BaseLoader),n(t,null,[{key:"isSupported",value:function(){try{var e=a.default.msedge&&a.default.version.minor>=15048,t=!a.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]);function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));return r.TAG="FetchStreamLoader",r._seekHandler=e,r._config=i,r._needStash=!0,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return n(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var i=this;this._dataSource=e,this._range=t;var n=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(n=e.redirectedURL);var a=this._seekHandler.getConfig(n,t),u=new self.Headers;if("object"===r(a.headers)){var l=a.headers;for(var c in l)l.hasOwnProperty(c)&&u.append(c,l[c])}var d={method:"GET",headers:u,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===r(this._config.headers))for(var h in this._config.headers)u.append(h,this._config.headers[h]);!1===e.cors&&(d.mode="same-origin"),e.withCredentials&&(d.credentials="include"),e.referrerPolicy&&(d.referrerPolicy=e.referrerPolicy),this._status=s.LoaderStatus.kConnecting,self.fetch(a.url,d).then(function(e){if(i._requestAbort)return i._requestAbort=!1,void(i._status=s.LoaderStatus.kIdle);if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==a.url&&i._onURLRedirect){var t=i._seekHandler.removeURLParameters(e.url);i._onURLRedirect(t)}var r=e.headers.get("Content-Length");return null!=r&&(i._contentLength=parseInt(r),0!==i._contentLength&&i._onContentLengthKnown&&i._onContentLengthKnown(i._contentLength)),i._pump.call(i,e.body.getReader())}if(i._status=s.LoaderStatus.kError,!i._onError)throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);i._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}).catch(function(e){if(i._status=s.LoaderStatus.kError,!i._onError)throw e;i._onError(s.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(i){if(i.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=s.LoaderStatus.kError;var r=s.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new o.RuntimeException(n.msg);t._onError(r,n)}else t._status=s.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(!0===t._requestAbort)return t._requestAbort=!1,t._status=s.LoaderStatus.kComplete,e.cancel();t._status=s.LoaderStatus.kBuffering;var a=i.value.buffer,u=t._range.from+t._receivedLength;t._receivedLength+=a.byteLength,t._onDataArrival&&t._onDataArrival(a,u,t._receivedLength),t._pump(e)}}).catch(function(e){if(11!==e.code||!a.default.msedge){t._status=s.LoaderStatus.kError;var i=0,r=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(i=s.LoaderErrors.EXCEPTION,r={code:e.code,msg:e.message}):(i=s.LoaderErrors.EARLY_EOF,r={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new o.RuntimeException(r.msg);t._onError(i,r)}})}}]),t}();i.default=l},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=p(e("../utils/logger.js")),a=p(e("./speed-sampler.js")),s=e("./loader.js"),o=p(e("./fetch-stream-loader.js")),u=p(e("./xhr-moz-chunked-loader.js")),l=(p(e("./xhr-msstream-loader.js")),p(e("./xhr-range-loader.js"))),c=p(e("./websocket-loader.js")),d=p(e("./range-seek-handler.js")),h=p(e("./param-seek-handler.js")),f=e("../utils/exception.js");function p(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="IOController",this._config=i,this._extraData=r,this._stashInitialSize=393216,void 0!=i.stashInitialSize&&i.stashInitialSize>0&&(this._stashInitialSize=i.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===i.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new a.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return r(e,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new d.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",i=e.seekParamEnd||"bend";this._seekHandler=new h.default(t,i)}else{if("custom"!==e.seekType)throw new f.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new f.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}},{key:"_selectLoader",value:function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=c.default;else if(o.default.isSupported())this._loaderClass=o.default;else if(u.default.isSupported())this._loaderClass=u.default;else{if(!l.default.isSupported())throw new f.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=l.default}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var i={from:e,to:-1};this._currentRange={from:i.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,i),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new f.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var i=new ArrayBuffer(t);if(this._stashUsed>0){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,t).set(r,0)}this._stashBuffer=i,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,i=t.length-1,r=0,n=0,a=i;if(e<t[0])return t[0];for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?n=r+1:a=r-1}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var i=1024*t+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,i){if(!this._onDataArrival)throw new f.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var r=this._speedSampler.lastSecondKBps;if(0!==r){var n=this._normalizeSpeed(r);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){new Uint8Array(this._stashBuffer,0,this._stashSize).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var a=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),o=this._dispatchChunks(s,this._stashByteStart);if(o<s.byteLength){if(o>0){var u=new Uint8Array(s,o);a.set(u,0),this._stashUsed=u.byteLength,this._stashByteStart+=o}}else this._stashUsed=0,this._stashByteStart+=o;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var l=this._dispatchChunks(e,t);if(l<e.byteLength){var c=e.byteLength-l;c>this._bufferSize&&(this._expandBuffer(c),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(e,l),0),this._stashUsed+=c,this._stashByteStart=t+l}}}else if(0===this._stashUsed){var d=this._dispatchChunks(e,t);if(d<e.byteLength){var h=e.byteLength-d;h>this._bufferSize&&this._expandBuffer(h);new Uint8Array(this._stashBuffer,0,this._bufferSize).set(new Uint8Array(e,d),0),this._stashUsed+=h,this._stashByteStart=t+d}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var p=new Uint8Array(this._stashBuffer,0,this._bufferSize);p.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var m=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(m<this._stashUsed&&m>0){var g=new Uint8Array(this._stashBuffer,m);p.set(g,0)}this._stashUsed-=m,this._stashByteStart+=m}}}},{key:"_flushStashBuffer",value:function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),i=this._dispatchChunks(t,this._stashByteStart),r=t.byteLength-i;if(i<t.byteLength){if(!e){if(i>0){var a=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(t,i);a.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=i}return 0}n.default.w(this.TAG,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(e,t){switch(n.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=s.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case s.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var i=this._currentRange.to+1;return void(i<this._totalLength&&(n.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(i,!1)))}e=s.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case s.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case s.LoaderErrors.CONNECTING_TIMEOUT:case s.LoaderErrors.HTTP_STATUS_CODE_INVALID:case s.LoaderErrors.EXCEPTION:}if(!this._onError)throw new f.RuntimeException("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||void 0!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),e}();i.default=m},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BaseLoader=i.LoaderErrors=i.LoaderStatus=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=e("../utils/exception.js");var a=i.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};i.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},i.BaseLoader=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t||"undefined",this._status=a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return r(e,[{key:"destroy",value:function(){this._status=a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===a.kConnecting||this._status===a.kBuffering}},{key:"open",value:function(e,t){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new n.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}()},{"../utils/exception.js":40}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._startName=t,this._endName=i}return r(e,[{key:"getConfig",value:function(e,t){var i=e;if(0!==t.from||-1!==t.to){var r=!0;-1===i.indexOf("?")&&(i+="?",r=!1),r&&(i+="&"),i+=this._startName+"="+t.from.toString(),-1!==t.to&&(i+="&"+this._endName+"="+t.to.toString())}return{url:i,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],i=void 0,r=e.indexOf("?");-1!==r&&(i=e.substring(r+1));var n="";if(void 0!=i&&i.length>0)for(var a=i.split("&"),s=0;s<a.length;s++){var o=a[s].split("="),u=s>0;o[0]!==this._startName&&o[0]!==this._endName&&(u&&(n+="&"),n+=a[s])}return 0===n.length?t:t+"?"+n}}]),e}();i.default=n},{}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._zeroStart=t||!1}return r(e,[{key:"getConfig",value:function(e,t){var i={};if(0!==t.from||-1!==t.to){var r=void 0;r=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",i.Range=r}else this._zeroStart&&(i.Range="bytes=0-");return{url:e,headers:i}}},{key:"removeURLParameters",value:function(e){return e}}]),e}();i.default=n},{}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return r(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();i.default=n},{}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("../utils/logger.js"),s=(r=a,r&&r.__esModule,e("./loader.js")),o=e("../utils/exception.js");var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.BaseLoader),n(t,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket}catch(e){return!1}}}]);function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return n(t,[{key:"destroy",value:function(){this._ws&&this.abort(),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=s.LoaderStatus.kConnecting}catch(e){this._status=s.LoaderStatus.kError;var i={code:e.code,msg:e.message};if(!this._onError)throw new o.RuntimeException(i.msg);this._onError(s.LoaderErrors.EXCEPTION,i)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=s.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._status=s.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?(this._status=s.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}else{this._status=s.LoaderStatus.kError;var r={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new o.RuntimeException(r.msg);this._onError(s.LoaderErrors.EXCEPTION,r)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,i=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){this._status=s.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new o.RuntimeException(t.msg);this._onError(s.LoaderErrors.EXCEPTION,t)}}]),t}();i.default=u},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=e("../utils/logger.js"),o=(r=s,r&&r.__esModule?r:{default:r}),u=e("./loader.js"),l=e("../utils/exception.js");var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.BaseLoader),a(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return o.default.w("MozChunkedLoader",e.message),!1}}}]);function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-moz-chunked-loader"));return r.TAG="MozChunkedLoader",r._seekHandler=e,r._config=i,r._needStash=!0,r._xhr=null,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return a(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(i=e.redirectedURL);var r=this._seekHandler.getConfig(i,t);this._requestURL=r.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",r.url,!0),a.responseType="moz-chunked-arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onloadend=this._onLoadEnd.bind(this),a.onerror=this._onXhrError.bind(this),e.withCredentials&&(a.withCredentials=!0),"object"===n(r.headers)){var s=r.headers;for(var o in s)s.hasOwnProperty(o)&&a.setRequestHeader(o,s[o])}if("object"===n(this._config.headers)){var l=this._config.headers;for(var c in l)l.hasOwnProperty(c)&&a.setRequestHeader(c,l[c])}this._status=u.LoaderStatus.kConnecting,a.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=u.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(i)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=u.LoaderStatus.kError,!this._onError)throw new l.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=u.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==u.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){!0!==this._requestAbort?this._status!==u.LoaderStatus.kError&&(this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1}},{key:"_onXhrError",value:function(e){this._status=u.LoaderStatus.kError;var t=0,i=null;if(this._contentLength&&e.loaded<this._contentLength?(t=u.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=u.LoaderErrors.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}}]),t}();i.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=e("../utils/logger.js"),o=(r=s,r&&r.__esModule?r:{default:r}),u=e("./loader.js"),l=e("../utils/exception.js");var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.BaseLoader),a(t,null,[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="ms-stream","ms-stream"===e.responseType}catch(e){return o.default.w("MSStreamLoader",e.message),!1}}}]);function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-msstream-loader"));return r.TAG="MSStreamLoader",r._seekHandler=e,r._config=i,r._needStash=!0,r._xhr=null,r._reader=null,r._totalRange=null,r._currentRange=null,r._currentRequestURL=null,r._currentRedirectedURL=null,r._contentLength=null,r._receivedLength=0,r._bufferLimit=16777216,r._lastTimeBufferSize=0,r._isReconnecting=!1,r}return a(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._internalOpen(e,t,!1)}},{key:"_internalOpen",value:function(e,t,i){this._dataSource=e,i?this._currentRange=t:this._totalRange=t;var r=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?r=this._currentRedirectedURL:void 0!=e.redirectedURL&&(r=e.redirectedURL));var a=this._seekHandler.getConfig(r,t);this._currentRequestURL=a.url;var s=this._reader=new self.MSStreamReader;s.onprogress=this._msrOnProgress.bind(this),s.onload=this._msrOnLoad.bind(this),s.onerror=this._msrOnError.bind(this);var o=this._xhr=new XMLHttpRequest;if(o.open("GET",a.url,!0),o.responseType="ms-stream",o.onreadystatechange=this._xhrOnReadyStateChange.bind(this),o.onerror=this._xhrOnError.bind(this),e.withCredentials&&(o.withCredentials=!0),"object"===n(a.headers)){var l=a.headers;for(var c in l)l.hasOwnProperty(c)&&o.setRequestHeader(c,l[c])}if("object"===n(this._config.headers)){var d=this._config.headers;for(var h in d)d.hasOwnProperty(h)&&o.setRequestHeader(h,d[h])}this._isReconnecting?this._isReconnecting=!1:this._status=u.LoaderStatus.kConnecting,o.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=u.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState)if(t.status>=200&&t.status<=299){if(this._status=u.LoaderStatus.kBuffering,void 0!=t.responseURL){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}var r=t.getResponseHeader("Content-Length");if(null!=r&&null==this._contentLength){var n=parseInt(r);n>0&&(this._contentLength=n,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=u.LoaderStatus.kError,!this._onError)throw new l.RuntimeException("MSStreamLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else if(3===t.readyState&&t.status>=200&&t.status<=299){this._status=u.LoaderStatus.kBuffering;var a=t.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(e){this._status=u.LoaderStatus.kError;var t=u.LoaderErrors.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}},{key:"_msrOnProgress",value:function(e){var t=e.target.result;if(null!=t){var i=t.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=t.byteLength;var r=this._totalRange.from+this._receivedLength;this._receivedLength+=i.byteLength,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),t.byteLength>=this._bufferLimit&&(o.default.v(this.TAG,"MSStream buffer exceeded max size near "+(r+i.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var e={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,e,!0)}}},{key:"_msrOnLoad",value:function(e){this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(e){this._status=u.LoaderStatus.kError;var t=0,i=null;if(this._contentLength&&this._receivedLength<this._contentLength?(t=u.LoaderErrors.EARLY_EOF,i={code:-1,msg:"MSStream meet Early-Eof"}):(t=u.LoaderErrors.EARLY_EOF,i={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}}]),t}();i.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=l(e("../utils/logger.js")),s=l(e("./speed-sampler.js")),o=e("./loader.js"),u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.BaseLoader),n(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return a.default.w("RangeLoader",e.message),!1}}}]);function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-range-loader"));return r.TAG="RangeLoader",r._seekHandler=e,r._config=i,r._needStash=!1,r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],r._currentChunkSizeKB=384,r._currentSpeedNormalized=0,r._zeroSpeedChunkCount=0,r._xhr=null,r._speedSampler=new s.default,r._requestAbort=!1,r._waitForTotalLength=!1,r._totalLengthReceived=!1,r._currentRequestURL=null,r._currentRedirectedURL=null,r._currentRequestRange=null,r._totalLength=null,r._contentLength=null,r._receivedLength=0,r._lastTimeLoaded=0,r}return n(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=o.LoaderStatus.kConnecting;var i=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(i=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||i?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,i=t+e;null!=this._contentLength&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var i=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?i=this._currentRedirectedURL:void 0!=e.redirectedURL&&(i=e.redirectedURL));var n=this._seekHandler.getConfig(i,t);this._currentRequestURL=n.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",n.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),e.withCredentials&&(a.withCredentials=!0),"object"===r(n.headers)){var s=n.headers;for(var o in s)s.hasOwnProperty(o)&&a.setRequestHeader(o,s[o])}if("object"===r(this._config.headers)){var u=this._config.headers;for(var l in u)u.hasOwnProperty(l)&&a.setRequestHeader(l,u[l])}a.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else{if(this._status=o.LoaderStatus.kError,!this._onError)throw new u.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==o.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var i=e.total;this._internalAbort(),null!=i&0!==i&&(this._totalLength=i)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var r=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(r)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,i=t.length-1,r=0,n=0,a=i;if(e<t[0])return t[0];for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?n=r+1:a=r-1}}},{key:"_onLoad",value:function(e){if(this._status!==o.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var i=this._normalizeSpeed(t);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var r=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(r,n,this._receivedLength),a&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=o.LoaderStatus.kError;var t=0,i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=o.LoaderErrors.EARLY_EOF,i={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=o.LoaderErrors.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new u.RuntimeException(i.msg);this._onError(t,i)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),t}();i.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=g(e("events")),s=g(e("../utils/logger.js")),o=g(e("../utils/browser.js")),u=g(e("./player-events.js")),l=g(e("../core/transmuxer.js")),c=g(e("../core/transmuxing-events.js")),d=g(e("../core/mse-controller.js")),h=g(e("../core/mse-events.js")),f=e("./player-errors.js"),p=e("../config.js"),m=e("../utils/exception.js");function g(e){return e&&e.__esModule?e:{default:e}}var y=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new a.default,this._config=(0,p.createDefaultConfig)(),"object"===(void 0===i?"undefined":r(i))&&Object.assign(this._config,i),"flv"!==t.type.toLowerCase())throw new m.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===t.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=t,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var n=o.default.chrome&&(o.default.version.major<50||50===o.default.version.major&&o.default.version.build<2661);this._alwaysSeekKeyframe=!!(n||o.default.msedge||o.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return n(e,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var i=this;e===u.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){i._emitter.emit(u.default.MEDIA_INFO,i.mediaInfo)}):e===u.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){i._emitter.emit(u.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new d.default(this._config),this._msectl.on(h.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(h.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(h.default.SOURCE_OPEN,function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on(h.default.ERROR,function(e){t._emitter.emit(u.default.ERROR,f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_MSE_ERROR,e)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var e=this;if(!this._mediaElement)throw new m.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new m.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(c.default.INIT_SEGMENT,function(t,i){e._msectl.appendInitSegment(i)}),this._transmuxer.on(c.default.MEDIA_SEGMENT,function(t,i){if(e._msectl.appendMediaSegment(i),e._config.lazyLoad&&!e._config.isLive){var r=e._mediaElement.currentTime;i.info.endDts>=1e3*(r+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(s.default.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}}),this._transmuxer.on(c.default.LOADING_COMPLETE,function(){e._msectl.endOfStream(),e._emitter.emit(u.default.LOADING_COMPLETE)}),this._transmuxer.on(c.default.RECOVERED_EARLY_EOF,function(){e._emitter.emit(u.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(c.default.IO_ERROR,function(t,i){e._emitter.emit(u.default.ERROR,f.ErrorTypes.NETWORK_ERROR,t,i)}),this._transmuxer.on(c.default.DEMUX_ERROR,function(t,i){e._emitter.emit(u.default.ERROR,f.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:i})}),this._transmuxer.on(c.default.MEDIA_INFO,function(t){e._mediaInfo=t,e._emitter.emit(u.default.MEDIA_INFO,Object.assign({},t))}),this._transmuxer.on(c.default.METADATA_ARRIVED,function(t){e._emitter.emit(u.default.METADATA_ARRIVED,t)}),this._transmuxer.on(c.default.SCRIPTDATA_ARRIVED,function(t){e._emitter.emit(u.default.SCRIPTDATA_ARRIVED,t)}),this._transmuxer.on(c.default.STATISTICS_INFO,function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(u.default.STATISTICS_INFO,Object.assign({},e._statisticsInfo))}),this._transmuxer.on(c.default.RECOMMEND_SEEKPOINT,function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)}),this._transmuxer.open()))}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,i=0,r=0;r<e.length;r++){var n=e.start(r),a=e.end(r);if(n<=t&&t<a){n,i=a;break}}i>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(s.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){s.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,i=!1,r=0;r<t.length;r++){var n=t.start(r),a=t.end(r);if(e>=n&&e<a){e>=a-this._config.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this._progressChecker),this._progressChecker=null,i&&(s.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(e>=r&&e<n)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),i=!1,r=0;if(e<1&&this._mediaElement.buffered.length>0){var n=this._mediaElement.buffered.start(0);(n<1&&e<n||o.default.safari)&&(i=!0,r=o.default.safari?.1:n)}if(i)this._requestSetTime=!0,this._mediaElement.currentTime=r;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var i=t.buffered;i.length>0&&t.currentTime<i.start(0)&&(s.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+i.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=i.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,i=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&i.length>0){var r=i.start(0);if(r<1&&t<r||o.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=o.default.safari?.1:r)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=n&&(this._requestSetTime=!0,this._mediaElement.currentTime=n.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),e}();i.default=y},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=l(e("events")),s=l(e("./player-events.js")),o=e("../config.js"),u=e("../utils/exception.js");function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new a.default,this._config=(0,o.createDefaultConfig)(),"object"===(void 0===i?"undefined":r(i))&&Object.assign(this._config,i),"flv"===t.type.toLowerCase())throw new u.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(t.hasOwnProperty("segments"))throw new u.InvalidArgumentException("NativePlayer("+t.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=t,this._mediaElement=null}return n(e,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var i=this;e===s.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(s.default.MEDIA_INFO,i.mediaInfo)}):e===s.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(s.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new u.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(s.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(s.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e}}]),e}();i.default=c},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ErrorDetails=i.ErrorTypes=void 0;var r,n=e("../io/loader.js"),a=e("../demux/demux-errors.js"),s=(r=a,r&&r.__esModule?r:{default:r});i.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},i.ErrorDetails={NETWORK_EXCEPTION:n.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:n.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:n.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:n.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:s.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:s.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:s.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},{}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();i.default=n},{}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=e.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,i=null,r=Array.prototype.slice.call(arguments,1),n=r.length,a=0;a<n;a++)t+=r[a].byteLength;(i=new Uint8Array(t))[0]=t>>>24&255,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i.set(e,4);for(var s=8,o=0;o<n;o++)i.set(r[o],s),s+=r[o].byteLength;return i}},{key:"generateInitSegment",value:function(t){var i=e.box(e.types.ftyp,e.constants.FTYP),r=e.moov(t),n=new Uint8Array(i.byteLength+r.byteLength);return n.set(i,0),n.set(r,i.byteLength),n}},{key:"moov",value:function(t){var i=e.mvhd(t.timescale,t.duration),r=e.trak(t),n=e.mvex(t);return e.box(e.types.moov,i,r,n)}},{key:"mvhd",value:function(t,i){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var i=t.id,r=t.duration,n=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var i=t.timescale,r=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))}},{key:"hdlr",value:function(t){var i=null;return i="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,i)}},{key:"minf",value:function(t){var i=null;return i="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,i,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var i=t.channelCount,r=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types[".mp3"],n)}},{key:"mp4a",value:function(t){var i=t.channelCount,r=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types.mp4a,n,e.esds(t))}},{key:"esds",value:function(t){var i=t.config||[],r=i.length,n=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(i).concat([6,1,2]));return e.box(e.types.esds,n)}},{key:"avc1",value:function(t){var i=t.avcc,r=t.codecWidth,n=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,i))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var i=t.id,r=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,r)}},{key:"moof",value:function(t,i){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,i))}},{key:"mfhd",value:function(t){var i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,i)}},{key:"traf",value:function(t,i){var r=t.id,n=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=e.sdtp(t),o=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,n,a,o,s)}},{key:"sdtp",value:function(t){for(var i=t.samples||[],r=i.length,n=new Uint8Array(4+r),a=0;a<r;a++){var s=i[a].flags;n[a+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,n)}},{key:"trun",value:function(t,i){var r=t.samples||[],n=r.length,a=12+16*n,s=new Uint8Array(a);i+=8+a,s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var o=0;o<n;o++){var u=r[o].duration,l=r[o].size,c=r[o].flags,d=r[o].cts;s.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*o)}return e.box(e.types.trun,s)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();n.init(),i.default=n},{}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=c(e("../utils/logger.js")),a=c(e("./mp4-generator.js")),s=c(e("./aac-silent.js")),o=c(e("../utils/browser.js")),u=e("../core/media-segment-info.js"),l=e("../utils/exception.js");function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="MP4Remuxer",this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new u.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new u.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!o.default.chrome||!(o.default.version.major<50||50===o.default.version.major&&o.default.version.build<2661)),this._fillSilentAfterSeek=o.default.msedge||o.default.msie,this._mp3UseMpegAudio=!o.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return r(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var i=null,r="mp4",n=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(r="mpeg",n="",i=new Uint8Array):i=a.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,i=a.default.generateInitSegment(t)}if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:i.buffer,codec:n,container:e+"/"+r,mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(i.samples.push(e),i.length=e.length);var r={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(r.samples.push(t),r.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(r,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var i=e,r=i.samples,l=void 0,c=-1,d=-1,h=this._audioMeta.refSampleDuration,f="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,p=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(r&&0!==r.length&&(1!==r.length||t)){var g=0,y=null,v=0;f?(g=0,v=i.length):(g=8,v=8+i.length);var _=null;if(r.length>1&&(v-=(_=r.pop()).length),null!=this._audioStashedLastSample){var b=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(b),v+=b.length}null!=_&&(this._audioStashedLastSample=_);var T=r[0].dts-this._dtsBase;if(this._audioNextDts)l=T-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())l=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var S=this._audioSegmentInfoList.getLastSampleBefore(T);if(null!=S){var E=T-(S.originalDts+S.duration);E<=3&&(E=0);l=T-(S.dts+S.duration+E)}else l=0}if(m){var k=T-l,w=this._videoSegmentInfoList.getLastSegmentBefore(T);if(null!=w&&w.beginDts<k){var A=s.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(A){var L=w.beginDts,C=k-w.beginDts;n.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+L+", duration: "+C),r.unshift({unit:A,dts:L,pts:L}),v+=A.byteLength}}else m=!1}for(var R=[],O=0;O<r.length;O++){var D=r[O],I=D.unit,P=D.dts-this._dtsBase,x=P-l;-1===c&&(c=x);var M=0;if(O!==r.length-1){M=r[O+1].dts-this._dtsBase-l-x}else if(null!=_){M=_.dts-this._dtsBase-l-x}else M=R.length>=1?R[R.length-1].duration:Math.floor(h);var U=!1,N=null;if(M>1.5*h&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!o.default.safari){U=!0;var B=Math.abs(M-h),F=Math.ceil(B/h),j=x+h;n.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: "+(x+M)+" ms, expected: "+(x+Math.round(h))+" ms, delta: "+Math.round(B)+" ms, generate: "+F+" frames");var G=s.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==G&&(n.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),G=I),N=[];for(var V=0;V<F;V++){var H=Math.round(j);if(N.length>0){var z=N[N.length-1];z.duration=H-z.dts}var W={dts:H,pts:H,cts:0,unit:G,size:G.byteLength,duration:0,originalDts:P,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};N.push(W),v+=W.size,j+=h}var q=N[N.length-1];q.duration=x+M-q.dts,M=Math.round(h)}R.push({dts:x,pts:x,cts:0,unit:D.unit,size:D.unit.byteLength,duration:M,originalDts:P,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),U&&R.push.apply(R,N)}f?y=new Uint8Array(v):((y=new Uint8Array(v))[0]=v>>>24&255,y[1]=v>>>16&255,y[2]=v>>>8&255,y[3]=255&v,y.set(a.default.types.mdat,4));for(var K=0;K<R.length;K++){var X=R[K].unit;y.set(X,g),g+=X.byteLength}var Y=R[R.length-1];d=Y.dts+Y.duration,this._audioNextDts=d;var $=new u.MediaSegmentInfo;$.beginDts=c,$.endDts=d,$.beginPts=c,$.endPts=d,$.originalBeginDts=R[0].originalDts,$.originalEndDts=Y.originalDts+Y.duration,$.firstSample=new u.SampleInfo(R[0].dts,R[0].pts,R[0].duration,R[0].originalDts,!1),$.lastSample=new u.SampleInfo(Y.dts,Y.pts,Y.duration,Y.originalDts,!1),this._isLive||this._audioSegmentInfoList.append($),i.samples=R,i.sequenceNumber++;var Q=null;Q=f?new Uint8Array:a.default.moof(i,c),i.samples=[],i.length=0;var J={type:"audio",data:this._mergeBoxes(Q,y).buffer,sampleCount:R.length,info:$};f&&p&&(J.timestampOffset=c),this._onMediaSegment("audio",J)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var i=e,r=i.samples,n=void 0,s=-1,o=-1,l=-1,c=-1;if(r&&0!==r.length&&(1!==r.length||t)){var d=8,h=null,f=8+e.length,p=null;if(r.length>1&&(f-=(p=r.pop()).length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,r.unshift(m),f+=m.length}null!=p&&(this._videoStashedLastSample=p);var g=r[0].dts-this._dtsBase;if(this._videoNextDts)n=g-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())n=0;else{var y=this._videoSegmentInfoList.getLastSampleBefore(g);if(null!=y){var v=g-(y.originalDts+y.duration);v<=3&&(v=0);n=g-(y.dts+y.duration+v)}else n=0}for(var _=new u.MediaSegmentInfo,b=[],T=0;T<r.length;T++){var S=r[T],E=S.dts-this._dtsBase,k=S.isKeyframe,w=E-n,A=S.cts,L=w+A;-1===s&&(s=w,l=L);var C=0;if(T!==r.length-1){C=r[T+1].dts-this._dtsBase-n-w}else if(null!=p){C=p.dts-this._dtsBase-n-w}else C=b.length>=1?b[b.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(k){var R=new u.SampleInfo(w,L,C,S.dts,!0);R.fileposition=S.fileposition,_.appendSyncPoint(R)}b.push({dts:w,pts:L,cts:A,units:S.units,size:S.length,isKeyframe:k,duration:C,originalDts:E,flags:{isLeading:0,dependsOn:k?2:1,isDependedOn:k?1:0,hasRedundancy:0,isNonSync:k?0:1}})}(h=new Uint8Array(f))[0]=f>>>24&255,h[1]=f>>>16&255,h[2]=f>>>8&255,h[3]=255&f,h.set(a.default.types.mdat,4);for(var O=0;O<b.length;O++)for(var D=b[O].units;D.length;){var I=D.shift().data;h.set(I,d),d+=I.byteLength}var P=b[b.length-1];if(o=P.dts+P.duration,c=P.pts+P.duration,this._videoNextDts=o,_.beginDts=s,_.endDts=o,_.beginPts=l,_.endPts=c,_.originalBeginDts=b[0].originalDts,_.originalEndDts=P.originalDts+P.duration,_.firstSample=new u.SampleInfo(b[0].dts,b[0].pts,b[0].duration,b[0].originalDts,b[0].isKeyframe),_.lastSample=new u.SampleInfo(P.dts,P.pts,P.duration,P.originalDts,P.isKeyframe),this._isLive||this._videoSegmentInfoList.append(_),i.samples=b,i.sequenceNumber++,this._forceFirstIDR){var x=b[0].flags;x.dependsOn=2,x.isNonSync=0}var M=a.default.moof(i,s);i.samples=[],i.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(M,h).buffer,sampleCount:b.length,info:_})}}}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}();i.default=d},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(n.browser){a[n.browser]=!0;var s=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}n.platform&&(a[n.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,n.browser="msie",a.msie=!0);a.edge&&(delete a.edge,n.browser="msedge",a.msedge=!0);a.opr&&(n.browser="opera",a.opera=!0);a.safari&&a.android&&(n.browser="android",a.android=!0);a.name=n.browser,a.platform=n.platform;for(var o in r)r.hasOwnProperty(o)&&delete r[o];Object.assign(r,a)}(),i.default=r},{}],40:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=i.RuntimeException=function(){function e(t){s(this,e),this._message=t}return r(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}();i.IllegalStateException=function(e){a(t,o);function t(e){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,[{key:"name",get:function(){return"IllegalStateException"}}]),t}(),i.InvalidArgumentException=function(e){a(t,o);function t(e){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,[{key:"name",get:function(){return"InvalidArgumentException"}}]),t}(),i.NotImplementedException=function(e){a(t,o);function t(e){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,[{key:"name",get:function(){return"NotImplementedException"}}]),t}()},{}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("events"),s=(r=a,r&&r.__esModule?r:{default:r});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"e",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",r),e.ENABLE_ERROR&&(console.error?console.error(r):console.warn?console.warn(r):console.log(r))}},{key:"i",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",r),e.ENABLE_INFO&&(console.info?console.info(r):console.log(r))}},{key:"w",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",r),e.ENABLE_WARN&&(console.warn?console.warn(r):console.log(r))}},{key:"d",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",r),e.ENABLE_DEBUG&&(console.debug?console.debug(r):console.log(r))}},{key:"v",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",r),e.ENABLE_VERBOSE&&console.log(r)}}]),e}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new s.default,i.default=o},{events:2}],42:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=s(e("events")),a=s(e("./logger.js"));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getConfig",value:function(){return{globalTag:a.default.GLOBAL_TAG,forceGlobalTag:a.default.FORCE_GLOBAL_TAG,enableVerbose:a.default.ENABLE_VERBOSE,enableDebug:a.default.ENABLE_DEBUG,enableInfo:a.default.ENABLE_INFO,enableWarn:a.default.ENABLE_WARN,enableError:a.default.ENABLE_ERROR,enableCallback:a.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){a.default.GLOBAL_TAG=e.globalTag,a.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,a.default.ENABLE_VERBOSE=e.enableVerbose,a.default.ENABLE_DEBUG=e.enableDebug,a.default.ENABLE_INFO=e.enableInfo,a.default.ENABLE_WARN=e.enableWarn,a.default.ENABLE_ERROR=e.enableError,a.default.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var t=e.emitter;if(t.listenerCount("change")>0){var i=e.getConfig();t.emit("change",i)}}},{key:"registerListener",value:function(t){e.emitter.addListener("change",t)}},{key:"removeListener",value:function(t){e.emitter.removeListener("change",t)}},{key:"addLogListener",value:function(t){a.default.emitter.addListener("log",t),a.default.emitter.listenerCount("log")>0&&(a.default.ENABLE_CALLBACK=!0,e._notifyChange())}},{key:"removeLogListener",value:function(t){a.default.emitter.removeListener("log",t),0===a.default.emitter.listenerCount("log")&&(a.default.ENABLE_CALLBACK=!1,e._notifyChange())}},{key:"forceGlobalTag",get:function(){return a.default.FORCE_GLOBAL_TAG},set:function(t){a.default.FORCE_GLOBAL_TAG=t,e._notifyChange()}},{key:"globalTag",get:function(){return a.default.GLOBAL_TAG},set:function(t){a.default.GLOBAL_TAG=t,e._notifyChange()}},{key:"enableAll",get:function(){return a.default.ENABLE_VERBOSE&&a.default.ENABLE_DEBUG&&a.default.ENABLE_INFO&&a.default.ENABLE_WARN&&a.default.ENABLE_ERROR},set:function(t){a.default.ENABLE_VERBOSE=t,a.default.ENABLE_DEBUG=t,a.default.ENABLE_INFO=t,a.default.ENABLE_WARN=t,a.default.ENABLE_ERROR=t,e._notifyChange()}},{key:"enableDebug",get:function(){return a.default.ENABLE_DEBUG},set:function(t){a.default.ENABLE_DEBUG=t,e._notifyChange()}},{key:"enableVerbose",get:function(){return a.default.ENABLE_VERBOSE},set:function(t){a.default.ENABLE_VERBOSE=t,e._notifyChange()}},{key:"enableInfo",get:function(){return a.default.ENABLE_INFO},set:function(t){a.default.ENABLE_INFO=t,e._notifyChange()}},{key:"enableWarn",get:function(){return a.default.ENABLE_WARN},set:function(t){a.default.ENABLE_WARN=t,e._notifyChange()}},{key:"enableError",get:function(){return a.default.ENABLE_ERROR},set:function(t){a.default.ENABLE_ERROR=t,e._notifyChange()}}]),e}();o.emitter=new n.default,i.default=o},{"./logger.js":41,events:2}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(void 0!==r&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t},"function"!=typeof self.Promise&&e("es6-promise").polyfill()}}]),t}();n.install(),i.default=n},{"es6-promise":1}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});function r(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}i.default=function(e){for(var t=[],i=e,n=0,a=e.length;n<a;)if(i[n]<128)t.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(r(i,n,1)){var s=(31&i[n])<<6|63&i[n+1];if(s>=128){t.push(String.fromCharCode(65535&s)),n+=2;continue}}}else if(i[n]<240){if(r(i,n,2)){var o=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),n+=3;continue}}}else if(i[n]<248&&r(i,n,3)){var u=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3];if(u>65536&&u<1114112){u-=65536,t.push(String.fromCharCode(u>>>10|55296)),t.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}},{}]},{},[21])(21)}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsFlash=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=e.getComponent("Tech"),s=e.dom,o=e.url,u=e.createTimeRange,l=e.mergeOptions,c=i&&i.navigator||{},d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e);function t(a,s){r(this,t);var o=n(this,e.call(this,a,s));return a.source&&o.ready(function(){this.setSource(a.source)},!0),a.startTime&&o.ready(function(){this.load(),this.play(),this.currentTime(a.startTime)},!0),i.videojs=i.videojs||{},i.videojs.Flash=i.videojs.Flash||{},i.videojs.Flash.onReady=t.onReady,i.videojs.Flash.onEvent=t.onEvent,i.videojs.Flash.onError=t.onError,o.on("seeked",function(){this.lastSeekTarget_=void 0}),o}return t.prototype.createEl=function(){var e=this.options_;e.swf||(e.swf="https://vjs.zencdn.net/swf/5.4.2/video-js.swf");var i=e.techId,r=l({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:e.autoplay,stretch:e.stretch||!1,fluent:e.fluent||!1,preload:e.preload,loop:e.loop,muted:e.muted},e.flashVars),n=l({wmode:"opaque",bgcolor:"#000000"},e.params),a=l({id:i,name:i,class:"vjs-tech"},e.attributes);return this.el_=t.embed(e.swf,r,n,a),this.el_.tech=this,this.el_},t.prototype.play=function(){this.ended()&&this.setCurrentTime(0),this.el_.vjs_play()},t.prototype.pause=function(){this.el_.vjs_pause()},t.prototype.src=function(e){return void 0===e?this.currentSrc():this.setSrc(e)},t.prototype.setSrc=function(e){var t=this;e=o.getAbsoluteURL(e),this.el_.vjs_src(e),this.autoplay()&&this.setTimeout(function(){return t.play()},0)},t.prototype.seeking=function(){return void 0!==this.lastSeekTarget_},t.prototype.setCurrentTime=function(t){var i=this.seekable();i.length&&(t=(t=t>i.start(0)?t:i.start(0))<i.end(i.length-1)?t:i.end(i.length-1),this.lastSeekTarget_=t,this.trigger("seeking"),this.el_.vjs_setProperty("currentTime",t),e.prototype.setCurrentTime.call(this))},t.prototype.currentTime=function(){return this.seeking()?this.lastSeekTarget_||0:this.el_.vjs_getProperty("currentTime")},t.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.vjs_getProperty("currentSrc")},t.prototype.duration=function(){if(0===this.readyState())return NaN;var e=this.el_.vjs_getProperty("duration");return e>=0?e:1/0},t.prototype.load=function(){this.el_.vjs_load()},t.prototype.poster=function(){this.el_.vjs_getProperty("poster")},t.prototype.setPoster=function(){},t.prototype.seekable=function(){var e=this.duration();return 0===e?u():u(0,e)},t.prototype.buffered=function(){var e=this.el_.vjs_getProperty("buffered");return 0===e.length?u():u(e[0][0],e[0][1])},t.prototype.supportsFullScreen=function(){return!1},t.prototype.enterFullScreen=function(){return!1},t.prototype.getVideoPlaybackQuality=function(){var e=this.el_.vjs_getProperty("getVideoPlaybackQuality");return i.performance&&"function"==typeof i.performance.now?e.creationTime=i.performance.now():i.performance&&i.performance.timing&&"number"==typeof i.performance.timing.navigationStart&&(e.creationTime=i.Date.now()-i.performance.timing.navigationStart),e},t}(a),h=["rtmpConnection","rtmpStream","preload","defaultPlaybackRate","playbackRate","autoplay","stretch","fluent","loop","controls","volume","muted","defaultMuted"],f=["networkState","readyState","initialTime","startOffsetTime","paused","ended","videoWidth","videoHeight"],p=d.prototype;function m(e){var t=e.charAt(0).toUpperCase()+e.slice(1);p["set"+t]=function(t){return this.el_.vjs_setProperty(e,t)}}function g(e){p[e]=function(){return this.el_.vjs_getProperty(e)}}for(var y=0;y<h.length;y++)g(h[y]),m(h[y]);for(var v=0;v<f.length;v++)g(f[v]);d.isSupported=function(){return!!(e.browser.IS_CHROME&&!e.browser.IS_ANDROID||e.browser.IS_SAFARI&&!e.browser.IS_IOS)||d.version()[0]>=10},a.withSourceHandlers(d),d.nativeSourceHandler={},d.nativeSourceHandler.canPlayType=function(e){return e in d.formats?"maybe":""},d.nativeSourceHandler.canHandleSource=function(e,t){var i=void 0;return i=e.type?e.type.replace(/;.*/,"").toLowerCase():function(e){var t=o.getFileExtension(e);return t?"video/"+t:""}(e.src),d.nativeSourceHandler.canPlayType(i)},d.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},d.nativeSourceHandler.dispose=function(){},d.registerSourceHandler(d.nativeSourceHandler),d.formats={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},d.onReady=function(e){var t=s.$("#"+e),i=t&&t.tech;i&&i.el()&&d.checkReady(i)},d.checkReady=function(e){e.el()&&(e.el().vjs_getProperty?e.triggerReady():this.setTimeout(function(){d.checkReady(e)},50))},d.onEvent=function(e,t){var i=s.$("#"+e).tech,r=Array.prototype.slice.call(arguments,2);i.setTimeout(function(){i.trigger(t,r)},1)},d.onError=function(e,t){var i=s.$("#"+e).tech;if("srcnotfound"===t)return i.error(4);"string"==typeof t?i.error("FLASH: "+t):(t.origin="flash",i.error(t))},d.version=function(){var e="0,0,0";try{e=new i.ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{c.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(e=(c.plugins["Shockwave Flash 2.0"]||c.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(e){}}return e.split(",")},d.embed=function(e,t,i,r){var n=d.getEmbedCode(e,t,i,r);return s.createEl("div",{innerHTML:n}).childNodes[0]},d.getEmbedCode=function(e,t,i,r){var n="",a="",s="";return t&&Object.getOwnPropertyNames(t).forEach(function(e){n+=e+"="+t[e]+"&amp;"}),i=l({movie:e,flashvars:n,allowScriptAccess:"always",allowNetworking:"all"},i),Object.getOwnPropertyNames(i).forEach(function(e){a+='<param name="'+e+'" value="'+i[e]+'" />'}),r=l({data:e,width:"100%",height:"100%"},r),Object.getOwnPropertyNames(r).forEach(function(e){s+=e+'="'+r[e]+'" '}),'<object type="application/x-shockwave-flash" '+s+">"+a+"</object>"},(_=d).streamingFormats={"rtmp/mp4":"MP4","rtmp/flv":"FLV"},_.streamFromParts=function(e,t){return e+"&"+t},_.streamToParts=function(e){var t={connection:"",stream:""};if(!e)return t;var i=e.search(/&(?![\w-]+=)/),r=void 0;return-1!==i?r=i+1:0===(i=r=e.lastIndexOf("/")+1)&&(i=r=e.length),t.connection=e.substring(0,i),t.stream=e.substring(r,e.length),t},_.isStreamingType=function(e){return e in _.streamingFormats},_.RTMP_RE=/^rtmp[set]?:\/\//i,_.isStreamingSrc=function(e){return _.RTMP_RE.test(e)},_.rtmpSourceHandler={},_.rtmpSourceHandler.canPlayType=function(e){return _.isStreamingType(e)?"maybe":""},_.rtmpSourceHandler.canHandleSource=function(e,t){var i=_.rtmpSourceHandler.canPlayType(e.type);return i||(_.isStreamingSrc(e.src)?"maybe":"")},_.rtmpSourceHandler.handleSource=function(e,t,i){var r=_.streamToParts(e.src);t.setRtmpConnection(r.connection),t.setRtmpStream(r.stream)},_.registerSourceHandler(_.rtmpSourceHandler);var _;return a.getTech("Flash")?(e.log.warn("Not using videojs-flash as it appears to already be registered"),e.log.warn("videojs-flash should only be used with video.js@6 and above")):e.registerTech("Flash",d),d.VERSION="2.1.2",d}),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("video.js"));else if("function"==typeof define&&define.amd)define(["video.js"],t);else{var i=t("object"==typeof exports?require("video.js"):e.videojs);for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}}(this,function(e){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,i){e.exports=function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=8)}([function(e,t,i){"use strict";function r(){}function n(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach(function(t){o[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?function(){for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];r[0]&&(r[0]=function(e,t){return t="["+e+"] > "+t}(e,r[0])),t.apply(self.console,r)}:r}(t)})}i.d(t,"a",function(){return u}),i.d(t,"b",function(){return l});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s={trace:r,debug:r,log:r,warn:r,info:r,error:r},o=s,u=function(e){if(!0===e||"object"===(void 0===e?"undefined":a(e))){n(e,"debug","log","info","warn","error");try{o.log()}catch(e){o=s}}else o=s},l=o},function(e,t,i){"use strict";t.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return n});var r={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,i){"use strict";i.d(t,"b",function(){return n});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,i){for(var r=i,n=0;e.isHeader(t,i);)n+=10,n+=e._readSize(t,i+6),e.isFooter(t,i+10)&&(n+=10),i+=n;if(n>0)return t.subarray(r,r+n)},e._readSize=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3]},e.getTimeStamp=function(t){for(var i=e.getID3Frames(t),r=0;r<i.length;r++){var n=i[r];if(e.isTimeStampFrame(n))return e._readTimeStamp(n)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:i,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var i=0,r=[];e.isHeader(t,i);){for(var n=e._readSize(t,i+6),a=(i+=10)+n;i+8<a;){var s=e._getFrameData(t.subarray(i)),o=e._decodeFrame(s);o&&r.push(o),i+=s.size+10}e.isFooter(t,i)&&(i+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var i=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,r=e._utf8ArrayToStr(t.data.subarray(i));i+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:r,data:n}}var a=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:a}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,r=e._utf8ArrayToStr(t.data.subarray(i));i+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:r,data:n}}var a=e._utf8ArrayToStr(t.data);return{key:t.type,data:a}},e._utf8ArrayToStr=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length,r=void 0,n=void 0,a=void 0,s="",o=0;o<i;){if(0===(r=e[o++])&&t)return s;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(r);break;case 12:case 13:n=e[o++],s+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=e[o++],a=e[o++],s+=String.fromCharCode((15&r)<<12|(63&n)<<6|(63&a)<<0)}}return s},e}(),n=r._utf8ArrayToStr;t.a=r},function(e,t,i){"use strict";var r=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.subtle=t,this.aesIV=i}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),n=r,a=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.subtle=t,this.key=i}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),s=a,o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),r=0;r<4;r++)i[r]=t.getUint32(4*r);return i},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],n=i[1],a=i[2],s=i[3],o=this.invSubMix,u=o[0],l=o[1],c=o[2],d=o[3],h=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var y=h[f],v=h[y],_=h[v],b=257*h[g]^16843008*g;r[f]=b<<24|b>>>8,n[f]=b<<16|b>>>16,a[f]=b<<8|b>>>24,s[f]=b,b=16843009*_^65537*v^257*y^16843008*f,u[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,c[g]=b<<8|b>>>24,d[g]=b,f?(f=y^h[h[h[_^y]]],p^=h[h[p]]):f=p=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;r<t.length&&i;)i=t[r]===this.key[r],r++;if(!i){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a=this.ksRows=4*(n+6+1),s=void 0,o=void 0,u=this.keySchedule=new Uint32Array(a),l=this.invKeySchedule=new Uint32Array(a),c=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],m=h[2],g=h[3],y=void 0,v=void 0;for(s=0;s<a;s++)s<n?y=u[s]=t[s]:(v=y,s%n==0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=d[s/n|0]<<24):n>6&&s%n==4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),u[s]=y=(u[s-n]^v)>>>0);for(o=0;o<a;o++)s=a-o,v=3&o?u[s]:u[s-4],l[o]=o<4||s<=4?v:f[c[v>>>24]]^p[c[v>>>16&255]]^m[c[v>>>8&255]]^g[c[255&v]],l[o]=l[o]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,i){for(var r,n,a=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,l=u[0],c=u[1],d=u[2],h=u[3],f=this.uint8ArrayToUint32Array_(i),p=f[0],m=f[1],g=f[2],y=f[3],v=new Int32Array(e),_=new Int32Array(v.length),b=void 0,T=void 0,S=void 0,E=void 0,k=void 0,w=void 0,A=void 0,L=void 0,C=void 0,R=void 0,O=void 0,D=void 0,I=this.networkToHostOrderSwap;t<v.length;){for(C=I(v[t]),R=I(v[t+1]),O=I(v[t+2]),D=I(v[t+3]),k=C^s[0],w=D^s[1],A=O^s[2],L=R^s[3],r=4,n=1;n<a;n++)b=l[k>>>24]^c[w>>16&255]^d[A>>8&255]^h[255&L]^s[r],T=l[w>>>24]^c[A>>16&255]^d[L>>8&255]^h[255&k]^s[r+1],S=l[A>>>24]^c[L>>16&255]^d[k>>8&255]^h[255&w]^s[r+2],E=l[L>>>24]^c[k>>16&255]^d[w>>8&255]^h[255&A]^s[r+3],k=b,w=T,A=S,L=E,r+=4;b=o[k>>>24]<<24^o[w>>16&255]<<16^o[A>>8&255]<<8^o[255&L]^s[r],T=o[w>>>24]<<24^o[A>>16&255]<<16^o[L>>8&255]<<8^o[255&k]^s[r+1],S=o[A>>>24]<<24^o[L>>16&255]<<16^o[k>>8&255]<<8^o[255&w]^s[r+2],E=o[L>>>24]<<24^o[k>>16&255]<<16^o[w>>8&255]<<8^o[255&A]^s[r+3],r+=3,_[t]=I(b^p),_[t+1]=I(E^m),_[t+2]=I(S^g),_[t+3]=I(T^y),p=C,m=R,g=O,y=D,t+=4}return _.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),u=o,l=i(2),c=i(0),d=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.config=i,this.logEnabled=!0;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,i,r){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(c.b.log("JS AES decrypt"),this.logEnabled=!1);var o=this.decryptor;o||(this.decryptor=o=new u),o.expandKey(t),r(o.decrypt(e,0,i))}else{this.logEnabled&&(c.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new s(l,t)),this.fastAesKey.expandKey().then(function(s){new n(l,i).decrypt(e,s).catch(function(n){a.onWebCryptoError(n,e,t,i,r)}).then(function(e){r(e)})}).catch(function(n){a.onWebCryptoError(n,e,t,i,r)})}},e.prototype.onWebCryptoError=function(e,t,i,r,n){this.config.enableSoftwareAES?(c.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,r,n)):(c.b.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:l.b.MEDIA_ERROR,details:l.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.a=d},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,s,o,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(i=this._events[e]))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(n(i))for(o=Array.prototype.slice.call(arguments,1),l=i.slice(),s=l.length,u=0;u<s;u++)l[u].apply(this,o);return!0},i.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,a,s,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,a=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(i)){for(o=s;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){a=o;break}if(a<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){!function(t){var i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/;?#]*)(.*)$/,n={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var a=this.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");return a.path=n.normalizePath(a.path),n.buildURLFromParts(a)}var s=this.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=n.normalizePath(s.path),n.buildURLFromParts(s)):t;var o=this.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=r.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+s.path;l.path=n.normalizePath(d)}else l.path=o.path,s.params||(l.params=o.params,s.query||(l.query=o.query));return null===l.path&&(l.path=i.alwaysNormalize?n.normalizePath(s.path):s.path),n.buildURLFromParts(l)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(/(?:\/|^)\.(?=\/)/g,"");e.length!==(e=e.replace(/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=n}()},function(e,t,i){"use strict";function r(e,t){return 255===e[t]&&240==(246&e[t+1])}function n(e,t){return 1&e[t+1]?7:9}function a(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function s(e,t){return!!(t+1<e.length&&r(e,t))}function o(e,t){if(t+1<e.length&&r(e,t)){var i=n(e,t),s=i;t+5<e.length&&(s=a(e,t));var o=t+s;if(o===e.length||o+1<e.length&&r(e,o))return!0}return!1}function u(e,t,i,r,n){if(!e.samplerate){var a=function(e,t,i,r){var n,a,s,o,u,l=navigator.userAgent.toLowerCase(),c=r,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return n=1+((192&t[i+2])>>>6),(a=(60&t[i+2])>>>2)>d.length-1?void e.trigger(Event.ERROR,{type:h.b.MEDIA_ERROR,details:h.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a}):(o=(1&t[i+2])<<2,o|=(192&t[i+3])>>>6,p.b.log("manifest codec:"+r+",ADTS data:type:"+n+",sampleingIndex:"+a+"["+d[a]+"Hz],channelConfig:"+o),/firefox/i.test(l)?a>=6?(n=5,u=new Array(4),s=a-3):(n=2,u=new Array(2),s=a):-1!==l.indexOf("android")?(n=2,u=new Array(2),s=a):(n=5,u=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&a>=6?s=a-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(a>=6&&1===o||/vivaldi/i.test(l))||!r&&1===o)&&(n=2,u=new Array(2)),s=a)),u[0]=n<<3,u[0]|=(14&a)>>1,u[1]|=(1&a)<<7,u[1]|=o<<3,5===n&&(u[1]|=(14&s)>>1,u[2]=(1&s)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:d[a],channelCount:o,codec:"mp4a.40."+n,manifestCodec:c})}(t,i,r,n);e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,p.b.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}}function l(e){return 9216e4/e}function c(e,t,i,r,s){var o=l(e.samplerate),u=function(e,t,i,r,s){var o,u,l,c=e.length;if(o=n(e,t),u=a(e,t),(u-=o)>0&&t+o+u<=c)return l=i+r*s,{headerLength:o,frameLength:u,stamp:l}}(t,i,r,s,o);if(u){var c=u.stamp,d=u.headerLength,h=u.frameLength,f={unit:t.subarray(i+d,i+d+h),pts:c,dts:c};return e.samples.push(f),e.len+=h,{sample:f,length:h+d}}}var d=i(1),h=i(2),f=i(4),p=i(0),m=i(3),g=function(){function e(t,i,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.config=r,this.remuxer=i}return e.prototype.resetInitSegment=function(e,t,i,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=m.a.getID3Data(e,0)||[],i=t.length,r=e.length;i<r;i++)if(o(e,i))return p.b.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,r){for(var n=this._audioTrack,a=m.a.getID3Data(e,0)||[],o=m.a.getTimeStamp(a),l=o?90*o:9e4*t,d=0,h=l,f=e.length,g=a.length,y=[{pts:h,dts:h,data:a}];g<f-1;)if(s(e,g)&&g+5<f){u(n,this.observer,e,g,n.manifestCodec);var v=c(n,e,g,l,d);if(!v){p.b.log("Unable to parse AAC frame");break}g+=v.length,h=v.sample.pts,d++}else m.a.isHeader(e,g)?(a=m.a.getID3Data(e,g),y.push({pts:h,dts:h,data:a}),g+=a.length):g++;this.remuxer.remux(n,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,i,r)},e.prototype.destroy=function(){},e}(),y=g,v=Math.pow(2,32)-1,_=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.remuxer=i}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,i,r,n){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==i&&(i="mp4a.40.5"),null==r&&(r="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:i+","+r,initSegment:n?t:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:i,initSegment:n?t:null}),a.video&&(s.video={container:"video/mp4",codec:r,initSegment:n?t:null})),this.observer.trigger(d.a.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else i&&(this.audioCodec=i),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i},e.writeUint32=function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},e.findBox=function(t,i){var r,n,a,s,o,u,l,c=[];if(t.data?(u=t.start,s=t.end,t=t.data):(u=0,s=t.byteLength),!i.length)return null;for(r=u;r<s;)n=e.readUint32(t,r),a=e.bin2str(t.subarray(r+4,r+8)),l=n>1?r+n:s,a===i[0]&&(1===i.length?c.push({data:t,start:r+8,end:l}):(o=e.findBox({data:t,start:r+8,end:l},i.slice(1)),o.length&&(c=c.concat(o)))),r=l;return c},e.parseInitSegment=function(t){var i=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var n=r.data[r.start],a=0===n?12:20,s=e.readUint32(r,a),o=e.findBox(t,["mdia","mdhd"])[0];if(o){n=o.data[o.start],a=0===n?12:20;var u=e.readUint32(o,a),l=e.findBox(t,["mdia","hdlr"])[0];if(l){var c=e.bin2str(l.data.subarray(l.start+8,l.start+12)),d={soun:"audio",vide:"video"}[c];if(d){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var f=e.bin2str(h.data.subarray(h.start+12,h.start+16));p.b.log("MP4Demuxer:"+d+":"+f+" found")}i[s]={timescale:u,type:d},i[d]={timescale:u,id:s}}}}}}),i},e.getStartDTS=function(t,i){var r,n,a;return r=e.findBox(i,["moof","traf"]),n=[].concat.apply([],r.map(function(i){return e.findBox(i,["tfhd"]).map(function(r){var n,a;return n=e.readUint32(r,4),a=t[n].timescale||9e4,e.findBox(i,["tfdt"]).map(function(t){var i,r;return i=t.data[t.start],r=e.readUint32(t,4),1===i&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r})[0]/a})})),a=Math.min.apply(null,n),isFinite(a)?a:0},e.offsetStartDTS=function(t,i,r){e.findBox(i,["moof","traf"]).map(function(i){return e.findBox(i,["tfhd"]).map(function(n){var a=e.readUint32(n,4),s=t[a].timescale||9e4;e.findBox(i,["tfdt"]).map(function(t){var i=t.data[t.start],n=e.readUint32(t,4);if(0===i)e.writeUint32(t,4,n-r*s);else{n*=Math.pow(2,32),n+=e.readUint32(t,8),n-=r*s,n=Math.max(n,0);var a=Math.floor(n/(v+1)),o=Math.floor(n%(v+1));e.writeUint32(t,4,a),e.writeUint32(t,8,o)}})})})},e.prototype.append=function(t,i,r,n){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec),a=this.initData);var s=void 0,o=this.initPTS;if(void 0===o){var u=e.getStartDTS(a,t);this.initPTS=o=u-i,this.observer.trigger(d.a.INIT_PTS_FOUND,{initPTS:o})}e.offsetStartDTS(a,t,o),s=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,s,r,n,t)},e.prototype.destroy=function(){},e}(),b=_,T={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,r,n){if(!(i+24>t.length)){var a=this.parseHeader(t,i);if(a&&i+a.frameLength<=t.length){var s=9e4*a.samplesPerFrame/a.sampleRate,o=r+n*s,u={unit:t.subarray(i,i+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(u),e.len+=a.frameLength,{sample:u,length:a.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,r=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==i&&0!==n&&15!==n&&3!==a){var o=3===i?3-r:3===r?3:4,u=1e3*T.BitratesMap[14*o+n-1],l=3===i?0:2===i?1:2,c=T.SamplingRateMap[3*l+a],d=e[t+3]>>6==3?1:2,h=T.SamplesCoefficients[i][r],f=T.BytesInSlot[r],p=8*h*f;return{sampleRate:c,channelCount:d,frameLength:parseInt(h*u/c+s,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),r=4;i&&i.frameLength&&(r=i.frameLength);var n=t+r;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},S=T,E=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");r.set(e.subarray(i,i+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&p.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t,i,r=8,n=8;for(t=0;t<e;t++)0!==n&&(i=this.readEG(),n=(r+i+256)%256),r=0===n?r:n},e.prototype.readSPS=function(){var e,t,i,r,n,a,s,o=0,u=0,l=0,c=0,d=this.readUByte.bind(this),h=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),g=this.skipEG.bind(this),y=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(d(),e=d(),h(5),m(3),d(),y(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=f();if(3===_&&m(1),y(),y(),m(1),p())for(a=3!==_?8:12,s=0;s<a;s++)p()&&v(s<6?16:64)}y();var b=f();if(0===b)f();else if(1===b)for(m(1),g(),g(),t=f(),s=0;s<t;s++)g();y(),m(1),i=f(),r=f(),0===(n=h(1))&&m(1),m(1),p()&&(o=f(),u=f(),l=f(),c=f());var T=[1,1];if(p()&&p())switch(d()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(i+1)-2*o-2*u),height:(2-n)*(r+1)*16-(n?2:4)*(l+c),pixelRatio:T}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),k=E,w=function(){function e(t,i,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.decryptdata=r,this.discardEPB=n,this.decrypter=new f.a(t,i)}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,i,r){var n=e[t].unit,a=n.subarray(16,n.length-n.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,function(a){a=new Uint8Array(a),n.set(a,16),r||o.decryptAacSamples(e,t+1,i)})},e.prototype.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,r),!r)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)i.set(e.subarray(n,n+16),r);return i},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var i=0,r=32;r<=e.length-16;r+=160,i+=16)e.set(t.subarray(i,i+16),r);return e},e.prototype.decryptAvcSample=function(e,t,i,r,n,a){var s=this.discardEPB(n.data),o=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(o.buffer,function(o){n.data=u.getAvcDecryptedUnit(s,o),a||u.decryptAvcSamples(e,t,i+1,r)})},e.prototype.decryptAvcSamples=function(e,t,i,r){for(;;t++,i=0){if(t>=e.length)return void r();for(var n=e[t].units;!(i>=n.length);i++){var a=n[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,r,a,s),!s)return}}}},e}(),A=w,L={video:0,audio:1,id3:2,text:3},C=function(){function e(t,i,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.config=r,this.typeSupported=n,this.remuxer=i,this.sampleAes=null}return e.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new A(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0||(i&&p.b.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:L[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,i,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",n),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3",n),this._txtTrack=e.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=r,this._duration=n},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,i,r,n){var a,s,o,u,l,c=t.length,f=!1;this.contiguous=r;var m=this.pmtParsed,g=this._avcTrack,y=this._audioTrack,v=this._id3Track,_=g.pid,b=y.pid,T=v.pid,S=this._pmtId,E=g.pesData,k=y.pesData,w=v.pesData,A=this._parsePAT,L=this._parsePMT,C=this._parsePES,R=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),D=this._parseMPEGPES.bind(this),I=this._parseID3PES.bind(this),P=e._syncOffset(t);for(c-=(c+P)%188,a=P;a<c;a+=188)if(71===t[a]){if(s=!!(64&t[a+1]),o=((31&t[a+1])<<8)+t[a+2],(48&t[a+3])>>4>1){if((u=a+5+t[a+4])===a+188)continue}else u=a+4;switch(o){case _:s&&(E&&(l=C(E))&&R(l,!1),E={data:[],size:0}),E&&(E.data.push(t.subarray(u,a+188)),E.size+=a+188-u);break;case b:s&&(k&&(l=C(k))&&(y.isAAC?O(l):D(l)),k={data:[],size:0}),k&&(k.data.push(t.subarray(u,a+188)),k.size+=a+188-u);break;case T:s&&(w&&(l=C(w))&&I(l),w={data:[],size:0}),w&&(w.data.push(t.subarray(u,a+188)),w.size+=a+188-u);break;case 0:s&&(u+=t[u]+1),S=this._pmtId=A(t,u);break;case S:s&&(u+=t[u]+1);var x=L(t,u,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(_=x.avc)>0&&(g.pid=_),(b=x.audio)>0&&(y.pid=b,y.isAAC=x.isAAC),(T=x.id3)>0&&(v.pid=T),f&&!m&&(p.b.log("reparse from beginning"),f=!1,a=P-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:f=!0}}else this.observer.trigger(d.a.ERROR,{type:h.b.MEDIA_ERROR,details:h.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});E&&(l=C(E))?(R(l,!0),g.pesData=null):g.pesData=E,k&&(l=C(k))?(y.isAAC?O(l):D(l),y.pesData=null):(k&&k.size&&p.b.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=k),w&&(l=C(w))?(I(l),v.pesData=null):v.pesData=w,null==this.sampleAes?this.remuxer.remux(y,g,v,this._txtTrack,i,r,n):this.decryptAndRemux(y,g,v,this._txtTrack,i,r,n)},e.prototype.decryptAndRemux=function(e,t,i,r,n,a,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,i,r,n,a,s)})}else this.decryptAndRemuxAvc(e,t,i,r,n,a,s)},e.prototype.decryptAndRemuxAvc=function(e,t,i,r,n,a,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,i,r,n,a,s)})}else this.remuxer.remux(e,t,i,r,n,a,s)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,i,r){var n,a,s,o,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=(15&e[t+1])<<8|e[t+2],a=t+3+n-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;t<a;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){p.b.log("unkown stream type:"+e[t]);break}case 15:-1===u.audio&&(u.audio=o);break;case 21:-1===u.id3&&(u.id3=o);break;case 219:if(!r){p.b.log("unkown stream type:"+e[t]);break}case 27:-1===u.avc&&(u.avc=o);break;case 3:case 4:i?-1===u.audio&&(u.audio=o,u.isAAC=!1):p.b.log("MPEG audio found, not supported in this browser for now");break;case 36:p.b.warn("HEVC stream type found, not supported for now");break;default:p.b.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return u},e.prototype._parsePES=function(e){var t,i,r,n,a,s,o,u,l=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var d=new Uint8Array(c[0].length+c[1].length);d.set(c[0]),d.set(c[1],c[0].length),c[0]=d,c.splice(1,1)}if(1===((t=c[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;192&(i=t[7])&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,s>4294967295&&(s-=8589934592),64&i?(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,o>4294967295&&(o-=8589934592),s-o>54e5&&(p.b.warn(Math.round((s-o)/9e4)+"s delta between PTS and DTS, align them"),s=o)):o=s),n=t[8],u=n+9,e.size-=u,a=new Uint8Array(e.size);for(var h=0,f=c.length;h<f;h++){var m=(t=c[h]).byteLength;if(u){if(u>m){u-=m;continue}t=t.subarray(u),m-=u,u=0}a.set(t,l),l+=m}return r&&(r-=n+3),{data:a,pts:s,dts:o,len:r}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,r=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,i.push(e)):t.dropped++}e.debug.length&&p.b.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var i,r,n,a=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),u=this.avcSample,l=!1,c=this.pushAccesUnit.bind(this),d=function(e,t,i,r){return{key:e,pts:t,dts:i,units:[],debug:r}};e.data=null,u&&o.length&&!s.audFound&&(c(u,s),u=this.avcSample=d(!1,e.pts,e.dts,"")),o.forEach(function(t){switch(t.type){case 1:r=!0,u||(u=a.avcSample=d(!0,e.pts,e.dts,"")),u.frame=!0;var o=t.data;if(l&&o.length>4){var h=new k(o).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(u.key=!0)}break;case 5:r=!0,u||(u=a.avcSample=d(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:r=!0,(i=new k(a.discardEPB(t.data))).readUByte();for(var f=0,p=0,m=!1,g=0;!m&&i.bytesAvailable>1;){f=0;do{g=i.readUByte(),f+=g}while(255===g);p=0;do{g=i.readUByte(),p+=g}while(255===g);if(4===f&&0!==i.bytesAvailable){if(m=!0,181===i.readUByte()&&49===i.readUShort()&&1195456820===i.readUInt()&&3===i.readUByte()){var y=i.readUByte(),v=i.readUByte(),_=31&y,b=[y,v];for(n=0;n<_;n++)b.push(i.readUByte()),b.push(i.readUByte()),b.push(i.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(p<i.bytesAvailable)for(n=0;n<p;n++)i.readUByte()}break;case 7:if(r=!0,l=!0,!s.sps){var T=(i=new k(t.data)).readSPS();s.width=T.width,s.height=T.height,s.pixelRatio=T.pixelRatio,s.sps=[t.data],s.duration=a._duration;var S=t.data.subarray(1,4),E="avc1.";for(n=0;n<3;n++){var w=S[n].toString(16);w.length<2&&(w="0"+w),E+=w}s.codec=E}break;case 8:r=!0,s.pps||(s.pps=[t.data]);break;case 9:r=!1,s.audFound=!0,u&&c(u,s),u=a.avcSample=d(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&r&&u.units.push(t)}),t&&u&&(c(u,s),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var r=i-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var i=this._avcTrack,r=i.samples;e=r[r.length-1]}if(e){var n=e.units;t=n[n.length-1]}return t},e.prototype._parseAVCNALu=function(e){var t,i,r,n,a,s=0,o=e.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,d=[],h=-1;for(-1===l&&(h=0,a=31&e[0],l=0,s=1);s<o;)if(t=e[s++],l)if(1!==l)if(t)if(1===t){if(h>=0)r={data:e.subarray(h,s-l-1),type:a},d.push(r);else{var f=this._getLastNalUnit();if(f&&(c&&s<=4-c&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c)),(i=s-l-1)>0)){var p=new Uint8Array(f.data.byteLength+i);p.set(f.data,0),p.set(e.subarray(0,i),f.data.byteLength),f.data=p}}s<o?(n=31&e[s],h=s,a=n,l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(h>=0&&l>=0&&(r={data:e.subarray(h,o),type:a,state:l},d.push(r)),0===d.length){var m=this._getLastNalUnit();if(m){var g=new Uint8Array(m.data.byteLength+e.byteLength);g.set(m.data,0),g.set(e,m.data.byteLength),m.data=g}}return u.naluState=l,d},e.prototype.discardEPB=function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},e.prototype._parseAACPES=function(e){var t,i,r,n,a,o=this._audioTrack,f=e.data,m=e.pts,g=this.aacOverFlow,y=this.aacLastPTS;if(g){var v=new Uint8Array(g.byteLength+f.byteLength);v.set(g,0),v.set(f,g.byteLength),f=v}for(r=0,a=f.length;r<a-1&&!s(f,r);r++);if(r){var _,b;if(r<a-1?(_="AAC PES did not start with ADTS header,offset:"+r,b=!1):(_="no ADTS header found in AAC PES",b=!0),p.b.warn("parsing error:"+_),this.observer.trigger(d.a.ERROR,{type:h.b.MEDIA_ERROR,details:h.a.FRAG_PARSING_ERROR,fatal:b,reason:_}),b)return}if(u(o,this.observer,f,r,this.audioCodec),i=0,t=l(o.samplerate),g&&y){var T=y+t;Math.abs(T-m)>1&&(p.b.log("AAC: align PTS for overlapping frames by "+Math.round((T-m)/90)),m=T)}for(;r<a;)if(s(f,r)&&r+5<a){var S=c(o,f,r,m,i);if(!S)break;r+=S.length,n=S.sample.pts,i++}else r++;g=r<a?f.subarray(r,a):null,this.aacOverFlow=g,this.aacLastPTS=n},e.prototype._parseMPEGPES=function(e){for(var t=e.data,i=t.length,r=0,n=0,a=e.pts;n<i;)if(S.isHeader(t,n)){var s=S.appendFrame(this._audioTrack,t,n,a,r);if(!s)break;n+=s.length,r++}else n++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),R=C,O=function(){function e(t,i,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.config=r,this.remuxer=i}return e.prototype.resetInitSegment=function(e,t,i,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t,i,r=m.a.getID3Data(e,0);if(r&&void 0!==m.a.getTimeStamp(r))for(t=r.length,i=Math.min(e.length-1,t+100);t<i;t++)if(S.probe(e,t))return p.b.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,r){for(var n=m.a.getID3Data(e,0),a=m.a.getTimeStamp(n),s=a?90*a:9e4*t,o=n.length,u=e.length,l=0,c=0,d=this._audioTrack,h=[{pts:s,dts:s,data:n}];o<u;)if(S.isHeader(e,o)){var f=S.appendFrame(d,e,o,s,l);if(!f)break;o+=f.length,c=f.sample.pts,l++}else m.a.isHeader(e,o)?(n=m.a.getID3Data(e,o),h.push({pts:c,dts:c,data:n}),o+=n.length):o++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,i,r)},e.prototype.destroy=function(){},e}(),D=O,I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),P=I,x=Math.pow(2,32)-1,M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t,i=Array.prototype.slice.call(arguments,1),r=8,n=i.length,a=n;n--;)r+=i[n].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),n=0,r=8;n<a;n++)t.set(i[n],r),r+=i[n].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var r=Math.floor(i/(x+1)),n=Math.floor(i%(x+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))},e.moov=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,i){i*=t;var r=Math.floor(i/(x+1)),n=Math.floor(i%(x+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,r,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,r,n,a=[],s=[];for(i=0;i<t.sps.length;i++)r=t.sps[i],n=r.byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));for(i=0;i<t.pps.length;i++)r=t.pps[i],n=r.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),u=t.width,l=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,r=t.duration*t.timescale,n=t.width,a=t.height,s=Math.floor(r/(x+1)),o=Math.floor(r%(x+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,i){var r=e.sdtp(t),n=t.id,a=Math.floor(i/(x+1)),s=Math.floor(i%(x+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var r,n,a,s,o,u,l=t.samples||[],c=l.length,d=12+16*c,h=new Uint8Array(d);for(i+=8+d,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<c;r++)n=l[r],a=n.duration,s=n.size,o=n.flags,u=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var i,r=e.moov(t);return(i=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),i.set(r,e.FTYP.byteLength),i},e}(),U=M,N=function(){function e(t,i,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.config=i,this.typeSupported=r;var a=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,i,r,n,a,s){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var o=e.samples.length,u=t.samples.length,l=n,c=n;if(o&&u){var h=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale;l+=Math.max(0,h),c+=Math.max(0,-h)}if(o){e.timescale||(p.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,n));var f=this.remuxAudio(e,l,a,s);if(u){var m=void 0;f&&(m=f.endPTS-f.startPTS),t.timescale||(p.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,n)),this.remuxVideo(t,c,a,m,s)}}else{var g=void 0;u&&(g=this.remuxVideo(t,c,a,s)),g&&e.codec&&this.remuxEmptyAudio(e,l,a,g)}}i.samples.length&&this.remuxID3(i,n),r.samples.length&&this.remuxText(r,n),this.observer.trigger(d.a.FRAG_PARSED)},e.prototype.generateIS=function(e,t,i){var r,n,a=this.observer,s=e.samples,o=t.samples,u=this.typeSupported,l="audio/mp4",c={},f={tracks:c},m=void 0===this._initPTS;if(m&&(r=n=1/0),e.config&&s.length&&(e.timescale=e.samplerate,p.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(u.mpeg?(l="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),c.audio={container:l,codec:e.codec,initSegment:!e.isAAC&&u.mpeg?new Uint8Array:U.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(r=n=s[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&o.length){var g=t.inputTimeScale;t.timescale=g,c.video={container:"video/mp4",codec:t.codec,initSegment:U.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(r=Math.min(r,o[0].pts-g*i),n=Math.min(n,o[0].dts-g*i),this.observer.trigger(d.a.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(c).length?(a.trigger(d.a.FRAG_PARSING_INIT_SEGMENT,f),this.ISGenerated=!0,m&&(this._initPTS=r,this._initDTS=n)):a.trigger(d.a.ERROR,{type:h.b.MEDIA_ERROR,details:h.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,i,r,n){var a,s,o,u,l,c,f,m=8,g=e.timescale,y=e.samples,v=[],_=y.length,b=this._PTSNormalize,T=this._initDTS,S=this.nextAvcDts,E=this.isSafari;E&&(i|=y.length&&S&&(n&&Math.abs(t-S/g)<.1||Math.abs(y[0].pts-S-T)<g/5)),i||(S=t*g),y.forEach(function(e){e.pts=b(e.pts-T,S),e.dts=b(e.dts-T,S)}),y.sort(function(e,t){var i=e.dts-t.dts,r=e.pts-t.pts;return i||r||e.id-t.id});var k=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(k<0){p.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(k/90)+" ms to overcome this issue");for(var w=0;w<y.length;w++)y[w].dts+=k}var A=y[0];l=Math.max(A.dts,0),u=Math.max(A.pts,0);var L=Math.round((l-S)/90);i&&L&&(L>1?p.b.log("AVC:"+L+" ms hole between fragments detected,filling it"):L<-1&&p.b.log("AVC:"+-L+" ms overlapping between fragments detected"),l=S,y[0].dts=l,u=Math.max(u-L,S),y[0].pts=u,p.b.log("Video/PTS/DTS adjusted: "+Math.round(u/90)+"/"+Math.round(l/90)+",delta:"+L+" ms")),A=y[y.length-1],f=Math.max(A.dts,0),c=Math.max(A.pts,0,f),E&&(a=Math.round((f-l)/(y.length-1)));for(var C=0,R=0,O=0;O<_;O++){for(var D=y[O],I=D.units,P=I.length,x=0,M=0;M<P;M++)x+=I[M].data.length;R+=x,C+=P,D.length=x,D.dts=E?l+O*a:Math.max(D.dts,l),D.pts=Math.max(D.pts,D.dts)}var N=R+4*C+8;try{s=new Uint8Array(N)}catch(e){return void this.observer.trigger(d.a.ERROR,{type:h.b.MUX_ERROR,details:h.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating video mdat "+N})}var B=new DataView(s.buffer);B.setUint32(0,N),s.set(U.types.mdat,4);for(var F=0;F<_;F++){for(var j=y[F],G=j.units,V=0,H=void 0,z=0,W=G.length;z<W;z++){var q=G[z],K=q.data,X=q.data.byteLength;B.setUint32(m,X),m+=4,s.set(K,m),m+=X,V+=4+X}if(E)H=Math.max(0,a*Math.round((j.pts-j.dts)/a));else{if(F<_-1)a=y[F+1].dts-j.dts;else{var Y=this.config,$=j.dts-y[F>0?F-1:F].dts;if(Y.stretchShortVideoTrack){var Q=Y.maxBufferHole,J=Y.maxSeekHole,Z=Math.floor(Math.min(Q,J)*g),ee=(r?u+r*g:this.nextAudioPts)-j.pts;ee>Z?((a=ee-$)<0&&(a=$),p.b.log("It is approximately "+ee/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=$}else a=$}H=Math.round(j.pts-j.dts)}v.push({size:V,duration:a,cts:H,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=f+a;var te=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,v.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ie=v[0].flags;ie.dependsOn=2,ie.isNonSync=0}e.samples=v,o=U.moof(e.sequenceNumber++,l,e),e.samples=[];var re={data1:o,data2:s,startPTS:u/g,endPTS:(c+a)/g,startDTS:l/g,endDTS:this.nextAvcDts/g,type:"video",nb:v.length,dropped:te};return this.observer.trigger(d.a.FRAG_PARSING_DATA,re),re},e.prototype.remuxAudio=function(e,t,i,r){var n,a,s,o,u,l,c,f=e.inputTimeScale,m=e.timescale,g=f/m,y=e.isAAC?1024:1152,v=y*g,_=this._PTSNormalize,b=this._initDTS,T=!e.isAAC&&this.typeSupported.mpeg,S=e.samples,E=[],k=this.nextAudioPts;if(i|=S.length&&k&&(r&&Math.abs(t-k/f)<.1||Math.abs(S[0].pts-k-b)<20*v),S.forEach(function(e){e.pts=e.dts=_(e.pts-b,t*f)}),0!==(S=S.filter(function(e){return e.pts>=0})).length){if(i||(k=r?t*f:S[0].pts),e.isAAC)for(var w=this.config.maxAudioFramesDrift,A=0,L=k;A<S.length;){var C,R=S[A],O=R.pts;C=O-L;var D=Math.abs(1e3*C/f);if(C<=-w*v)p.b.warn("Dropping 1 audio frame @ "+(L/f).toFixed(3)+"s due to "+Math.round(D)+" ms overlap."),S.splice(A,1),e.len-=R.unit.length;else if(C>=w*v&&D<1e4&&L){var I=Math.round(C/v);p.b.warn("Injecting "+I+" audio frame @ "+(L/f).toFixed(3)+"s due to "+Math.round(1e3*C/f)+" ms gap.");for(var x=0;x<I;x++){var M=Math.max(L,0);(s=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(p.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),s=R.unit.subarray()),S.splice(A,0,{unit:s,pts:M,dts:M}),e.len+=s.length,L+=v,A++}R.pts=R.dts=L,L+=v,A++}else Math.abs(C),R.pts=R.dts=L,L+=v,A++}for(var N=0,B=S.length;N<B;N++){var F=S[N],j=F.unit,G=F.pts;if(void 0!==c)a.duration=Math.round((G-c)/g);else{var V=Math.round(1e3*(G-k)/f),H=0;if(i&&e.isAAC&&V){if(V>0&&V<1e4)H=Math.round((G-k)/v),p.b.log(V+" ms hole between AAC samples detected,filling it"),H>0&&(s=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),s||(s=j.subarray()),e.len+=H*s.length);else if(V<-12){p.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(k/f).toFixed(3)+"s/"+(G/f).toFixed(3)+"s/"+-V+"ms"),e.len-=j.byteLength;continue}G=k}if(l=G,!(e.len>0))return;var z=T?e.len:e.len+8;n=T?0:8;try{o=new Uint8Array(z)}catch(e){return void this.observer.trigger(d.a.ERROR,{type:h.b.MUX_ERROR,details:h.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:z,reason:"fail allocating audio mdat "+z})}T||(new DataView(o.buffer).setUint32(0,z),o.set(U.types.mdat,4));for(var W=0;W<H;W++)s=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),s||(p.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),s=j.subarray()),o.set(s,n),n+=s.byteLength,a={size:s.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(a)}o.set(j,n);var q=j.byteLength;n+=q,a={size:q,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(a),c=G}var K=0,X=E.length;if(X>=2&&(K=E[X-2].duration,a.duration=K),X){this.nextAudioPts=k=c+g*K,e.len=0,e.samples=E,u=T?new Uint8Array:U.moof(e.sequenceNumber++,l/g,e),e.samples=[];var Y=l/f,$=k/f,Q={data1:u,data2:o,startPTS:Y,endPTS:$,startDTS:Y,endDTS:$,type:"audio",nb:X};return this.observer.trigger(d.a.FRAG_PARSING_DATA,Q),Q}return null}},e.prototype.remuxEmptyAudio=function(e,t,i,r){var n=e.inputTimeScale,a=e.samplerate?e.samplerate:n,s=n/a,o=this.nextAudioPts,u=(void 0!==o?o:r.startDTS*n)+this._initDTS,l=r.endDTS*n+this._initDTS,c=1024*s,d=Math.ceil((l-u)/c),h=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(p.b.warn("remux empty Audio"),h){for(var f=[],m=0;m<d;m++){var g=u+m*c;f.push({unit:h,pts:g,dts:g}),e.len+=h.length}e.samples=f,this.remuxAudio(e,t,i)}else p.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.prototype.remuxID3=function(e,t){var i,r=e.samples.length,n=e.inputTimeScale,a=this._initPTS,s=this._initDTS;if(r){for(var o=0;o<r;o++)i=e.samples[o],i.pts=(i.pts-a)/n,i.dts=(i.dts-s)/n;this.observer.trigger(d.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},e.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var i,r=e.samples.length,n=e.inputTimeScale,a=this._initPTS;if(r){for(var s=0;s<r;s++)i=e.samples[s],i.pts=(i.pts-a)/n;this.observer.trigger(d.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},e.prototype._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},e}(),B=N,F=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,i,r,n,a,s,o){var u=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),u.trigger(d.a.FRAG_PARSING_DATA,{data1:o,startPTS:n,startDTS:n,type:l,nb:1,dropped:0}),u.trigger(d.a.FRAG_PARSED)},e}(),j=F,G=function(){function e(t,i,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t,this.typeSupported=i,this.config=r,this.vendor=n}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,i,r,n,a,s,o,u,l,c,h){if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new f.a(this.observer,this.config));var m,g=this;try{m=performance.now()}catch(e){m=Date.now()}p.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var f;try{f=performance.now()}catch(e){f=Date.now()}g.observer.trigger(d.a.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:f}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),r,n,a,s,o,u,l,c,h)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),r,n,a,s,o,u,l,c,h)},e.prototype.pushDecrypted=function(e,t,i,r,n,a,s,o,u,l,c,f){var p=this.demuxer;if(!p||s&&!this.probe(e)){for(var m=this.observer,g=this.typeSupported,v=this.config,_=[{demux:R,remux:B},{demux:b,remux:j},{demux:y,remux:B},{demux:D,remux:B}],T=0,S=_.length;T<S;T++){var E=_[T],k=E.demux.probe;if(k(e)){var w=this.remuxer=new E.remux(m,v,g,this.vendor);p=new E.demux(m,w,v,g),this.probe=k;break}}if(!p)return void m.trigger(d.a.ERROR,{type:h.b.MEDIA_ERROR,details:h.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=p}var A=this.remuxer;(s||o)&&(p.resetInitSegment(i,r,n,l),A.resetInitSegment()),s&&(p.resetTimeStamp(f),A.resetTimeStamp(f)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,a,u,c)},e}();t.a=G},function(e,t,i){"use strict";function r(e,t){var i=M[t];return!!i&&!0===i[e.slice(0,4)]}function n(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)return null;for(var i=null,r=0;r<e.length;r++){var n=e[r];n.id===t&&(i=n)}return i}function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function u(e,t,i){var r=e[t],n=e[i],a=n.startPTS;isNaN(a)?n.start=i>t?r.start+r.duration:Math.max(r.start-n.duration,0):i>t?(r.duration=a-r.start,r.duration<0&&L.b.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(n.duration=r.start-a,n.duration<0&&L.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!"))}function l(e,t,i,r,n,a){var s=i;if(!isNaN(t.startPTS)){var o=Math.abs(t.startPTS-i);isNaN(t.deltaPTS)?t.deltaPTS=o:t.deltaPTS=Math.max(o,t.deltaPTS),s=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),r=Math.max(r,t.endPTS),n=Math.min(n,t.startDTS),a=Math.max(a,t.endDTS)}var l=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=s,t.endPTS=r,t.startDTS=n,t.endDTS=a,t.duration=r-i;var c=t.sn;if(!e||c<e.startSN||c>e.endSN)return 0;var d,h,f;for(d=c-e.startSN,(h=e.fragments)[d]=t,f=d;f>0;f--)u(h,f,f-1);for(f=d;f<h.length-1;f++)u(h,f,f+1);return e.PTSKnown=!0,l}function c(e,t){var i,r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=e.fragments,o=t.fragments,u=0;if(n<r)t.PTSKnown=!1;else{for(var c=r;c<=n;c++){var d=s[a+c],h=o[c];h&&d&&(u=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,h.backtracked=d.backtracked,h.dropped=d.dropped,i=h))}if(u)for(L.b.log("discontinuity sliding from playlist, take drift into account"),c=0;c<o.length;c++)o[c].cc+=u;if(i)l(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(a>=0&&a<s.length){var f=s[a].start;for(c=0;c<o.length;c++)o[c].start+=f}t.PTSKnown=e.PTSKnown}}function d(e,t){t.fragments.forEach(function(t){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}),t.PTSKnown=!0}function h(e,t,i){if(function(e,t,i){var r=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(r=!0),r}(e,t,i)){var r=function(e,t){var i=e.fragments,r=t.fragments;if(r.length&&i.length){var n=function(e,t){for(var i=null,r=0;r<e.length;r+=1){var n=e[r];if(n&&n.cc===t){i=n;break}}return i}(i,r[0].cc);return!n||n&&!n.startPTS?void L.b.log("No frag in previous level to align on"):n}L.b.log("No fragments to align")}(t.details,i);r&&(L.b.log("Adjusting PTS using last level due to CC increase within current level"),d(r.start,i))}if(!1===i.PTSKnown&&t&&t.details){var n=t.details.programDateTime,a=i.programDateTime,s=(a-n)/1e3+t.details.fragments[0].start;isNaN(s)||(L.b.log("adjusting PTS using programDateTime delta, sliding:"+s.toFixed(3)),d(s,i))}}function f(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new je,this.regionList=[]}function p(){this.values=Object.create(null)}function m(e,t,i,r){var n=r?e.split(r):[e];for(var a in n)if("string"==typeof n[a]){var s=n[a].split(i);if(2===s.length){var o=s[0],u=s[1];t(o,u)}}}function g(e,t,i){function r(){var t=function(e){function t(e,t,i,r){return 3600*(0|e)+60*(0|t)+(0|i)+(0|r)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}var a=e;if(n(),t.startTime=r(),n(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);e=e.substr(3),n(),t.endTime=r(),n(),function(e,t){var r=new p;m(e,function(e,t){switch(e){case"region":for(var n=i.length-1;n>=0;n--)if(i[n].id===t){r.set(e,i[n].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",Ve,"end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",Ve,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",Ve,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var n=r.get("line","auto");"auto"===n&&-1===Ge.line&&(n=-1),t.line=n,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",Ve);var a=r.get("position","auto");"auto"===a&&50===Ge.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function y(e){return e.replace(/<br(?: \/)?>/gi,"\n")}function v(e,t,i,r){for(var n,a,s,o,u,l=window.VTTCue||window.TextTrackCue,c=0;c<r.rows.length;c++)if(n=r.rows[c],s=!0,o=0,u="",!n.isEmpty()){for(var d=0;d<n.chars.length;d++)n.chars[d].uchar.match(/\s/)&&s?o++:(u+=n.chars[d].uchar,s=!1);n.cueStartTime=t,t===i&&(i+=1e-4),a=new l(t,i,y(u.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}function T(e){for(var t=[],i=0;i<e.length;i++)"subtitles"===e[i].kind&&t.push(e[i]);return t}Object.defineProperty(t,"__esModule",{value:!0});var S={};i.d(S,"newCue",function(){return v});var E=i(6),k=i.n(E),w=i(1),A=i(2),L=i(0),C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.unregisterListeners()},e.prototype.isEventHandler=function(){return"object"===C(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){try{(function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)}).call(this,e,t).call()}catch(t){L.b.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(w.a.ERROR,{type:A.b.OTHER_ERROR,details:A.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),O=R,D=/^(\d+)x(\d+)$/,I=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,P=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])}return e.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(2*r,2*r+2),16);return i}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=D.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={};for(I.lastIndex=0;null!==(t=I.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),i[t[1]]=r}return i},e}(),x=P,M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},U=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),N=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,B=/#EXT-X-MEDIA:(.*)/g,F=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),j=function(){function e(){a(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return U(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=k.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),G=function(){function e(){a(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&(i=new j,i.method=e.method,i.baseuri=e.baseuri,i.reluri=e.reluri,i.iv=this.createInitializationVector(t)),i},e.prototype.cloneObj=function(e){return JSON.parse(JSON.stringify(e))},U(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=k.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var i=this.lastByteRangeEndOffset;e[0]=i||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),V=function(e){function t(i){a(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MANIFEST_LOADING,w.a.LEVEL_LOADING,w.a.AUDIO_TRACK_LOADING,w.a.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},O.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:"manifest"})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:"audioTrack",id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:"subtitleTrack",id:e.id})},t.prototype.load=function(e,t){var i=this.loaders[t.type];if(void 0!==i){var r=i.context;if(r&&r.url===e)return void L.b.trace("playlist request ongoing");L.b.warn("abort previous loader for type:"+t.type),i.abort()}var n=this.hls.config,a=void 0,s=void 0,o=void 0,u=void 0;"manifest"===t.type?(a=n.manifestLoadingMaxRetry,s=n.manifestLoadingTimeOut,o=n.manifestLoadingRetryDelay,u=n.manifestLoadingMaxRetryTimeout):"level"===t.type?(a=0,s=n.levelLoadingTimeOut):(a=n.levelLoadingMaxRetry,s=n.levelLoadingTimeOut,o=n.levelLoadingRetryDelay,u=n.levelLoadingMaxRetryTimeout,L.b.log("loading playlist for "+t.type+" "+(t.level||t.id))),i=this.loaders[t.type]=t.loader=void 0!==n.pLoader?new n.pLoader(n):new n.loader(n),t.url=e,t.responseType="";var l=void 0,c=void 0;l={timeout:s,maxRetry:a,retryDelay:o,maxRetryDelay:u},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.load(t,l,c)},t.prototype.resolve=function(e,t){return k.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},t.prototype.parseMasterPlaylist=function(e,t){var i=[],n=void 0;for(N.lastIndex=0;null!=(n=N.exec(e));){var a={},s=a.attrs=new x(n[1]);a.url=this.resolve(n[2],t);var o=s.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),a.name=s.NAME,function(e,t){["video","audio"].forEach(function(i){var n=e.filter(function(e){return r(e,i)});if(n.length){var a=n.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[i+"Codec"]=a.length>0?a[0]:n[0],e=e.filter(function(e){return-1===n.indexOf(e)})}}),t.unknownCodecs=e}([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=this.avc1toavcoti(a.videoCodec)),i.push(a)}return i},t.prototype.parseMasterPlaylistMedia=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=void 0,a=[],o=0;for(B.lastIndex=0;null!==(n=B.exec(e));){var u={},l=new x(n[1]);if(l.TYPE===i){if(u.groupId=l["GROUP-ID"],u.name=l.NAME,u.type=i,u.default="YES"===l.DEFAULT,u.autoselect="YES"===l.AUTOSELECT,u.forced="YES"===l.FORCED,l.URI&&(u.url=this.resolve(l.URI,t)),u.lang=l.LANGUAGE,u.name||(u.name=u.lang),r.length){var c=s(r,u.groupId);u.audioCodec=c?c.codec:r[0].codec}u.id=o++,a.push(u)}}return a},t.prototype.avc1toavcoti=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},t.prototype.parseLevelPlaylist=function(e,t,i,r){var n,a,s=0,o=0,u={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},l=new j,c=0,d=null,h=new G;for(F.lastIndex=0;null!==(n=F.exec(e));){var f=n[1];if(f){h.duration=parseFloat(f);var p=(" "+n[2]).slice(1);h.title=p||null,h.tagList.push(p?["INF",f,p]:["INF",f])}else if(n[3]){if(!isNaN(h.duration)){var m=s++;h.type=r,h.start=o,h.levelkey=l,h.sn=m,h.level=i,h.cc=c,h.baseurl=t,h.relurl=(" "+n[3]).slice(1),u.fragments.push(h),d=h,o+=h.duration,h=new G}}else if(n[4]){if(h.rawByteRange=(" "+n[4]).slice(1),d){var g=d.byteRangeEndOffset;g&&(h.lastByteRangeEndOffset=g)}}else if(n[5])h.rawProgramDateTime=(" "+n[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),void 0===u.programDateTime&&(u.programDateTime=new Date(new Date(Date.parse(n[5]))-1e3*o));else{for(n=n[0].match(/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/),a=1;a<n.length&&void 0===n[a];a++);var y=(" "+n[a+1]).slice(1),v=(" "+n[a+2]).slice(1);switch(n[a]){case"#":h.tagList.push(v?[y,v]:[y]);break;case"PLAYLIST-TYPE":u.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(y);break;case"TARGETDURATION":u.targetduration=parseFloat(y);break;case"VERSION":u.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(y);break;case"KEY":var _=y,b=new x(_),T=b.enumeratedString("METHOD"),S=b.URI,E=b.hexadecimalInteger("IV");T&&(l=new j,S&&["AES-128","SAMPLE-AES"].indexOf(T)>=0&&(l.method=T,l.baseuri=t,l.reluri=S,l.key=null,l.iv=E));break;case"START":var k=y,w=new x(k),A=w.decimalFloatingPoint("TIME-OFFSET");isNaN(A)||(u.startTimeOffset=A);break;case"MAP":var C=new x(y);h.relurl=C.URI,h.rawByteRange=C.BYTERANGE,h.baseurl=t,h.level=i,h.type=r,h.sn="initSegment",u.initSegment=h,h=new G;break;default:L.b.warn("line parsed but not handled: "+n)}}}return(h=d)&&!h.relurl&&(u.fragments.pop(),o-=h.duration),u.totalduration=o,u.averagetargetduration=o/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=c,u},t.prototype.loadsuccess=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=e.data,a=e.url,s=i.type,o=i.id,u=i.level,l=this.hls;if(this.loaders[s]=void 0,void 0!==a&&0!==a.indexOf("data:")||(a=i.url),t.tload=performance.now(),0===n.indexOf("#EXTM3U"))if(n.indexOf("#EXTINF:")>0){var c="audioTrack"!==s&&"subtitleTrack"!==s,d=isNaN(u)?isNaN(o)?0:o:u,h=this.parseLevelPlaylist(n,a,d,"audioTrack"===s?"audio":"subtitleTrack"===s?"subtitle":"main");h.tload=t.tload,"manifest"===s&&l.trigger(w.a.MANIFEST_LOADED,{levels:[{url:a,details:h}],audioTracks:[],url:a,stats:t,networkDetails:r}),t.tparsed=performance.now(),h.targetduration?c?l.trigger(w.a.LEVEL_LOADED,{details:h,level:u||0,id:o||0,stats:t,networkDetails:r}):"audioTrack"===s?l.trigger(w.a.AUDIO_TRACK_LOADED,{details:h,id:o,stats:t,networkDetails:r}):"subtitleTrack"===s&&l.trigger(w.a.SUBTITLE_TRACK_LOADED,{details:h,id:o,stats:t,networkDetails:r}):l.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"invalid targetduration",networkDetails:r})}else{var f=this.parseMasterPlaylist(n,a);if(f.length){var p=f.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),m=this.parseMasterPlaylistMedia(n,a,"AUDIO",p),g=this.parseMasterPlaylistMedia(n,a,"SUBTITLES");if(m.length){var y=!1;m.forEach(function(e){e.url||(y=!0)}),!1===y&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(L.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main"}))}l.trigger(w.a.MANIFEST_LOADED,{levels:f,audioTracks:m,subtitles:g,url:a,stats:t,networkDetails:r})}else l.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest",networkDetails:r})}else l.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter",networkDetails:r})},t.prototype.loaderror=function(e,t){var i,r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=t.loader;switch(t.type){case"manifest":i=A.a.MANIFEST_LOAD_ERROR,r=!0;break;case"level":i=A.a.LEVEL_LOAD_ERROR,r=!1;break;case"audioTrack":i=A.a.AUDIO_TRACK_LOAD_ERROR,r=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:i,fatal:r,url:a.url,loader:a,response:e,context:t,networkDetails:n})},t.prototype.loadtimeout=function(e,t){var i,r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=t.loader;switch(t.type){case"manifest":i=A.a.MANIFEST_LOAD_TIMEOUT,r=!0;break;case"level":i=A.a.LEVEL_LOAD_TIMEOUT,r=!1;break;case"audioTrack":i=A.a.AUDIO_TRACK_LOAD_TIMEOUT,r=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:i,fatal:r,url:a.url,loader:a,context:t,networkDetails:n})},t}(O),H=V,z=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.FRAG_LOADING));return r.loaders={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){var e=this.loaders;for(var t in e){var i=e[t];i&&i.destroy()}this.loaders={},O.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,i=t.type,r=this.loaders[i],n=this.hls.config;t.loaded=0,r&&(L.b.warn("abort previous fragment loader for type:"+i),r.abort()),r=this.loaders[i]=t.loader=void 0!==n.fLoader?new n.fLoader(n):new n.loader(n);var a=void 0,s=void 0,o=void 0;a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var u=t.byteRangeStartOffset,l=t.byteRangeEndOffset;isNaN(u)||isNaN(l)||(a.rangeStart=u,a.rangeEnd=l),s={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(a,s,o)},t.prototype.loadsuccess=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=e.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(w.a.FRAG_LOADED,{payload:n,frag:a,stats:t,networkDetails:r})},t.prototype.loaderror=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},t.prototype.loadtimeout=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},t.prototype.loadprogress=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=t.frag;n.loaded=e.loaded,this.hls.trigger(w.a.FRAG_LOAD_PROGRESS,{frag:n,stats:e,networkDetails:r})},t}(O),W=z,q=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},O.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,i=t.type,r=this.loaders[i],n=t.decryptdata,a=n.uri;if(a!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;r&&(L.b.warn("abort previous key loader for type:"+i),r.abort()),t.loader=this.loaders[i]=new s.loader(s),this.decrypturl=a,this.decryptkey=null;var o=void 0,u=void 0,l=void 0;o={url:a,frag:t,responseType:"arraybuffer"},u={timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(o,u,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(w.a.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,i){var r=i.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(w.a.KEY_LOADED,{frag:r})},t.prototype.loaderror=function(e,t){var i=t.frag,r=i.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},t.prototype.loadtimeout=function(e,t){var i=t.frag,r=i.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(w.a.ERROR,{type:A.b.NETWORK_ERROR,details:A.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}(O),K=q,X={search:function(e,t){for(var i=0,r=e.length-1,n=null,a=null;i<=r;){a=e[n=(i+r)/2|0];var s=t(a);if(s>0)i=n+1;else{if(!(s<0))return a;r=n-1}}return null}},Y={isBuffered:function(e,t){try{if(e)for(var i=e.buffered,r=0;r<i.length;r++)if(t>=i.start(r)&&t<=i.end(r))return!0}catch(e){}return!1},bufferInfo:function(e,t,i){try{if(e){var r,n=e.buffered,a=[];for(r=0;r<n.length;r++)a.push({start:n.start(r),end:n.end(r)});return this.bufferedInfo(a,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},bufferedInfo:function(e,t,i){var r,n,a,s,o,u=[];for(e.sort(function(e,t){var i=e.start-t.start;return i||t.end-e.end}),o=0;o<e.length;o++){var l=u.length;if(l){var c=u[l-1].end;e[o].start-c<i?e[o].end>c&&(u[l-1].end=e[o].end):u.push(e[o])}else u.push(e[o])}for(o=0,r=0,n=a=t;o<u.length;o++){var d=u[o].start,h=u[o].end;if(t+i>=d&&t<h)n=d,a=h,r=a-t;else if(t+i<d){s=d;break}}return{len:r,start:n,end:a,nextStart:s}}},$=i(7),Q=i(5),J=i.n(Q),Z=i(9),ee=i.n(Z),te=o(),ie=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.hls=t,this.id=i;var r=this.observer=new J.a,n=t.config;r.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];r.emit.apply(r,[e,e].concat(i))},r.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[e].concat(i))};var a=function(e,i){(i=i||{}).frag=this.frag,i.id=this.id,t.trigger(e,i)}.bind(this);r.on(w.a.FRAG_DECRYPTED,a),r.on(w.a.FRAG_PARSING_INIT_SEGMENT,a),r.on(w.a.FRAG_PARSING_DATA,a),r.on(w.a.FRAG_PARSED,a),r.on(w.a.ERROR,a),r.on(w.a.FRAG_PARSING_METADATA,a),r.on(w.a.FRAG_PARSING_USERDATA,a),r.on(w.a.INIT_PTS_FOUND,a);var s={mp4:te.isTypeSupported("video/mp4"),mpeg:te.isTypeSupported("audio/mpeg"),mp3:te.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(n.enableWorker&&"undefined"!=typeof Worker){L.b.log("demuxing in webworker");var u=void 0;try{u=this.w=ee()(10),this.onwmsg=this.onWorkerMessage.bind(this),u.addEventListener("message",this.onwmsg),u.onerror=function(e){t.trigger(w.a.ERROR,{type:A.b.OTHER_ERROR,details:A.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},u.postMessage({cmd:"init",typeSupported:s,vendor:o,id:i,config:JSON.stringify(n)})}catch(e){L.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),u&&URL.revokeObjectURL(u.objectURL),this.demuxer=new $.a(r,s,n,o),this.w=void 0}}else this.demuxer=new $.a(r,s,n,o)}return e.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,i,r,n,a,s,o){var u=this.w,l=isNaN(n.startDTS)?n.start:n.startDTS,c=n.decryptdata,d=this.frag,h=!(d&&n.cc===d.cc),f=!(d&&n.level===d.level),p=d&&n.sn===d.sn+1,m=!f&&p;if(h&&L.b.log(this.id+":discontinuity detected"),f&&L.b.log(this.id+":switch detected"),this.frag=n,u)u.postMessage({cmd:"demux",data:e,decryptdata:c,initSegment:t,audioCodec:i,videoCodec:r,timeOffset:l,discontinuity:h,trackSwitch:f,contiguous:m,duration:a,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]);else{var g=this.demuxer;g&&g.push(e,c,t,i,r,l,h,f,m,a,s,o)}},e.prototype.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case w.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},e}(),re=ie,ne={toString:function(e){for(var t="",i=e.length,r=0;r<i;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}},ae=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),se={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},oe=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHED,w.a.MEDIA_DETACHING,w.a.MANIFEST_LOADING,w.a.MANIFEST_PARSED,w.a.LEVEL_LOADED,w.a.KEY_LOADED,w.a.FRAG_LOADED,w.a.FRAG_LOAD_EMERGENCY_ABORTED,w.a.FRAG_PARSING_INIT_SEGMENT,w.a.FRAG_PARSING_DATA,w.a.FRAG_PARSED,w.a.ERROR,w.a.AUDIO_TRACK_SWITCHING,w.a.AUDIO_TRACK_SWITCHED,w.a.BUFFER_CREATED,w.a.BUFFER_APPENDED,w.a.BUFFER_FLUSHED));return r.config=i.config,r.audioCodecSwap=!1,r.ticks=0,r._state=se.STOPPED,r.ontick=r.tick.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),O.prototype.destroy.call(this),this.state=se.STOPPED},t.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=i.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(L.b.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=se.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=se.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=se.STOPPED,this.forceStartLoad=!1},t.prototype.tick=function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){switch(this.state){case se.ERROR:break;case se.BUFFER_FLUSHING:this.fragLoadError=0;break;case se.IDLE:this._doTickIdle();break;case se.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=se.IDLE);break;case se.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),i=this.retryDate;(!i||t>=i||this.media&&this.media.seeking)&&(L.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=se.IDLE);break;case se.ERROR:case se.STOPPED:case se.FRAG_LOADING:case se.PARSING:case se.PARSED:case se.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},t.prototype._doTickIdle=function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var r=void 0;r=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=e.nextLoadLevel,a=this.levels[n];if(a){var s=a.bitrate,o=void 0;o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var u=Y.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,r,t.maxBufferHole),l=u.len;if(!(l>=o)){L.b.trace("buffer length of "+l.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=n;var c=a.details;if(void 0===c||!0===c.live&&this.levelLastLoaded!==n)return void(this.state=se.WAITING_LEVEL);var d=this.fragPrevious;if(!c.live&&d&&!d.backtracked&&d.sn===c.endSN&&!u.nextStart&&Math.min(i.duration,d.start+d.duration)-Math.max(u.end,d.start)<=Math.max(.2,d.duration)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(w.a.BUFFER_EOS,h),void(this.state=se.ENDED)}this._fetchPayloadOrEos(r,u,c)}}}},t.prototype._fetchPayloadOrEos=function(e,t,i){var r=this.fragPrevious,n=this.level,a=i.fragments,s=a.length;if(0!==s){var o=a[0].start,u=a[s-1].start+a[s-1].duration,l=t.end,c=void 0;if(i.initSegment&&!i.initSegment.data)c=i.initSegment;else if(i.live){var d=this.config.initialLiveManifestSize;if(s<d)return void L.b.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+d);if(null===(c=this._ensureFragmentAtLivePoint(i,l,o,u,r,a,s)))return}else l<o&&(c=a[0]);c||(c=this._findFragment(o,r,s,a,l,u,i)),c&&this._loadFragmentOrKey(c,n,i,e,l)}},t.prototype._ensureFragmentAtLivePoint=function(e,t,i,r,n,a,s){var o=this.hls.config,u=this.media,l=void 0,c=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-o.maxFragLookUpTolerance,r-c)){var d=this.liveSyncPosition=this.computeLivePosition(i,e);L.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,u&&u.readyState&&u.duration>d&&(u.currentTime=d),this.nextLoadPosition=d}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(n){var h=n.sn+1;if(h>=e.startSN&&h<=e.endSN){var f=a[h-e.startSN];n.cc===f.cc&&(l=f,L.b.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=X.search(a,function(e){return n.cc-e.cc}))&&L.b.log("live playlist, switching playlist, load frag with same CC: "+l.sn)}l||(l=a[Math.min(s-1,Math.round(s/2))],L.b.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l},t.prototype._findFragment=function(e,t,i,r,n,a,s){var o=this.hls.config,u=void 0,l=void 0,c=o.maxFragLookUpTolerance,d=t?r[t.sn-r[0].sn+1]:void 0,h=function(e){var t=Math.min(c,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=n?1:e.start-t>n&&e.start?-1:0};if(n<a?(n>a-c&&(c=0),l=d&&!h(d)?d:X.search(r,h)):l=r[i-1],l){var f=(u=l).sn-s.startSN,p=t&&u.level===t.level,m=r[f-1],g=r[f+1];if(t&&u.sn===t.sn)if(p&&!u.backtracked)if(u.sn<s.endSN){var y=t.deltaPTS;y&&y>o.maxBufferHole&&t.dropped&&f?(u=m,L.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(u=g,L.b.log("SN just loaded, load next one: "+u.sn))}else u=null;else u.backtracked&&(g&&g.backtracked?(L.b.warn("Already backtracked from fragment "+g.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+g.sn),u=g):(L.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,m?(m.loadCounter&&m.loadCounter--,u=m,u.backtracked=!0):f&&(u=null)))}return u},t.prototype._loadFragmentOrKey=function(e,t,i,r,n){var a=this.hls,s=a.config;if(!e.decryptdata||null==e.decryptdata.uri||null!=e.decryptdata.key){if(L.b.log("Loading "+e.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t+", currentTime:"+r.toFixed(3)+",bufferEnd:"+n.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var o=s.fragLoadingLoopThreshold;if(e.loadCounter>o&&Math.abs(this.fragLoadIdx-e.loadIdx)<o)return void a.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e})}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,e.autoLevel=a.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),a.trigger(w.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new re(a,"main")),void(this.state=se.FRAG_LOADING)}L.b.log("Loading key for "+e.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t),this.state=se.KEY_LOADING,a.trigger(w.a.KEY_LOADING,{frag:e})},t.prototype.getBufferedFrag=function(e){return X.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})},t.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t.prototype._checkFragmentChanged=function(){var e,t,i=this.media;if(i&&i.readyState&&!1===i.seeking&&(t=i.currentTime,t>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),Y.isBuffered(i,t)?e=this.getBufferedFrag(t):Y.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(w.a.FRAG_CHANGED,{frag:r});var n=r.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(w.a.LEVEL_SWITCHED,{level:n}),this.fragPlaying=r}}},t.prototype.immediateLevelSwitch=function(){if(L.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,Y.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},t.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t=void 0,i=void 0,r=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),(i=this.getBufferedFrag(e.currentTime))&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),e.paused)t=0;else{var n=this.hls.nextLoadLevel,a=this.levels[n],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*s)+1:0}if((r=this.getBufferedFrag(e.currentTime+t))&&(r=this.followingBufferedFrag(r))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}},t.prototype.flushMainBuffer=function(e,t){this.state=se.BUFFER_FLUSHING;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(w.a.BUFFER_FLUSHING,i)},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(L.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0,e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,i=this.config;isNaN(t)||L.b.log("media seeking to "+t.toFixed(3));var r=this.mediaBuffer?this.mediaBuffer:e,n=Y.bufferInfo(r,t,this.config.maxBufferHole);if(this.state===se.FRAG_LOADING){var a=this.fragCurrent;if(0===n.len&&a){var s=i.maxFragLookUpTolerance,o=a.start-s,u=a.start+a.duration+s;t<o||t>u?(a.loader&&(L.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=se.IDLE):L.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===se.ENDED&&(0===n.len&&(this.fragPrevious=0),this.state=se.IDLE);e&&(this.lastCurrentTime=t),this.state!==se.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},t.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;isNaN(t)||L.b.log("media seeked to "+t.toFixed(3)),this.tick()},t.prototype.onMediaEnded=function(){L.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestLoading=function(){L.b.log("trigger BUFFER_RESET"),this.hls.trigger(w.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestParsed=function(e){var t,i=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=i&&r,this.audioCodecSwitch&&L.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},t.prototype.onLevelLoaded=function(e){var t=e.details,i=e.level,r=this.levels[this.levelLastLoaded],n=this.levels[i],a=t.totalduration,s=0;if(L.b.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var o=n.details;o&&t.fragments.length>0?(c(o,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),t.PTSKnown&&!isNaN(s)?L.b.log("live playlist sliding:"+s.toFixed(3)):(L.b.log("live playlist - outdated PTS, unknown sliding"),h(this.fragPrevious,r,t))):(L.b.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,h(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(n.details=t,this.levelLastLoaded=i,this.hls.trigger(w.a.LEVEL_UPDATED,{details:t,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=t.startTimeOffset;isNaN(u)?t.live?(this.startPosition=this.computeLivePosition(s,t),L.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(u<0&&(L.b.log("negative start time offset "+u+", count from end of last fragment"),u=s+a+u),L.b.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===se.WAITING_LEVEL&&(this.state=se.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===se.KEY_LOADING&&(this.state=se.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===se.FRAG_LOADING&&t&&"main"===i.type&&i.level===t.level&&i.sn===t.sn){var r=e.stats,n=this.levels[t.level],a=n.details;if(L.b.log("Loaded  "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t.level),this.bitrateTest=!1,this.stats=r,!0===i.bitrateTest&&this.hls.nextLoadLevel)this.state=se.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(w.a.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=se.IDLE,r.tparsed=r.tbuffered=performance.now(),a.initSegment.data=e.payload,this.hls.trigger(w.a.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{this.state=se.PARSING;var s=a.totalduration,o=t.level,u=t.sn,l=this.config.defaultAudioCodec||n.audioCodec;this.audioCodecSwap&&(L.b.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,L.b.log("Parsing "+u+" of ["+a.startSN+" ,"+a.endSN+"],level "+o+", cc "+t.cc);var c=this.demuxer;c||(c=this.demuxer=new re(this.hls,"main"));var d=this.media,h=d&&d.seeking,f=!h&&(a.PTSKnown||!a.live),p=a.initSegment?a.initSegment.data:[];c.push(e.payload,p,l,n.videoCodec,t,s,f,void 0)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===se.PARSING){var r,n,a=e.tracks;if(a.audio&&this.altAudio&&delete a.audio,n=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(L.b.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==n.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==n.container&&(s="mp4a.40.2",L.b.log("Android: force audio codec to "+s)),n.levelCodec=s,n.id=e.id}(n=a.video)&&(n.levelCodec=this.levels[this.level].videoCodec,n.id=e.id),this.hls.trigger(w.a.BUFFER_CODECS,a);for(r in a){n=a[r],L.b.log("main track:"+r+",container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var u=n.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(w.a.BUFFER_APPENDING,{type:r,data:u,parent:"main",content:"initSegment"}))}this.tick()}},t.prototype.onFragParsingData=function(e){var t=this,i=this.fragCurrent,r=e.frag;if(i&&"main"===e.id&&r.sn===i.sn&&r.level===i.level&&("audio"!==e.type||!this.altAudio)&&this.state===se.PARSING){var n=this.levels[this.level],a=i;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),L.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(a.dropped=e.dropped,a.dropped)if(a.backtracked)L.b.warn("Already backtracked on this fragment, appending with the gap");else{var s=n.details;if(!s||a.sn!==s.startSN)return L.b.warn("missing video frame(s), backtracking fragment"),a.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=se.IDLE,this.fragPrevious=a,void this.tick();L.b.warn("missing video frame(s) on first frag, appending with gap")}else a.backtracked=!1;var o=l(n.details,a,e.startPTS,e.endPTS,e.startDTS,e.endDTS),u=this.hls;u.trigger(w.a.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:o,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(i){i&&i.length&&t.state===se.PARSING&&(t.appended=!0,t.pendingBuffering=!0,u.trigger(w.a.BUFFER_APPENDING,{type:e.type,data:i,parent:"main",content:"data"}))}),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===se.PARSING&&(this.stats.tparsed=performance.now(),this.state=se.PARSED,this._checkAppendedParsed())},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,i=e.id;if(!t){if(this.mediaBuffer!==this.media){L.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(L.b.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=se.IDLE}var n=this.hls;n.trigger(w.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(w.a.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},t.prototype.onAudioTrackSwitched=function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(L.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i,this.tick()},t.prototype.onBufferCreated=function(e){var t=e.tracks,i=void 0,r=void 0,n=!1;for(var a in t){var s=t[a];"main"===s.id?(r=a,i=s,"video"===a&&(this.videoBuffer=t[a].buffer)):n=!0}n&&i?(L.b.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},t.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==se.PARSING&&t!==se.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==se.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;L.b.log("main buffered : "+ne.toString(t.buffered));var i=this._bufferedFrags.filter(function(e){return Y.isBuffered(t,(e.startPTS+e.endPTS)/2)});i.push(e),this._bufferedFrags=i.sort(function(e,t){return e.startPTS-t.startPTS}),this.fragPrevious=e;var r=this.stats;r.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(w.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.state=se.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var i=!!this.media&&Y.isBuffered(this.media,this.media.currentTime)&&Y.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case A.a.FRAG_LOAD_ERROR:case A.a.FRAG_LOAD_TIMEOUT:case A.a.KEY_LOAD_ERROR:case A.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);t.loadCounter=0,L.b.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=se.FRAG_LOADING_WAITING_RETRY}else L.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=se.ERROR;break;case A.a.FRAG_LOOP_LOADING_ERROR:e.fatal||(i?(this._reduceMaxBufferLength(t.duration),this.state=se.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.state=se.ERROR));break;case A.a.LEVEL_LOAD_ERROR:case A.a.LEVEL_LOAD_TIMEOUT:this.state!==se.ERROR&&(e.fatal?(this.state=se.ERROR,L.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==se.WAITING_LEVEL||(this.state=se.IDLE));break;case A.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==se.PARSING&&this.state!==se.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=se.IDLE):(L.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},t.prototype._reduceMaxBufferLength=function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,L.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*t.fragLoadingLoopThreshold))},t.prototype._checkBuffer=function(){var e=this.media,t=this.config;if(e&&e.readyState){var i=e.currentTime,r=this.mediaBuffer?this.mediaBuffer:e,n=r.buffered;if(!this.loadedmetadata&&n.length){this.loadedmetadata=!0;var a=e.seeking?i:this.startPosition,s=Y.isBuffered(r,a),o=n.start(0),u=!s&&Math.abs(a-o)<t.maxSeekHole;(i!==a||u)&&(L.b.log("target start position:"+a),u&&(a=o,L.b.log("target start position not buffered, seek to buffered.start(0) "+a)),L.b.log("adjust currentTime from "+i+" to "+a),e.currentTime=a)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var l=Y.bufferInfo(e,i,0),c=!(e.paused||e.ended||0===e.buffered.length),d=i!==this.lastCurrentTime;if(d)this.stallReported&&(L.b.warn("playback not stuck anymore @"+i+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(c){var h=performance.now(),f=this.hls;if(this.stalled){var p=h-this.stalled,m=l.len,g=this.nudgeRetry||0;if(m<=.5&&p>1e3*t.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,L.b.warn("playback stalling in low buffer @"+i),f.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:m}));var y=l.nextStart,v=y-i;if(y&&v<t.maxSeekHole&&v>0){this.nudgeRetry=++g;var _=g*t.nudgeOffset;L.b.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+y+" + nudge "+_),e.currentTime=y+_,this.stalled=void 0,f.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:y+_-i})}}else if(m>.5&&p>1e3*t.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,L.b.warn("playback stalling in high buffer @"+i),f.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:m})),this.stalled=void 0,this.nudgeRetry=++g,g<t.nudgeMaxRetry){var b=e.currentTime,T=b+g*t.nudgeOffset;L.b.log("adjust currentTime from "+b+" to "+T),e.currentTime=T,f.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else L.b.error("still stuck in high buffer @"+i+" after "+t.nudgeMaxRetry+", raise fatal error"),f.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=h,this.stallReported=!1}}}},t.prototype.onFragLoadEmergencyAborted=function(){this.state=se.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return Y.isBuffered(e,(t.startPTS+t.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=se.IDLE,this.fragPrevious=null},t.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.prototype.computeLivePosition=function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)},ae(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,L.b.log("main stream:"+t+"->"+e),this.hls.trigger(w.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(O),ue=oe,le=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ce=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MANIFEST_LOADED,w.a.LEVEL_LOADED,w.a.FRAG_LOADED,w.a.ERROR));return r.canload=!1,r.currentLevelIndex=null,r.manualLevelIndex=-1,r.timer=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},t.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t=[],i=void 0,r={},a=null,s=!1,o=!1,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,o=o||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),!0===u&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),void 0===(a=r[e.bitrate])?(e.url=[e.url],e.urlId=0,r[e.bitrate]=e,t.push(e)):a.url.push(e.url)}),!0===s&&!0===o&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||n(t))&&(!i||n(i))}),e.audioTracks&&(l=e.audioTracks.filter(function(e){return!e.audioCodec||n(e.audioCodec,"audio")})),t.length>0){i=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var c=0;c<t.length;c++)if(t[c].bitrate===i){this._firstLevel=c,L.b.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+i);break}this.hls.trigger(w.a.MANIFEST_PARSED,{levels:t,audioTracks:l,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:s,altAudio:l.length>0})}else this.hls.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},t.prototype.setLevelInternal=function(e){var t=this._levels,i=this.hls;if(e>=0&&e<t.length){if(this.cleanTimer(),this.currentLevelIndex!==e){L.b.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,i.trigger(w.a.LEVEL_SWITCH,r),i.trigger(w.a.LEVEL_SWITCHING,r)}var n=t[e],a=n.details;if(!a||!0===a.live){var s=n.urlId;i.trigger(w.a.LEVEL_LOADING,{url:n.url[s],level:e,id:s})}}else i.trigger(w.a.ERROR,{type:A.b.OTHER_ERROR,details:A.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},t.prototype.onError=function(e){if(!0!==e.fatal){var t=!1,i=!1,r=void 0;switch(e.details){case A.a.FRAG_LOAD_ERROR:case A.a.FRAG_LOAD_TIMEOUT:case A.a.FRAG_LOOP_LOADING_ERROR:case A.a.KEY_LOAD_ERROR:case A.a.KEY_LOAD_TIMEOUT:r=e.frag.level,i=!0;break;case A.a.LEVEL_LOAD_ERROR:case A.a.LEVEL_LOAD_TIMEOUT:r=e.context.level,t=!0;break;case A.a.REMUX_ALLOC_ERROR:r=e.level,t=!0}void 0!==r&&this.recoverLevel(e,r,t,i)}else e.type===A.b.NETWORK_ERROR&&this.cleanTimer()},t.prototype.recoverLevel=function(e,t,i,r){var n=this,a=this.hls.config,s=e.details,o=this._levels[t],u=void 0,l=void 0,c=void 0;if(o.loadError++,o.fragmentError=r,!0===i){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return L.b.error("level controller, cannot recover from "+s+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(e.fatal=!0);l=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return n.loadLevel()},l),e.levelRetry=!0,this.levelRetryCount++,L.b.warn("level controller, "+s+", retry in "+l+" ms, current retry count is "+this.levelRetryCount)}!0!==i&&!0!==r||(u=o.url.length,u>1&&o.loadError<u?(L.b.warn("level controller, "+s+" for level "+t+": switching to redundant stream id "+o.urlId),o.urlId=(o.urlId+1)%u,o.details=void 0):-1===this.manualLevelIndex?(c=0===t?this._levels.length-1:t-1,L.b.warn("level controller, "+s+": switch to "+c),this.hls.nextAutoLevel=this.currentLevelIndex=c):!0===r&&(L.b.warn("level controller, "+s+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,i=e.level;if(i===this.currentLevelIndex){var r=this._levels[i];!1===r.fragmentError&&(r.loadError=0,this.levelRetryCount=0);var n=e.details;if(n.live){var a=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),s=r.details;s&&n.endSN===s.endSN&&(a/=2,L.b.log("same live playlist, reload twice faster")),a-=performance.now()-e.stats.trequest,a=Math.max(1e3,Math.round(a)),L.b.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},a)}else this.cleanTimer()}},t.prototype.loadLevel=function(){var e=void 0,t=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(e=this._levels[this.currentLevelIndex])&&e.url.length>0&&(t=e.urlId,this.hls.trigger(w.a.LEVEL_LOADING,{url:e.url[t],level:this.currentLevelIndex,id:t}))},le(t,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(O),de=ce,he=i(3),fe=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHED,w.a.MEDIA_DETACHING,w.a.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){O.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){this.media=void 0},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var a=he.a.getID3Frames(i[n].data);if(a){var s=i[n].pts,o=n<i.length-1?i[n+1].pts:t.endPTS;s===o&&(o+=1e-4);for(var u=0;u<a.length;u++){var l=a[u];if(!he.a.isTimeStampFrame(l)){var c=new r(s,o,"");c.value=l,this.id3Track.addCue(c)}}}}},t}(O),pe=fe,me=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),ge=me,ye=function(){function e(t,i,r,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ge(i),this.fast_=new ge(r)}return e.prototype.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var i=8e3*t/e,r=e/1e3;this.fast_.sample(r,i),this.slow_.sample(r,i)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}(),ve=ye,_e=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),be=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.FRAG_LOADING,w.a.FRAG_LOADED,w.a.FRAG_BUFFERED,w.a.ERROR));return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=i,r.timer=null,r._bwEstimator=null,r.onCheck=r._abandonRulesCheck.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.clearTimer(),O.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var i=this.hls,r=e.frag.level,n=i.levels[r].details.live,a=i.config,s=void 0,o=void 0;n?(s=a.abrEwmaFastLive,o=a.abrEwmaSlowLive):(s=a.abrEwmaFastVoD,o=a.abrEwmaSlowVoD),this._bwEstimator=new ve(i,o,s,a.abrEwmaDefaultEstimate)}this.fragCurrent=t}},t.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,i=this.fragCurrent,r=i.loader,n=e.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return L.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=r.stats;if(t&&a&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var s=performance.now()-a.trequest,o=Math.abs(t.playbackRate);if(s>500*i.duration/o){var u=e.levels,l=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/s),c=u[i.level],d=c.realBitrate?Math.max(c.realBitrate,c.bitrate):c.bitrate,h=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*d/8)),f=t.currentTime,p=(h-a.loaded)/l,m=(Y.bufferInfo(t,f,e.config.maxBufferHole).end-f)/o;if(m<2*i.duration/o&&p>m){var g=void 0,y=void 0;for(y=i.level-1;y>n;y--){var v=u[y].realBitrate?Math.max(u[y].realBitrate,u[y].bitrate):u[y].bitrate;if((g=i.duration*v/(6.4*l))<m)break}g<p&&(L.b.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+g.toFixed(1)+"<"+p.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=y,this._bwEstimator.sample(s,a.loaded),r.abort(),this.clearTimer(),e.trigger(w.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}},t.prototype.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&!isNaN(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[t.level],r=(i.loaded?i.loaded.bytes:0)+e.stats.loaded,n=(i.loaded?i.loaded.duration:0)+e.frag.duration;i.loaded={bytes:r,duration:n},i.realBitrate=Math.round(8*r/n)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},t.prototype.onFragBuffered=function(e){var t=e.stats,i=e.frag;if(!(!0===t.aborted||1!==i.loadCounter||"main"!==i.type||isNaN(i.sn)||i.bitrateTest&&t.tload!==t.tbuffered)){var r=t.tparsed-t.trequest;L.b.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},t.prototype.onError=function(e){switch(e.details){case A.a.FRAG_LOAD_ERROR:case A.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},t.prototype._findBestLevel=function(e,t,i,r,n,a,s,o,u){for(var l=n;l>=r;l--){var c=u[l],d=c.details,h=d?d.totalduration/d.fragments.length:t,f=!!d&&d.live,p=void 0;p=l<=e?s*i:o*i;var m=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,g=m*h/p;if(L.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(p)+"/"+m+"/"+h+"/"+a+"/"+g),p>m&&(!g||f&&!this.bitrateTestDelay||g<a))return l}return-1},_e(t,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,r=e.config,n=e.minAutoLevel,a=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,u=a?a.currentTime:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(Y.bufferInfo(a,u,r.maxBufferHole).end-u)/l,h=this._findBestLevel(s,o,c,n,t,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,i);if(h>=0)return h;L.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===d){var g=this.bitrateTestDelay;g&&(f=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-g,L.b.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),p=m=1)}return h=this._findBestLevel(s,o,c,n,t,d+f,p,m,i),Math.max(h,0)}}]),t}(O),Te=be,Se=o(),Ee=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHING,w.a.MEDIA_DETACHING,w.a.MANIFEST_PARSED,w.a.BUFFER_RESET,w.a.BUFFER_APPENDING,w.a.BUFFER_CODECS,w.a.BUFFER_EOS,w.a.BUFFER_FLUSHING,w.a.LEVEL_PTS_UPDATED,w.a.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r._live=null,r._objectUrl=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){O.prototype.destroy.call(this)},t.prototype.onLevelPtsUpdated=function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var n=r.updating;try{r.abort()}catch(e){n=!0,L.b.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(L.b.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},t.prototype.onManifestParsed=function(e){var t=e.audio,i=e.video||e.levels.length&&e.audio,r=0;e.altAudio&&(t||i)&&(r=(t?1:0)+(i?1:0),L.b.log(r+" sourceBuffer(s) expected")),this.sourceBufferNb=r},t.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new Se;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(i),this._objectUrl=t.src}},t.prototype.onMediaDetaching=function(){L.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){L.b.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):L.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(w.a.MEDIA_DETACHED)},t.prototype.onMediaSourceOpen=function(){L.b.log("media source opened"),this.hls.trigger(w.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},t.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},t.prototype.onMediaSourceClose=function(){L.b.log("media source closed")},t.prototype.onMediaSourceEnded=function(){L.b.log("media source ended")},t.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;L.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,i=this.segments.reduce(function(e,i){return i.parent===t?e+1:e},0);this.hls.trigger(w.a.BUFFER_APPENDED,{parent:t,pending:i}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},t.prototype.onSBUpdateError=function(e){L.b.error("sourceBuffer error:",e),this.hls.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},t.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}},t.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;for(var r in e)if(!t[r]){var n=e[r],a=n.levelCodec||n.codec,s=n.container+";codecs="+a;L.b.log("creating sourceBuffer("+s+")");try{var o=t[r]=i.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[r]={codec:a,container:n.container},n.buffer=o}catch(e){L.b.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(w.a.BUFFER_CREATED,{tracks:e})},t.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},t.prototype.onBufferAppendFail=function(e){L.b.error("sourceBuffer error:",e.event),this.hls.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferEos=function(e){var t=this.sourceBuffer,i=e.type;for(var r in t)i&&r!==i||t[r].ended||(t[r].ended=!0,L.b.log(r+" sourceBuffer now EOS"));this.checkEos()},t.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var i in e){var r=e[i];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}L.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){L.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},t.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},t.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},t.prototype.updateMediaElementDuration=function(){var e=this.hls.config,t=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(L.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||t===1/0||isNaN(t))&&(L.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},t.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var r in i)t+=i[r].buffered.length}catch(e){L.b.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(w.a.BUFFER_FLUSHED)}},t.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,i=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void L.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var r=i.shift();try{var n=r.type,a=t[n];a?a.updating?i.unshift(r):(a.ended=!1,this.parent=r.parent,a.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){L.b.error("error while trying to append buffer:"+t.message),i.unshift(r);var s={type:A.b.MEDIA_ERROR,parent:r.parent};if(22===t.code)return this.segments=[],s.details=A.a.BUFFER_FULL_ERROR,s.fatal=!1,void e.trigger(w.a.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=A.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry)return L.b.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],s.fatal=!0,void e.trigger(w.a.ERROR,s);s.fatal=!1,e.trigger(w.a.ERROR,s)}}}},t.prototype.flushBuffer=function(e,t,i){var r,n,a,s,o,u,l=this.sourceBuffer;if(Object.keys(l).length){if(L.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in l)if(!i||c===i){if((r=l[c]).ended=!1,r.updating)return L.b.warn("cannot flush, sb updating in progress"),!1;try{for(n=0;n<r.buffered.length;n++)if(a=r.buffered.start(n),s=r.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(o=e,u=t):(o=Math.max(a,e),u=Math.min(s,t)),Math.min(u,s)-o>.5)return this.flushBufferCounter++,L.b.log("flush "+c+" ["+o+","+u+"], of ["+a+","+s+"], pos:"+this.media.currentTime),r.remove(o,u),!1}catch(e){L.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else L.b.warn("abort flushing too many retries");L.b.log("buffer flushed")}return!0},t}(O),ke=Ee,we=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ae=function(e){function t(i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.FPS_DROP_LEVEL_CAPPING,w.a.MEDIA_ATTACHING,w.a.MANIFEST_PARSED))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},t.prototype.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.prototype.getMaxLevel=function(e){var i=this;if(!this.levels)return-1;var r=this.levels.filter(function(r,n){return t.isLevelAllowed(n,i.restrictedLevels)&&n<=e});return t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.isLevelAllowed=function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,i){if(!e||e&&!e.length)return-1;for(var r=e.length-1,n=0;n<e.length;n+=1){var a=e[n];if((a.width>=t||a.height>=i)&&(s=a,o=e[n+1],!o||s.width!==o.width||s.height!==o.height)){r=n;break}}var s,o;return r},we(t,[{key:"mediaWidth",get:function(){var e=void 0,i=this.media;return i&&(e=i.width||i.clientWidth||i.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,i=this.media;return i&&(e=i.height||i.clientHeight||i.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),t}(O),Le=Ae,Ce=function(e){function t(i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHING))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,i){var r=performance.now();if(t){if(this.lastTime){var n=r-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/n,u=this.hls;if(u.trigger(w.a.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),o>0&&a>u.config.fpsDroppedMonitoringThreshold*s){var l=u.currentLevel;L.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=l)&&(l-=1,u.trigger(w.a.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:u.currentLevel}),u.autoLevelCapping=l,u.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(O),Re=Ce,Oe=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e,t=this.context;e=this.loader=new XMLHttpRequest;var i=this.stats;i.tfirst=0,i.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(i){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,r=this.stats,n=this.context,a=this.config;if(!r.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),4===i){var s=t.status;if(s>=200&&s<300){r.tload=Math.max(r.tfirst,performance.now());var o=void 0,u=void 0;"arraybuffer"===n.responseType?(o=t.response,u=o.byteLength):(o=t.responseText,u=o.length),r.loaded=r.total=u;var l={url:t.responseURL,data:o};this.callbacks.onSuccess(l,r,n,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(L.b.error(s+" while loading "+n.url),this.callbacks.onError({code:s,text:t.statusText},n,t)):(L.b.warn(s+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},e.prototype.loadtimeout=function(){L.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var r=this.callbacks.onProgress;r&&r(i,this.context,null,t)},e}(),De=Oe,Ie=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Pe=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MANIFEST_LOADING,w.a.MANIFEST_PARSED,w.a.AUDIO_TRACK_LOADED,w.a.ERROR));return r.ticks=0,r.ontick=r.tick.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.cleanTimer(),O.prototype.destroy.call(this)},t.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.tick=function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){this.updateTrack(this.trackId)},t.prototype.onError=function(e){e.fatal&&e.type===A.b.NETWORK_ERROR&&this.cleanTimer()},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestParsed=function(e){var t=this,i=e.audioTracks||[],r=!1;this.tracks=i,this.hls.trigger(w.a.AUDIO_TRACKS_UPDATED,{audioTracks:i});var n=0;i.forEach(function(e){if(e.default&&!r)return t.audioTrack=n,void(r=!0);n++}),!1===r&&i.length&&(L.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},t.prototype.onAudioTrackLoaded=function(e){e.id<this.tracks.length&&(L.b.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&this.cleanTimer())},t.prototype.setAudioTrackInternal=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,L.b.log("switching to audioTrack "+e);var t=this.tracks[e],i=this.hls,r=t.type,n=t.url,a={id:e,type:r,url:n};i.trigger(w.a.AUDIO_TRACK_SWITCH,a),i.trigger(w.a.AUDIO_TRACK_SWITCHING,a);var s=t.details;!n||void 0!==s&&!0!==s.live||(L.b.log("(re)loading playlist for audioTrack "+e),i.trigger(w.a.AUDIO_TRACK_LOADING,{url:n,id:e}))}},t.prototype.updateTrack=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,L.b.log("updating audioTrack "+e);var t=this.tracks[e],i=t.url,r=t.details;!i||void 0!==r&&!0!==r.live||(L.b.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(w.a.AUDIO_TRACK_LOADING,{url:i,id:e}))}},Ie(t,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(O),xe=Pe,Me=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ue={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},Ne=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHED,w.a.MEDIA_DETACHING,w.a.AUDIO_TRACKS_UPDATED,w.a.AUDIO_TRACK_SWITCHING,w.a.AUDIO_TRACK_LOADED,w.a.KEY_LOADED,w.a.FRAG_LOADED,w.a.FRAG_PARSING_INIT_SEGMENT,w.a.FRAG_PARSING_DATA,w.a.FRAG_PARSED,w.a.ERROR,w.a.BUFFER_RESET,w.a.BUFFER_CREATED,w.a.BUFFER_APPENDED,w.a.BUFFER_FLUSHED,w.a.INIT_PTS_FOUND));return r.config=i.config,r.audioCodecSwap=!1,r.ticks=0,r._state=Ue.STOPPED,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),O.prototype.destroy.call(this),this.state=Ue.STOPPED},t.prototype.onInitPtsFound=function(e){var t=e.id,i=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[i]=r,this.videoTrackCC=i,L.b.log("InitPTS for cc:"+i+" found from video track:"+r),this.state===Ue.WAITING_INIT_PTS&&this.tick())},t.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(L.b.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=Ue.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=Ue.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=Ue.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ue.STOPPED},t.prototype.tick=function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){var e,t,i,r=this.hls,n=r.config;switch(this.state){case Ue.ERROR:case Ue.PAUSED:case Ue.BUFFER_FLUSHING:break;case Ue.STARTING:this.state=Ue.WAITING_TRACK,this.loadedmetadata=!1;break;case Ue.IDLE:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!n.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,u=Y.bufferInfo(s,e,n.maxBufferHole),l=Y.bufferInfo(o,e,n.maxBufferHole),c=u.len,d=u.end,h=this.fragPrevious,f=Math.max(n.maxBufferLength,l.len),p=this.audioSwitch,m=this.trackId;if((c<f||p)&&m<a.length){if(void 0===(i=a[m].details)){this.state=Ue.WAITING_TRACK;break}if(!p&&!i.live&&h&&h.sn===i.endSN&&!u.nextStart&&(!this.media.seeking||this.media.duration-d<h.duration/2)){this.hls.trigger(w.a.BUFFER_EOS,{type:"audio"}),this.state=Ue.ENDED;break}var g=i.fragments,y=g.length,v=g[0].start,_=g[y-1].start+g[y-1].duration,b=void 0;if(p)if(i.live&&!i.PTSKnown)L.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),d=0;else if(d=e,i.PTSKnown&&e<v){if(!(u.end>v||u.nextStart))return;L.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=v+.05}if(i.initSegment&&!i.initSegment.data)b=i.initSegment;else if(d<=v){if(b=g[0],null!==this.videoTrackCC&&b.cc!==this.videoTrackCC&&(U=g,N=this.videoTrackCC,b=X.search(U,function(e){return e.cc<N?1:e.cc>N?-1:0})),i.live&&b.loadIdx&&b.loadIdx===this.fragLoadIdx){var T=u.nextStart?u.nextStart:v;return L.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(T+.05)),void(this.media.currentTime=T+.05)}}else{var S=void 0,E=n.maxFragLookUpTolerance,k=h?g[h.sn-g[0].sn+1]:void 0,C=function(e){var t=Math.min(E,e.duration);return e.start+e.duration-t<=d?1:e.start-t>d&&e.start?-1:0};d<_?(d>_-E&&(E=0),S=k&&!C(k)?k:X.search(g,C)):S=g[y-1],S&&(b=S,v=S.start,h&&b.level===h.level&&b.sn===h.sn&&(b.sn<i.endSN?(b=g[b.sn+1-i.startSN],L.b.log("SN just loaded, load next one: "+b.sn)):b=null))}if(b)if(b.decryptdata&&null!=b.decryptdata.uri&&null==b.decryptdata.key)L.b.log("Loading key for "+b.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+m),this.state=Ue.KEY_LOADING,r.trigger(w.a.KEY_LOADING,{frag:b});else{if(L.b.log("Loading "+b.sn+", cc: "+b.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+m+", currentTime:"+e+",bufferEnd:"+d.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,b.loadCounter){b.loadCounter++;var R=n.fragLoadingLoopThreshold;if(b.loadCounter>R&&Math.abs(this.fragLoadIdx-b.loadIdx)<R)return void r.trigger(w.a.ERROR,{type:A.b.MEDIA_ERROR,details:A.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:b})}else b.loadCounter=1;b.loadIdx=this.fragLoadIdx,this.fragCurrent=b,this.startFragRequested=!0,isNaN(b.sn)||(this.nextLoadPosition=b.start+b.duration),r.trigger(w.a.FRAG_LOADING,{frag:b}),this.state=Ue.FRAG_LOADING}}break;case Ue.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=Ue.IDLE);break;case Ue.FRAG_LOADING_WAITING_RETRY:var O=performance.now(),D=this.retryDate,I=(s=this.media)&&s.seeking;(!D||O>=D||I)&&(L.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Ue.IDLE);break;case Ue.WAITING_INIT_PTS:var P=this.videoTrackCC;if(void 0===this.initPTS[P])break;var x=this.waitingFragment;if(x){var M=x.frag.cc;P!==M?(t=this.tracks[this.trackId]).details&&t.details.live&&(L.b.warn("Waiting fragment CC ("+M+") does not match video track CC ("+P+")"),this.waitingFragment=null,this.state=Ue.IDLE):(this.state=Ue.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Ue.IDLE;break;case Ue.STOPPED:case Ue.FRAG_LOADING:case Ue.PARSING:case Ue.PARSED:case Ue.ENDED:}var U,N},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(L.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){this.state===Ue.ENDED&&(this.state=Ue.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.prototype.onAudioTracksUpdated=function(e){L.b.log("audio tracks updated"),this.tracks=e.audioTracks},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=Ue.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=Ue.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},t.prototype.onAudioTrackLoaded=function(e){var t=e.details,i=e.id,r=this.tracks[i],n=t.totalduration,a=0;if(L.b.log("track "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+n),t.live){var s=r.details;s&&t.fragments.length>0?(c(s,t),a=t.fragments[0].start,t.PTSKnown?L.b.log("live audio playlist sliding:"+a.toFixed(3)):L.b.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,L.b.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;isNaN(o)?this.startPosition=0:(L.b.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===Ue.WAITING_TRACK&&(this.state=Ue.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===Ue.KEY_LOADING&&(this.state=Ue.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===Ue.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var r=this.tracks[this.trackId],n=r.details,a=n.totalduration,s=t.level,o=t.sn,u=t.cc,l=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",c=this.stats=e.stats;if("initSegment"===o)this.state=Ue.IDLE,c.tparsed=c.tbuffered=performance.now(),n.initSegment.data=e.payload,this.hls.trigger(w.a.FRAG_BUFFERED,{stats:c,frag:t,id:"audio"}),this.tick();else{this.state=Ue.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new re(this.hls,"audio"));var d=this.initPTS[u],h=n.initSegment?n.initSegment.data:[];n.initSegment||void 0!==d?(this.pendingBuffering=!0,L.b.log("Demuxing "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+s),this.demuxer.push(e.payload,h,l,null,t,a,!1,d)):(L.b.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+s),this.waitingFragment=e,this.state=Ue.WAITING_INIT_PTS)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Ue.PARSING){var r=e.tracks,n=void 0;if(r.video&&delete r.video,n=r.audio){n.levelCodec=n.codec,n.id=e.id,this.hls.trigger(w.a.BUFFER_CODECS,r),L.b.log("audio track:audio,container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var a=n.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(w.a.BUFFER_APPENDING,s))}this.tick()}}},t.prototype.onFragParsingData=function(e){var t=this,i=this.fragCurrent,r=e.frag;if(i&&"audio"===e.id&&"audio"===e.type&&r.sn===i.sn&&r.level===i.level&&this.state===Ue.PARSING){var n=this.trackId,a=this.tracks[n],s=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),L.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),l(a.details,i,e.startPTS,e.endPTS);var o=this.audioSwitch,u=this.media,c=!1;if(o&&u)if(u.readyState){var d=u.currentTime;L.b.log("switching audio track : currentTime:"+d),d>=e.startPTS&&(L.b.log("switching audio track : flushing all audio"),this.state=Ue.BUFFER_FLUSHING,s.trigger(w.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),c=!0,this.audioSwitch=!1,s.trigger(w.a.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,s.trigger(w.a.AUDIO_TRACK_SWITCHED,{id:n});var h=this.pendingData;this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&h.push({type:e.type,data:t,parent:"audio",content:"data"})}),!c&&h.length&&(h.forEach(function(e){t.state===Ue.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(w.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Ue.PARSING&&(this.stats.tparsed=performance.now(),this.state=Ue.PARSED,this._checkAppendedParsed())},t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==Ue.PARSING&&t!==Ue.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==Ue.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),i.trigger(w.a.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;L.b.log("audio buffered : "+ne.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(w.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ue.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case A.a.FRAG_LOAD_ERROR:case A.a.FRAG_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var r=this.config;if(i<=r.fragLoadingMaxRetry){this.fragLoadError=i,t.loadCounter=0;var n=Math.min(Math.pow(2,i-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);L.b.warn("audioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=performance.now()+n,this.state=Ue.FRAG_LOADING_WAITING_RETRY}else L.b.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ue.ERROR}break;case A.a.FRAG_LOOP_LOADING_ERROR:case A.a.AUDIO_TRACK_LOAD_ERROR:case A.a.AUDIO_TRACK_LOAD_TIMEOUT:case A.a.KEY_LOAD_ERROR:case A.a.KEY_LOAD_TIMEOUT:this.state!==Ue.ERROR&&(this.state=e.fatal?Ue.ERROR:Ue.IDLE,L.b.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case A.a.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===Ue.PARSING||this.state===Ue.PARSED)){var a=this.mediaBuffer,s=this.media.currentTime;if(a&&Y.isBuffered(a,s)&&Y.isBuffered(a,s+.5)){var o=this.config;o.maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,L.b.warn("audio:reduce max buffer length to "+o.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*o.fragLoadingLoopThreshold),this.state=Ue.IDLE}else L.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ue.BUFFER_FLUSHING,this.hls.trigger(w.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},t.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(L.b.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(w.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=Ue.PARSED):(this.state=Ue.IDLE,this.fragPrevious=null,this.tick())},Me(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,L.b.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(O),Be=Ne,Fe=function(){function e(e){return"string"==typeof e&&!!a[e.toLowerCase()]&&e.toLowerCase()}function t(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)e[r]=i[r]}return e}function i(i,a,s){var o=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};u?o=document.createElement("custom"):l.enumerable=!0,o.hasBeenReset=!1;var c="",d=!1,h=i,f=a,p=s,m=null,g="",y=!0,v="auto",_="start",b=50,T="middle",S=50,E="middle";if(Object.defineProperty(o,"id",t({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",t({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",t({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",t({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",t({},l,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",t({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",t({},l,{get:function(){return g},set:function(e){var t,i=(t=e,"string"==typeof t&&!!n[t.toLowerCase()]&&t.toLowerCase());if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",t({},l,{get:function(){return y},set:function(e){y=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",t({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&e!==r)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",t({},l,{get:function(){return _},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");_=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",t({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",t({},l,{get:function(){return T},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");T=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",t({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",t({},l,{get:function(){return E},set:function(t){var i=e(t);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");E=i,this.hasBeenReset=!0}})),o.displayState=void 0,u)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var r="auto",n={"":!0,lr:!0,rl:!0},a={start:!0,middle:!0,end:!0,left:!0,right:!0};return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),je=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};p.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var Ge=new Fe(0,0,0),Ve="middle"===Ge.align?"middle":"center";f.prototype={parse:function(e){function t(){var e=i.buffer,t=0;for(e=y(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),r}var i=this;e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var n=(r=t()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var a=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:r=t(),i.state){case"HEADER":/:/.test(r)?m(r,function(e,t){switch(e){case"Region":console.log("parse region",t)}},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new Fe(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":try{g(r,i.cue,i.regionList)}catch(e){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID");continue}}}catch(e){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var He=f,ze={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},We=function(e){var t=e;return ze.hasOwnProperty(e)&&(t=ze[e]),String.fromCharCode(t)},qe=15,Ke=100,Xe={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ye={17:2,18:4,21:6,22:8,23:10,19:13,20:15},$e={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Qe={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Je=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Ze={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var i=this.verboseFilter[e];this.verboseLevel>=i&&console.log(this.time+" ["+e+"] "+t)}},et=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},tt=function(){function e(t,i,r,n,a){_(this,e),this.foreground=t||"white",this.underline=i||!1,this.italics=r||!1,this.background=n||"black",this.flash=a||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),it=function(){function e(t,i,r,n,a,s){_(this,e),this.uchar=t||" ",this.penState=new tt(i,r,n,a,s)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),rt=function(){function e(){_(this,e),this.chars=[];for(var t=0;t<Ke;t++)this.chars.push(new it);this.pos=0,this.currPenState=new tt}return e.prototype.equals=function(e){for(var t=!0,i=0;i<Ke;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<Ke;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<Ke;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(Ze.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>Ke&&(Ze.log("ERROR","Too large cursor position "+this.pos),this.pos=Ke)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=We(e);this.pos>=Ke?Ze.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t;for(t=e;t<Ke;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,i=0;i<Ke;i++){var r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),nt=function(){function e(){_(this,e),this.rows=[];for(var t=0;t<qe;t++)this.rows.push(new rt);this.currRow=qe-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<qe;e++)this.rows[e].clear();this.currRow=qe-1},e.prototype.equals=function(e){for(var t=!0,i=0;i<qe;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<qe;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<qe;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){Ze.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){Ze.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<qe;i++)this.rows[i].clear();var r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[r].cueStartTime;if(a&&a<Ze.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[r+s])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,l=Math.max(u-1,0);o.setCursor(e.indent),e.color=o.chars[l].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)},e.prototype.setBkgData=function(e){Ze.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null!==this.nrRollUpRows){Ze.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),Ze.log("INFO","Rolling up")}else Ze.log("DEBUG","roll_up but nrRollUpRows not set yet")},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],i="",r=-1,n=0;n<qe;n++){var a=this.rows[n].getTextString();a&&(r=n+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),at=function(){function e(t,i){_(this,e),this.chNr=t,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new nt,this.nonDisplayedMemory=new nt,this.lastOutputScreen=new nt,this.currRollUpRow=this.displayedMemory.rows[qe-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[qe-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,Ze.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Ze.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(Ze.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){Ze.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){Ze.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){Ze.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){Ze.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){Ze.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){Ze.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){Ze.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){Ze.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){Ze.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){Ze.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){Ze.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(Ze.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,Ze.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){Ze.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}Ze.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Ze.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),st=function(){function e(t,i,r){_(this,e),this.field=t||1,this.outputs=[i,r],this.channels=[new at(1,i),new at(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var i,r,n,a=!1;this.lastTime=e,Ze.setTime(e);for(var s=0;s<t.length;s+=2)if(r=127&t[s],n=127&t[s+1],0!==r||0!==n){if(Ze.log("DATA","["+et([t[s],t[s+1]])+"] -> ("+et([r,n])+")"),(i=this.parseCmd(r,n))||(i=this.parseMidrow(r,n)),i||(i=this.parsePAC(r,n)),i||(i=this.parseBackgroundAttributes(r,n)),!i&&(a=this.parseChars(r,n)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(a)}else Ze.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,Ze.log("WARNING","Couldn't parse cleaned data "+et([r,n])+" orig: "+et([t[s],t[s+1]])))}else this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var i=null,r=(20===e||28===e)&&32<=t&&t<=47,n=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,Ze.log("DEBUG","Repeated command ("+et([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var a=this.channels[i-1];return 20===e||28===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.parseMidrow=function(e,t){var i=null;return(17===e||25===e)&&32<=t&&t<=47&&((i=17===e?1:2)!==this.currChNr?(Ze.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),Ze.log("DEBUG","MIDROW ("+et([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var i=null,r=null,n=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,a=(16===e||24===e)&&64<=t&&t<=95;if(!n&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=e<=23?1:2,r=64<=t&&t<=95?1===i?Xe[e]:$e[e]:1===i?Ye[e]:Qe[e];var s=this.interpretPAC(r,t);return this.channels[i-1].setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.interpretPAC=function(e,t){var i=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,r.underline=1==(1&i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r},e.prototype.parseChars=function(e,t){var i=null,r=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),17<=n&&n<=19){var a=t;a=17===n?t+80:18===n?t+112:t+144,Ze.log("INFO","Special char '"+We(a)+"' in channel "+i),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=et(r);Ze.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},e.prototype.parseBackgroundAttributes=function(e,t){var i,r,n,a,s=(16===e||24===e)&&32<=t&&t<=47,o=(23===e||31===e)&&45<=t&&t<=47;return!(!s&&!o||(i={},16===e||24===e?(r=Math.floor((t-32)/2),i.background=Je[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),n=e<24?1:2,a=this.channels[n-1],a.setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,0))},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),ot=st,ut=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.timelineController=t,this.track=i,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.track)},e}(),lt=ut,ct=function(e,t,i){return e.substr(i||0,t.length)===t},dt=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},ht={parse:function(e,t,i,r,n,a){var s=Object(he.b)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),o="00:00.000",u=0,l=0,c=0,d=[],h=void 0,f=!0,p=new He;p.oncue=function(e){var t=i[r],n=i.ccOffset;t&&t.new&&(void 0!==l?n=i.ccOffset=t.start:function(e,t,i){var r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;n&&n.new;)e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC];e.presentationOffset=i}(i,r,c)),c&&(n=c+i.ccOffset-i.presentationOffset),e.startTime+=n-l,e.endTime+=n-l,e.id=dt(e.startTime.toString())+dt(e.endTime.toString())+dt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&d.push(e)},p.onparsingerror=function(e){h=e},p.onflush=function(){h&&a?a(h):n(d)},s.forEach(function(e){if(f){if(ct(e,"X-TIMESTAMP-MAP=")){f=!1,e.substr(16).split(",").forEach(function(e){ct(e,"LOCAL:")?o=e.substr(6):ct(e,"MPEGTS:")&&(u=parseInt(e.substr(7)))});try{u-=t=t<0?t+8589934592:t,l=function(e){var t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),n=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return isNaN(t)||isNaN(i)||isNaN(r)||isNaN(n)?-1:(t+=1e3*i,t+=6e4*r,t+=36e5*n)}(o)/1e3,c=u/9e4,-1===l&&(h=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){h=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(f=!1)}p.parse(e+"\n")}),p.flush()}},ft=ht,pt=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHING,w.a.MEDIA_DETACHING,w.a.FRAG_PARSING_USERDATA,w.a.FRAG_DECRYPTED,w.a.MANIFEST_LOADING,w.a.MANIFEST_LOADED,w.a.FRAG_LOADED,w.a.LEVEL_SWITCHING,w.a.INIT_PTS_FOUND));if(r.hls=i,r.config=i.config,r.enabled=!0,r.Cues=i.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions){var n=new lt(r,1),a=new lt(r,2);r.cea608Parser=new ot(0,n,a)}return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addCues=function(e,t,i,r){for(var n=this.cueRanges,a=!1,s=n.length;s--;){var o=n[s],u=(l=o[0],c=o[1],d=t,h=i,Math.min(c,h)-Math.max(l,d));if(u>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],i),a=!0,u/(i-t)>.5))return}var l,c,d,h;a||n.push([t,i]),this.Cues.newCue(this[e],t,i,r)},t.prototype.onInitPtsFound=function(e){var t=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},t.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var r=t.textTracks[i],n="textTrack"+e;if(!0===r[n])return r}return null},t.prototype.sendAddTrackEvent=function(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)},t.prototype.createCaptionsTrack=function(e){var t="textTrack"+e;if(!this[t]){var i=this.getExistingTrack(e);if(i)this[t]=i,b(this[t]),this.sendAddTrackEvent(this[t],this.media);else{var r=this.createTextTrack("captions",this.config["captionsTextTrack"+e+"Label"],this.config.captionsTextTrack1LanguageCode);r&&(r[t]=!0,this[t]=r)}}},t.prototype.createTextTrack=function(e,t,i){var r=this.media;if(r)return r.addTextTrack(e,t,i)},t.prototype.destroy=function(){O.prototype.destroy.call(this)},t.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.prototype.onMediaDetaching=function(){b(this.textTrack1),b(this.textTrack2)},t.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},t.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)b(t[i])}},t.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,r){var n=void 0;if(r<i.length){var a=i[r];o=e,(s=a)&&s.label===o.name&&!s.textTrack1&&!s.textTrack2&&(n=a)}var s,o;n||(n=t.createTextTrack("subtitles",e.name,e.lang)),n.mode=e.default?"showing":"hidden",t.textTracks.push(n)})}},t.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},t.prototype.onFragLoaded=function(e){var t=e.frag,i=e.payload;if("main"===t.type){var r=t.sn;if(r!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=r}else if("subtitle"===t.type)if(i.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);var a=t.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(t,i)}else this.hls.trigger(w.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t.prototype._parseVTTs=function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var r=this.textTracks,n=this.hls;ft.parse(t,this.initPTS,i,e.cc,function(t){var i=r[e.trackId];t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(r){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}),n.trigger(w.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){L.b.log("Failed to parse VTT cue: "+t),n.trigger(w.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},t.prototype.onFragDecrypted=function(e){var t=e.payload,i=e.frag;if("subtitle"===i.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(i,t)}},t.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}},t.prototype.extractCea608Data=function(e){for(var t,i,r,n,a,s=31&e[0],o=2,u=[],l=0;l<s;l++)t=e[o++],i=127&e[o++],r=127&e[o++],n=0!=(4&t),a=3&t,0===i&&0===r||n&&0===a&&(u.push(i),u.push(r));return u},t}(O),mt=pt,gt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),yt=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHED,w.a.MEDIA_DETACHING,w.a.MANIFEST_LOADING,w.a.MANIFEST_LOADED,w.a.SUBTITLE_TRACK_LOADED));return r.tracks=[],r.trackId=-1,r.media=void 0,r.subtitleDisplay=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=T(this.media.textTracks),i=0;i<t.length;i++)"showing"===t[i].mode&&(e=i);this.subtitleTrack=e}},t.prototype.destroy=function(){O.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.trackId=-1,this.hls.trigger(w.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var e=this.trackId,t=this.tracks[e];if(t){var i=t.details;void 0!==i&&!0!==i.live||(L.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(w.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(L.b.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},t.prototype.setSubtitleTrackInternal=function(e){if(!(e<-1||e>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var t=T(this.media.textTracks);if(-1!==this.trackId&&this.subtitleDisplay&&(t[this.trackId].mode="hidden"),this.trackId=e,L.b.log("switching to subtitle track "+e),this.hls.trigger(w.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e){var i=this.tracks[e];this.subtitleDisplay&&(t[e].mode="showing");var r=i.details;void 0!==r&&!0!==r.live||(L.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(w.a.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))}}},gt(t,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&this.setSubtitleTrackInternal(e)}}]),t}(O),vt=yt,_t=i(4),bt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Tt=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,w.a.MEDIA_ATTACHED,w.a.ERROR,w.a.KEY_LOADED,w.a.FRAG_LOADED,w.a.SUBTITLE_TRACKS_UPDATED,w.a.SUBTITLE_TRACK_SWITCH,w.a.SUBTITLE_TRACK_LOADED,w.a.SUBTITLE_FRAG_PROCESSED));return r.config=i.config,r.vttFragSNsProcessed={},r.vttFragQueues=void 0,r.currentlyProcessing=null,r.state=bt.STOPPED,r.currentTrackId=-1,r.ticks=0,r.decrypter=new _t.a(i.observer,i.config),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){O.prototype.destroy.call(this),this.state=bt.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(w.a.FRAG_LOADING,{frag:e}),this.state=bt.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=bt.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=bt.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.tick=function(){var e=this;1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(function(){e.tick()},1),this.ticks=0)},t.prototype.doTick=function(){var e=this;switch(this.state){case bt.IDLE:var t=this.tracks,i=this.currentTrackId,r=this.vttFragSNsProcessed[i],n=this.vttFragQueues[i],a=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!t)break;var s;if(i<t.length&&(s=t[i].details),void 0===s)break;s.fragments.forEach(function(t){o=t,r.indexOf(o.sn)>-1||t.sn===a||(s=t,n.some(function(e){return e.sn===s.sn}))||(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key?(L.b.log("Loading key for "+t.sn),e.state=bt.KEY_LOADING,e.hls.trigger(w.a.KEY_LOADING,{frag:t})):(t.trackId=i,n.push(t),e.nextFrag()));var s,o})}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;L.b.log("subtitle tracks updated"),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,this.clearVttFragQueues()},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===bt.KEY_LOADING&&(this.state=bt.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag.decryptdata,r=e.frag,n=this.hls;if(this.state===bt.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){var a;try{a=performance.now()}catch(e){a=Date.now()}this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t;try{t=performance.now()}catch(e){t=Date.now()}n.trigger(w.a.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})})}},t}(O),St=Tt,Et={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:De,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Te,bufferController:ke,capLevelController:Le,fpsController:Re,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Et.subtitleStreamController=St,Et.subtitleTrackController=vt,Et.timelineController=mt,Et.cueHandler=S,Et.enableCEA708Captions=!0,Et.enableWebVTT=!0,Et.captionsTextTrack1Label="English",Et.captionsTextTrack1LanguageCode="en",Et.captionsTextTrack2Label="Spanish",Et.captionsTextTrack2LanguageCode="es",Et.audioStreamController=Be,Et.audioTrackController=xe;var kt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),wt=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=e.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in r)n in i||(i[n]=r[n]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(L.a)(i.debug),this.config=i,this._autoLevelCapping=-1;var a=this.observer=new J.a;a.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(i))},a.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(i))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a);var s=this.abrController=new i.abrController(this),o=new i.bufferController(this),u=new i.capLevelController(this),l=new i.fpsController(this),c=new H(this),d=new W(this),h=new K(this),f=new pe(this),p=this.levelController=new de(this),m=this.streamController=new ue(this),g=[p,m],y=i.audioStreamController;y&&g.push(new y(this)),this.networkControllers=g;var v=[c,d,h,s,o,u,l,f];if(y=i.audioTrackController){var _=new y(this);this.audioTrackController=_,v.push(_)}if(y=i.subtitleTrackController){var b=new y(this);this.subtitleTrackController=b,v.push(b)}[i.subtitleStreamController,i.timelineController].forEach(function(e){e&&v.push(new e(t))}),this.coreComponents=v}return e.isSupported=function(){return function(){var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r}()},kt(e,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return w.a}},{key:"ErrorTypes",get:function(){return A.b}},{key:"ErrorDetails",get:function(){return A.a}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:Et},set:function(t){e.defaultConfig=t}}]),e.prototype.destroy=function(){L.b.log("destroy"),this.trigger(w.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(e){L.b.log("attachMedia"),this.media=e,this.trigger(w.a.MEDIA_ATTACHING,{media:e})},e.prototype.detachMedia=function(){L.b.log("detachMedia"),this.trigger(w.a.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(e){e=k.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),L.b.log("loadSource:"+e),this.url=e,this.trigger(w.a.MANIFEST_LOADING,{url:e})},e.prototype.startLoad=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;L.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},e.prototype.stopLoad=function(){L.b.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.prototype.swapAudioCodec=function(){L.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){L.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},kt(e,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){L.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.b.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){L.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0,r=0;r<i;r++)if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),e}();t.default=wt},function(e,t,i){function r(e){var t=[],i=e.toString(),r=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!r)return t;for(var n,a=r[1],s=new RegExp("(\\\\n|\\W)"+(o=a,(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&"))+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");n=s.exec(i);)t.push(n[3]);var o;return t}e.exports=function(e,t){t=t||{};var n=i.m,a=t.all?Object.keys(n):function(e,t){for(var i=[t],n=[],a={};i.length;){var s=i.pop();if(!a[s]&&e[s]){a[s]=!0,n.push(s);var o=r(e[s]);i=i.concat(o)}}return n}(n,e),s="("+function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e};var r=t(t.s=ENTRY_MODULE);return r.default||r}.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.map(function(e){return JSON.stringify(e)+": "+n[e].toString()}).join(",")+"})(self);",o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var u=window.URL||window.webkitURL||window.mozURL||window.msURL,l=u.createObjectURL(o),c=new window.Worker(l);return c.objectURL=l,c}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(7),n=i(1),a=i(0),s=i(5),o=i.n(s);t.default=function(e){var t=new o.a;t.trigger=function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(r))};var i=function(t,i){e.postMessage({event:t,data:i})};e.addEventListener("message",function(n){var s=n.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.demuxer=new r.a(t,s.typeSupported,o,s.vendor);try{Object(a.a)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}}),t.on(n.a.FRAG_DECRYPTED,i),t.on(n.a.FRAG_PARSING_INIT_SEGMENT,i),t.on(n.a.FRAG_PARSED,i),t.on(n.a.ERROR,i),t.on(n.a.FRAG_PARSING_METADATA,i),t.on(n.a.FRAG_PARSING_USERDATA,i),t.on(n.a.INIT_PTS_FOUND,i),t.on(n.a.FRAG_PARSING_DATA,function(t,i){var r=[],n={event:t,data:i};i.data1&&(n.data1=i.data1.buffer,r.push(i.data1.buffer),delete i.data1),i.data2&&(n.data2=i.data2.buffer,r.push(i.data2.buffer),delete i.data2),e.postMessage(n,r)})}}]).default},function(t,i){t.exports=e},function(e,t,i){"use strict";var r=i(0);window.Hls||(window.Hls=r);var n=/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i,a=/\.m3u8/i,s={canHandleSource:function(e){return e.skipContribHlsJs?"":n.test(e.type)?"probably":a.test(e.src)?"maybe":""},handleSource:function(e,t){return new function(e,t){function i(){var e=null,t=null;return function(){var i=Date.now();!e||i-e>2e3?(e=i,o.recoverMediaError()):!t||i-t>2e3?(t=i,o.swapAudioCodec(),o.recoverMediaError()):console.error("Error loading media: File could not be played")}}var n=t.options_,a=t.el(),s=null,o=this.hls=new r(n.hlsjsConfig),u=i(),l=i();a.addEventListener("error",function(e){var t=e.currentTarget.error;t.code===t.MEDIA_ERR_DECODE?l():console.error("Error loading media: File could not be played")}),this.dispose=function(){o.destroy()},this.duration=function(){return s||a.duration||0},o.on(r.Events.LEVEL_LOADED,function(e,t){s=t.details.live?1/0:t.details.totalduration}),o.on(r.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case r.ErrorTypes.NETWORK_ERROR:o.startLoad();break;case r.ErrorTypes.MEDIA_ERROR:u();break;default:console.error("Error loading media: File could not be played")}}),Object.keys(r.Events).forEach(function(e){var i=r.Events[e];o.on(i,function(e,r){t.trigger(i,r)})}),t.featuresNativeTextTracks||(Object.defineProperty(a,"textTracks",{value:t.textTracks,writable:!1}),a.addTextTrack=function(){return t.addTextTrack.apply(t,arguments)}),o.attachMedia(a),o.loadSource(e.src)}(e,t)},canPlayType:function(e){return n.test(e)?"probably":""}};if(r.isSupported()){var o=i(1);if(o=o&&o.default||o){var u=o.getTech&&o.getTech("Html5");(u=u||o.getComponent&&o.getComponent("Html5"))&&u.registerSourceHandler(s,0)}else console.warn("videojs-contrib-hls.js: Couldn't find find window.videojs nor require('video.js')")}}])}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).videojsFlvjs=e()}}(function(){return function e(t,i,r){function n(s,o){if(!i[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return n(i||e)},c,c.exports,e,t,i,r)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){(function(e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,a=(t=n,t&&t.__esModule?t:{default:t});var s=a.default.getTech("Html5"),o=a.default.mergeOptions||a.default.util.mergeOptions,u={mediaDataSource:{},config:{}},l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s);function t(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=o(u,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i))}return r(t,[{key:"setSrc",value:function(e){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy());var t=this.options_.mediaDataSource,i=this.options_.config;t.type=void 0===t.type?"flv":t.type,t.url=e,this.flvPlayer=window.flvjs.createPlayer(t,i),this.flvPlayer.attachMediaElement(this.el_),this.flvPlayer.load()}},{key:"dispose",value:function(){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy()),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]),t}();l.isSupported=function(){return window.flvjs&&window.flvjs.isSupported()},l.formats={"video/flv":"FLV","video/x-flv":"FLV"},l.canPlayType=function(e){return l.isSupported()&&e in l.formats?"maybe":""},l.canPlaySource=function(e,t){return l.canPlayType(e.type)},l.VERSION="0.2.0",a.default.registerTech("Flvjs",l),i.default=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}),function(){"use strict";var e=null;e=void 0===window.videojs&&"function"==typeof require?require("video.js"):window.videojs,function(e,t){var i,r={},n={},a={};function s(e,t,i,r){return n={label:i,sources:t},"function"==typeof r?r(e,t,i):e.src(t.map(function(e){return{src:e.src,type:e.type,res:e.res}}))}var o=t.getComponent("MenuItem"),u=t.extend(o,{constructor:function(e,t,i,r){this.onClickListener=i,this.label=r,o.call(this,e,t),this.src=t.src,this.on("click",this.onClick),this.on("touchstart",this.onClick),t.initialySelected&&(this.showAsLabel(),this.selected(!0),this.addClass("vjs-selected"))},showAsLabel:function(){this.label&&(this.label.innerHTML=this.options_.label)},onClick:function(e){this.onClickListener(this);var t=this.player_.currentTime(),i=this.player_.paused();this.showAsLabel(),this.addClass("vjs-selected"),i||this.player_.bigPlayButton.hide(),"function"!=typeof e&&"function"==typeof this.options_.customSourcePicker&&(e=this.options_.customSourcePicker);var r="loadeddata";"Youtube"!==this.player_.techName_&&"none"===this.player_.preload()&&"Flash"!==this.player_.techName_&&(r="timeupdate"),s(this.player_,this.src,this.options_.label,e),this.player_.one(r,function(){this.player_.currentTime(t),this.player_.handleTechSeeked_(),this.player_.trigger("resolutionchange")})}}),l=t.getComponent("MenuButton"),c=t.extend(l,{constructor:function(e,i,r,n){if(this.sources=i.sources,this.label=n,this.label.innerHTML=i.initialySelectedLabel,l.call(this,e,i,r),this.controlText("Quality"),r.dynamicLabel)this.el().appendChild(n);else{var a=document.createElement("span");t.dom.addClass(a,"vjs-resolution-button-staticlabel"),this.el().appendChild(a)}},createItems:function(){var e=[],t=this.sources&&this.sources.label||{},i=function(t){e.map(function(e){e.selected(e===t),e.removeClass("vjs-selected")})};for(var r in t)t.hasOwnProperty(r)&&(e.push(new u(this.player_,{label:r,src:t[r],initialySelected:r===this.options_.initialySelectedLabel,customSourcePicker:this.options_.customSourcePicker},i,this.label)),a[r]=e[e.length-1]);return e}});i=function(e){var i=t.mergeOptions(r,e),o=this,u=document.createElement("span"),l={};t.dom.addClass(u,"vjs-resolution-button-label"),o.updateSrc=function(e){if(!e)return o.src();o.controlBar.resolutionSwitcher&&(o.controlBar.resolutionSwitcher.dispose(),delete o.controlBar.resolutionSwitcher),e=e.sort(d);var r=function(e,t){var r=i.default,n="";"high"===r?(r=t[0].res,n=t[0].label):"low"!==r&&null!=r&&e.res[r]?e.res[r]&&(n=e.res[r][0].label):(r=t[t.length-1].res,n=t[t.length-1].label);return{res:r,label:n,sources:e.res[r]}}(l=h(e),e),n=new c(o,{sources:l,initialySelectedLabel:r.label,initialySelectedRes:r.res,customSourcePicker:i.customSourcePicker},i,u);return t.dom.addClass(n.el(),"vjs-resolution-button"),o.controlBar.resolutionSwitcher=o.controlBar.el_.insertBefore(n.el_,o.controlBar.getChild("fullscreenToggle").el_),o.controlBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)},s(o,r.sources,r.label)},o.currentResolution=function(e,t){return null==e?n:(null!=a[e]&&a[e].onClick(t),o)},o.getGroupedSrc=function(){return l};function d(e,t){return e.res&&t.res?+t.res-+e.res:0}function h(e){var t={label:{},res:{},type:{}};return e.map(function(e){f(t,"label",e),f(t,"res",e),f(t,"type",e),p(t,"label",e),p(t,"res",e),p(t,"type",e)}),t}function f(e,t,i){null==e[t][i[t]]&&(e[t][i[t]]=[])}function p(e,t,i){e[t][i[t]].push(i)}o.ready(function(){o.options_.sources.length>1&&o.updateSrc(o.options_.sources),"Youtube"===o.techName_&&((e=o).tech_.ytPlayer.setPlaybackQuality("default"),e.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",function(){e.trigger("resolutionchange")}),e.one("play",function(){var t={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"default"}},r=[];e.tech_.ytPlayer.getAvailableQualityLevels().map(function(i){r.push({src:e.src().src,type:e.src().type,label:t[i].label,res:t[i].res,_yt:t[i].yt})});var n="auto",a=0,s=((l=h(r)).label.auto,new c(e,{sources:l,initialySelectedLabel:n,initialySelectedRes:a,customSourcePicker:function(t,i,r){return e.tech_.ytPlayer.setPlaybackQuality(i[0]._yt),e}},i,u));s.el().classList.add("vjs-resolution-button"),e.controlBar.resolutionSwitcher=e.controlBar.addChild(s)}));var e})},t.registerPlugin("videoJsResolutionSwitcher",i)}(window,e)}(),function(e,t){"undefined"!=typeof window&&window.videojs?t(window.videojs):"function"==typeof define&&define.amd?define("videojs-hotkeys",["video.js"],function(e){return t(e.default||e)}):"undefined"!=typeof module&&module.exports&&(module.exports=t(require("video.js")))}(0,function(e){"use strict";"undefined"!=typeof window&&(window.videojs_hotkeys={version:"0.2.22"});(e.registerPlugin||e.plugin)("hotkeys",function(t){var i=this,r=i.el(),n=document,a={volumeStep:.1,seekStep:5,enableMute:!0,enableVolumeScroll:!0,enableFullscreen:!0,enableNumbers:!0,enableJogStyle:!1,alwaysCaptureHotkeys:!1,enableModifiersForNumbers:!0,enableInactiveFocus:!0,skipInitialFocus:!1,playPauseKey:function(e){return 32===e.which||179===e.which},rewindKey:function(e){return 37===e.which||177===e.which},forwardKey:function(e){return 39===e.which||176===e.which},volumeUpKey:function(e){return 38===e.which},volumeDownKey:function(e){return 40===e.which},muteKey:function(e){return 77===e.which},fullscreenKey:function(e){return 70===e.which},customKeys:{}},s=e.mergeOptions||e.util.mergeOptions,o=(t=s(a,t||{})).volumeStep,u=t.seekStep,l=t.enableMute,c=t.enableVolumeScroll,d=t.enableFullscreen,h=t.enableNumbers,f=t.enableJogStyle,p=t.alwaysCaptureHotkeys,m=t.enableModifiersForNumbers,g=t.enableInactiveFocus,y=t.skipInitialFocus;r.hasAttribute("tabIndex")||r.setAttribute("tabIndex","-1"),r.style.outline="none",!p&&i.autoplay()||y||i.one("play",function(){r.focus()}),g&&i.on("userinactive",function(){var e=function(){clearTimeout(t)},t=setTimeout(function(){i.off("useractive",e);var t=n.activeElement,a=r.querySelector(".vjs-control-bar");t&&t.parentElement==a&&r.focus()},10);i.one("useractive",e)}),i.on("play",function(){var e=r.querySelector(".iframeblocker");e&&""===e.style.display&&(e.style.display="block",e.style.bottom="39px")});var v=function(e){if(i.controls()){var t=n.activeElement;if((p||t==r||t==r.querySelector(".vjs-tech")||t==r.querySelector(".iframeblocker")||t==r.querySelector(".vjs-control-bar"))&&c){e=window.event||e;var a=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));e.preventDefault(),1==a?i.volume(i.volume()+o):-1==a&&i.volume(i.volume()-o)}}},_=function(e,i){return t.playPauseKey(e,i)?1:t.rewindKey(e,i)?2:t.forwardKey(e,i)?3:t.volumeUpKey(e,i)?4:t.volumeDownKey(e,i)?5:t.muteKey(e,i)?6:t.fullscreenKey(e,i)?7:void 0};function b(e){return"function"==typeof u?u(e):u}return i.on("keydown",function(e){var a,s,u=e.which,c=e.preventDefault,g=i.duration();if(i.controls()){var y=n.activeElement;if(p||y==r||y==r.querySelector(".vjs-tech")||y==r.querySelector(".vjs-control-bar")||y==r.querySelector(".iframeblocker"))switch(_(e,i)){case 1:c(),p&&e.stopPropagation(),i.paused()?i.play():i.pause();break;case 2:a=!i.paused(),c(),a&&i.pause(),(s=i.currentTime()-b(e))<=0&&(s=0),i.currentTime(s),a&&i.play();break;case 3:a=!i.paused(),c(),a&&i.pause(),(s=i.currentTime()+b(e))>=g&&(s=a?g-.001:g),i.currentTime(s),a&&i.play();break;case 5:c(),f?(s=i.currentTime()-1,i.currentTime()<=1&&(s=0),i.currentTime(s)):i.volume(i.volume()-o);break;case 4:c(),f?((s=i.currentTime()+1)>=g&&(s=g),i.currentTime(s)):i.volume(i.volume()+o);break;case 6:l&&i.muted(!i.muted());break;case 7:d&&(i.isFullscreen()?i.exitFullscreen():i.requestFullscreen());break;default:if((u>47&&u<59||u>95&&u<106)&&(m||!(e.metaKey||e.ctrlKey||e.altKey))&&h){var v=48;u>95&&(v=96);var T=u-v;c(),i.currentTime(i.duration()*T*.1)}for(var S in t.customKeys){var E=t.customKeys[S];E&&E.key&&E.handler&&E.key(e)&&(c(),E.handler(i,t,e))}}}}),i.on("dblclick",function(e){if(i.controls()){var t=e.relatedTarget||e.toElement||n.activeElement;t!=r&&t!=r.querySelector(".vjs-tech")&&t!=r.querySelector(".iframeblocker")||d&&(i.isFullscreen()?i.exitFullscreen():i.requestFullscreen())}}),i.on("mousewheel",v),i.on("DOMMouseScroll",v),this})});